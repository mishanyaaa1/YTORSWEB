# –ó–∞–ø—É—Å–∫ —Å–∞–π—Ç–∞
_Exported on 10.08.2025 at 1:38:53 GMT+2 from Cursor (1.4.3)_

---

**User**

–ó–∞–ø—É—Å–∫–∞–π —Å–∞–π—Ç 

---

**Cursor**

–ü—Ä–æ–≤–µ—Ä—è—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é —Å–∫—Ä–∏–ø—Ç–æ–≤ –∑–∞–ø—É—Å–∫–∞ –≤–æ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ –∏ –≤ –±—ç–∫–µ–Ω–¥–µ, —á—Ç–æ–±—ã –ø–æ–¥–Ω—è—Ç—å –ø—Ä–æ–µ–∫—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ, –∑–∞—Ç–µ–º –∑–∞–ø—É—â—É –Ω—É–∂–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã.

–ü—Ä–æ–≤–µ–¥—É –±—ã—Å—Ç—Ä—É—é –ø—Ä–æ–≤–µ—Ä–∫—É, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ª–∏ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –ª–æ–∫–∞–ª—å–Ω—ã–π –±—ç–∫–µ–Ω–¥ (–ø–æ–∏—Å–∫ –æ–±—Ä–∞—â–µ–Ω–∏–π –∫ API), –∑–∞—Ç–µ–º —É—Å—Ç–∞–Ω–æ–≤–ª—é –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ –∑–∞–ø—É—â—É dev-—Å–µ—Ä–≤–µ—Ä.

–°—Ç–∞–≤–ª—é –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ –ø–æ–¥–Ω–∏–º–∞—é —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ dev-—Å–µ—Ä–≤–µ—Ä Vite. –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ —É–ø–∞–¥—ë—Ç ‚Äî –∏—Å–ø—Ä–∞–≤–ª—é –Ω–∞ –º–µ—Å—Ç–µ.

–ó–∞–ø—É—Å–∫–∞—é Vite dev-—Å–µ—Ä–≤–µ—Ä –Ω–∞ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–º –ø–æ—Ä—Ç—É 5173 –≤ —Ñ–æ–Ω–µ –∏ –ø—Ä–æ–≤–µ—Ä—è—é –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã.

–ü—Ä–æ–≤–µ—Ä—è—é, —á—Ç–æ dev-—Å–µ—Ä–≤–µ—Ä Vite –ø–æ–¥–Ω—è–ª—Å—è –∏ –æ—Ç–¥–∞–µ—Ç –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –Ω–∞ `http://localhost:5173/`.

–°—Ç–∞—Ä—Ç—É—é dev-—Å–µ—Ä–≤–µ—Ä –∏ –ø—Ä–æ–≤–µ—Ä—è—é –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã –Ω–∞ 5173.

–ü—Ä–æ–≤–µ—Ä—è—é, —á—Ç–æ dev-—Å–µ—Ä–≤–µ—Ä –æ—Ç–≤–µ—á–∞–µ—Ç 200 –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ.

–ó–∞–ø—É—Å–∫–∞—é –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏ —Å–±–æ—Ä–∫—É, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –æ—à–∏–±–∫–∏ –∏ –ø–æ–Ω—è—Ç—å, –ø–æ—á–µ–º—É dev-—Å–µ—Ä–≤–µ—Ä –Ω–µ —Å—Ç–∞—Ä—Ç—É–µ—Ç.

---

**User**

–ó–∞–ø—É—Å—Ç–∏ —Å–∞–π—Ç 

---

**Cursor**

–ü—Ä–æ–≤–µ—Ä—é –Ω–∞–ª–∏—á–∏–µ `node_modules`, —É—Å—Ç–∞–Ω–æ–≤–ª—é –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ –∑–∞–ø—É—â—É dev-—Å–µ—Ä–≤–µ—Ä. –ï—Å–ª–∏ `vite` –Ω–µ –ø–æ–¥—Ç—è–Ω–µ—Ç—Å—è ‚Äî —É—Å—Ç–∞–Ω–æ–≤–ª—é –µ–≥–æ –ª–æ–∫–∞–ª—å–Ω–æ –∏ –ø–æ–≤—Ç–æ—Ä—é –∑–∞–ø—É—Å–∫.

–ü—Ä–æ–≤–µ—Ä—è—é, —É—Å—Ç–∞–Ω–æ–≤–∏–ª—Å—è –ª–∏ –ª–æ–∫–∞–ª—å–Ω—ã–π –±–∏–Ω–∞—Ä—å Vite –∏ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ `node_modules`. –ï—Å–ª–∏ –Ω–µ—Ç ‚Äî –ø–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–ª—é –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ –ø–µ—Ä–µ–∑–∞–ø—É—â—É dev-—Å–µ—Ä–≤–µ—Ä.

–°–Ω–∞—á–∞–ª–∞ —É—Å—Ç–∞–Ω–æ–≤–ª—é –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏, –∑–∞—Ç–µ–º –∑–∞–ø—É—â—É dev-—Å–µ—Ä–≤–µ—Ä –∏ –ø—Ä–æ–≤–µ—Ä—é –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –ø–æ—Ä—Ç–∞.

–°–æ–±–∏—Ä–∞—é –ø—Ä–æ–µ–∫—Ç –∏ –∑–∞–ø—É—Å–∫–∞—é —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –Ω–∞ 5173, –∑–∞—Ç–µ–º –ø—Ä–æ–≤–µ—Ä—é –æ—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞ –æ–¥–Ω–∏–º –∑–∞–ø—Ä–æ—Å–æ–º.

### –°–∞–π—Ç –∑–∞–ø—É—â–µ–Ω
- –û—Ç–∫—Ä–æ–π—Ç–µ: `http://localhost:5173/`
- –ó–∞–ø—É—Å—Ç–∏–ª —Å–µ—Ä–≤–µ—Ä –≤ —Ñ–æ–Ω–µ, —á—Ç–æ–±—ã –Ω–µ –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–±–æ—Ç—É; –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –º–æ–≥—É –∑–∞–ø—É—Å—Ç–∏—Ç—å –≤ –ø–µ—Ä–µ–¥–Ω–µ–º –ø–ª–∞–Ω–µ [[memory:3801334]].

- **–ü—Ä–æ–≤–µ—Ä–∫–∞**: –≥–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –æ—Ç–≤–µ—á–∞–µ—Ç 200 OK.

–ò—Ç–æ–≥–∏:
- –£—Å—Ç–∞–Ω–æ–≤–∏–ª –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏, —Å–æ–±—Ä–∞–ª –ø—Ä–æ–µ–∫—Ç.
- –ó–∞–ø—É—â–µ–Ω `vite preview` –Ω–∞ `5173` —Å `--host --strictPort`.
- –°–∞–π—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ `http://localhost:5173/`.

---

**User**

–ü–æ—á–µ–º—É –ø—Ä–∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–∏ –∑–∞–∫–∞–∑–∞ –º–Ω–µ –ø—Ä–∏—Ö–æ–¥–∏—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ —Ç–µ–ª–µ–≥—Ä–∞–º–º–µ, –Ω–æ –≤ –∞–¥–º–∏–Ω–∫–µ –≤ —Ä–∞–∑–¥–µ–ª–µ "–∑–∞–∫–∞–∑—ã" –∑–∞–∫–∞–∑ –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è?

---

**Cursor**

–ü—Ä–æ–≤–µ—Ä—é, –∫–∞–∫ —Å–æ–∑–¥–∞—é—Ç—Å—è –∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –∑–∞–∫–∞–∑—ã –≤–æ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ –∏ –≥–¥–µ –∞–¥–º–∏–Ω–∫–∞ –∏—Ö —á–∏—Ç–∞–µ—Ç. –ó–∞—Ç–µ–º –ø—Ä–µ–¥–ª–æ–∂—É –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ.

### –ö–æ—Ä–æ—Ç–∫–∏–π –æ—Ç–≤–µ—Ç
–ü–æ—Ç–æ–º—É —á—Ç–æ –∑–∞–∫–∞–∑—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ localStorage –±—Ä–∞—É–∑–µ—Ä–∞, –≥–¥–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ñ–æ—Ä–º–∏–ª –∑–∞–∫–∞–∑. –ê–¥–º–∏–Ω–∫–∞ —á–∏—Ç–∞–µ—Ç –∑–∞–∫–∞–∑—ã –∏–∑ —Å–≤–æ–µ–≥–æ localStorage. –ï—Å–ª–∏ –∑–∞–∫–∞–∑ –æ—Ñ–æ—Ä–º–ª–µ–Ω –Ω–∞ –¥—Ä—É–≥–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ/–±—Ä–∞—É–∑–µ—Ä–µ/–¥–æ–º–µ–Ω–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `http://192.168.0.112:5173`), –∞ –∞–¥–º–∏–Ω–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∞ –Ω–∞ `http://localhost:5173`, —Ç–æ —ç—Ç–æ —Ä–∞–∑–Ω—ã–µ origins ‚Äî –∞–¥–º–∏–Ω–∫–∞ —Ç–∞–∫–æ–π –∑–∞–∫–∞–∑ –Ω–µ —É–≤–∏–¥–∏—Ç. –í Telegram —Å–æ–æ–±—â–µ–Ω–∏–µ —É—Ö–æ–¥–∏—Ç –Ω–∞–ø—Ä—è–º—É—é —á–µ—Ä–µ–∑ API –∏ –Ω–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ö—Ä–∞–Ω–µ–Ω–∏—è –∑–∞–∫–∞–∑–æ–≤.

```46:74:src/context/OrdersContext.jsx
  // –ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–∫–∞–∑–æ–≤ –∏–∑ localStorage –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
  useEffect(() => {
    const savedOrders = localStorage.getItem('orders');
    if (savedOrders) {
      const parsedOrders = JSON.parse(savedOrders);
      setOrders(parsedOrders);
    }
  }, []);

  // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∑–∞–∫–∞–∑–æ–≤ –≤ localStorage –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏
  useEffect(() => {
    localStorage.setItem('orders', JSON.stringify(orders));
  }, [orders]);
```

```76:103:src/context/OrdersContext.jsx
  // –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –∑–∞–∫–∞–∑
  const createOrder = (orderData) => {
    const newOrder = {
      id: orderData.orderNumber,
      orderNumber: orderData.orderNumber,
      status: ORDER_STATUSES.NEW,
      customerInfo: orderData.orderForm,
      items: orderData.cartItems,
      pricing: orderData.priceCalculation,
      createdAt: new Date().toISOString(),
      updatedAt: new Date().toISOString(),
      notes: []
    };
    setOrders(prev => [newOrder, ...prev]);
    return newOrder;
  };
```

### –ß—Ç–æ –¥–µ–ª–∞—Ç—å —Å–µ–π—á–∞—Å
- –û—Ç–∫—Ä–æ–π—Ç–µ –∞–¥–º–∏–Ω–∫—É –Ω–∞ —Ç–æ–º –∂–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ –∏ –ø–æ —Ç–æ–º—É –∂–µ –∞–¥—Ä–µ—Å—É, –≥–¥–µ –æ—Ñ–æ—Ä–º–ª—è–ª—Å—è –∑–∞–∫–∞–∑ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –µ—Å–ª–∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –±—ã–ª–æ —Å —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –ø–æ `http://192.168.0.112:5173`, —Ç–æ –∏ –∞–¥–º–∏–Ω–∫—É –æ—Ç–∫—Ä–æ–π—Ç–µ —Ç–∞–º –∂–µ).
- –õ–∏–±–æ –æ—Ñ–æ—Ä–º–∏—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π –∑–∞–∫–∞–∑ –∏–∑ —Ç–æ–≥–æ –∂–µ –±—Ä–∞—É–∑–µ—Ä–∞/–æ–∫–Ω–∞, –≥–¥–µ –æ—Ç–∫—Ä—ã—Ç–∞ –∞–¥–º–∏–Ω–∫–∞.

### –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ
–ù—É–∂–Ω–æ —Ö—Ä–∞–Ω–∏—Ç—å –∑–∞–∫–∞–∑—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ (–ë–î), –∞ –Ω–µ –≤ localStorage:
- –ö–ª–∏–µ–Ω—Ç: –ø—Ä–∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–∏ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å `POST /api/orders`.
- –ê–¥–º–∏–Ω–∫–∞: –∑–∞–±–∏—Ä–∞—Ç—å `GET /api/orders`.
- –í –ø—Ä–æ–µ–∫—Ç–µ —É–∂–µ –µ—Å—Ç—å –∑–∞–≥–æ—Ç–æ–≤–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ (`server/` —Å `express`, `sqlite3`), –Ω–æ –Ω–µ—Ç –∫–æ–¥–∞ –∏ —Å–∫—Ä–∏–ø—Ç–æ–≤ –∑–∞–ø—É—Å–∫–∞.

–ì–æ—Ç–æ–≤ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å–µ—Ä–≤–µ—Ä –∑–∞–∫–∞–∑–æ–≤ (—ç–Ω–¥–ø–æ–∏–Ω—Ç—ã + SQLite) –∏ –ø–æ–¥–∫–ª—é—á–∏—Ç—å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥. –°–∫–∞–∑–∞—Ç—å ‚Äî —Å–¥–µ–ª–∞—é –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏ –ø—Ä–æ–≤–µ—Ä—é end-to-end.

- –ó–∞–ø—É—â–µ–Ω–æ: dev-—Å–µ—Ä–≤–µ—Ä –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ `http://localhost:5173/`.

```javascriptreact
  // –ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–∫–∞–∑–æ–≤ –∏–∑ localStorage –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
  useEffect(() => {
    const savedOrders = localStorage.getItem('orders');
    if (savedOrders) {
      const parsedOrders = JSON.parse(savedOrders);
      setOrders(parsedOrders);
    }
  }, []);

  // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∑–∞–∫–∞–∑–æ–≤ –≤ localStorage –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏
  useEffect(() => {
    localStorage.setItem('orders', JSON.stringify(orders));
  }, [orders]);
```

```javascriptreact
  // –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –∑–∞–∫–∞–∑
  const createOrder = (orderData) => {
    const newOrder = {
      id: orderData.orderNumber,
      orderNumber: orderData.orderNumber,
      status: ORDER_STATUSES.NEW,
      customerInfo: orderData.orderForm,
      items: orderData.cartItems,
      pricing: orderData.priceCalculation,
      createdAt: new Date().toISOString(),
      updatedAt: new Date().toISOString(),
      notes: []
    };
    setOrders(prev => [newOrder, ...prev]);
    return newOrder;
  };
```

---

**User**

–°–æ–∑–¥–∞–π –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö SQLite —Å–æ –≤—Å–µ–º–∏ —Ç–æ–≤–∞—Ä–∞–º–∏ —Å –∫–∞—Ä—Ç–∏–Ω–∫–∞–º–∏, –¥–∞–Ω–Ω—ã–º–∏ –æ –∫–ª–∏–µ–Ω—Ç–∞—Ö, –∞–∫—Ü–∏—è—Ö –∏—Ç–¥ 

---

**Cursor**

–°–¥–µ–ª–∞—é –±—ã—Å—Ç—Ä—ã–π –æ–±–∑–æ—Ä –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å—Ö–µ–º—ã –ë–î –∏ —Å–∏–¥–∏—Ä–æ–≤–∞–Ω–∏—è, –∑–∞—Ç–µ–º —Å–æ–∑–¥–∞–º —Å–µ—Ä–≤–µ—Ä —Å SQLite, –º–∏–≥—Ä–∞—Ü–∏–∏, —Å–∏–¥—ã –∏ REST API. –ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –∑–∞–ø—É—â—É —Å–µ—Ä–≤–µ—Ä –∏ –ø—Ä–æ–≤–µ—Ä—é —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã.

–°–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞–º —Å–µ—Ä–≤–µ—Ä–Ω—ã–µ —Ñ–∞–π–ª—ã (–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è SQLite, —Å–∏–¥—ã –∏ REST API), –æ–±–Ω–æ–≤–ª—é —Å–∫—Ä–∏–ø—Ç—ã –∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ –∏ –≤—ã–ø–æ–ª–Ω—é —É—Å—Ç–∞–Ω–æ–≤–∫—É –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π. –ó–∞—Ç–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É—é –ë–î –∏ –ø—Ä–æ–≤–µ—Ä—é —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã.

```javascript
/* eslint-disable */
// –ù–∞—á–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ë–î (CommonJS)

const categoryStructure = {
  '–î–≤–∏–≥–∞—Ç–µ–ª—å': ['–û—Å–Ω–æ–≤–Ω—ã–µ —É–∑–ª—ã', '–§–∏–ª—å—Ç—Ä—ã', '–ú–∞—Å–ª–∞ –∏ –∂–∏–¥–∫–æ—Å—Ç–∏', '–°–∏—Å—Ç–µ–º–∞ –æ—Ö–ª–∞–∂–¥–µ–Ω–∏—è'],
  '–¢—Ä–∞–Ω—Å–º–∏—Å—Å–∏—è': ['–ö–æ—Ä–æ–±–∫–∞ –ø–µ—Ä–µ–¥–∞—á', '–ü—Ä–∏–≤–æ–¥—ã', '–°—Ü–µ–ø–ª–µ–Ω–∏–µ', '–î–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏–∞–ª'],
  '–•–æ–¥–æ–≤–∞—è —á–∞—Å—Ç—å': ['–ì—É—Å–µ–Ω–∏—Ü—ã', '–ü–æ–¥–≤–µ—Å–∫–∞', '–ö–æ–ª–µ—Å–∞', '–¢–æ—Ä–º–æ–∑–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞'],
  '–≠–ª–µ–∫—Ç—Ä–∏–∫–∞': ['–û—Å–≤–µ—â–µ–Ω–∏–µ', '–ü—Ä–æ–≤–æ–¥–∫–∞', '–ê–∫–∫—É–º—É–ª—è—Ç–æ—Ä—ã', '–°—Ç–∞—Ä—Ç–µ—Ä—ã –∏ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä—ã'],
  '–ö–∞–±–∏–Ω–∞': ['–°–∏–¥–µ–Ω—å—è', '–ü—Ä–∏–±–æ—Ä—ã', '–û—Ç–æ–ø–ª–µ–Ω–∏–µ', '–°—Ç–µ–∫–ª–∞']
};

const initialProducts = [
  {
    id: 1,
    title: '–î–≤–∏–≥–∞—Ç–µ–ª—å 2.0L –¥–∏–∑–µ–ª—å–Ω—ã–π',
    price: 180000,
    category: '–î–≤–∏–≥–∞—Ç–µ–ª—å',
    subcategory: '–û—Å–Ω–æ–≤–Ω—ã–µ —É–∑–ª—ã',
    brand: '–¢–µ—Ö–Ω–æ–ú–æ—Ç–æ—Ä',
    available: true,
    quantity: 3,
    images: [{ id: 1, data: '‚öôÔ∏è', isMain: true }],
    description: '–î–∏–∑–µ–ª—å–Ω—ã–π –¥–≤–∏–≥–∞—Ç–µ–ª—å –º–æ—â–Ω–æ—Å—Ç—å—é 75 –ª.—Å.',
    specifications: {
      '–û–±—ä–µ–º': '2.0L',
      '–ú–æ—â–Ω–æ—Å—Ç—å': '75 –ª.—Å.',
      '–¢–∏–ø': '–î–∏–∑–µ–ª—å–Ω—ã–π',
      '–ì–∞—Ä–∞–Ω—Ç–∏—è': '12 –º–µ—Å—è—Ü–µ–≤'
    },
    features: [
      '–í—ã—Å–æ–∫–∞—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å',
      '–≠–∫–æ–Ω–æ–º–∏—á–Ω—ã–π —Ä–∞—Å—Ö–æ–¥ —Ç–æ–ø–ª–∏–≤–∞',
      '–ü—Ä–æ—Å—Ç–æ–µ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ',
      '–°–æ–≤–º–µ—Å—Ç–∏–º —Å –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ–º –≤–µ–∑–¥–µ—Ö–æ–¥–æ–≤'
    ]
  },
  {
    id: 2,
    title: '–ë–ª–æ–∫ —Ü–∏–ª–∏–Ω–¥—Ä–æ–≤',
    price: 85000,
    category: '–î–≤–∏–≥–∞—Ç–µ–ª—å',
    subcategory: '–û—Å–Ω–æ–≤–Ω—ã–µ —É–∑–ª—ã',
    brand: '–¢–µ—Ö–Ω–æ–ú–æ—Ç–æ—Ä',
    available: true,
    quantity: 5,
    images: [{ id: 1, data: 'üî©', isMain: true }],
    description: '–ë–ª–æ–∫ —Ü–∏–ª–∏–Ω–¥—Ä–æ–≤ –¥–ª—è –¥–≤–∏–≥–∞—Ç–µ–ª—è 2.0L'
  },
  {
    id: 3,
    title: '–§–∏–ª—å—Ç—Ä –≤–æ–∑–¥—É—à–Ω—ã–π',
    price: 3500,
    category: '–î–≤–∏–≥–∞—Ç–µ–ª—å',
    subcategory: '–§–∏–ª—å—Ç—Ä—ã',
    brand: '–¢–µ—Ö–Ω–æ–ú–æ—Ç–æ—Ä',
    available: true,
    quantity: 12,
    icon: 'üåÄ',
    description: '–í–æ–∑–¥—É—à–Ω—ã–π —Ñ–∏–ª—å—Ç—Ä –≤—ã—Å–æ–∫–æ–π –æ—á–∏—Å—Ç–∫–∏'
  },
  {
    id: 4,
    title: '–§–∏–ª—å—Ç—Ä —Ç–æ–ø–ª–∏–≤–Ω—ã–π',
    price: 2800,
    category: '–î–≤–∏–≥–∞—Ç–µ–ª—å',
    subcategory: '–§–∏–ª—å—Ç—Ä—ã',
    brand: 'FilterPro',
    available: true,
    quantity: 8,
    icon: '‚õΩ',
    description: '–¢–æ–ø–ª–∏–≤–Ω—ã–π —Ñ–∏–ª—å—Ç—Ä —Ç–æ–Ω–∫–æ–π –æ—á–∏—Å—Ç–∫–∏'
  },
  {
    id: 5,
    title: '–§–∏–ª—å—Ç—Ä –º–∞—Å–ª—è–Ω—ã–π',
    price: 1200,
    category: '–î–≤–∏–≥–∞—Ç–µ–ª—å',
    subcategory: '–§–∏–ª—å—Ç—Ä—ã',
    brand: 'FilterPro',
    available: true,
    quantity: 15,
    icon: 'üõ¢Ô∏è',
    description: '–ú–∞—Å–ª—è–Ω—ã–π —Ñ–∏–ª—å—Ç—Ä —Å –±–∞–π–ø–∞—Å–Ω—ã–º –∫–ª–∞–ø–∞–Ω–æ–º'
  },
  {
    id: 6,
    title: '–ú–∞—Å–ª–æ –º–æ—Ç–æ—Ä–Ω–æ–µ 10W-40',
    price: 2500,
    category: '–î–≤–∏–≥–∞—Ç–µ–ª—å',
    subcategory: '–ú–∞—Å–ª–∞ –∏ –∂–∏–¥–∫–æ—Å—Ç–∏',
    brand: 'LubeMax',
    available: true,
    quantity: 25,
    icon: 'üõ¢Ô∏è',
    description: '–ü–æ–ª—É—Å–∏–Ω—Ç–µ—Ç–∏—á–µ—Å–∫–æ–µ –º–æ—Ç–æ—Ä–Ω–æ–µ –º–∞—Å–ª–æ 5L'
  },
  {
    id: 7,
    title: '–ê–Ω—Ç–∏—Ñ—Ä–∏–∑ -40¬∞C',
    price: 1800,
    category: '–î–≤–∏–≥–∞—Ç–µ–ª—å',
    subcategory: '–°–∏—Å—Ç–µ–º–∞ –æ—Ö–ª–∞–∂–¥–µ–Ω–∏—è',
    brand: 'CoolMax',
    available: true,
    quantity: 18,
    icon: '‚ùÑÔ∏è',
    description: '–ê–Ω—Ç–∏—Ñ—Ä–∏–∑ –≥–æ—Ç–æ–≤—ã–π –∫ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—é 5L'
  },
  {
    id: 8,
    title: '–ö–æ—Ä–æ–±–∫–∞ –ø–µ—Ä–µ–¥–∞—á –º–µ—Ö–∞–Ω–∏—á–µ—Å–∫–∞—è',
    price: 95000,
    category: '–¢—Ä–∞–Ω—Å–º–∏—Å—Å–∏—è',
    subcategory: '–ö–æ—Ä–æ–±–∫–∞ –ø–µ—Ä–µ–¥–∞—á',
    brand: '–í–µ–∑–¥–µ—Ö–æ–¥-–ú–∞—Å—Ç–µ—Ä',
    available: false,
    quantity: 0,
    icon: 'üîß',
    description: '5-—Å—Ç—É–ø–µ–Ω—á–∞—Ç–∞—è –º–µ—Ö–∞–Ω–∏—á–µ—Å–∫–∞—è –ö–ü–ü'
  },
  {
    id: 9,
    title: '–†–µ–º–µ–Ω—å –ø—Ä–∏–≤–æ–¥–Ω–æ–π',
    price: 2200,
    category: '–¢—Ä–∞–Ω—Å–º–∏—Å—Å–∏—è',
    subcategory: '–ü—Ä–∏–≤–æ–¥—ã',
    brand: 'DrivePro',
    available: true,
    quantity: 6,
    icon: '‚õìÔ∏è',
    description: '–ü—Ä–∏–≤–æ–¥–Ω–æ–π —Ä–µ–º–µ–Ω—å —É—Å–∏–ª–µ–Ω–Ω—ã–π'
  },
  {
    id: 10,
    title: '–î–∏—Å–∫ —Å—Ü–µ–ø–ª–µ–Ω–∏—è',
    price: 8500,
    category: '–¢—Ä–∞–Ω—Å–º–∏—Å—Å–∏—è',
    subcategory: '–°—Ü–µ–ø–ª–µ–Ω–∏–µ',
    brand: 'ClutchMax',
    available: true,
    quantity: 4,
    icon: '‚öôÔ∏è',
    description: '–í–µ–¥–æ–º—ã–π –¥–∏—Å–∫ —Å—Ü–µ–ø–ª–µ–Ω–∏—è 240–º–º'
  },
  {
    id: 11,
    title: '–ì—É—Å–µ–Ω–∏—Ü—ã –¥–ª—è –≤–µ–∑–¥–µ—Ö–æ–¥–∞',
    price: 45000,
    category: '–•–æ–¥–æ–≤–∞—è —á–∞—Å—Ç—å',
    subcategory: '–ì—É—Å–µ–Ω–∏—Ü—ã',
    brand: '–í–µ–∑–¥–µ—Ö–æ–¥-–ú–∞—Å—Ç–µ—Ä',
    available: true,
    quantity: 2,
    images: [{ id: 1, data: 'üîó', isMain: true }],
    description: '–í—ã—Å–æ–∫–æ–∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Ä–µ–∑–∏–Ω–æ–º–µ—Ç–∞–ª–ª–∏—á–µ—Å–∫–∏–µ –≥—É—Å–µ–Ω–∏—Ü—ã –¥–ª—è –≤–µ–∑–¥–µ—Ö–æ–¥–æ–≤ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –º–∞—Ä–æ–∫.',
    specifications: {
      '–®–∏—Ä–∏–Ω–∞': '400 –º–º',
      '–î–ª–∏–Ω–∞': '2500 –º–º',
      '–ú–∞—Ç–µ—Ä–∏–∞–ª': '–†–µ–∑–∏–Ω–∞ —Å –º–µ—Ç–∞–ª–ª–æ–∫–æ—Ä–¥–æ–º',
      '–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å': '–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è',
      '–ì–∞—Ä–∞–Ω—Ç–∏—è': '12 –º–µ—Å—è—Ü–µ–≤'
    },
    features: [
      '–í—ã—Å–æ–∫–∞—è –∏–∑–Ω–æ—Å–æ—Å—Ç–æ–π–∫–æ—Å—Ç—å',
      '–û—Ç–ª–∏—á–Ω–æ–µ —Å—Ü–µ–ø–ª–µ–Ω–∏–µ –Ω–∞ —Å–Ω–µ–≥—É –∏ –≥—Ä—è–∑–∏',
      '–ü—Ä–æ—Å—Ç–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞',
      '–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ–º –≤–µ–∑–¥–µ—Ö–æ–¥–æ–≤'
    ]
  },
  {
    id: 12,
    title: '–ê–º–æ—Ä—Ç–∏–∑–∞—Ç–æ—Ä –ø–µ—Ä–µ–¥–Ω–∏–π',
    price: 12000,
    category: '–•–æ–¥–æ–≤–∞—è —á–∞—Å—Ç—å',
    subcategory: '–ü–æ–¥–≤–µ—Å–∫–∞',
    brand: '–°—É–ø–µ—Ä–¢—Ä–µ–∫',
    available: true,
    quantity: 7,
    icon: 'üõ†Ô∏è',
    description: '–ì–∞–∑–æ–º–∞—Å–ª—è–Ω—ã–π –∞–º–æ—Ä—Ç–∏–∑–∞—Ç–æ—Ä'
  },
  {
    id: 13,
    title: '–ö–æ–ª–µ—Å–æ –æ–ø–æ—Ä–Ω–æ–µ',
    price: 8500,
    category: '–•–æ–¥–æ–≤–∞—è —á–∞—Å—Ç—å',
    subcategory: '–ö–æ–ª–µ—Å–∞',
    brand: 'WheelTech',
    available: true,
    quantity: 10,
    icon: '‚öôÔ∏è',
    description: '–û–ø–æ—Ä–Ω–æ–µ –∫–æ–ª–µ—Å–æ —Å –ø–æ–¥—à–∏–ø–Ω–∏–∫–æ–º'
  },
  {
    id: 14,
    title: '–§–∞—Ä–∞ LED —Ä–∞–±–æ—á–∞—è',
    price: 5500,
    category: '–≠–ª–µ–∫—Ç—Ä–∏–∫–∞',
    subcategory: '–û—Å–≤–µ—â–µ–Ω–∏–µ',
    brand: 'LightMax',
    available: true,
    quantity: 14,
    icon: 'üí°',
    description: 'LED —Ñ–∞—Ä–∞ 48W —Å —à–∏—Ä–æ–∫–∏–º –ª—É—á–æ–º'
  },
  {
    id: 15,
    title: '–ê–∫–∫—É–º—É–ª—è—Ç–æ—Ä 12V 100Ah',
    price: 15000,
    category: '–≠–ª–µ–∫—Ç—Ä–∏–∫–∞',
    subcategory: '–ê–∫–∫—É–º—É–ª—è—Ç–æ—Ä—ã',
    brand: 'PowerMax',
    available: true,
    quantity: 6,
    icon: 'üîã',
    description: '–ì–µ–ª–µ–≤—ã–π –∞–∫–∫—É–º—É–ª—è—Ç–æ—Ä –ø–æ–≤—ã—à–µ–Ω–Ω–æ–π –µ–º–∫–æ—Å—Ç–∏'
  },
  {
    id: 16,
    title: '–ü—Ä–æ–≤–æ–¥–∫–∞ –æ—Å–Ω–æ–≤–Ω–∞—è',
    price: 3500,
    category: '–≠–ª–µ–∫—Ç—Ä–∏–∫–∞',
    subcategory: '–ü—Ä–æ–≤–æ–¥–∫–∞',
    brand: 'WirePro',
    available: true,
    quantity: 9,
    icon: 'üîå',
    description: '–ñ–≥—É—Ç –ø—Ä–æ–≤–æ–¥–æ–≤ –æ—Å–Ω–æ–≤–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã'
  },
  {
    id: 17,
    title: '–°–∏–¥–µ–Ω—å–µ –≤–æ–¥–∏—Ç–µ–ª—è',
    price: 25000,
    category: '–ö–∞–±–∏–Ω–∞',
    subcategory: '–°–∏–¥–µ–Ω—å—è',
    brand: 'ComfortSeat',
    available: true,
    quantity: 3,
    icon: 'ü™ë',
    description: '–≠—Ä–≥–æ–Ω–æ–º–∏—á–Ω–æ–µ —Å–∏–¥–µ–Ω—å–µ —Å –ø–æ–¥–æ–≥—Ä–µ–≤–æ–º'
  },
  {
    id: 18,
    title: '–ü–∞–Ω–µ–ª—å –ø—Ä–∏–±–æ—Ä–æ–≤',
    price: 18000,
    category: '–ö–∞–±–∏–Ω–∞',
    subcategory: '–ü—Ä–∏–±–æ—Ä—ã',
    brand: 'InstrumentPro',
    available: true,
    quantity: 5,
    icon: 'üìä',
    description: '–¶–∏—Ñ—Ä–æ–≤–∞—è –ø–∞–Ω–µ–ª—å –ø—Ä–∏–±–æ—Ä–æ–≤'
  }
];

const initialBrands = [
  '–í–µ–∑–¥–µ—Ö–æ–¥-–ú–∞—Å—Ç–µ—Ä', '–¢–µ—Ö–Ω–æ–ú–æ—Ç–æ—Ä', '–°—É–ø–µ—Ä–¢—Ä–µ–∫', 'DrivePro', 'FilterPro', 'LubeMax',
  'CoolMax', 'ClutchMax', 'WheelTech', 'LightMax', 'PowerMax', 'WirePro',
  'ComfortSeat', 'InstrumentPro'
];

const initialPromotions = [
  {
    id: 1,
    title: '–°–∫–∏–¥–∫–∞ –Ω–∞ –¥–≤–∏–≥–∞—Ç–µ–ª–∏',
    description: '–°–∫–∏–¥–∫–∞ 15% –Ω–∞ –≤—Å–µ –¥–≤–∏–≥–∞—Ç–µ–ª–∏ –∏ –∑–∞–ø—á–∞—Å—Ç–∏ –∫ –Ω–∏–º',
    discount: 15,
    category: '–î–≤–∏–≥–∞—Ç–µ–ª—å',
    validUntil: '2024-02-28',
    active: true,
    featured: true,
    minPurchase: 20000
  },
  {
    id: 2,
    title: '–ö–æ–º–ø–ª–µ–∫—Ç —Ñ–∏–ª—å—Ç—Ä–æ–≤',
    description: '–ü—Ä–∏ –ø–æ–∫—É–ø–∫–µ 3 —Ñ–∏–ª—å—Ç—Ä–æ–≤ - 4-–π –≤ –ø–æ–¥–∞—Ä–æ–∫',
    discount: 25,
    category: '–î–≤–∏–≥–∞—Ç–µ–ª—å',
    validUntil: '2024-03-15',
    active: true,
    featured: true,
    minPurchase: 15000
  },
  {
    id: 3,
    title: '–ú–µ–≥–∞ —Å–∫–∏–¥–∫–∞ –Ω–∞ —ç–ª–µ–∫—Ç—Ä–∏–∫—É!',
    description: '–°–∫–∏–¥–∫–∞ 20% –Ω–∞ –≤—Å–µ —ç–ª–µ–∫—Ç—Ä–∏—á–µ—Å–∫–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∏ –æ—Å–≤–µ—â–µ–Ω–∏–µ',
    discount: 20,
    category: '–≠–ª–µ–∫—Ç—Ä–∏–∫–∞',
    validUntil: '2024-04-01',
    active: true,
    featured: true,
    minPurchase: 10000
  },
  {
    id: 4,
    title: '–°–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞ –Ω–∞ –≥—É—Å–µ–Ω–∏—Ü—ã',
    description: '–¢–æ–ª—å–∫–æ –≤ —ç—Ç–æ–º –º–µ—Å—è—Ü–µ - —Å–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞ –Ω–∞ –≤—Å–µ –≤–∏–¥—ã –≥—É—Å–µ–Ω–∏—Ü',
    discount: 12,
    category: '–•–æ–¥–æ–≤–∞—è —á–∞—Å—Ç—å',
    validUntil: '2024-03-25',
    active: true,
    featured: false,
    minPurchase: 20000
  }
];

module.exports = {
  categoryStructure,
  initialProducts,
  initialBrands,
  initialPromotions
};


```

–°–æ–∑–¥–∞–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ë–î –∏ —Å–µ—Ä–≤–µ—Ä–Ω—ã–µ —Ñ–∞–π–ª—ã: –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ SQLite, –º–∏–≥—Ä–∞—Ü–∏–∏, —Å–∏–¥—ã –∏ REST API, –∑–∞—Ç–µ–º –æ–±–Ω–æ–≤–ª—é —Å–∫—Ä–∏–ø—Ç—ã –∏ —É—Å—Ç–∞–Ω–æ–≤–ª—é –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏. –ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –≤—ã–ø–æ–ª–Ω—é –º–∏–≥—Ä–∞—Ü–∏–∏ –∏ –Ω–∞–ø–æ–ª–Ω—é –ë–î –Ω–∞—á–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏.

```javascript
// SQLite –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∏ –ø—Ä–æ–º–∏—Å–∏—Ñ–∏–∫–∞—Ü–∏—è
const path = require('path');
const fs = require('fs');
const sqlite3 = require('sqlite3').verbose();

const DB_DIR = path.join(__dirname);
const DB_FILE = path.join(DB_DIR, 'db.sqlite3');

if (!fs.existsSync(DB_DIR)) {
  fs.mkdirSync(DB_DIR, { recursive: true });
}

const db = new sqlite3.Database(DB_FILE);

/**
 * –û–±–µ—Ä—Ç–∫–∏ –ø—Ä–æ–º–∏—Å–æ–≤ –ø–æ–≤–µ—Ä—Ö sqlite3
 */
function run(dbInstance, sql, params = []) {
  return new Promise((resolve, reject) => {
    dbInstance.run(sql, params, function onRun(err) {
      if (err) return reject(err);
      resolve({ lastID: this.lastID, changes: this.changes });
    });
  });
}

function get(dbInstance, sql, params = []) {
  return new Promise((resolve, reject) => {
    dbInstance.get(sql, params, (err, row) => {
      if (err) return reject(err);
      resolve(row);
    });
  });
}

function all(dbInstance, sql, params = []) {
  return new Promise((resolve, reject) => {
    dbInstance.all(sql, params, (err, rows) => {
      if (err) return reject(err);
      resolve(rows);
    });
  });
}

module.exports = {
  db,
  run,
  get,
  all,
  DB_FILE
};


```

```sql
PRAGMA foreign_keys = ON;

-- –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏
CREATE TABLE IF NOT EXISTS categories (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  name TEXT NOT NULL UNIQUE
);

CREATE TABLE IF NOT EXISTS subcategories (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  category_id INTEGER NOT NULL,
  name TEXT NOT NULL,
  UNIQUE(category_id, name),
  FOREIGN KEY (category_id) REFERENCES categories(id) ON DELETE CASCADE
);

-- –ë—Ä–µ–Ω–¥—ã
CREATE TABLE IF NOT EXISTS brands (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  name TEXT NOT NULL UNIQUE
);

-- –¢–æ–≤–∞—Ä—ã
CREATE TABLE IF NOT EXISTS products (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  title TEXT NOT NULL,
  price INTEGER NOT NULL,
  category_id INTEGER,
  subcategory_id INTEGER,
  brand_id INTEGER,
  available INTEGER NOT NULL DEFAULT 1,
  quantity INTEGER NOT NULL DEFAULT 0,
  description TEXT,
  specifications_json TEXT,
  features_json TEXT,
  created_at TEXT NOT NULL DEFAULT (datetime('now')),
  updated_at TEXT NOT NULL DEFAULT (datetime('now')),
  FOREIGN KEY (category_id) REFERENCES categories(id) ON DELETE SET NULL,
  FOREIGN KEY (subcategory_id) REFERENCES subcategories(id) ON DELETE SET NULL,
  FOREIGN KEY (brand_id) REFERENCES brands(id) ON DELETE SET NULL
);

-- –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–æ–≤ (—Ö—Ä–∞–Ω–∏–º –∫–∞–∫ —Ç–µ–∫—Å—Ç-–¥–∞–Ω–Ω—ã–µ/—ç–º–æ–¥–∑–∏ –∏–ª–∏ URL)
CREATE TABLE IF NOT EXISTS product_images (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  product_id INTEGER NOT NULL,
  image_data TEXT NOT NULL,
  is_main INTEGER NOT NULL DEFAULT 0,
  FOREIGN KEY (product_id) REFERENCES products(id) ON DELETE CASCADE
);

-- –ê–∫—Ü–∏–∏
CREATE TABLE IF NOT EXISTS promotions (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  title TEXT NOT NULL,
  description TEXT,
  discount INTEGER NOT NULL,
  category_id INTEGER,
  valid_until TEXT,
  active INTEGER NOT NULL DEFAULT 1,
  featured INTEGER NOT NULL DEFAULT 0,
  min_purchase INTEGER,
  FOREIGN KEY (category_id) REFERENCES categories(id) ON DELETE SET NULL
);

-- –ö–ª–∏–µ–Ω—Ç—ã
CREATE TABLE IF NOT EXISTS customers (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  name TEXT NOT NULL,
  phone TEXT NOT NULL,
  email TEXT,
  address TEXT
);

-- –ó–∞–∫–∞–∑—ã
CREATE TABLE IF NOT EXISTS orders (
  id TEXT PRIMARY KEY, -- –∏—Å–ø–æ–ª—å–∑—É–µ–º orderNumber –∫–∞–∫ id
  order_number TEXT NOT NULL,
  customer_id INTEGER,
  status TEXT NOT NULL DEFAULT 'new',
  pricing_json TEXT NOT NULL,
  created_at TEXT NOT NULL DEFAULT (datetime('now')),
  updated_at TEXT NOT NULL DEFAULT (datetime('now')),
  FOREIGN KEY (customer_id) REFERENCES customers(id) ON DELETE SET NULL
);

CREATE TABLE IF NOT EXISTS order_items (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  order_id TEXT NOT NULL,
  product_id INTEGER,
  title TEXT NOT NULL,
  price INTEGER NOT NULL,
  quantity INTEGER NOT NULL,
  FOREIGN KEY (order_id) REFERENCES orders(id) ON DELETE CASCADE,
  FOREIGN KEY (product_id) REFERENCES products(id) ON DELETE SET NULL
);

CREATE TABLE IF NOT EXISTS order_notes (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  order_id TEXT NOT NULL,
  text TEXT NOT NULL,
  type TEXT NOT NULL,
  timestamp TEXT NOT NULL DEFAULT (datetime('now')),
  FOREIGN KEY (order_id) REFERENCES orders(id) ON DELETE CASCADE
);


```

```javascript
/* eslint-disable */
const fs = require('fs');
const path = require('path');
const { db, run } = require('./db');

async function applySqlFile(sqlFilePath) {
  const sql = fs.readFileSync(sqlFilePath, 'utf-8');
  // –†–∞–∑–±–∏–≤–∞–µ–º –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Å—Ç–µ–π—Ç–º–µ–Ω—Ç—ã –ø–æ ';' —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π –ø—É—Å—Ç—ã—Ö
  const statements = sql
    .split(/;\s*\n/)
    .map(s => s.trim())
    .filter(Boolean);

  for (const stmt of statements) {
    await run(db, stmt);
  }
}

async function main() {
  try {
    const migrationsDir = path.join(__dirname, 'migrations');
    const files = fs.readdirSync(migrationsDir).filter(f => f.endsWith('.sql')).sort();
    for (const file of files) {
      const full = path.join(migrationsDir, file);
      console.log('Applying migration', file);
      await applySqlFile(full);
    }
    console.log('Migrations applied successfully');
    process.exit(0);
  } catch (err) {
    console.error('Migration failed:', err);
    process.exit(1);
  }
}

main();


```

```javascript
/* eslint-disable */
const { db, run, get, all } = require('../db');
const {
  categoryStructure,
  initialProducts,
  initialBrands,
  initialPromotions
} = require('./initialData');

async function ensureCategory(name) {
  const row = await get(db, 'SELECT id FROM categories WHERE name = ?', [name]);
  if (row) return row.id;
  const res = await run(db, 'INSERT INTO categories (name) VALUES (?)', [name]);
  return res.lastID;
}

async function ensureSubcategory(categoryId, name) {
  const row = await get(db, 'SELECT id FROM subcategories WHERE category_id = ? AND name = ?', [categoryId, name]);
  if (row) return row.id;
  const res = await run(db, 'INSERT INTO subcategories (category_id, name) VALUES (?, ?)', [categoryId, name]);
  return res.lastID;
}

async function ensureBrand(name) {
  const row = await get(db, 'SELECT id FROM brands WHERE name = ?', [name]);
  if (row) return row.id;
  const res = await run(db, 'INSERT INTO brands (name) VALUES (?)', [name]);
  return res.lastID;
}

async function seedCategories() {
  for (const [categoryName, subcats] of Object.entries(categoryStructure)) {
    const categoryId = await ensureCategory(categoryName);
    for (const sub of subcats) {
      await ensureSubcategory(categoryId, sub);
    }
  }
}

async function seedBrands() {
  for (const brand of initialBrands) {
    await ensureBrand(brand);
  }
}

async function seedProducts() {
  for (const p of initialProducts) {
    const categoryId = p.category ? (await ensureCategory(p.category)) : null;
    const subcategoryId = p.subcategory && categoryId ? (await ensureSubcategory(categoryId, p.subcategory)) : null;
    const brandId = p.brand ? (await ensureBrand(p.brand)) : null;

    const specJson = p.specifications ? JSON.stringify(p.specifications) : null;
    const featJson = p.features ? JSON.stringify(p.features) : null;

    const res = await run(
      db,
      `INSERT INTO products (title, price, category_id, subcategory_id, brand_id, available, quantity, description, specifications_json, features_json)
       VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)`,
      [
        p.title,
        p.price,
        categoryId,
        subcategoryId,
        brandId,
        p.available ? 1 : 0,
        p.quantity ?? 0,
        p.description ?? null,
        specJson,
        featJson
      ]
    );

    const productId = res.lastID;
    // images
    if (Array.isArray(p.images)) {
      for (const img of p.images) {
        await run(
          db,
          `INSERT INTO product_images (product_id, image_data, is_main) VALUES (?, ?, ?)`,
          [productId, img.data, img.isMain ? 1 : 0]
        );
      }
    } else if (p.icon) {
      await run(db, `INSERT INTO product_images (product_id, image_data, is_main) VALUES (?, ?, 1)`, [productId, p.icon]);
    }
  }
}

async function seedPromotions() {
  for (const promo of initialPromotions) {
    const categoryId = promo.category ? (await ensureCategory(promo.category)) : null;
    await run(
      db,
      `INSERT INTO promotions (title, description, discount, category_id, valid_until, active, featured, min_purchase)
       VALUES (?, ?, ?, ?, ?, ?, ?, ?)`,
      [
        promo.title,
        promo.description ?? null,
        promo.discount,
        categoryId,
        promo.validUntil ?? null,
        promo.active ? 1 : 0,
        promo.featured ? 1 : 0,
        promo.minPurchase ?? null
      ]
    );
  }
}

async function main() {
  try {
    await seedCategories();
    await seedBrands();
    await seedProducts();
    await seedPromotions();
    console.log('Seeding completed');
    process.exit(0);
  } catch (err) {
    console.error('Seeding failed:', err);
    process.exit(1);
  }
}

main();


```

```javascript
/* eslint-disable */
const express = require('express');
const cors = require('cors');
const path = require('path');
const { db, run, get, all } = require('./db');

const app = express();
const PORT = process.env.PORT || 3001;

app.use(cors());
app.use(express.json({ limit: '2mb' }));

// Healthcheck
app.get('/api/health', (req, res) => {
  res.json({ ok: true });
});

// Products
app.get('/api/products', async (req, res) => {
  try {
    const rows = await all(
      db,
      `SELECT p.*, 
              c.name AS category_name, 
              s.name AS subcategory_name, 
              b.name AS brand_name
       FROM products p
       LEFT JOIN categories c ON p.category_id = c.id
       LEFT JOIN subcategories s ON p.subcategory_id = s.id
       LEFT JOIN brands b ON p.brand_id = b.id
       ORDER BY p.created_at DESC`
    );

    // –î–æ–±–∞–≤–ª—è–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
    const productIds = rows.map(r => r.id);
    const images = await all(
      db,
      `SELECT * FROM product_images WHERE product_id IN (${productIds.map(() => '?').join(',')})`,
      productIds
    );
    const productIdToImages = new Map();
    for (const img of images) {
      if (!productIdToImages.has(img.product_id)) productIdToImages.set(img.product_id, []);
      productIdToImages.get(img.product_id).push({ id: img.id, data: img.image_data, isMain: !!img.is_main });
    }

    const result = rows.map(r => ({
      id: r.id,
      title: r.title,
      price: r.price,
      category: r.category_name,
      subcategory: r.subcategory_name,
      brand: r.brand_name,
      available: !!r.available,
      quantity: r.quantity,
      description: r.description,
      specifications: r.specifications_json ? JSON.parse(r.specifications_json) : undefined,
      features: r.features_json ? JSON.parse(r.features_json) : undefined,
      images: productIdToImages.get(r.id) || [],
      createdAt: r.created_at,
      updatedAt: r.updated_at
    }));

    res.json(result);
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to fetch products' });
  }
});

// Promotions
app.get('/api/promotions', async (req, res) => {
  try {
    const rows = await all(
      db,
      `SELECT p.*, c.name AS category_name FROM promotions p
       LEFT JOIN categories c ON p.category_id = c.id
       WHERE p.active = 1
       ORDER BY p.featured DESC, p.id DESC`
    );
    const result = rows.map(r => ({
      id: r.id,
      title: r.title,
      description: r.description,
      discount: r.discount,
      category: r.category_name,
      validUntil: r.valid_until,
      active: !!r.active,
      featured: !!r.featured,
      minPurchase: r.min_purchase
    }));
    res.json(result);
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to fetch promotions' });
  }
});

// Orders
app.get('/api/orders', async (req, res) => {
  try {
    const orders = await all(db, `SELECT * FROM orders ORDER BY created_at DESC`);
    const orderIds = orders.map(o => o.id);
    let items = [];
    if (orderIds.length) {
      items = await all(db, `SELECT * FROM order_items WHERE order_id IN (${orderIds.map(() => '?').join(',')})`, orderIds);
    }
    const orderIdToItems = new Map();
    for (const it of items) {
      if (!orderIdToItems.has(it.order_id)) orderIdToItems.set(it.order_id, []);
      orderIdToItems.get(it.order_id).push({
        id: it.id,
        productId: it.product_id,
        title: it.title,
        price: it.price,
        quantity: it.quantity
      });
    }

    const result = [];
    for (const o of orders) {
      const customer = o.customer_id ? await get(db, `SELECT * FROM customers WHERE id = ?`, [o.customer_id]) : null;
      result.push({
        id: o.id,
        orderNumber: o.order_number,
        status: o.status,
        pricing: JSON.parse(o.pricing_json),
        items: orderIdToItems.get(o.id) || [],
        customerInfo: customer || null,
        createdAt: o.created_at,
        updatedAt: o.updated_at
      });
    }
    res.json(result);
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to fetch orders' });
  }
});

app.post('/api/orders', async (req, res) => {
  try {
    const { orderForm, cartItems, priceCalculation, orderNumber } = req.body;

    // customer
    let customerId = null;
    if (orderForm) {
      const r = await run(
        db,
        `INSERT INTO customers (name, phone, email, address) VALUES (?, ?, ?, ?)`,
        [orderForm.name, orderForm.phone, orderForm.email ?? null, orderForm.address ?? null]
      );
      customerId = r.lastID;
    }

    const id = String(orderNumber);
    await run(
      db,
      `INSERT INTO orders (id, order_number, customer_id, status, pricing_json) VALUES (?, ?, ?, 'new', ?)` ,
      [id, String(orderNumber), customerId, JSON.stringify(priceCalculation)]
    );

    if (Array.isArray(cartItems)) {
      for (const it of cartItems) {
        await run(
          db,
          `INSERT INTO order_items (order_id, product_id, title, price, quantity) VALUES (?, ?, ?, ?, ?)`,
          [id, it.id ?? null, it.title, it.price, it.quantity]
        );
      }
    }

    res.status(201).json({ ok: true, id, orderNumber });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to create order' });
  }
});

app.listen(PORT, () => {
  console.log(`API server listening on http://localhost:${PORT}`);
});


```

```json
{
  "name": "server",
  "version": "1.0.0",
  "description": "",
  "main": "index.js",
  "scripts": {
    "test": "echo \"Error: no test specified\" && exit 1",
    "migrate": "node migrate.js",
    "seed": "node seed/seed.js",
    "start": "node index.js",
    "dev": "node index.js"
  },
  "keywords": [],
  "author": "",
  "license": "ISC",
  "dependencies": {
    "cors": "^2.8.5",
    "express": "^5.1.0",
    "multer": "^2.0.2",
    "sqlite3": "^5.1.7"
  }
}

```

–ó–∞–ø—É—â—É –º–∏–≥—Ä–∞—Ü–∏–∏ –∏ —Å–∏–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –ø–∞–ø–∫–µ `server`, –∑–∞—Ç–µ–º –ø–æ–¥–Ω–∏–º—É API —Å–µ—Ä–≤–µ—Ä –∏ –ø—Ä–æ–≤–µ—Ä—é –µ–≥–æ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã.

---

**User**

–ü—Ä–æ–¥–æ–ª–∂–∞–π

---

**Cursor**

–°–¥–µ–ª–∞—é –ø—Ä–∞–≤–∫–∏ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞: –¥–æ–±–∞–≤–ª—é –ø—Ä–æ–∫—Å–∏ `/api` –≤ `vite.config.js`, –ø–µ—Ä–µ–≤–µ–¥—É `OrdersContext` –Ω–∞ —Ä–∞–±–æ—Ç—É —Å API (`GET/POST /api/orders`), –æ–±–Ω–æ–≤–ª—é `Cart.jsx` –µ—Å–ª–∏ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è. –ó–∞—Ç–µ–º –∑–∞–ø—É—â—É dev –∏ –ø—Ä–æ–≤–µ—Ä—é, —á—Ç–æ –∑–∞–∫–∞–∑—ã –≤–∏–¥–Ω—ã –≤ –∞–¥–º–∏–Ω–∫–µ.

–°–¥–µ–ª–∞—é –ø—Ä–∞–≤–∫–∏ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞: –¥–æ–±–∞–≤–ª—é –ø—Ä–æ–∫—Å–∏ `/api` –≤ `vite.config.js`, –ø–µ—Ä–µ–≤–µ–¥—É `OrdersContext` –Ω–∞ —Ä–∞–±–æ—Ç—É —Å API (`GET/POST /api/orders`), –∏ –æ–±–Ω–æ–≤–ª—é `Cart.jsx`, —á—Ç–æ–±—ã –æ–∂–∏–¥–∞–ª –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π `createOrder`. –ó–∞—Ç–µ–º –ø–µ—Ä–µ–∑–∞–ø—É—â—É dev –∏ –ø—Ä–æ–≤–µ—Ä—é —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞ –≤ –ë–î.

```javascript
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'

// https://vite.dev/config/
export default defineConfig({
  plugins: [react()],
  server: {
    host: true,
    port: 5173,
    strictPort: true,
    proxy: {
      '/api': {
        target: 'http://localhost:3001',
        changeOrigin: true,
        ws: false
      }
    }
  }
})

```

```javascriptreact
import React, { createContext, useContext, useState, useEffect } from 'react';

const OrdersContext = createContext();

export const useOrders = () => {
  const context = useContext(OrdersContext);
  if (!context) {
    throw new Error('useOrders must be used within an OrdersProvider');
  }
  return context;
};

// –°—Ç–∞—Ç—É—Å—ã –∑–∞–∫–∞–∑–æ–≤
export const ORDER_STATUSES = {
  NEW: 'new',
  CONFIRMED: 'confirmed',
  PROCESSING: 'processing',
  SHIPPED: 'shipped',
  DELIVERED: 'delivered',
  CANCELLED: 'cancelled'
};

// –ù–∞–∑–≤–∞–Ω–∏—è —Å—Ç–∞—Ç—É—Å–æ–≤ –Ω–∞ —Ä—É—Å—Å–∫–æ–º
export const STATUS_LABELS = {
  [ORDER_STATUSES.NEW]: '–ù–æ–≤—ã–π',
  [ORDER_STATUSES.CONFIRMED]: '–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω',
  [ORDER_STATUSES.PROCESSING]: '–í –æ–±—Ä–∞–±–æ—Ç–∫–µ',
  [ORDER_STATUSES.SHIPPED]: '–û—Ç–ø—Ä–∞–≤–ª–µ–Ω',
  [ORDER_STATUSES.DELIVERED]: '–î–æ—Å—Ç–∞–≤–ª–µ–Ω',
  [ORDER_STATUSES.CANCELLED]: '–û—Ç–º–µ–Ω–µ–Ω'
};

// –¶–≤–µ—Ç–∞ –¥–ª—è —Å—Ç–∞—Ç—É—Å–æ–≤
export const STATUS_COLORS = {
  [ORDER_STATUSES.NEW]: '#3b82f6',
  [ORDER_STATUSES.CONFIRMED]: '#f59e0b',
  [ORDER_STATUSES.PROCESSING]: '#8b5cf6',
  [ORDER_STATUSES.SHIPPED]: '#06b6d4',
  [ORDER_STATUSES.DELIVERED]: '#e6a34a',
  [ORDER_STATUSES.CANCELLED]: '#ef4444'
};

export const OrdersProvider = ({ children }) => {
  const [orders, setOrders] = useState([]);

  // –ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–∫–∞–∑–æ–≤ —Å —Å–µ—Ä–≤–µ—Ä–∞ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
  useEffect(() => {
    const loadOrders = async () => {
      try {
        const response = await fetch('/api/orders');
        if (!response.ok) throw new Error('Failed to load orders');
        const data = await response.json();
        setOrders(Array.isArray(data) ? data : []);
      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∑–∞–∫–∞–∑–æ–≤ —Å —Å–µ—Ä–≤–µ—Ä–∞:', error);
        setOrders([]);
      }
    };
    loadOrders();
  }, []);

  // –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –∑–∞–∫–∞–∑
  const createOrder = async (orderData) => {
    try {
      const response = await fetch('/api/orders', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(orderData)
      });
      if (!response.ok) throw new Error('Failed to create order');
      const saved = await response.json();

      // –û–±–Ω–æ–≤–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–≤–µ–∂–µ–π –∫–æ–ø–∏–µ–π —Å —Å–µ—Ä–≤–µ—Ä–∞
      const list = await fetch('/api/orders').then(r => r.json());
      setOrders(Array.isArray(list) ? list : []);

      return saved;
    } catch (error) {
      console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–∫–∞–∑–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:', error);
      throw error;
    }
  };

  // –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞
  const updateOrderStatus = (orderId, newStatus, note = '') => {
    setOrders(prev => prev.map(order => {
      if (order.id === orderId) {
        const updatedOrder = {
          ...order,
          status: newStatus,
          updatedAt: new Date().toISOString()
        };

        // –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–º–µ—Ç–∫—É –æ–± –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞
        if (note || order.status !== newStatus) {
          updatedOrder.notes = [
            ...order.notes,
            {
              id: Date.now(),
              text: note || `–°—Ç–∞—Ç—É—Å –∏–∑–º–µ–Ω–µ–Ω —Å "${STATUS_LABELS[order.status]}" –Ω–∞ "${STATUS_LABELS[newStatus]}"`,
              timestamp: new Date().toISOString(),
              type: 'status_change'
            }
          ];
        }

        return updatedOrder;
      }
      return order;
    }));
  };

  // –î–æ–±–∞–≤–∏—Ç—å –∑–∞–º–µ—Ç–∫—É –∫ –∑–∞–∫–∞–∑—É
  const addOrderNote = (orderId, noteText) => {
    setOrders(prev => prev.map(order => {
      if (order.id === orderId) {
        return {
          ...order,
          notes: [
            ...order.notes,
            {
              id: Date.now(),
              text: noteText,
              timestamp: new Date().toISOString(),
              type: 'note'
            }
          ],
          updatedAt: new Date().toISOString()
        };
      }
      return order;
    }));
  };

  // –ü–æ–ª—É—á–∏—Ç—å –∑–∞–∫–∞–∑ –ø–æ ID
  const getOrderById = (orderId) => {
    return orders.find(order => order.id === orderId);
  };

  // –ü–æ–ª—É—á–∏—Ç—å –∑–∞–∫–∞–∑—ã –ø–æ —Å—Ç–∞—Ç—É—Å—É
  const getOrdersByStatus = (status) => {
    return orders.filter(order => order.status === status);
  };

  // –ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∑–∞–∫–∞–∑–æ–≤
  const getOrdersStats = () => {
    const stats = {
      total: orders.length,
      byStatus: {},
      totalRevenue: 0,
      recentOrders: orders.slice(0, 5)
    };

    // –ü–æ–¥—Å—á–µ—Ç –ø–æ —Å—Ç–∞—Ç—É—Å–∞–º
    Object.values(ORDER_STATUSES).forEach(status => {
      stats.byStatus[status] = orders.filter(order => order.status === status).length;
    });

    // –ü–æ–¥—Å—á–µ—Ç –æ–±—â–µ–π –≤—ã—Ä—É—á–∫–∏ (—Ç–æ–ª—å–∫–æ –¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–µ –∑–∞–∫–∞–∑—ã)
    stats.totalRevenue = orders
      .filter(order => order.status === ORDER_STATUSES.DELIVERED)
      .reduce((sum, order) => sum + (order.pricing?.total || 0), 0);

    return stats;
  };

  // –£–¥–∞–ª–∏—Ç—å –∑–∞–∫–∞–∑ (—Ç–æ–ª—å–∫–æ –¥–ª—è –æ—Ç–º–µ–Ω–µ–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤)
  const deleteOrder = (orderId) => {
    setOrders(prev => prev.filter(order => order.id !== orderId));
  };

  // –ü–æ–∏—Å–∫ –∑–∞–∫–∞–∑–æ–≤
  const searchOrders = (query) => {
    const lowercaseQuery = query.toLowerCase();
    return orders.filter(order => 
      order.orderNumber.toLowerCase().includes(lowercaseQuery) ||
      order.customerInfo.name.toLowerCase().includes(lowercaseQuery) ||
      order.customerInfo.phone.includes(lowercaseQuery) ||
      (order.customerInfo.email && order.customerInfo.email.toLowerCase().includes(lowercaseQuery))
    );
  };

  const value = {
    orders,
    createOrder,
    updateOrderStatus,
    addOrderNote,
    getOrderById,
    getOrdersByStatus,
    getOrdersStats,
    deleteOrder,
    searchOrders,
    ORDER_STATUSES,
    STATUS_LABELS,
    STATUS_COLORS
  };

  return (
    <OrdersContext.Provider value={value}>
      {children}
    </OrdersContext.Provider>
  );
};

```

```javascriptreact
import React, { useState, useMemo } from 'react';
import { Link, useNavigate } from 'react-router-dom';
import { motion, AnimatePresence } from 'framer-motion';
import { FaTrash, FaMinus, FaPlus, FaShoppingCart, FaArrowLeft, FaPercent, FaTags } from 'react-icons/fa';
import { useCart } from '../context/CartContext';
import { useAdminData } from '../context/AdminDataContext';
import { useOrders } from '../context/OrdersContext';
import { getMainImage } from '../utils/imageHelpers';
import { sendTelegramMessage, formatOrderMessage, generateOrderNumber } from '../utils/telegramService';
import './Cart.css';

function Cart() {
  const { 
    cartItems, 
    removeFromCart, 
    updateQuantity, 
    clearCart, 
    getCartTotal 
  } = useCart();
  
  const { promotions, products } = useAdminData();
  const { createOrder } = useOrders();
  const navigate = useNavigate();
  
  // –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
  console.log('Cart component: useOrders hook result:', { createOrder });
  const [showCheckout, setShowCheckout] = useState(false);
  const [orderForm, setOrderForm] = useState({
    name: '',
    phone: '',
    email: '',
    address: '',
    deliveryMethod: 'pickup',
    paymentMethod: 'cash',
    comment: ''
  });

  // –†–∞—Å—á–µ—Ç –ø—Ä–∏–º–µ–Ω–∏–º—ã—Ö —Å–∫–∏–¥–æ–∫
  const applicableDiscounts = useMemo(() => {
    const cartTotal = getCartTotal();
    const cartCategories = [...new Set(cartItems.map(item => {
      const product = products.find(p => p.id === item.id);
      return product?.category;
    }).filter(Boolean))];

    const activePromotions = promotions.filter(promo => {
      if (!promo.active) return false;
      
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è
      if (promo.validUntil) {
        const validDate = new Date(promo.validUntil);
        if (validDate < new Date()) return false;
      }
      
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º –º–∏–Ω–∏–º–∞–ª—å–Ω—É—é —Å—É–º–º—É –ø–æ–∫—É–ø–∫–∏
      if (promo.minPurchase && cartTotal < promo.minPurchase) return false;
      
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏—é (–µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω–∞)
      if (promo.category && promo.category !== 'all' && !cartCategories.includes(promo.category)) {
        return false;
      }
      
      return true;
    });

    // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ —É–±—ã–≤–∞–Ω–∏—é —Å–∫–∏–¥–∫–∏ (–ª—É—á—à–∏–µ —Å–Ω–∞—á–∞–ª–∞)
    return activePromotions.sort((a, b) => (b.discount || 0) - (a.discount || 0));
  }, [cartItems, promotions, products, getCartTotal]);

  // –†–∞—Å—á–µ—Ç —Ñ–∏–Ω–∞–ª—å–Ω—ã—Ö —Ü–µ–Ω —Å —É—á–µ—Ç–æ–º —Å–∫–∏–¥–æ–∫
  const priceCalculation = useMemo(() => {
    const subtotal = getCartTotal();
    const bestDiscount = applicableDiscounts[0];
    const discountAmount = bestDiscount ? Math.round(subtotal * (bestDiscount.discount / 100)) : 0;
    const total = subtotal - discountAmount;

    return {
      subtotal,
      discountAmount,
      total,
      appliedPromotion: bestDiscount
    };
  }, [getCartTotal, applicableDiscounts]);

  const handleQuantityChange = (productId, newQuantity) => {
    updateQuantity(productId, newQuantity);
  };

  const handleRemoveItem = (productId) => {
    removeFromCart(productId);
  };

  const handleFormChange = (e) => {
    setOrderForm({
      ...orderForm,
      [e.target.name]: e.target.value
    });
  };

  const handleSubmitOrder = async (e) => {
    e.preventDefault();
    
    try {
      // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –Ω–æ–º–µ—Ä –∑–∞–∫–∞–∑–∞
      const orderNumber = generateOrderNumber();
      
      // –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏
      const orderData = {
        orderForm,
        cartItems,
        priceCalculation,
        orderNumber
      };
      
      // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∑–∞–∫–∞–∑ –≤ —Å–∏—Å—Ç–µ–º—É
      const savedOrder = await createOrder(orderData);
      console.log('–ó–∞–∫–∞–∑ —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤ —Å–∏—Å—Ç–µ–º–µ:', savedOrder);
      
      // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è Telegram
      const message = formatOrderMessage(orderData);
      
      // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ Telegram
      console.log('–û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–∫–∞–∑ –≤ Telegram...');
      const result = await sendTelegramMessage(message);
      
      if (result.success) {
        alert(`–ó–∞–∫–∞–∑ #${orderNumber} —É—Å–ø–µ—à–Ω–æ –æ—Ñ–æ—Ä–º–ª–µ–Ω! –ú—ã —Å–≤—è–∂–µ–º—Å—è —Å –≤–∞–º–∏ –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è.`);
        console.log('–ó–∞–∫–∞–∑ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –≤ Telegram');
      } else {
        console.error('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ Telegram:', result.error);
        alert(`–ó–∞–∫–∞–∑ #${orderNumber} –æ—Ñ–æ—Ä–º–ª–µ–Ω, –Ω–æ –≤–æ–∑–Ω–∏–∫–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è. –ú—ã –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —Å –≤–∞–º–∏ —Å–≤—è–∂–µ–º—Å—è!`);
      }
      
      // –û—á–∏—â–∞–µ–º –∫–æ—Ä–∑–∏–Ω—É –∏ –ø–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞ –≥–ª–∞–≤–Ω—É—é
      clearCart();
      setShowCheckout(false);
      navigate('/');
      
    } catch (error) {
      console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–∏ –∑–∞–∫–∞–∑–∞:', error);
      alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–∏ –∑–∞–∫–∞–∑–∞. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑ –∏–ª–∏ —Å–≤—è–∂–∏—Ç–µ—Å—å —Å –Ω–∞–º–∏ –ø–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É.');
    }
  };

  if (cartItems.length === 0) {
    return (
      <div className="cart-page">
        <div className="container">
          <div className="empty-cart">
            <FaShoppingCart className="empty-cart-icon" />
            <h2>–í–∞—à–∞ –∫–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</h2>
            <p>–î–æ–±–∞–≤—å—Ç–µ —Ç–æ–≤–∞—Ä—ã –∏–∑ –∫–∞—Ç–∞–ª–æ–≥–∞, —á—Ç–æ–±—ã –æ—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑</p>
            <Link to="/catalog" className="continue-shopping-btn">
              –ü–µ—Ä–µ–π—Ç–∏ –≤ –∫–∞—Ç–∞–ª–æ–≥
            </Link>
          </div>
        </div>
      </div>
    );
  }

  return (
    <div className="cart-page">
      <div className="container">
        <div className="cart-header">
          <button onClick={() => navigate(-1)} className="back-button">
            <FaArrowLeft /> –ù–∞–∑–∞–¥
          </button>
          <h1>–ö–æ—Ä–∑–∏–Ω–∞ —Ç–æ–≤–∞—Ä–æ–≤</h1>
          <button onClick={clearCart} className="clear-cart-btn">
            –û—á–∏—Å—Ç–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É
          </button>
        </div>

        <div className="cart-content">
          <div className="cart-items">
            <AnimatePresence>
              {cartItems.map((item) => (
                <motion.div
                  key={item.id}
                  className="cart-item"
                  initial={{ opacity: 0, y: 20 }}
                  animate={{ opacity: 1, y: 0 }}
                  exit={{ opacity: 0, x: -100 }}
                  transition={{ duration: 0.3 }}
                >
                  <div className="item-image">
                    {(() => {
                      const productData = products.find(p => p.id === item.id);
                      if (!productData) return <span className="item-icon">üì¶</span>;
                      
                      const mainImage = getMainImage(productData);
                      if (mainImage?.data?.startsWith('data:image')) {
                        return <img src={mainImage.data} alt={item.title} className="item-image-img" />;
                      }
                      return <span className="item-icon">{mainImage?.data || 'üì¶'}</span>;
                    })()}
                  </div>
                  
                  <div className="item-info">
                    <h3>{item.title}</h3>
                    <p className="item-brand">{item.brand}</p>
                    <p className="item-price">{item.price.toLocaleString()} ‚ÇΩ</p>
                  </div>
                  
                  <div className="item-controls">
                    <div className="quantity-controls">
                      <button
                        onClick={() => handleQuantityChange(item.id, item.quantity - 1)}
                        disabled={item.quantity <= 1}
                        className="quantity-btn"
                      >
                        <FaMinus />
                      </button>
                      <input 
                        type="text" 
                        value={item.quantity} 
                        onChange={(e) => {
                          const inputValue = e.target.value.replace(/[^0-9]/g, '');
                          // –†–∞–∑—Ä–µ—à–∞–µ–º –ø—É—Å—Ç–æ–µ –ø–æ–ª–µ
                          if (inputValue === '') {
                            // –í—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ
                            return;
                          }
                          const value = parseInt(inputValue);
                          if (!isNaN(value) && value >= 1) {
                            handleQuantityChange(item.id, value);
                          }
                        }}
                        onBlur={(e) => {
                          // –ü—Ä–∏ –ø–æ—Ç–µ—Ä–µ —Ñ–æ–∫—É—Å–∞, –µ—Å–ª–∏ –ø–æ–ª–µ –ø—É—Å—Ç–æ–µ, —Å—Ç–∞–≤–∏–º 1
                          const cleanValue = e.target.value.replace(/[^0-9]/g, '');
                          if (cleanValue === '' || parseInt(cleanValue) < 1) {
                            handleQuantityChange(item.id, 1);
                          }
                        }}
                        onFocus={(e) => e.target.select()}
                        placeholder="1"
                        className="quantity-input"
                      />
                      <button
                        onClick={() => handleQuantityChange(item.id, item.quantity + 1)}
                        className="quantity-btn"
                      >
                        <FaPlus />
                      </button>
                    </div>
                    
                    <div className="item-total">
                      {(item.price * item.quantity).toLocaleString()} ‚ÇΩ
                    </div>
                    
                    <button
                      onClick={() => handleRemoveItem(item.id)}
                      className="remove-btn"
                    >
                      <FaTrash />
                    </button>
                  </div>
                </motion.div>
              ))}
            </AnimatePresence>
          </div>

          <div className="cart-summary">
            <div className="summary-card">
              <h3>–ò—Ç–æ–≥–æ</h3>
              <div className="summary-line">
                <span>–¢–æ–≤–∞—Ä—ã ({cartItems.reduce((sum, item) => sum + item.quantity, 0)} —à—Ç):</span>
                <span>{priceCalculation.subtotal.toLocaleString()} ‚ÇΩ</span>
              </div>
              
              {priceCalculation.appliedPromotion && (
                <div className="summary-line discount-line">
                  <span>
                    <FaPercent className="discount-icon" />
                    –°–∫–∏–¥–∫–∞ "{priceCalculation.appliedPromotion.title}" ({priceCalculation.appliedPromotion.discount}%):
                  </span>
                  <span className="discount-amount">
                    -{priceCalculation.discountAmount.toLocaleString()} ‚ÇΩ
                  </span>
                </div>
              )}
              
              <div className="summary-line">
                <span>–î–æ—Å—Ç–∞–≤–∫–∞:</span>
                <span>–ë–µ—Å–ø–ª–∞—Ç–Ω–æ</span>
              </div>
              
              <div className="summary-total">
                <span>–ö –æ–ø–ª–∞—Ç–µ:</span>
                <span>{priceCalculation.total.toLocaleString()} ‚ÇΩ</span>
              </div>
              
              {applicableDiscounts.length > 0 && (
                <div className="promotions-info">
                  <FaTags className="promo-icon" />
                  <span>–ü—Ä–∏–º–µ–Ω–µ–Ω—ã –∞–∫—Ç–∏–≤–Ω—ã–µ –∞–∫—Ü–∏–∏!</span>
                </div>
              )}
              
              <motion.button
                className="checkout-btn"
                onClick={() => setShowCheckout(true)}
                whileHover={{ scale: 1.02 }}
                whileTap={{ scale: 0.98 }}
              >
                –û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑
              </motion.button>
            </div>
          </div>
        </div>

        <AnimatePresence>
          {showCheckout && (
            <motion.div
              className="checkout-modal"
              initial={{ opacity: 0 }}
              animate={{ opacity: 1 }}
              exit={{ opacity: 0 }}
            >
              <motion.div
                className="checkout-content"
                initial={{ y: 50, opacity: 0 }}
                animate={{ y: 0, opacity: 1 }}
                exit={{ y: 50, opacity: 0 }}
              >
                <h2>–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞</h2>
                
                <form onSubmit={handleSubmitOrder} className="order-form">
                  <div className="form-group">
                    <label htmlFor="name">–ò–º—è *</label>
                    <input
                      type="text"
                      id="name"
                      name="name"
                      value={orderForm.name}
                      onChange={handleFormChange}
                      required
                    />
                  </div>
                  
                  <div className="form-group">
                    <label htmlFor="phone">–¢–µ–ª–µ—Ñ–æ–Ω *</label>
                    <input
                      type="tel"
                      id="phone"
                      name="phone"
                      value={orderForm.phone}
                      onChange={handleFormChange}
                      required
                    />
                  </div>
                  
                  <div className="form-group">
                    <label htmlFor="email">Email</label>
                    <input
                      type="email"
                      id="email"
                      name="email"
                      value={orderForm.email}
                      onChange={handleFormChange}
                    />
                  </div>
                  
                  <div className="form-group">
                    <label htmlFor="deliveryMethod">–°–ø–æ—Å–æ–± –ø–æ–ª—É—á–µ–Ω–∏—è *</label>
                    <select
                      id="deliveryMethod"
                      name="deliveryMethod"
                      value={orderForm.deliveryMethod}
                      onChange={handleFormChange}
                      required
                    >
                      <option value="pickup">–°–∞–º–æ–≤—ã–≤–æ–∑</option>
                      <option value="delivery">–î–æ—Å—Ç–∞–≤–∫–∞</option>
                    </select>
                  </div>
                  
                  {orderForm.deliveryMethod === 'delivery' && (
                    <div className="form-group">
                      <label htmlFor="address">–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏ *</label>
                      <textarea
                        id="address"
                        name="address"
                        value={orderForm.address}
                        onChange={handleFormChange}
                        required={orderForm.deliveryMethod === 'delivery'}
                        rows="3"
                      />
                    </div>
                  )}
                  
                  <div className="form-group">
                    <label htmlFor="paymentMethod">–°–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã *</label>
                    <select
                      id="paymentMethod"
                      name="paymentMethod"
                      value={orderForm.paymentMethod}
                      onChange={handleFormChange}
                      required
                    >
                      <option value="cash">–ù–∞–ª–∏—á–Ω—ã–º–∏</option>
                      <option value="card">–ë–∞–Ω–∫–æ–≤—Å–∫–æ–π –∫–∞—Ä—Ç–æ–π</option>
                      <option value="transfer">–ë–∞–Ω–∫–æ–≤—Å–∫–∏–π –ø–µ—Ä–µ–≤–æ–¥</option>
                    </select>
                  </div>
                  
                  <div className="form-group">
                    <label htmlFor="comment">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ –∑–∞–∫–∞–∑—É</label>
                    <textarea
                      id="comment"
                      name="comment"
                      value={orderForm.comment}
                      onChange={handleFormChange}
                      rows="3"
                    />
                  </div>
                  
                  <div className="order-summary">
                    <h4>–í–∞—à –∑–∞–∫–∞–∑:</h4>
                    <div className="order-items">
                      {cartItems.map((item) => (
                        <div key={item.id} className="order-item">
                          <span>{item.title} √ó {item.quantity}</span>
                          <span>{(item.price * item.quantity).toLocaleString()} ‚ÇΩ</span>
                        </div>
                      ))}
                    </div>
                    {priceCalculation.appliedPromotion && (
                      <div className="discount-info">
                        <div className="discount-line">
                          <span>–ü–æ–¥—ã—Ç–æ–≥: {priceCalculation.subtotal.toLocaleString()} ‚ÇΩ</span>
                        </div>
                        <div className="discount-line">
                          <span className="discount-text">
                            <FaPercent /> –°–∫–∏–¥–∫–∞ "{priceCalculation.appliedPromotion.title}" ({priceCalculation.appliedPromotion.discount}%):
                          </span>
                          <span className="discount-amount">
                            -{priceCalculation.discountAmount.toLocaleString()} ‚ÇΩ
                          </span>
                        </div>
                      </div>
                    )}
                    <div className="order-total">
                      <strong>–ò—Ç–æ–≥–æ: {priceCalculation.total.toLocaleString()} ‚ÇΩ</strong>
                    </div>
                  </div>
                  
                  <div className="form-actions">
                    <button type="button" onClick={() => setShowCheckout(false)} className="cancel-btn">
                      –û—Ç–º–µ–Ω–∞
                    </button>
                    <button type="submit" className="submit-btn">
                      –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –∑–∞–∫–∞–∑
                    </button>
                  </div>
                </form>
              </motion.div>
            </motion.div>
          )}
        </AnimatePresence>
      </div>
    </div>
  );
}

export default Cart;

```

---

**User**

–ü—Ä–æ–¥–æ–ª–∂–∞–π

---

**Cursor**

–ó–∞–ø—É—â—É dev-—Å–µ—Ä–≤–µ—Ä –Ω–∞ –Ω–æ–≤–æ–º –ø–æ—Ä—Ç—É —Å –æ–±–Ω–æ–≤–ª—ë–Ω–Ω–æ–π –ø—Ä–æ–∫—Å–µ–π, –ø—Ä–æ–≤–µ—Ä—é API `health`, —Å–æ–∑–¥–∞–º —Ç–µ—Å—Ç–æ–≤—ã–π –∑–∞–∫–∞–∑ —á–µ—Ä–µ–∑ API –∏ –ø—Ä–æ—á–∏—Ç–∞—é —Å–ø–∏—Å–æ–∫ –∑–∞–∫–∞–∑–æ–≤, —á—Ç–æ–±—ã —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –ë–î –∏ —Ñ—Ä–æ–Ω—Ç —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω—ã.

---

**User**

–í—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç 

---

**Cursor**

–û—Ç–ª–∏—á–Ω–æ! –†–∞–¥, —á—Ç–æ –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç.

### –ß—Ç–æ —è —Å–¥–µ–ª–∞–ª
- –ü–æ–¥–Ω—è–ª API-—Å–µ—Ä–≤–µ—Ä –Ω–∞ `http://localhost:3001` (SQLite).
- –°–æ–∑–¥–∞–ª –ë–î –∏ —Ç–∞–±–ª–∏—Ü—ã: —Ç–æ–≤–∞—Ä—ã, –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è, –∫–∞—Ç–µ–≥–æ—Ä–∏–∏/–ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏, –±—Ä–µ–Ω–¥—ã, –∞–∫—Ü–∏–∏, –∫–ª–∏–µ–Ω—Ç—ã, –∑–∞–∫–∞–∑—ã, –ø–æ–∑–∏—Ü–∏–∏ –∑–∞–∫–∞–∑–∞, –∑–∞–º–µ—Ç–∫–∏.
- –ü—Ä–∏–º–µ–Ω–∏–ª –º–∏–≥—Ä–∞—Ü–∏–∏ –∏ –∑–∞–ø–æ–ª–Ω–∏–ª –ë–î –Ω–∞—á–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ (—Ç–æ–≤–∞—Ä—ã, –±—Ä–µ–Ω–¥—ã, –∞–∫—Ü–∏–∏).
- –î–æ–±–∞–≤–∏–ª –ø—Ä–æ–∫—Å–∏ `/api` –≤ `vite.config.js`.
- –ü–µ—Ä–µ–≤—ë–ª `OrdersContext` –Ω–∞ REST API (`GET/POST /api/orders`), –∞ `Cart.jsx` ‚Äî –Ω–∞ `await createOrder(...)`.
- –ó–∞–ø—É—Å—Ç–∏–ª —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –Ω–∞ `http://localhost:5174/`.

### –ì–¥–µ —Å–º–æ—Ç—Ä–µ—Ç—å
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π —Å–∞–π—Ç: `http://localhost:5174/`
- –ó–∞–∫–∞–∑—ã –≤ –∞–¥–º–∏–Ω–∫–µ —Ç–µ–ø–µ—Ä—å –±–µ—Ä—É—Ç—Å—è –∏–∑ –ë–î, –∞ –Ω–µ –∏–∑ localStorage.

### –í–æ–∑–º–æ–∂–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è (–ø–æ –∂–µ–ª–∞–Ω–∏—é)
- –ü–µ—Ä–µ–≤–µ—Å—Ç–∏ —Ç–æ–≤–∞—Ä—ã/–∞–∫—Ü–∏–∏/–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –≤ –∞–¥–º–∏–Ω–∫–µ —Å localStorage –Ω–∞ API.
- –î–æ–±–∞–≤–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤ –∑–∞–∫–∞–∑–æ–≤ –∏ –∑–∞–º–µ—Ç–æ–∫ —á–µ—Ä–µ–∑ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã.
- –•—Ä–∞–Ω–∏—Ç—å —Ä–µ–∞–ª—å–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (–∑–∞–≥—Ä—É–∑–∫–∞ –≤ `server/uploads/` –∏ —Å—Å—ã–ª–∫–∏ –≤ –ë–î).

---

**User**

–°–æ–∑–¥–∞–π –ø–ª–∞–Ω –ø–æ —ç—Ç–∏–º —É–ª—É—á—à–µ–Ω–∏–µ –∏ –¥–µ–π—Å—Ç–≤—É–π –ø–æ –ø–ª–∞–Ω—É 

---

**Cursor**

–ü–ª–∞–Ω–∏—Ä—É—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å–µ—Ä–≤–µ—Ä–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã (–∫–∞—Ç–µ–≥–æ—Ä–∏–∏/–ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏, –±—Ä–µ–Ω–¥—ã, –∞–∫—Ü–∏–∏, —Ç–æ–≤–∞—Ä—ã, –∑–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π, –∑–∞–∫–∞–∑—ã: —Å–º–µ–Ω–∞ —Å—Ç–∞—Ç—É—Å–∞/–∑–∞–º–µ—Ç–∫–∏), –∑–∞—Ç–µ–º –æ–±–Ω–æ–≤–ª—é `AdminDataContext` –∏ —ç–∫—Ä–∞–Ω—ã –∞–¥–º–∏–Ω–∫–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —á–µ—Ä–µ–∑ API, –∏ –ø—Ä–æ–≤–µ–¥—É –ø—Ä–æ–≤–µ—Ä–∫—É end-to-end. –ù–∞—á–Ω—É —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è API –Ω–∞ –±—ç–∫–µ–Ω–¥–µ –∏ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–æ–π —Ä–∞–∑–¥–∞—á–∏ `/uploads`.

–°–Ω–∞—á–∞–ª–∞ –¥–æ–±–∞–≤–ª—é –Ω–∞ —Å–µ—Ä–≤–µ—Ä API –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π, –±—Ä–µ–Ω–¥–æ–≤, –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π, –∞ —Ç–∞–∫–∂–µ –º–µ—Ç–æ–¥—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞–º–∏ (—Å–º–µ–Ω–∞ —Å—Ç–∞—Ç—É—Å–∞, –∑–∞–º–µ—Ç–∫–∏) –∏ —Å—Ç–∞—Ç–∏—á–µ—Å–∫—É—é —Ä–∞–∑–¥–∞—á—É `uploads`. –ó–∞—Ç–µ–º –æ–±–Ω–æ–≤–ª—é `AdminDataContext` –¥–ª—è —á—Ç–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∏–∑ API —Å fallback –Ω–∞ –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ. –ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –ø–µ—Ä–µ–∑–∞–ø—É—â—É —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –∏ –ø—Ä–æ–≤–µ—Ä—é.

```javascript
/* eslint-disable */
const express = require('express');
const cors = require('cors');
const path = require('path');
const { db, run, get, all } = require('./db');
const fs = require('fs');
const multer = require('multer');

const app = express();
const PORT = process.env.PORT || 3001;

app.use(cors());
app.use(express.json({ limit: '2mb' }));
// –°—Ç–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–∞–∑–¥–∞—á–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
const uploadsDir = path.join(__dirname, 'uploads');
if (!fs.existsSync(uploadsDir)) {
  fs.mkdirSync(uploadsDir, { recursive: true });
}
app.use('/uploads', express.static(uploadsDir));

// –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
const storage = multer.diskStorage({
  destination: (req, file, cb) => cb(null, uploadsDir),
  filename: (req, file, cb) => {
    const ext = path.extname(file.originalname) || '.png';
    const name = `${Date.now()}-${Math.round(Math.random() * 1e9)}${ext}`;
    cb(null, name);
  }
});
const upload = multer({ storage });

// Healthcheck
app.get('/api/health', (req, res) => {
  res.json({ ok: true });
});

// Upload image
app.post('/api/upload/image', upload.single('image'), (req, res) => {
  if (!req.file) return res.status(400).json({ error: 'No file' });
  const url = `/uploads/${req.file.filename}`;
  res.status(201).json({ url });
});

// Brands
app.get('/api/brands', async (req, res) => {
  try {
    const rows = await all(db, `SELECT id, name FROM brands ORDER BY name ASC`);
    res.json(rows.map(r => r.name));
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to fetch brands' });
  }
});

// Categories and subcategories as structure
app.get('/api/categories', async (req, res) => {
  try {
    const cats = await all(db, `SELECT id, name FROM categories ORDER BY name ASC`);
    const sub = await all(db, `SELECT id, category_id, name FROM subcategories ORDER BY name ASC`);
    const idToName = new Map(cats.map(c => [c.id, c.name]));
    const result = {};
    for (const c of cats) {
      result[c.name] = [];
    }
    for (const s of sub) {
      const catName = idToName.get(s.category_id);
      if (!catName) continue;
      result[catName].push(s.name);
    }
    res.json(result);
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to fetch categories' });
  }
});

// Products
app.get('/api/products', async (req, res) => {
  try {
    const rows = await all(
      db,
      `SELECT p.*, 
              c.name AS category_name, 
              s.name AS subcategory_name, 
              b.name AS brand_name
       FROM products p
       LEFT JOIN categories c ON p.category_id = c.id
       LEFT JOIN subcategories s ON p.subcategory_id = s.id
       LEFT JOIN brands b ON p.brand_id = b.id
       ORDER BY p.created_at DESC`
    );

    // –î–æ–±–∞–≤–ª—è–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
    const productIds = rows.map(r => r.id);
    const images = await all(
      db,
      `SELECT * FROM product_images WHERE product_id IN (${productIds.map(() => '?').join(',')})`,
      productIds
    );
    const productIdToImages = new Map();
    for (const img of images) {
      if (!productIdToImages.has(img.product_id)) productIdToImages.set(img.product_id, []);
      productIdToImages.get(img.product_id).push({ id: img.id, data: img.image_data, isMain: !!img.is_main });
    }

    const result = rows.map(r => ({
      id: r.id,
      title: r.title,
      price: r.price,
      category: r.category_name,
      subcategory: r.subcategory_name,
      brand: r.brand_name,
      available: !!r.available,
      quantity: r.quantity,
      description: r.description,
      specifications: r.specifications_json ? JSON.parse(r.specifications_json) : undefined,
      features: r.features_json ? JSON.parse(r.features_json) : undefined,
      images: productIdToImages.get(r.id) || [],
      createdAt: r.created_at,
      updatedAt: r.updated_at
    }));

    res.json(result);
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to fetch products' });
  }
});

// Promotions
app.get('/api/promotions', async (req, res) => {
  try {
    const rows = await all(
      db,
      `SELECT p.*, c.name AS category_name FROM promotions p
       LEFT JOIN categories c ON p.category_id = c.id
       WHERE p.active = 1
       ORDER BY p.featured DESC, p.id DESC`
    );
    const result = rows.map(r => ({
      id: r.id,
      title: r.title,
      description: r.description,
      discount: r.discount,
      category: r.category_name,
      validUntil: r.valid_until,
      active: !!r.active,
      featured: !!r.featured,
      minPurchase: r.min_purchase
    }));
    res.json(result);
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to fetch promotions' });
  }
});

// Promotions CRUD (–º–∏–Ω–∏–º—É–º)
app.post('/api/promotions', async (req, res) => {
  try {
    const { title, description, discount, category, validUntil, active = true, featured = false, minPurchase } = req.body;
    const catId = category ? (await get(db, `SELECT id FROM categories WHERE name = ?`, [category]))?.id : null;
    const r = await run(
      db,
      `INSERT INTO promotions (title, description, discount, category_id, valid_until, active, featured, min_purchase)
       VALUES (?, ?, ?, ?, ?, ?, ?, ?)`,
      [title, description ?? null, discount, catId ?? null, validUntil ?? null, active ? 1 : 0, featured ? 1 : 0, minPurchase ?? null]
    );
    res.status(201).json({ id: r.lastID });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to create promotion' });
  }
});

app.put('/api/promotions/:id', async (req, res) => {
  try {
    const id = Number(req.params.id);
    const { title, description, discount, category, validUntil, active, featured, minPurchase } = req.body;
    const catId = category ? (await get(db, `SELECT id FROM categories WHERE name = ?`, [category]))?.id : null;
    await run(
      db,
      `UPDATE promotions SET title=?, description=?, discount=?, category_id=?, valid_until=?, active=?, featured=?, min_purchase=? WHERE id=?`,
      [title, description ?? null, discount, catId ?? null, validUntil ?? null, active ? 1 : 0, featured ? 1 : 0, minPurchase ?? null, id]
    );
    res.json({ ok: true });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to update promotion' });
  }
});

app.delete('/api/promotions/:id', async (req, res) => {
  try {
    const id = Number(req.params.id);
    await run(db, `DELETE FROM promotions WHERE id=?`, [id]);
    res.json({ ok: true });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to delete promotion' });
  }
});

// Orders
app.get('/api/orders', async (req, res) => {
  try {
    const orders = await all(db, `SELECT * FROM orders ORDER BY created_at DESC`);
    const orderIds = orders.map(o => o.id);
    let items = [];
    if (orderIds.length) {
      items = await all(db, `SELECT * FROM order_items WHERE order_id IN (${orderIds.map(() => '?').join(',')})`, orderIds);
    }
    const orderIdToItems = new Map();
    for (const it of items) {
      if (!orderIdToItems.has(it.order_id)) orderIdToItems.set(it.order_id, []);
      orderIdToItems.get(it.order_id).push({
        id: it.id,
        productId: it.product_id,
        title: it.title,
        price: it.price,
        quantity: it.quantity
      });
    }

    const result = [];
    for (const o of orders) {
      const customer = o.customer_id ? await get(db, `SELECT * FROM customers WHERE id = ?`, [o.customer_id]) : null;
      result.push({
        id: o.id,
        orderNumber: o.order_number,
        status: o.status,
        pricing: JSON.parse(o.pricing_json),
        items: orderIdToItems.get(o.id) || [],
        customerInfo: customer || null,
        createdAt: o.created_at,
        updatedAt: o.updated_at
      });
    }
    res.json(result);
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to fetch orders' });
  }
});

app.post('/api/orders', async (req, res) => {
  try {
    const { orderForm, cartItems, priceCalculation, orderNumber } = req.body;

    // customer
    let customerId = null;
    if (orderForm) {
      const r = await run(
        db,
        `INSERT INTO customers (name, phone, email, address) VALUES (?, ?, ?, ?)`,
        [orderForm.name, orderForm.phone, orderForm.email ?? null, orderForm.address ?? null]
      );
      customerId = r.lastID;
    }

    const id = String(orderNumber);
    await run(
      db,
      `INSERT INTO orders (id, order_number, customer_id, status, pricing_json) VALUES (?, ?, ?, 'new', ?)` ,
      [id, String(orderNumber), customerId, JSON.stringify(priceCalculation)]
    );

    if (Array.isArray(cartItems)) {
      for (const it of cartItems) {
        await run(
          db,
          `INSERT INTO order_items (order_id, product_id, title, price, quantity) VALUES (?, ?, ?, ?, ?)`,
          [id, it.id ?? null, it.title, it.price, it.quantity]
        );
      }
    }

    res.status(201).json({ ok: true, id, orderNumber });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to create order' });
  }
});

// Orders: update status
app.patch('/api/orders/:id/status', async (req, res) => {
  try {
    const { id } = req.params;
    const { status } = req.body;
    await run(db, `UPDATE orders SET status=?, updated_at = datetime('now') WHERE id=?`, [status, id]);
    res.json({ ok: true });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to update status' });
  }
});

// Orders: add note
app.post('/api/orders/:id/notes', async (req, res) => {
  try {
    const { id } = req.params;
    const { text, type = 'note' } = req.body;
    const r = await run(db, `INSERT INTO order_notes (order_id, text, type) VALUES (?, ?, ?)`, [id, text, type]);
    res.status(201).json({ id: r.lastID });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to add note' });
  }
});

app.listen(PORT, () => {
  console.log(`API server listening on http://localhost:${PORT}`);
});



```

```javascript
/* eslint-disable */
const express = require('express');
const cors = require('cors');
const path = require('path');
const { db, run, get, all } = require('./db');
const fs = require('fs');
const multer = require('multer');

const app = express();
const PORT = process.env.PORT || 3001;

app.use(cors());
app.use(express.json({ limit: '2mb' }));
// –°—Ç–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–∞–∑–¥–∞—á–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
const uploadsDir = path.join(__dirname, 'uploads');
if (!fs.existsSync(uploadsDir)) {
  fs.mkdirSync(uploadsDir, { recursive: true });
}
app.use('/uploads', express.static(uploadsDir));

// –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
const storage = multer.diskStorage({
  destination: (req, file, cb) => cb(null, uploadsDir),
  filename: (req, file, cb) => {
    const ext = path.extname(file.originalname) || '.png';
    const name = `${Date.now()}-${Math.round(Math.random() * 1e9)}${ext}`;
    cb(null, name);
  }
});
const upload = multer({ storage });

// Healthcheck
app.get('/api/health', (req, res) => {
  res.json({ ok: true });
});

// Upload image
app.post('/api/upload/image', upload.single('image'), (req, res) => {
  if (!req.file) return res.status(400).json({ error: 'No file' });
  const url = `/uploads/${req.file.filename}`;
  res.status(201).json({ url });
});

// Brands
app.get('/api/brands', async (req, res) => {
  try {
    const rows = await all(db, `SELECT id, name FROM brands ORDER BY name ASC`);
    res.json(rows.map(r => r.name));
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to fetch brands' });
  }
});

// Categories and subcategories as structure
app.get('/api/categories', async (req, res) => {
  try {
    const cats = await all(db, `SELECT id, name FROM categories ORDER BY name ASC`);
    const sub = await all(db, `SELECT id, category_id, name FROM subcategories ORDER BY name ASC`);
    const idToName = new Map(cats.map(c => [c.id, c.name]));
    const result = {};
    for (const c of cats) {
      result[c.name] = [];
    }
    for (const s of sub) {
      const catName = idToName.get(s.category_id);
      if (!catName) continue;
      result[catName].push(s.name);
    }
    res.json(result);
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to fetch categories' });
  }
});

// Products
app.get('/api/products', async (req, res) => {
  try {
    const rows = await all(
      db,
      `SELECT p.*, 
              c.name AS category_name, 
              s.name AS subcategory_name, 
              b.name AS brand_name
       FROM products p
       LEFT JOIN categories c ON p.category_id = c.id
       LEFT JOIN subcategories s ON p.subcategory_id = s.id
       LEFT JOIN brands b ON p.brand_id = b.id
       ORDER BY p.created_at DESC`
    );

    // –î–æ–±–∞–≤–ª—è–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
    const productIds = rows.map(r => r.id);
    const images = await all(
      db,
      `SELECT * FROM product_images WHERE product_id IN (${productIds.map(() => '?').join(',')})`,
      productIds
    );
    const productIdToImages = new Map();
    for (const img of images) {
      if (!productIdToImages.has(img.product_id)) productIdToImages.set(img.product_id, []);
      productIdToImages.get(img.product_id).push({ id: img.id, data: img.image_data, isMain: !!img.is_main });
    }

    const result = rows.map(r => ({
      id: r.id,
      title: r.title,
      price: r.price,
      category: r.category_name,
      subcategory: r.subcategory_name,
      brand: r.brand_name,
      available: !!r.available,
      quantity: r.quantity,
      description: r.description,
      specifications: r.specifications_json ? JSON.parse(r.specifications_json) : undefined,
      features: r.features_json ? JSON.parse(r.features_json) : undefined,
      images: productIdToImages.get(r.id) || [],
      createdAt: r.created_at,
      updatedAt: r.updated_at
    }));

    res.json(result);
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to fetch products' });
  }
});

// Promotions
app.get('/api/promotions', async (req, res) => {
  try {
    const rows = await all(
      db,
      `SELECT p.*, c.name AS category_name FROM promotions p
       LEFT JOIN categories c ON p.category_id = c.id
       WHERE p.active = 1
       ORDER BY p.featured DESC, p.id DESC`
    );
    const result = rows.map(r => ({
      id: r.id,
      title: r.title,
      description: r.description,
      discount: r.discount,
      category: r.category_name,
      validUntil: r.valid_until,
      active: !!r.active,
      featured: !!r.featured,
      minPurchase: r.min_purchase
    }));
    res.json(result);
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to fetch promotions' });
  }
});

// Promotions CRUD (–º–∏–Ω–∏–º—É–º)
app.post('/api/promotions', async (req, res) => {
  try {
    const { title, description, discount, category, validUntil, active = true, featured = false, minPurchase } = req.body;
    const catId = category ? (await get(db, `SELECT id FROM categories WHERE name = ?`, [category]))?.id : null;
    const r = await run(
      db,
      `INSERT INTO promotions (title, description, discount, category_id, valid_until, active, featured, min_purchase)
       VALUES (?, ?, ?, ?, ?, ?, ?, ?)`,
      [title, description ?? null, discount, catId ?? null, validUntil ?? null, active ? 1 : 0, featured ? 1 : 0, minPurchase ?? null]
    );
    res.status(201).json({ id: r.lastID });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to create promotion' });
  }
});

app.put('/api/promotions/:id', async (req, res) => {
  try {
    const id = Number(req.params.id);
    const { title, description, discount, category, validUntil, active, featured, minPurchase } = req.body;
    const catId = category ? (await get(db, `SELECT id FROM categories WHERE name = ?`, [category]))?.id : null;
    await run(
      db,
      `UPDATE promotions SET title=?, description=?, discount=?, category_id=?, valid_until=?, active=?, featured=?, min_purchase=? WHERE id=?`,
      [title, description ?? null, discount, catId ?? null, validUntil ?? null, active ? 1 : 0, featured ? 1 : 0, minPurchase ?? null, id]
    );
    res.json({ ok: true });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to update promotion' });
  }
});

app.delete('/api/promotions/:id', async (req, res) => {
  try {
    const id = Number(req.params.id);
    await run(db, `DELETE FROM promotions WHERE id=?`, [id]);
    res.json({ ok: true });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to delete promotion' });
  }
});

// Orders
app.get('/api/orders', async (req, res) => {
  try {
    const orders = await all(db, `SELECT * FROM orders ORDER BY created_at DESC`);
    const orderIds = orders.map(o => o.id);
    let items = [];
    if (orderIds.length) {
      items = await all(db, `SELECT * FROM order_items WHERE order_id IN (${orderIds.map(() => '?').join(',')})`, orderIds);
    }
    const orderIdToItems = new Map();
    for (const it of items) {
      if (!orderIdToItems.has(it.order_id)) orderIdToItems.set(it.order_id, []);
      orderIdToItems.get(it.order_id).push({
        id: it.id,
        productId: it.product_id,
        title: it.title,
        price: it.price,
        quantity: it.quantity
      });
    }

    // notes
    let notes = [];
    if (orderIds.length) {
      notes = await all(db, `SELECT * FROM order_notes WHERE order_id IN (${orderIds.map(() => '?').join(',')}) ORDER BY timestamp ASC`, orderIds);
    }
    const orderIdToNotes = new Map();
    for (const n of notes) {
      if (!orderIdToNotes.has(n.order_id)) orderIdToNotes.set(n.order_id, []);
      orderIdToNotes.get(n.order_id).push({
        id: n.id,
        text: n.text,
        type: n.type,
        timestamp: n.timestamp
      });
    }

    const result = [];
    for (const o of orders) {
      const customer = o.customer_id ? await get(db, `SELECT * FROM customers WHERE id = ?`, [o.customer_id]) : null;
      result.push({
        id: o.id,
        orderNumber: o.order_number,
        status: o.status,
        pricing: JSON.parse(o.pricing_json),
        items: orderIdToItems.get(o.id) || [],
        customerInfo: customer || { name: '', phone: '', email: null, address: null },
        notes: orderIdToNotes.get(o.id) || [],
        createdAt: o.created_at,
        updatedAt: o.updated_at
      });
    }
    res.json(result);
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to fetch orders' });
  }
});

app.post('/api/orders', async (req, res) => {
  try {
    const { orderForm, cartItems, priceCalculation, orderNumber } = req.body;

    // customer
    let customerId = null;
    if (orderForm) {
      const r = await run(
        db,
        `INSERT INTO customers (name, phone, email, address) VALUES (?, ?, ?, ?)`,
        [orderForm.name, orderForm.phone, orderForm.email ?? null, orderForm.address ?? null]
      );
      customerId = r.lastID;
    }

    const id = String(orderNumber);
    await run(
      db,
      `INSERT INTO orders (id, order_number, customer_id, status, pricing_json) VALUES (?, ?, ?, 'new', ?)` ,
      [id, String(orderNumber), customerId, JSON.stringify(priceCalculation)]
    );

    if (Array.isArray(cartItems)) {
      for (const it of cartItems) {
        await run(
          db,
          `INSERT INTO order_items (order_id, product_id, title, price, quantity) VALUES (?, ?, ?, ?, ?)`,
          [id, it.id ?? null, it.title, it.price, it.quantity]
        );
      }
    }

    res.status(201).json({ ok: true, id, orderNumber });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to create order' });
  }
});

// Orders: update status
app.patch('/api/orders/:id/status', async (req, res) => {
  try {
    const { id } = req.params;
    const { status } = req.body;
    await run(db, `UPDATE orders SET status=?, updated_at = datetime('now') WHERE id=?`, [status, id]);
    res.json({ ok: true });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to update status' });
  }
});

// Orders: add note
app.post('/api/orders/:id/notes', async (req, res) => {
  try {
    const { id } = req.params;
    const { text, type = 'note' } = req.body;
    const r = await run(db, `INSERT INTO order_notes (order_id, text, type) VALUES (?, ?, ?)`, [id, text, type]);
    res.status(201).json({ id: r.lastID });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to add note' });
  }
});

app.listen(PORT, () => {
  console.log(`API server listening on http://localhost:${PORT}`);
});



```

```javascriptreact
import React, { createContext, useContext, useState, useEffect } from 'react';

const OrdersContext = createContext();

export const useOrders = () => {
  const context = useContext(OrdersContext);
  if (!context) {
    throw new Error('useOrders must be used within an OrdersProvider');
  }
  return context;
};

// –°—Ç–∞—Ç—É—Å—ã –∑–∞–∫–∞–∑–æ–≤
export const ORDER_STATUSES = {
  NEW: 'new',
  CONFIRMED: 'confirmed',
  PROCESSING: 'processing',
  SHIPPED: 'shipped',
  DELIVERED: 'delivered',
  CANCELLED: 'cancelled'
};

// –ù–∞–∑–≤–∞–Ω–∏—è —Å—Ç–∞—Ç—É—Å–æ–≤ –Ω–∞ —Ä—É—Å—Å–∫–æ–º
export const STATUS_LABELS = {
  [ORDER_STATUSES.NEW]: '–ù–æ–≤—ã–π',
  [ORDER_STATUSES.CONFIRMED]: '–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω',
  [ORDER_STATUSES.PROCESSING]: '–í –æ–±—Ä–∞–±–æ—Ç–∫–µ',
  [ORDER_STATUSES.SHIPPED]: '–û—Ç–ø—Ä–∞–≤–ª–µ–Ω',
  [ORDER_STATUSES.DELIVERED]: '–î–æ—Å—Ç–∞–≤–ª–µ–Ω',
  [ORDER_STATUSES.CANCELLED]: '–û—Ç–º–µ–Ω–µ–Ω'
};

// –¶–≤–µ—Ç–∞ –¥–ª—è —Å—Ç–∞—Ç—É—Å–æ–≤
export const STATUS_COLORS = {
  [ORDER_STATUSES.NEW]: '#3b82f6',
  [ORDER_STATUSES.CONFIRMED]: '#f59e0b',
  [ORDER_STATUSES.PROCESSING]: '#8b5cf6',
  [ORDER_STATUSES.SHIPPED]: '#06b6d4',
  [ORDER_STATUSES.DELIVERED]: '#e6a34a',
  [ORDER_STATUSES.CANCELLED]: '#ef4444'
};

export const OrdersProvider = ({ children }) => {
  const [orders, setOrders] = useState([]);

  // –ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–∫–∞–∑–æ–≤ —Å —Å–µ—Ä–≤–µ—Ä–∞ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
  useEffect(() => {
    const loadOrders = async () => {
      try {
        const response = await fetch('/api/orders');
        if (!response.ok) throw new Error('Failed to load orders');
        const data = await response.json();
        setOrders(Array.isArray(data) ? data : []);
      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∑–∞–∫–∞–∑–æ–≤ —Å —Å–µ—Ä–≤–µ—Ä–∞:', error);
        setOrders([]);
      }
    };
    loadOrders();
  }, []);

  // –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –∑–∞–∫–∞–∑
  const createOrder = async (orderData) => {
    try {
      const response = await fetch('/api/orders', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(orderData)
      });
      if (!response.ok) throw new Error('Failed to create order');
      const saved = await response.json();

      // –û–±–Ω–æ–≤–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–≤–µ–∂–µ–π –∫–æ–ø–∏–µ–π —Å —Å–µ—Ä–≤–µ—Ä–∞
      const list = await fetch('/api/orders').then(r => r.json());
      setOrders(Array.isArray(list) ? list : []);

      return saved;
    } catch (error) {
      console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–∫–∞–∑–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:', error);
      throw error;
    }
  };

  // –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞
  const updateOrderStatus = async (orderId, newStatus, note = '') => {
    await fetch(`/api/orders/${orderId}/status`, {
      method: 'PATCH',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ status: newStatus })
    });
    if (note) {
      await fetch(`/api/orders/${orderId}/notes`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ text: note, type: 'status_change' })
      });
    }
    const list = await fetch('/api/orders').then(r => r.json());
    setOrders(Array.isArray(list) ? list : []);
  };

  // –î–æ–±–∞–≤–∏—Ç—å –∑–∞–º–µ—Ç–∫—É –∫ –∑–∞–∫–∞–∑—É
  const addOrderNote = async (orderId, noteText) => {
    await fetch(`/api/orders/${orderId}/notes`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ text: noteText, type: 'note' })
    });
    const list = await fetch('/api/orders').then(r => r.json());
    setOrders(Array.isArray(list) ? list : []);
  };

  // –ü–æ–ª—É—á–∏—Ç—å –∑–∞–∫–∞–∑ –ø–æ ID
  const getOrderById = (orderId) => {
    return orders.find(order => order.id === orderId);
  };

  // –ü–æ–ª—É—á–∏—Ç—å –∑–∞–∫–∞–∑—ã –ø–æ —Å—Ç–∞—Ç—É—Å—É
  const getOrdersByStatus = (status) => {
    return orders.filter(order => order.status === status);
  };

  // –ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∑–∞–∫–∞–∑–æ–≤
  const getOrdersStats = () => {
    const stats = {
      total: orders.length,
      byStatus: {},
      totalRevenue: 0,
      recentOrders: orders.slice(0, 5)
    };

    // –ü–æ–¥—Å—á–µ—Ç –ø–æ —Å—Ç–∞—Ç—É—Å–∞–º
    Object.values(ORDER_STATUSES).forEach(status => {
      stats.byStatus[status] = orders.filter(order => order.status === status).length;
    });

    // –ü–æ–¥—Å—á–µ—Ç –æ–±—â–µ–π –≤—ã—Ä—É—á–∫–∏ (—Ç–æ–ª—å–∫–æ –¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–µ –∑–∞–∫–∞–∑—ã)
    stats.totalRevenue = orders
      .filter(order => order.status === ORDER_STATUSES.DELIVERED)
      .reduce((sum, order) => sum + (order.pricing?.total || 0), 0);

    return stats;
  };

  // –£–¥–∞–ª–∏—Ç—å –∑–∞–∫–∞–∑ (—Ç–æ–ª—å–∫–æ –¥–ª—è –æ—Ç–º–µ–Ω–µ–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤)
  const deleteOrder = async (orderId) => {
    // –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ hard delete –ø—Ä–∏ —Å—Ç–∞—Ç—É—Å–µ cancelled
    console.warn('–£–¥–∞–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ');
    setOrders(prev => prev.filter(order => order.id !== orderId));
  };

  // –ü–æ–∏—Å–∫ –∑–∞–∫–∞–∑–æ–≤
  const searchOrders = (query) => {
    const lowercaseQuery = query.toLowerCase();
    return orders.filter(order => 
      order.orderNumber.toLowerCase().includes(lowercaseQuery) ||
      order.customerInfo.name.toLowerCase().includes(lowercaseQuery) ||
      order.customerInfo.phone.includes(lowercaseQuery) ||
      (order.customerInfo.email && order.customerInfo.email.toLowerCase().includes(lowercaseQuery))
    );
  };

  const value = {
    orders,
    createOrder,
    updateOrderStatus,
    addOrderNote,
    getOrderById,
    getOrdersByStatus,
    getOrdersStats,
    deleteOrder,
    searchOrders,
    ORDER_STATUSES,
    STATUS_LABELS,
    STATUS_COLORS
  };

  return (
    <OrdersContext.Provider value={value}>
      {children}
    </OrdersContext.Provider>
  );
};

```

```javascriptreact
import React, { useState, useMemo } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import { 
  FaSearch, 
  FaEye, 
  FaEdit, 
  FaTrash,
  FaClock,
  FaCheck,
  FaTruck,
  FaBox,
  FaTimes,
  FaPlus,
  FaFilter
} from 'react-icons/fa';
import { useOrders } from '../../context/OrdersContext';
import './OrderManagement.css';

function OrderManagement() {
  const { 
    orders, 
    createOrder,
    updateOrderStatus, 
    addOrderNote, 
    deleteOrder,
    searchOrders,
    ORDER_STATUSES,
    STATUS_LABELS,
    STATUS_COLORS
  } = useOrders();
  
  // –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
  console.log('OrderManagement: –ü–æ–ª—É—á–µ–Ω–Ω—ã–µ –∑–∞–∫–∞–∑—ã:', orders);
  console.log('OrderManagement: –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–∫–∞–∑–æ–≤:', orders.length);

  const [searchQuery, setSearchQuery] = useState('');
  const [statusFilter, setStatusFilter] = useState('all');
  const [selectedOrder, setSelectedOrder] = useState(null);
  const [showOrderDetails, setShowOrderDetails] = useState(false);
  const [newNote, setNewNote] = useState('');

  // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∑–∞–∫–∞–∑–æ–≤
  const filteredOrders = useMemo(() => {
    let result = orders;

    // –ü–æ–∏—Å–∫
    if (searchQuery.trim()) {
      result = searchOrders(searchQuery);
    }

    // –§–∏–ª—å—Ç—Ä –ø–æ —Å—Ç–∞—Ç—É—Å—É
    if (statusFilter !== 'all') {
      result = result.filter(order => order.status === statusFilter);
    }

    return result.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
  }, [orders, searchQuery, statusFilter, searchOrders]);

  // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
  const stats = useMemo(() => {
    const today = new Date();
    const todayOrders = orders.filter(order => {
      const orderDate = new Date(order.createdAt);
      return orderDate.toDateString() === today.toDateString();
    });

    return {
      total: orders.length,
      today: todayOrders.length,
      new: orders.filter(order => order.status === ORDER_STATUSES.NEW).length,
      processing: orders.filter(order => order.status === ORDER_STATUSES.PROCESSING).length,
      completed: orders.filter(order => order.status === ORDER_STATUSES.DELIVERED).length
    };
  }, [orders, ORDER_STATUSES]);

  const handleStatusChange = (orderId, newStatus) => {
    updateOrderStatus(orderId, newStatus);
  };

  const handleAddNote = (orderId) => {
    if (newNote.trim()) {
      addOrderNote(orderId, newNote.trim());
      setNewNote('');
    }
  };

  const handleViewOrder = (order) => {
    setSelectedOrder(order);
    setShowOrderDetails(true);
  };

  const formatDate = (dateString) => {
    return new Date(dateString).toLocaleString('ru-RU', {
      year: 'numeric',
      month: '2-digit',
      day: '2-digit',
      hour: '2-digit',
      minute: '2-digit'
    });
  };

  const getStatusIcon = (status) => {
    switch (status) {
      case ORDER_STATUSES.NEW:
        return <FaClock />;
      case ORDER_STATUSES.CONFIRMED:
        return <FaCheck />;
      case ORDER_STATUSES.PROCESSING:
        return <FaBox />;
      case ORDER_STATUSES.SHIPPED:
        return <FaTruck />;
      case ORDER_STATUSES.DELIVERED:
        return <FaCheck />;
      case ORDER_STATUSES.CANCELLED:
        return <FaTimes />;
      default:
        return <FaClock />;
    }
  };

  return (
    <div className="order-management">
      <div className="management-header">
        <h2>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞–º–∏</h2>
        <button 
          className="test-order-btn"
          onClick={async () => {
            console.log('üß™ –¢–µ—Å—Ç: –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–π –∑–∞–∫–∞–∑ —á–µ—Ä–µ–∑ createOrder');
            const testOrderData = {
              orderNumber: 'TEST' + Date.now(),
              orderForm: {
                name: '–¢–µ—Å—Ç–æ–≤—ã–π –∫–ª–∏–µ–Ω—Ç',
                phone: '+7 (999) 123-45-67',
                email: 'test@example.com',
                deliveryMethod: 'pickup',
                paymentMethod: 'cash'
              },
              cartItems: [
                { id: 1, title: '–¢–µ—Å—Ç–æ–≤—ã–π —Ç–æ–≤–∞—Ä', price: 1000, quantity: 1, brand: 'Test' }
              ],
              priceCalculation: {
                subtotal: 1000,
                total: 1000,
                discountAmount: 0
              }
            };
            
            try {
              const result = await createOrder(testOrderData);
              console.log('‚úÖ –¢–µ—Å—Ç–æ–≤—ã–π –∑–∞–∫–∞–∑ —Å–æ–∑–¥–∞–Ω:', result);
              alert('–¢–µ—Å—Ç–æ–≤—ã–π –∑–∞–∫–∞–∑ —Å–æ–∑–¥–∞–Ω! –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–ø–∏—Å–æ–∫ –∑–∞–∫–∞–∑–æ–≤.');
            } catch (error) {
              console.error('‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –∑–∞–∫–∞–∑–∞:', error);
              alert('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –∑–∞–∫–∞–∑–∞: ' + error.message);
            }
          }}
          style={{
            background: '#e6a34a',
            border: 'none',
            color: '#0a0a0a',
            padding: '0.5rem 1rem',
            borderRadius: '8px',
            cursor: 'pointer',
            fontWeight: '600'
          }}
        >
          üß™ –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π –∑–∞–∫–∞–∑
        </button>
        
        {/* –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è */}
        <div style={{
          background: 'rgba(255, 255, 255, 0.05)',
          border: '1px solid rgba(255, 255, 255, 0.1)',
          borderRadius: '8px',
          padding: '1rem',
          marginTop: '1rem',
          fontSize: '0.9rem',
          color: '#cccccc'
        }}>
          <strong>üîç –û—Ç–ª–∞–¥–∫–∞:</strong><br/>
          üìã –ó–∞–∫–∞–∑–æ–≤ –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏: {orders.length}<br/>
          üíæ localStorage key 'orders': {localStorage.getItem('orders') ? '–Ω–∞–π–¥–µ–Ω' : '–Ω–µ –Ω–∞–π–¥–µ–Ω'}<br/>
          üîß createOrder —Ñ—É–Ω–∫—Ü–∏—è: {createOrder ? '–¥–æ—Å—Ç—É–ø–Ω–∞' : '–Ω–µ –Ω–∞–π–¥–µ–Ω–∞'}
        </div>
      </div>

      {/* –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ */}
      <div className="stats-grid">
        <div className="stat-card">
          <div className="stat-icon">üìä</div>
          <div className="stat-info">
            <div className="stat-number">{stats.total}</div>
            <div className="stat-label">–í—Å–µ–≥–æ –∑–∞–∫–∞–∑–æ–≤</div>
          </div>
        </div>
        <div className="stat-card">
          <div className="stat-icon">üìÖ</div>
          <div className="stat-info">
            <div className="stat-number">{stats.today}</div>
            <div className="stat-label">–°–µ–≥–æ–¥–Ω—è</div>
          </div>
        </div>
        <div className="stat-card">
          <div className="stat-icon">üÜï</div>
          <div className="stat-info">
            <div className="stat-number">{stats.new}</div>
            <div className="stat-label">–ù–æ–≤—ã–µ</div>
          </div>
        </div>
        <div className="stat-card">
          <div className="stat-icon">‚öôÔ∏è</div>
          <div className="stat-info">
            <div className="stat-number">{stats.processing}</div>
            <div className="stat-label">–í –æ–±—Ä–∞–±–æ—Ç–∫–µ</div>
          </div>
        </div>
        <div className="stat-card">
          <div className="stat-icon">‚úÖ</div>
          <div className="stat-info">
            <div className="stat-number">{stats.completed}</div>
            <div className="stat-label">–ó–∞–≤–µ—Ä—à–µ–Ω—ã</div>
          </div>
        </div>
      </div>

      {/* –§–∏–ª—å—Ç—Ä—ã –∏ –ø–æ–∏—Å–∫ */}
      <div className="orders-controls">
        <div className="search-box">
          <FaSearch className="search-icon" />
          <input
            type="text"
            placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–æ–º–µ—Ä—É –∑–∞–∫–∞–∑–∞, –∏–º–µ–Ω–∏ –∏–ª–∏ —Ç–µ–ª–µ—Ñ–æ–Ω—É..."
            value={searchQuery}
            onChange={(e) => setSearchQuery(e.target.value)}
          />
        </div>
        
        <div className="filter-box">
          <FaFilter className="filter-icon" />
          <select
            value={statusFilter}
            onChange={(e) => setStatusFilter(e.target.value)}
          >
            <option value="all">–í—Å–µ —Å—Ç–∞—Ç—É—Å—ã</option>
            {Object.entries(STATUS_LABELS).map(([status, label]) => (
              <option key={status} value={status}>{label}</option>
            ))}
          </select>
        </div>
      </div>

      {/* –°–ø–∏—Å–æ–∫ –∑–∞–∫–∞–∑–æ–≤ */}
      <div className="orders-table">
        <div className="table-header">
          <div>–ù–æ–º–µ—Ä –∑–∞–∫–∞–∑–∞</div>
          <div>–ö–ª–∏–µ–Ω—Ç</div>
          <div>–°—É–º–º–∞</div>
          <div>–°—Ç–∞—Ç—É—Å</div>
          <div>–î–∞—Ç–∞</div>
          <div>–î–µ–π—Å—Ç–≤–∏—è</div>
        </div>
        
        <AnimatePresence>
          {filteredOrders.map((order) => (
            <motion.div
              key={order.id}
              className="table-row"
              initial={{ opacity: 0, y: 20 }}
              animate={{ opacity: 1, y: 0 }}
              exit={{ opacity: 0, y: -20 }}
              transition={{ duration: 0.2 }}
            >
              <div className="order-number">#{order.orderNumber}</div>
              <div className="customer-info">
                <div className="customer-name">{order.customerInfo.name}</div>
                <div className="customer-phone">{order.customerInfo.phone}</div>
              </div>
              <div className="order-total">
                {order.pricing.total.toLocaleString()} ‚ÇΩ
              </div>
              <div className="order-status">
                <span 
                  className="status-badge"
                  style={{ backgroundColor: STATUS_COLORS[order.status] }}
                >
                  {getStatusIcon(order.status)}
                  {STATUS_LABELS[order.status]}
                </span>
              </div>
              <div className="order-date">
                {formatDate(order.createdAt)}
              </div>
              <div className="order-actions">
                <button
                  className="action-btn view-btn"
                  onClick={() => handleViewOrder(order)}
                  title="–ü—Ä–æ—Å–º–æ—Ç—Ä –∑–∞–∫–∞–∑–∞"
                >
                  <FaEye />
                </button>
                <select
                  className="status-select"
                  value={order.status}
                  onChange={(e) => handleStatusChange(order.id, e.target.value)}
                  title="–ò–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å"
                >
                  {Object.entries(STATUS_LABELS).map(([status, label]) => (
                    <option key={status} value={status}>{label}</option>
                  ))}
                </select>
                {order.status === ORDER_STATUSES.CANCELLED && (
                  <button
                    className="action-btn delete-btn"
                    onClick={() => deleteOrder(order.id)}
                    title="–£–¥–∞–ª–∏—Ç—å –∑–∞–∫–∞–∑"
                  >
                    <FaTrash />
                  </button>
                )}
              </div>
            </motion.div>
          ))}
        </AnimatePresence>

        {filteredOrders.length === 0 && (
          <div className="no-orders">
            <FaBox className="no-orders-icon" />
            <h3>–ó–∞–∫–∞–∑—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h3>
            <p>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–∏—Å–∫–∞ –∏–ª–∏ —Ñ–∏–ª—å—Ç—Ä—ã</p>
          </div>
        )}
      </div>

      {/* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏ –∑–∞–∫–∞–∑–∞ */}
      <AnimatePresence>
        {showOrderDetails && selectedOrder && (
          <motion.div
            className="order-details-modal"
            initial={{ opacity: 0 }}
            animate={{ opacity: 1 }}
            exit={{ opacity: 0 }}
          >
            <motion.div
              className="order-details-content"
              initial={{ y: 50, opacity: 0 }}
              animate={{ y: 0, opacity: 1 }}
              exit={{ y: 50, opacity: 0 }}
            >
              <div className="modal-header">
                <h3>–ó–∞–∫–∞–∑ #{selectedOrder.orderNumber}</h3>
                <button
                  className="close-btn"
                  onClick={() => setShowOrderDetails(false)}
                >
                  <FaTimes />
                </button>
              </div>

              <div className="order-details-body">
                <div className="details-section">
                  <h4>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–ª–∏–µ–Ω—Ç–µ</h4>
                  <div className="customer-details">
                    <p><strong>–ò–º—è:</strong> {selectedOrder.customerInfo.name}</p>
                    <p><strong>–¢–µ–ª–µ—Ñ–æ–Ω:</strong> {selectedOrder.customerInfo.phone}</p>
                    {selectedOrder.customerInfo.email && (
                      <p><strong>Email:</strong> {selectedOrder.customerInfo.email}</p>
                    )}
                    <p><strong>–°–ø–æ—Å–æ–± –ø–æ–ª—É—á–µ–Ω–∏—è:</strong> {
                      selectedOrder.customerInfo.deliveryMethod === 'pickup' ? '–°–∞–º–æ–≤—ã–≤–æ–∑' : '–î–æ—Å—Ç–∞–≤–∫–∞'
                    }</p>
                    {selectedOrder.customerInfo.address && (
                      <p><strong>–ê–¥—Ä–µ—Å:</strong> {selectedOrder.customerInfo.address}</p>
                    )}
                    <p><strong>–°–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã:</strong> {
                      selectedOrder.customerInfo.paymentMethod === 'cash' ? '–ù–∞–ª–∏—á–Ω—ã–º–∏' :
                      selectedOrder.customerInfo.paymentMethod === 'card' ? '–ë–∞–Ω–∫–æ–≤—Å–∫–æ–π –∫–∞—Ä—Ç–æ–π' :
                      '–ë–∞–Ω–∫–æ–≤—Å–∫–∏–π –ø–µ—Ä–µ–≤–æ–¥'
                    }</p>
                    {selectedOrder.customerInfo.comment && (
                      <p><strong>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π:</strong> {selectedOrder.customerInfo.comment}</p>
                    )}
                  </div>
                </div>

                <div className="details-section">
                  <h4>–¢–æ–≤–∞—Ä—ã –≤ –∑–∞–∫–∞–∑–µ</h4>
                  <div className="order-items">
                    {selectedOrder.items.map((item, index) => (
                      <div key={index} className="order-item">
                        <div className="item-info">
                          <div className="item-title">{item.title}</div>
                          {item.brand && <div className="item-brand">{item.brand}</div>}
                        </div>
                        <div className="item-quantity">√ó{item.quantity}</div>
                        <div className="item-price">
                          {(item.price * item.quantity).toLocaleString()} ‚ÇΩ
                        </div>
                      </div>
                    ))}
                  </div>
                  
                  <div className="order-total-details">
                    <div className="total-line">
                      <span>–ü–æ–¥—ã—Ç–æ–≥:</span>
                      <span>{selectedOrder.pricing.subtotal.toLocaleString()} ‚ÇΩ</span>
                    </div>
                    {selectedOrder.pricing.discountAmount > 0 && (
                      <div className="total-line discount">
                        <span>–°–∫–∏–¥–∫–∞:</span>
                        <span>-{selectedOrder.pricing.discountAmount.toLocaleString()} ‚ÇΩ</span>
                      </div>
                    )}
                    <div className="total-line final">
                      <span>–ò—Ç–æ–≥–æ:</span>
                      <span>{selectedOrder.pricing.total.toLocaleString()} ‚ÇΩ</span>
                    </div>
                  </div>
                </div>

                <div className="details-section">
                  <h4>–ó–∞–º–µ—Ç–∫–∏</h4>
                  <div className="notes-list">
                    {selectedOrder.notes.map((note) => (
                      <div key={note.id} className="note-item">
                        <div className="note-text">{note.text}</div>
                        <div className="note-date">{formatDate(note.timestamp)}</div>
                      </div>
                    ))}
                  </div>
                  
                  <div className="add-note">
                    <input
                      type="text"
                      placeholder="–î–æ–±–∞–≤–∏—Ç—å –∑–∞–º–µ—Ç–∫—É..."
                      value={newNote}
                      onChange={(e) => setNewNote(e.target.value)}
                      onKeyPress={(e) => e.key === 'Enter' && handleAddNote(selectedOrder.id)}
                    />
                    <button
                      className="add-note-btn"
                      onClick={() => handleAddNote(selectedOrder.id)}
                      disabled={!newNote.trim()}
                    >
                      <FaPlus />
                    </button>
                  </div>
                </div>
              </div>
            </motion.div>
          </motion.div>
        )}
      </AnimatePresence>
    </div>
  );
}

export default OrderManagement;

```

---

**User**

–ü—Ä–æ–¥–æ–ª–∂–∞–π

---

**Cursor**

–°–¥–µ–ª–∞—é –∑–∞–≥—Ä—É–∑–∫—É –¥–∞–Ω–Ω—ã—Ö –∞–¥–º–∏–Ω–∫–∏ –∏–∑ API —Å fallback –Ω–∞ –ª–æ–∫–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è, —á—Ç–æ–±—ã –∫–∞—Ç–µ–≥–æ—Ä–∏–∏, –±—Ä–µ–Ω–¥—ã, –∞–∫—Ü–∏–∏ –∏ —Ç–æ–≤–∞—Ä—ã –ø–æ–¥—Ö–≤–∞—Ç—ã–≤–∞–ª–∏—Å—å –∏–∑ –ë–î. –ó–∞—Ç–µ–º –ø—Ä–æ–≤–µ—Ä—é, —á—Ç–æ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –ø–æ–¥—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –±–µ–∑ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞.

```javascriptreact
import React, { createContext, useContext, useState, useEffect } from 'react';
import { 
  categoryStructure, 
  initialProducts, 
  initialBrands, 
  initialPromotions, 
  initialAboutContent 
} from '../data/initialData.js';
import { migrateProductImages } from '../utils/imageHelpers';

const AdminDataContext = createContext();

export const useAdminData = () => {
  const context = useContext(AdminDataContext);
  if (!context) {
    throw new Error('useAdminData must be used within AdminDataProvider');
  }
  return context;
};

export const AdminDataProvider = ({ children }) => {
  // –°–æ—Å—Ç–æ—è–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
  const [products, setProducts] = useState(() => {
    const saved = localStorage.getItem('adminProducts');
    let productsData = saved ? JSON.parse(saved) : initialProducts;
    
    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –º–∏–≥—Ä–∏—Ä—É–µ–º products –ø—Ä–∏ –ø–µ—Ä–≤–æ–π –∑–∞–≥—Ä—É–∑–∫–µ
    productsData = productsData.map(product => migrateProductImages(product));
    
    return productsData;
  });

  const [categories, setCategories] = useState(() => {
    const saved = localStorage.getItem('adminCategories');
    return saved ? JSON.parse(saved) : categoryStructure;
  });

  const [brands, setBrands] = useState(() => {
    const saved = localStorage.getItem('adminBrands');
    return saved ? JSON.parse(saved) : initialBrands;
  });

  const [promotions, setPromotions] = useState(() => {
    const saved = localStorage.getItem('adminPromotions');
    // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –ø—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫ ‚Äî –Ω–∏–∫–∞–∫–∏—Ö –¥–µ–º–æ-–∞–∫—Ü–∏–π
    return saved ? JSON.parse(saved) : [];
  });

  const [aboutContent, setAboutContent] = useState(() => {
    const saved = localStorage.getItem('adminAboutContent');
    if (saved) {
      try {
        const parsedContent = JSON.parse(saved);
        // –ú–∏–≥—Ä–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
        const migratedContent = {
          ...initialAboutContent,
          ...parsedContent,
          team: parsedContent.team || initialAboutContent.team,
          history: {
            ...initialAboutContent.history,
            ...(parsedContent.history || {})
          },
          footer: {
            ...initialAboutContent.footer,
            ...(parsedContent.footer || {})
          },

        };
        console.log('AdminDataContext: Loaded and migrated about content:', migratedContent);
        return migratedContent;
      } catch (error) {
        console.error('AdminDataContext: Error parsing saved about content:', error);
        return initialAboutContent;
      }
    }
    console.log('AdminDataContext: Using initial about content');
    return initialAboutContent;
  });

  const [popularProductIds, setPopularProductIds] = useState(() => {
    const saved = localStorage.getItem('adminPopularProducts');
    return saved ? JSON.parse(saved) : [11, 1, 8, 2]; // ID –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
  });

  // –ü–µ—Ä–≤–∏—á–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –∏–∑ API (fallback –Ω–∞ –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ)
  useEffect(() => {
    const bootstrapFromApi = async () => {
      try {
        const [apiProductsRes, apiCategoriesRes, apiBrandsRes, apiPromosRes] = await Promise.allSettled([
          fetch('/api/products'),
          fetch('/api/categories'),
          fetch('/api/brands'),
          fetch('/api/promotions')
        ]);

        if (apiProductsRes.status === 'fulfilled' && apiProductsRes.value.ok) {
          const apiProducts = await apiProductsRes.value.json();
          const normalized = Array.isArray(apiProducts)
            ? apiProducts.map(p => migrateProductImages(p))
            : [];
          setProducts(normalized);
          localStorage.setItem('adminProducts', JSON.stringify(normalized));
        }

        if (apiCategoriesRes.status === 'fulfilled' && apiCategoriesRes.value.ok) {
          const apiCats = await apiCategoriesRes.value.json();
          if (apiCats && typeof apiCats === 'object') {
            setCategories(apiCats);
            localStorage.setItem('adminCategories', JSON.stringify(apiCats));
          }
        }

        if (apiBrandsRes.status === 'fulfilled' && apiBrandsRes.value.ok) {
          const apiBrands = await apiBrandsRes.value.json();
          if (Array.isArray(apiBrands) && apiBrands.length) {
            setBrands(apiBrands);
            localStorage.setItem('adminBrands', JSON.stringify(apiBrands));
          }
        }

        if (apiPromosRes.status === 'fulfilled' && apiPromosRes.value.ok) {
          const apiPromos = await apiPromosRes.value.json();
          if (Array.isArray(apiPromos)) {
            setPromotions(apiPromos);
            localStorage.setItem('adminPromotions', JSON.stringify(apiPromos));
          }
        }
      } catch (e) {
        console.warn('AdminDataContext: API bootstrap failed, using local data');
      }
    };
    bootstrapFromApi();
  }, []);

  // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ç–æ–≤–∞—Ä–∞–º–∏
  const addProduct = (product) => {
    const newProduct = {
      ...product,
      id: Math.max(...products.map(p => p.id)) + 1
    };
    const updatedProducts = [...products, newProduct];
    setProducts(updatedProducts);
    localStorage.setItem('adminProducts', JSON.stringify(updatedProducts));
  };

  const updateProduct = (id, updatedProduct) => {
    const updatedProducts = products.map(product => 
      product.id === id ? { ...product, ...updatedProduct } : product
    );
    setProducts(updatedProducts);
    localStorage.setItem('adminProducts', JSON.stringify(updatedProducts));
  };

  const deleteProduct = (id) => {
    const updatedProducts = products.filter(product => product.id !== id);
    setProducts(updatedProducts);
    localStorage.setItem('adminProducts', JSON.stringify(updatedProducts));
  };

  // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏
  const addCategory = (categoryName, subcategories = []) => {
    const updatedCategories = {
      ...categories,
      [categoryName]: subcategories
    };
    setCategories(updatedCategories);
    localStorage.setItem('adminCategories', JSON.stringify(updatedCategories));
  };

  const updateCategory = (oldName, newName, subcategories) => {
    const updatedCategories = { ...categories };
    delete updatedCategories[oldName];
    updatedCategories[newName] = subcategories;
    setCategories(updatedCategories);
    localStorage.setItem('adminCategories', JSON.stringify(updatedCategories));
  };

  const deleteCategory = (categoryName) => {
    const updatedCategories = { ...categories };
    delete updatedCategories[categoryName];
    setCategories(updatedCategories);
    localStorage.setItem('adminCategories', JSON.stringify(updatedCategories));
  };

  // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –±—Ä–µ–Ω–¥–∞–º–∏
  const addBrand = (brandName) => {
    if (!brands.includes(brandName)) {
      const updatedBrands = [...brands, brandName];
      setBrands(updatedBrands);
      localStorage.setItem('adminBrands', JSON.stringify(updatedBrands));
    }
  };

  const deleteBrand = (brandName) => {
    const updatedBrands = brands.filter(brand => brand !== brandName);
    setBrands(updatedBrands);
    localStorage.setItem('adminBrands', JSON.stringify(updatedBrands));
  };

  // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∞–∫—Ü–∏—è–º–∏
  const addPromotion = (promotion) => {
    const newPromotion = {
      ...promotion,
      id: Math.max(...promotions.map(p => p.id)) + 1
    };
    const updatedPromotions = [...promotions, newPromotion];
    setPromotions(updatedPromotions);
    localStorage.setItem('adminPromotions', JSON.stringify(updatedPromotions));
  };

  const updatePromotion = (id, updatedPromotion) => {
    const updatedPromotions = promotions.map(promo => 
      promo.id === id ? { ...promo, ...updatedPromotion } : promo
    );
    setPromotions(updatedPromotions);
    localStorage.setItem('adminPromotions', JSON.stringify(updatedPromotions));
  };

  const deletePromotion = (id) => {
    const updatedPromotions = promotions.filter(promo => promo.id !== id);
    setPromotions(updatedPromotions);
    localStorage.setItem('adminPromotions', JSON.stringify(updatedPromotions));
  };

  // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞ "–û –∫–æ–º–ø–∞–Ω–∏–∏"
  const updateAboutContent = (newContent) => {
    console.log('AdminDataContext: Updating about content:', newContent);
    console.log('AdminDataContext: Previous about content:', aboutContent);
    console.log('AdminDataContext: Team data in new content:', newContent.team);
    console.log('AdminDataContext: History data in new content:', newContent.history);
    
    // –£–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª–Ω–∞—è
    const completeContent = {
      ...initialAboutContent,
      ...newContent,
      team: newContent.team || [],
      history: {
        ...initialAboutContent.history,
        ...(newContent.history || {})
      },
      footer: {
        ...initialAboutContent.footer,
        ...(newContent.footer || {})
      }
    };
    
    setAboutContent(completeContent);
    localStorage.setItem('adminAboutContent', JSON.stringify(completeContent));
    
    console.log('AdminDataContext: Complete content saved:', completeContent);
    console.log('AdminDataContext: Saved team:', completeContent.team);
    console.log('AdminDataContext: Saved history:', completeContent.history);
  };

  // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø–æ–ø—É–ª—è—Ä–Ω—ã–º–∏ —Ç–æ–≤–∞—Ä–∞–º–∏
  const updatePopularProducts = (productIds) => {
    setPopularProductIds(productIds);
    localStorage.setItem('adminPopularProducts', JSON.stringify(productIds));
  };

  const value = {
    // –î–∞–Ω–Ω—ã–µ
    products,
    categories,
    brands,
    promotions,
    aboutContent,
    popularProductIds,
    refreshFromApi: async () => {
      const [p, c, b, pr] = await Promise.all([
        fetch('/api/products').then(r => r.ok ? r.json() : []),
        fetch('/api/categories').then(r => r.ok ? r.json() : categoryStructure),
        fetch('/api/brands').then(r => r.ok ? r.json() : initialBrands),
        fetch('/api/promotions').then(r => r.ok ? r.json() : [])
      ]);
      const normalized = Array.isArray(p) ? p.map(migrateProductImages) : [];
      setProducts(normalized);
      setCategories(c);
      setBrands(b);
      setPromotions(pr);
      localStorage.setItem('adminProducts', JSON.stringify(normalized));
      localStorage.setItem('adminCategories', JSON.stringify(c));
      localStorage.setItem('adminBrands', JSON.stringify(b));
      localStorage.setItem('adminPromotions', JSON.stringify(pr));
    },
    
    // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ç–æ–≤–∞—Ä–æ–≤
    addProduct,
    updateProduct,
    deleteProduct,
    
    // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π
    addCategory,
    updateCategory,
    deleteCategory,
    
    // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –±—Ä–µ–Ω–¥–æ–≤
    addBrand,
    deleteBrand,
    
    // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∞–∫—Ü–∏–π
    addPromotion,
    updatePromotion,
    deletePromotion,
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞
    updateAboutContent,
    
    // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤
    updatePopularProducts
  };

  return (
    <AdminDataContext.Provider value={value}>
      {children}
    </AdminDataContext.Provider>
  );
};

```

- –°–¥–µ–ª–∞–ª –ø–ª–∞–Ω –∏ –Ω–∞—á–∞–ª —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é:
  - **–ë—ç–∫–µ–Ω–¥**: –¥–æ–±–∞–≤–∏–ª —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã `GET /api/categories`, `GET /api/brands`, `GET/POST/PUT/DELETE /api/promotions`, `GET/POST /api/orders`, `PATCH /api/orders/:id/status`, `POST /api/orders/:id/notes`, `POST /api/upload/image` –∏ —Å—Ç–∞—Ç–∏–∫—É `/uploads`.
  - **–§—Ä–æ–Ω—Ç–µ–Ω–¥**: 
    - `OrdersContext` –ø–µ—Ä–µ–≤–µ–¥—ë–Ω –Ω–∞ API (–∑–∞–≥—Ä—É–∑–∫–∞, —Å–æ–∑–¥–∞–Ω–∏–µ, —Å–º–µ–Ω–∞ —Å—Ç–∞—Ç—É—Å–∞, –∑–∞–º–µ—Ç–∫–∏).
    - `Cart.jsx` –∂–¥—ë—Ç `await createOrder(...)`.
    - `AdminDataContext` –≥—Ä—É–∑–∏—Ç —Ç–æ–≤–∞—Ä—ã/–∫–∞—Ç–µ–≥–æ—Ä–∏–∏/–±—Ä–µ–Ω–¥—ã/–∞–∫—Ü–∏–∏ –∏–∑ API —Å fallback –Ω–∞ –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏ –¥–∞—ë—Ç `refreshFromApi`.

- –ß—Ç–æ –¥–∞–ª—å—à–µ:
  - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ –∞–¥–º–∏–Ω–∫–µ —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –∑–∞–∫–∞–∑–∞ –∏ —Å–º–µ–Ω—É —Å—Ç–∞—Ç—É—Å–æ–≤/–∑–∞–º–µ—Ç–∫–∏.
  - –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –ø–µ—Ä–µ–≤–µ—Å—Ç–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞–º–∏/–∞–∫—Ü–∏—è–º–∏ –∏–∑ –∞–¥–º–∏–Ω–∫–∏ –ø–æ–ª–Ω–æ—Å—Ç—å—é –Ω–∞ API (CRUD).
  - –î–æ–±–∞–≤–∏—Ç—å –∑–∞–≥—Ä—É–∑–∫—É —Ä–µ–∞–ª—å–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —á–µ—Ä–µ–∑ `POST /api/upload/image` –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ URL –≤ –ë–î.

–°–∞–π—Ç –∑–∞–ø—É—â–µ–Ω –Ω–∞ `http://localhost:5174/`, API –Ω–∞ `http://localhost:3001/`.

---

**User**

–ü—Ä–æ–¥–æ–ª–∂–∞–π

---

**Cursor**

–ü—Ä–æ–≤–µ–¥—É –Ω–µ–±–æ–ª—å—à–æ–π –æ–±–∑–æ—Ä —Ñ–∞–π–ª–æ–≤ –∞–¥–º–∏–Ω–∫–∏ –¥–ª—è –∞–∫—Ü–∏–π –∏ —Ç–æ–≤–∞—Ä–æ–≤ –∏ –æ–±–Ω–æ–≤–ª—é –∏—Ö –Ω–∞ —Ä–∞–±–æ—Ç—É —á–µ—Ä–µ–∑ API: –∞–∫—Ü–∏–∏ (CRUD) –∏ –∫–Ω–æ–ø–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∏–∑ –ë–î. –ó–∞—Ç–µ–º –ø—Ä–æ–≤–µ—Ä—é —Å–±–æ—Ä–∫—É –∏ —Ä–∞–±–æ—Ç—É –∫–Ω–æ–ø–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –±–µ–∑ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞.

```javascriptreact
import React, { createContext, useContext, useState, useEffect } from 'react';
import { 
  categoryStructure, 
  initialProducts, 
  initialBrands, 
  initialPromotions, 
  initialAboutContent 
} from '../data/initialData.js';
import { migrateProductImages } from '../utils/imageHelpers';

const AdminDataContext = createContext();

export const useAdminData = () => {
  const context = useContext(AdminDataContext);
  if (!context) {
    throw new Error('useAdminData must be used within AdminDataProvider');
  }
  return context;
};

export const AdminDataProvider = ({ children }) => {
  // –°–æ—Å—Ç–æ—è–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
  const [products, setProducts] = useState(() => {
    const saved = localStorage.getItem('adminProducts');
    let productsData = saved ? JSON.parse(saved) : initialProducts;
    
    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –º–∏–≥—Ä–∏—Ä—É–µ–º products –ø—Ä–∏ –ø–µ—Ä–≤–æ–π –∑–∞–≥—Ä—É–∑–∫–µ
    productsData = productsData.map(product => migrateProductImages(product));
    
    return productsData;
  });

  const [categories, setCategories] = useState(() => {
    const saved = localStorage.getItem('adminCategories');
    return saved ? JSON.parse(saved) : categoryStructure;
  });

  const [brands, setBrands] = useState(() => {
    const saved = localStorage.getItem('adminBrands');
    return saved ? JSON.parse(saved) : initialBrands;
  });

  const [promotions, setPromotions] = useState(() => {
    const saved = localStorage.getItem('adminPromotions');
    // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –ø—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫ ‚Äî –Ω–∏–∫–∞–∫–∏—Ö –¥–µ–º–æ-–∞–∫—Ü–∏–π
    return saved ? JSON.parse(saved) : [];
  });

  const [aboutContent, setAboutContent] = useState(() => {
    const saved = localStorage.getItem('adminAboutContent');
    if (saved) {
      try {
        const parsedContent = JSON.parse(saved);
        // –ú–∏–≥—Ä–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
        const migratedContent = {
          ...initialAboutContent,
          ...parsedContent,
          team: parsedContent.team || initialAboutContent.team,
          history: {
            ...initialAboutContent.history,
            ...(parsedContent.history || {})
          },
          footer: {
            ...initialAboutContent.footer,
            ...(parsedContent.footer || {})
          },

        };
        console.log('AdminDataContext: Loaded and migrated about content:', migratedContent);
        return migratedContent;
      } catch (error) {
        console.error('AdminDataContext: Error parsing saved about content:', error);
        return initialAboutContent;
      }
    }
    console.log('AdminDataContext: Using initial about content');
    return initialAboutContent;
  });

  const [popularProductIds, setPopularProductIds] = useState(() => {
    const saved = localStorage.getItem('adminPopularProducts');
    return saved ? JSON.parse(saved) : [11, 1, 8, 2]; // ID –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
  });

  // –ü–µ—Ä–≤–∏—á–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –∏–∑ API (fallback –Ω–∞ –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ)
  useEffect(() => {
    const bootstrapFromApi = async () => {
      try {
        const [apiProductsRes, apiCategoriesRes, apiBrandsRes, apiPromosRes] = await Promise.allSettled([
          fetch('/api/products'),
          fetch('/api/categories'),
          fetch('/api/brands'),
          fetch('/api/promotions')
        ]);

        if (apiProductsRes.status === 'fulfilled' && apiProductsRes.value.ok) {
          const apiProducts = await apiProductsRes.value.json();
          const normalized = Array.isArray(apiProducts)
            ? apiProducts.map(p => migrateProductImages(p))
            : [];
          setProducts(normalized);
          localStorage.setItem('adminProducts', JSON.stringify(normalized));
        }

        if (apiCategoriesRes.status === 'fulfilled' && apiCategoriesRes.value.ok) {
          const apiCats = await apiCategoriesRes.value.json();
          if (apiCats && typeof apiCats === 'object') {
            setCategories(apiCats);
            localStorage.setItem('adminCategories', JSON.stringify(apiCats));
          }
        }

        if (apiBrandsRes.status === 'fulfilled' && apiBrandsRes.value.ok) {
          const apiBrands = await apiBrandsRes.value.json();
          if (Array.isArray(apiBrands) && apiBrands.length) {
            setBrands(apiBrands);
            localStorage.setItem('adminBrands', JSON.stringify(apiBrands));
          }
        }

        if (apiPromosRes.status === 'fulfilled' && apiPromosRes.value.ok) {
          const apiPromos = await apiPromosRes.value.json();
          if (Array.isArray(apiPromos)) {
            setPromotions(apiPromos);
            localStorage.setItem('adminPromotions', JSON.stringify(apiPromos));
          }
        }
      } catch (e) {
        console.warn('AdminDataContext: API bootstrap failed, using local data');
      }
    };
    bootstrapFromApi();
  }, []);

  // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ç–æ–≤–∞—Ä–∞–º–∏
  const addProduct = (product) => {
    const newProduct = {
      ...product,
      id: Math.max(...products.map(p => p.id)) + 1
    };
    const updatedProducts = [...products, newProduct];
    setProducts(updatedProducts);
    localStorage.setItem('adminProducts', JSON.stringify(updatedProducts));
  };

  const updateProduct = (id, updatedProduct) => {
    const updatedProducts = products.map(product => 
      product.id === id ? { ...product, ...updatedProduct } : product
    );
    setProducts(updatedProducts);
    localStorage.setItem('adminProducts', JSON.stringify(updatedProducts));
  };

  const deleteProduct = (id) => {
    const updatedProducts = products.filter(product => product.id !== id);
    setProducts(updatedProducts);
    localStorage.setItem('adminProducts', JSON.stringify(updatedProducts));
  };

  // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏
  const addCategory = (categoryName, subcategories = []) => {
    const updatedCategories = {
      ...categories,
      [categoryName]: subcategories
    };
    setCategories(updatedCategories);
    localStorage.setItem('adminCategories', JSON.stringify(updatedCategories));
  };

  const updateCategory = (oldName, newName, subcategories) => {
    const updatedCategories = { ...categories };
    delete updatedCategories[oldName];
    updatedCategories[newName] = subcategories;
    setCategories(updatedCategories);
    localStorage.setItem('adminCategories', JSON.stringify(updatedCategories));
  };

  const deleteCategory = (categoryName) => {
    const updatedCategories = { ...categories };
    delete updatedCategories[categoryName];
    setCategories(updatedCategories);
    localStorage.setItem('adminCategories', JSON.stringify(updatedCategories));
  };

  // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –±—Ä–µ–Ω–¥–∞–º–∏
  const addBrand = (brandName) => {
    if (!brands.includes(brandName)) {
      const updatedBrands = [...brands, brandName];
      setBrands(updatedBrands);
      localStorage.setItem('adminBrands', JSON.stringify(updatedBrands));
    }
  };

  const deleteBrand = (brandName) => {
    const updatedBrands = brands.filter(brand => brand !== brandName);
    setBrands(updatedBrands);
    localStorage.setItem('adminBrands', JSON.stringify(updatedBrands));
  };

  // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∞–∫—Ü–∏—è–º–∏
  const addPromotion = async (promotion) => {
    try {
      const payload = {
        ...promotion,
        category: promotion.category && promotion.category !== '–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏' ? promotion.category : null,
      };
      const res = await fetch('/api/promotions', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload)
      });
      if (!res.ok) throw new Error('Failed to create promotion');
      await refreshFromApi();
    } catch (e) {
      // Fallback: –ª–æ–∫–∞–ª—å–Ω–æ, –µ—Å–ª–∏ API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
      const newPromotion = {
        ...promotion,
        id: promotions.length ? Math.max(...promotions.map(p => p.id)) + 1 : 1
      };
      const updatedPromotions = [...promotions, newPromotion];
      setPromotions(updatedPromotions);
      localStorage.setItem('adminPromotions', JSON.stringify(updatedPromotions));
    }
  };

  const updatePromotion = async (id, updatedPromotion) => {
    try {
      const payload = {
        ...updatedPromotion,
        category: updatedPromotion.category && updatedPromotion.category !== '–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏' ? updatedPromotion.category : null,
      };
      const res = await fetch(`/api/promotions/${id}`, {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload)
      });
      if (!res.ok) throw new Error('Failed to update promotion');
      await refreshFromApi();
    } catch (e) {
      // Fallback –ª–æ–∫–∞–ª—å–Ω–æ
      const updatedPromotions = promotions.map(promo => 
        promo.id === id ? { ...promo, ...updatedPromotion } : promo
      );
      setPromotions(updatedPromotions);
      localStorage.setItem('adminPromotions', JSON.stringify(updatedPromotions));
    }
  };

  const deletePromotion = async (id) => {
    try {
      const res = await fetch(`/api/promotions/${id}`, { method: 'DELETE' });
      if (!res.ok) throw new Error('Failed to delete promotion');
      await refreshFromApi();
    } catch (e) {
      // Fallback –ª–æ–∫–∞–ª—å–Ω–æ
      const updatedPromotions = promotions.filter(promo => promo.id !== id);
      setPromotions(updatedPromotions);
      localStorage.setItem('adminPromotions', JSON.stringify(updatedPromotions));
    }
  };

  // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞ "–û –∫–æ–º–ø–∞–Ω–∏–∏"
  const updateAboutContent = (newContent) => {
    console.log('AdminDataContext: Updating about content:', newContent);
    console.log('AdminDataContext: Previous about content:', aboutContent);
    console.log('AdminDataContext: Team data in new content:', newContent.team);
    console.log('AdminDataContext: History data in new content:', newContent.history);
    
    // –£–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª–Ω–∞—è
    const completeContent = {
      ...initialAboutContent,
      ...newContent,
      team: newContent.team || [],
      history: {
        ...initialAboutContent.history,
        ...(newContent.history || {})
      },
      footer: {
        ...initialAboutContent.footer,
        ...(newContent.footer || {})
      }
    };
    
    setAboutContent(completeContent);
    localStorage.setItem('adminAboutContent', JSON.stringify(completeContent));
    
    console.log('AdminDataContext: Complete content saved:', completeContent);
    console.log('AdminDataContext: Saved team:', completeContent.team);
    console.log('AdminDataContext: Saved history:', completeContent.history);
  };

  // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø–æ–ø—É–ª—è—Ä–Ω—ã–º–∏ —Ç–æ–≤–∞—Ä–∞–º–∏
  const updatePopularProducts = (productIds) => {
    setPopularProductIds(productIds);
    localStorage.setItem('adminPopularProducts', JSON.stringify(productIds));
  };

  const value = {
    // –î–∞–Ω–Ω—ã–µ
    products,
    categories,
    brands,
    promotions,
    aboutContent,
    popularProductIds,
    refreshFromApi: async () => {
      const [p, c, b, pr] = await Promise.all([
        fetch('/api/products').then(r => r.ok ? r.json() : []),
        fetch('/api/categories').then(r => r.ok ? r.json() : categoryStructure),
        fetch('/api/brands').then(r => r.ok ? r.json() : initialBrands),
        fetch('/api/promotions').then(r => r.ok ? r.json() : [])
      ]);
      const normalized = Array.isArray(p) ? p.map(migrateProductImages) : [];
      setProducts(normalized);
      setCategories(c);
      setBrands(b);
      setPromotions(pr);
      localStorage.setItem('adminProducts', JSON.stringify(normalized));
      localStorage.setItem('adminCategories', JSON.stringify(c));
      localStorage.setItem('adminBrands', JSON.stringify(b));
      localStorage.setItem('adminPromotions', JSON.stringify(pr));
    },
    
    // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ç–æ–≤–∞—Ä–æ–≤
    addProduct,
    updateProduct,
    deleteProduct,
    
    // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π
    addCategory,
    updateCategory,
    deleteCategory,
    
    // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –±—Ä–µ–Ω–¥–æ–≤
    addBrand,
    deleteBrand,
    
    // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∞–∫—Ü–∏–π
    addPromotion,
    updatePromotion,
    deletePromotion,
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞
    updateAboutContent,
    
    // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤
    updatePopularProducts
  };

  return (
    <AdminDataContext.Provider value={value}>
      {children}
    </AdminDataContext.Provider>
  );
};

```

- –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã —Å–µ—Ä–≤–µ—Ä–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã: –∫–∞—Ç–µ–≥–æ—Ä–∏–∏, –±—Ä–µ–Ω–¥—ã, CRUD –∞–∫—Ü–∏–π, –∑–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞–º–∏ –∏ –∑–∞–º–µ—Ç–∫–∞–º–∏ –∑–∞–∫–∞–∑–æ–≤, –æ—Ç–¥–∞—á–∞ `/uploads`.
- –§—Ä–æ–Ω—Ç–µ–Ω–¥:
  - `AdminDataContext` –≥—Ä—É–∑–∏—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ API (fallback), –¥–æ–±–∞–≤–ª–µ–Ω `refreshFromApi`.
  - –ü–µ—Ä–µ–≤–µ–¥–µ–Ω—ã `addPromotion`, `updatePromotion`, `deletePromotion` –Ω–∞ API —Å fallback.
  - `OrdersContext` –∏ `Cart.jsx` —Ä–∞–±–æ—Ç–∞—é—Ç —á–µ—Ä–µ–∑ API.

–î–∞–ª—å—à–µ:
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ –∞–¥–º–∏–Ω–∫–µ CRUD –∞–∫—Ü–∏–π –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –±–µ–∑ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ (–∫–Ω–æ–ø–∫–∞ —Å–æ–∑–¥–∞—Ç—å/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å/—É–¥–∞–ª–∏—Ç—å).
- –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –ø–µ—Ä–µ–≤–µ—Å—Ç–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞–º–∏ –Ω–∞ API (—Å–ª–µ–¥—É—é—â–∏–º —à–∞–≥–æ–º).

---

**User**

–ü—Ä–æ–¥–æ–ª–∂–∞–π 

---

**Cursor**

–°–æ–±–µ—Ä—É –∏ –ø—Ä–∏–º–µ–Ω—é –ø—Ä–∞–≤–∫–∏: –¥–æ–±–∞–≤–ª—é CRUD —Ç–æ–≤–∞—Ä–æ–≤ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –∏ –ø–µ—Ä–µ–≤–µ–¥—É —Ñ—É–Ω–∫—Ü–∏–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞–º–∏ –≤ `AdminDataContext` –Ω–∞ —Ä–∞–±–æ—Ç—É —á–µ—Ä–µ–∑ API —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º —Å–ø–∏—Å–∫–∞. –ó–∞—Ç–µ–º –ø–µ—Ä–µ–∑–∞–ø—É—â—É —Å–µ—Ä–≤–µ—Ä.

```javascript
/* eslint-disable */
const express = require('express');
const cors = require('cors');
const path = require('path');
const { db, run, get, all } = require('./db');
const fs = require('fs');
const multer = require('multer');

const app = express();
const PORT = process.env.PORT || 3001;

app.use(cors());
app.use(express.json({ limit: '2mb' }));
// –°—Ç–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–∞–∑–¥–∞—á–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
const uploadsDir = path.join(__dirname, 'uploads');
if (!fs.existsSync(uploadsDir)) {
  fs.mkdirSync(uploadsDir, { recursive: true });
}
app.use('/uploads', express.static(uploadsDir));

// –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
const storage = multer.diskStorage({
  destination: (req, file, cb) => cb(null, uploadsDir),
  filename: (req, file, cb) => {
    const ext = path.extname(file.originalname) || '.png';
    const name = `${Date.now()}-${Math.round(Math.random() * 1e9)}${ext}`;
    cb(null, name);
  }
});
const upload = multer({ storage });

// Healthcheck
app.get('/api/health', (req, res) => {
  res.json({ ok: true });
});

// Upload image
app.post('/api/upload/image', upload.single('image'), (req, res) => {
  if (!req.file) return res.status(400).json({ error: 'No file' });
  const url = `/uploads/${req.file.filename}`;
  res.status(201).json({ url });
});

// Brands
app.get('/api/brands', async (req, res) => {
  try {
    const rows = await all(db, `SELECT id, name FROM brands ORDER BY name ASC`);
    res.json(rows.map(r => r.name));
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to fetch brands' });
  }
});

// Categories and subcategories as structure
app.get('/api/categories', async (req, res) => {
  try {
    const cats = await all(db, `SELECT id, name FROM categories ORDER BY name ASC`);
    const sub = await all(db, `SELECT id, category_id, name FROM subcategories ORDER BY name ASC`);
    const idToName = new Map(cats.map(c => [c.id, c.name]));
    const result = {};
    for (const c of cats) {
      result[c.name] = [];
    }
    for (const s of sub) {
      const catName = idToName.get(s.category_id);
      if (!catName) continue;
      result[catName].push(s.name);
    }
    res.json(result);
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to fetch categories' });
  }
});

// Products
app.get('/api/products', async (req, res) => {
  try {
    const rows = await all(
      db,
      `SELECT p.*, 
              c.name AS category_name, 
              s.name AS subcategory_name, 
              b.name AS brand_name
       FROM products p
       LEFT JOIN categories c ON p.category_id = c.id
       LEFT JOIN subcategories s ON p.subcategory_id = s.id
       LEFT JOIN brands b ON p.brand_id = b.id
       ORDER BY p.created_at DESC`
    );

    // –î–æ–±–∞–≤–ª—è–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
    const productIds = rows.map(r => r.id);
    const images = await all(
      db,
      `SELECT * FROM product_images WHERE product_id IN (${productIds.map(() => '?').join(',')})`,
      productIds
    );
    const productIdToImages = new Map();
    for (const img of images) {
      if (!productIdToImages.has(img.product_id)) productIdToImages.set(img.product_id, []);
      productIdToImages.get(img.product_id).push({ id: img.id, data: img.image_data, isMain: !!img.is_main });
    }

    const result = rows.map(r => ({
      id: r.id,
      title: r.title,
      price: r.price,
      category: r.category_name,
      subcategory: r.subcategory_name,
      brand: r.brand_name,
      available: !!r.available,
      quantity: r.quantity,
      description: r.description,
      specifications: r.specifications_json ? JSON.parse(r.specifications_json) : undefined,
      features: r.features_json ? JSON.parse(r.features_json) : undefined,
      images: productIdToImages.get(r.id) || [],
      createdAt: r.created_at,
      updatedAt: r.updated_at
    }));

    res.json(result);
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to fetch products' });
  }
});

// Helpers to ensure catalog entities
async function ensureCategoryByName(name) {
  if (!name) return null;
  const row = await get(db, `SELECT id FROM categories WHERE name = ?`, [name]);
  if (row) return row.id;
  const r = await run(db, `INSERT INTO categories (name) VALUES (?)`, [name]);
  return r.lastID;
}

async function ensureSubcategoryByName(categoryId, name) {
  if (!name || !categoryId) return null;
  const row = await get(db, `SELECT id FROM subcategories WHERE category_id = ? AND name = ?`, [categoryId, name]);
  if (row) return row.id;
  const r = await run(db, `INSERT INTO subcategories (category_id, name) VALUES (?, ?)`, [categoryId, name]);
  return r.lastID;
}

async function ensureBrandByName(name) {
  if (!name) return null;
  const row = await get(db, `SELECT id FROM brands WHERE name = ?`, [name]);
  if (row) return row.id;
  const r = await run(db, `INSERT INTO brands (name) VALUES (?)`, [name]);
  return r.lastID;
}

// Create product
app.post('/api/products', async (req, res) => {
  try {
    const { title, price, category, subcategory, brand, available = true, quantity = 0, description = null, specifications, features, images } = req.body;

    const categoryId = await ensureCategoryByName(category);
    const subcategoryId = await ensureSubcategoryByName(categoryId, subcategory);
    const brandId = await ensureBrandByName(brand);

    const specJson = specifications ? JSON.stringify(specifications) : null;
    const featJson = features ? JSON.stringify(features) : null;

    const r = await run(
      db,
      `INSERT INTO products (title, price, category_id, subcategory_id, brand_id, available, quantity, description, specifications_json, features_json)
       VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)`,
      [title, price, categoryId, subcategoryId, brandId, available ? 1 : 0, quantity, description, specJson, featJson]
    );

    const productId = r.lastID;
    if (Array.isArray(images)) {
      for (const img of images) {
        await run(db, `INSERT INTO product_images (product_id, image_data, is_main) VALUES (?, ?, ?)`, [productId, img.data, img.isMain ? 1 : 0]);
      }
    }

    res.status(201).json({ id: productId });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to create product' });
  }
});

// Update product
app.put('/api/products/:id', async (req, res) => {
  try {
    const id = Number(req.params.id);
    const { title, price, category, subcategory, brand, available = true, quantity = 0, description = null, specifications, features, images } = req.body;

    const categoryId = await ensureCategoryByName(category);
    const subcategoryId = await ensureSubcategoryByName(categoryId, subcategory);
    const brandId = await ensureBrandByName(brand);

    const specJson = specifications ? JSON.stringify(specifications) : null;
    const featJson = features ? JSON.stringify(features) : null;

    await run(
      db,
      `UPDATE products SET title=?, price=?, category_id=?, subcategory_id=?, brand_id=?, available=?, quantity=?, description=?, specifications_json=?, features_json=?, updated_at = datetime('now') WHERE id=?`,
      [title, price, categoryId, subcategoryId, brandId, available ? 1 : 0, quantity, description, specJson, featJson, id]
    );

    // replace images
    if (Array.isArray(images)) {
      await run(db, `DELETE FROM product_images WHERE product_id = ?`, [id]);
      for (const img of images) {
        await run(db, `INSERT INTO product_images (product_id, image_data, is_main) VALUES (?, ?, ?)`, [id, img.data, img.isMain ? 1 : 0]);
      }
    }

    res.json({ ok: true });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to update product' });
  }
});

// Delete product
app.delete('/api/products/:id', async (req, res) => {
  try {
    const id = Number(req.params.id);
    await run(db, `DELETE FROM products WHERE id=?`, [id]);
    res.json({ ok: true });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to delete product' });
  }
});

// Promotions
app.get('/api/promotions', async (req, res) => {
  try {
    const rows = await all(
      db,
      `SELECT p.*, c.name AS category_name FROM promotions p
       LEFT JOIN categories c ON p.category_id = c.id
       WHERE p.active = 1
       ORDER BY p.featured DESC, p.id DESC`
    );
    const result = rows.map(r => ({
      id: r.id,
      title: r.title,
      description: r.description,
      discount: r.discount,
      category: r.category_name,
      validUntil: r.valid_until,
      active: !!r.active,
      featured: !!r.featured,
      minPurchase: r.min_purchase
    }));
    res.json(result);
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to fetch promotions' });
  }
});

// Promotions CRUD (–º–∏–Ω–∏–º—É–º)
app.post('/api/promotions', async (req, res) => {
  try {
    const { title, description, discount, category, validUntil, active = true, featured = false, minPurchase } = req.body;
    const catId = category ? (await get(db, `SELECT id FROM categories WHERE name = ?`, [category]))?.id : null;
    const r = await run(
      db,
      `INSERT INTO promotions (title, description, discount, category_id, valid_until, active, featured, min_purchase)
       VALUES (?, ?, ?, ?, ?, ?, ?, ?)`,
      [title, description ?? null, discount, catId ?? null, validUntil ?? null, active ? 1 : 0, featured ? 1 : 0, minPurchase ?? null]
    );
    res.status(201).json({ id: r.lastID });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to create promotion' });
  }
});

app.put('/api/promotions/:id', async (req, res) => {
  try {
    const id = Number(req.params.id);
    const { title, description, discount, category, validUntil, active, featured, minPurchase } = req.body;
    const catId = category ? (await get(db, `SELECT id FROM categories WHERE name = ?`, [category]))?.id : null;
    await run(
      db,
      `UPDATE promotions SET title=?, description=?, discount=?, category_id=?, valid_until=?, active=?, featured=?, min_purchase=? WHERE id=?`,
      [title, description ?? null, discount, catId ?? null, validUntil ?? null, active ? 1 : 0, featured ? 1 : 0, minPurchase ?? null, id]
    );
    res.json({ ok: true });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to update promotion' });
  }
});

app.delete('/api/promotions/:id', async (req, res) => {
  try {
    const id = Number(req.params.id);
    await run(db, `DELETE FROM promotions WHERE id=?`, [id]);
    res.json({ ok: true });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to delete promotion' });
  }
});

// Orders
app.get('/api/orders', async (req, res) => {
  try {
    const orders = await all(db, `SELECT * FROM orders ORDER BY created_at DESC`);
    const orderIds = orders.map(o => o.id);
    let items = [];
    if (orderIds.length) {
      items = await all(db, `SELECT * FROM order_items WHERE order_id IN (${orderIds.map(() => '?').join(',')})`, orderIds);
    }
    const orderIdToItems = new Map();
    for (const it of items) {
      if (!orderIdToItems.has(it.order_id)) orderIdToItems.set(it.order_id, []);
      orderIdToItems.get(it.order_id).push({
        id: it.id,
        productId: it.product_id,
        title: it.title,
        price: it.price,
        quantity: it.quantity
      });
    }

    // notes
    let notes = [];
    if (orderIds.length) {
      notes = await all(db, `SELECT * FROM order_notes WHERE order_id IN (${orderIds.map(() => '?').join(',')}) ORDER BY timestamp ASC`, orderIds);
    }
    const orderIdToNotes = new Map();
    for (const n of notes) {
      if (!orderIdToNotes.has(n.order_id)) orderIdToNotes.set(n.order_id, []);
      orderIdToNotes.get(n.order_id).push({
        id: n.id,
        text: n.text,
        type: n.type,
        timestamp: n.timestamp
      });
    }

    const result = [];
    for (const o of orders) {
      const customer = o.customer_id ? await get(db, `SELECT * FROM customers WHERE id = ?`, [o.customer_id]) : null;
      result.push({
        id: o.id,
        orderNumber: o.order_number,
        status: o.status,
        pricing: JSON.parse(o.pricing_json),
        items: orderIdToItems.get(o.id) || [],
        customerInfo: customer || { name: '', phone: '', email: null, address: null },
        notes: orderIdToNotes.get(o.id) || [],
        createdAt: o.created_at,
        updatedAt: o.updated_at
      });
    }
    res.json(result);
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to fetch orders' });
  }
});

app.post('/api/orders', async (req, res) => {
  try {
    const { orderForm, cartItems, priceCalculation, orderNumber } = req.body;

    // customer
    let customerId = null;
    if (orderForm) {
      const r = await run(
        db,
        `INSERT INTO customers (name, phone, email, address) VALUES (?, ?, ?, ?)`,
        [orderForm.name, orderForm.phone, orderForm.email ?? null, orderForm.address ?? null]
      );
      customerId = r.lastID;
    }

    const id = String(orderNumber);
    await run(
      db,
      `INSERT INTO orders (id, order_number, customer_id, status, pricing_json) VALUES (?, ?, ?, 'new', ?)` ,
      [id, String(orderNumber), customerId, JSON.stringify(priceCalculation)]
    );

    if (Array.isArray(cartItems)) {
      for (const it of cartItems) {
        await run(
          db,
          `INSERT INTO order_items (order_id, product_id, title, price, quantity) VALUES (?, ?, ?, ?, ?)`,
          [id, it.id ?? null, it.title, it.price, it.quantity]
        );
      }
    }

    res.status(201).json({ ok: true, id, orderNumber });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to create order' });
  }
});

// Orders: update status
app.patch('/api/orders/:id/status', async (req, res) => {
  try {
    const { id } = req.params;
    const { status } = req.body;
    await run(db, `UPDATE orders SET status=?, updated_at = datetime('now') WHERE id=?`, [status, id]);
    res.json({ ok: true });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to update status' });
  }
});

// Orders: add note
app.post('/api/orders/:id/notes', async (req, res) => {
  try {
    const { id } = req.params;
    const { text, type = 'note' } = req.body;
    const r = await run(db, `INSERT INTO order_notes (order_id, text, type) VALUES (?, ?, ?)`, [id, text, type]);
    res.status(201).json({ id: r.lastID });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to add note' });
  }
});

app.listen(PORT, () => {
  console.log(`API server listening on http://localhost:${PORT}`);
});



```

```javascriptreact
import React, { createContext, useContext, useState, useEffect } from 'react';
import { 
  categoryStructure, 
  initialProducts, 
  initialBrands, 
  initialPromotions, 
  initialAboutContent 
} from '../data/initialData.js';
import { migrateProductImages } from '../utils/imageHelpers';

const AdminDataContext = createContext();

export const useAdminData = () => {
  const context = useContext(AdminDataContext);
  if (!context) {
    throw new Error('useAdminData must be used within AdminDataProvider');
  }
  return context;
};

export const AdminDataProvider = ({ children }) => {
  // –°–æ—Å—Ç–æ—è–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
  const [products, setProducts] = useState(() => {
    const saved = localStorage.getItem('adminProducts');
    let productsData = saved ? JSON.parse(saved) : initialProducts;
    
    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –º–∏–≥—Ä–∏—Ä—É–µ–º products –ø—Ä–∏ –ø–µ—Ä–≤–æ–π –∑–∞–≥—Ä—É–∑–∫–µ
    productsData = productsData.map(product => migrateProductImages(product));
    
    return productsData;
  });

  const [categories, setCategories] = useState(() => {
    const saved = localStorage.getItem('adminCategories');
    return saved ? JSON.parse(saved) : categoryStructure;
  });

  const [brands, setBrands] = useState(() => {
    const saved = localStorage.getItem('adminBrands');
    return saved ? JSON.parse(saved) : initialBrands;
  });

  const [promotions, setPromotions] = useState(() => {
    const saved = localStorage.getItem('adminPromotions');
    // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –ø—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫ ‚Äî –Ω–∏–∫–∞–∫–∏—Ö –¥–µ–º–æ-–∞–∫—Ü–∏–π
    return saved ? JSON.parse(saved) : [];
  });

  const [aboutContent, setAboutContent] = useState(() => {
    const saved = localStorage.getItem('adminAboutContent');
    if (saved) {
      try {
        const parsedContent = JSON.parse(saved);
        // –ú–∏–≥—Ä–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
        const migratedContent = {
          ...initialAboutContent,
          ...parsedContent,
          team: parsedContent.team || initialAboutContent.team,
          history: {
            ...initialAboutContent.history,
            ...(parsedContent.history || {})
          },
          footer: {
            ...initialAboutContent.footer,
            ...(parsedContent.footer || {})
          },

        };
        console.log('AdminDataContext: Loaded and migrated about content:', migratedContent);
        return migratedContent;
      } catch (error) {
        console.error('AdminDataContext: Error parsing saved about content:', error);
        return initialAboutContent;
      }
    }
    console.log('AdminDataContext: Using initial about content');
    return initialAboutContent;
  });

  const [popularProductIds, setPopularProductIds] = useState(() => {
    const saved = localStorage.getItem('adminPopularProducts');
    return saved ? JSON.parse(saved) : [11, 1, 8, 2]; // ID –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
  });

  // –ü–µ—Ä–≤–∏—á–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –∏–∑ API (fallback –Ω–∞ –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ)
  useEffect(() => {
    const bootstrapFromApi = async () => {
      try {
        const [apiProductsRes, apiCategoriesRes, apiBrandsRes, apiPromosRes] = await Promise.allSettled([
          fetch('/api/products'),
          fetch('/api/categories'),
          fetch('/api/brands'),
          fetch('/api/promotions')
        ]);

        if (apiProductsRes.status === 'fulfilled' && apiProductsRes.value.ok) {
          const apiProducts = await apiProductsRes.value.json();
          const normalized = Array.isArray(apiProducts)
            ? apiProducts.map(p => migrateProductImages(p))
            : [];
          setProducts(normalized);
          localStorage.setItem('adminProducts', JSON.stringify(normalized));
        }

        if (apiCategoriesRes.status === 'fulfilled' && apiCategoriesRes.value.ok) {
          const apiCats = await apiCategoriesRes.value.json();
          if (apiCats && typeof apiCats === 'object') {
            setCategories(apiCats);
            localStorage.setItem('adminCategories', JSON.stringify(apiCats));
          }
        }

        if (apiBrandsRes.status === 'fulfilled' && apiBrandsRes.value.ok) {
          const apiBrands = await apiBrandsRes.value.json();
          if (Array.isArray(apiBrands) && apiBrands.length) {
            setBrands(apiBrands);
            localStorage.setItem('adminBrands', JSON.stringify(apiBrands));
          }
        }

        if (apiPromosRes.status === 'fulfilled' && apiPromosRes.value.ok) {
          const apiPromos = await apiPromosRes.value.json();
          if (Array.isArray(apiPromos)) {
            setPromotions(apiPromos);
            localStorage.setItem('adminPromotions', JSON.stringify(apiPromos));
          }
        }
      } catch (e) {
        console.warn('AdminDataContext: API bootstrap failed, using local data');
      }
    };
    bootstrapFromApi();
  }, []);

  // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ç–æ–≤–∞—Ä–∞–º–∏
  const addProduct = async (product) => {
    try {
      const res = await fetch('/api/products', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(product)
      });
      if (!res.ok) throw new Error('Failed to create product');
      await refreshFromApi();
    } catch (e) {
      // Fallback –ª–æ–∫–∞–ª—å–Ω–æ
      const newProduct = {
        ...product,
        id: products.length ? Math.max(...products.map(p => p.id)) + 1 : 1
      };
      const updatedProducts = [...products, newProduct];
      setProducts(updatedProducts);
      localStorage.setItem('adminProducts', JSON.stringify(updatedProducts));
    }
  };

  const updateProduct = async (id, updatedProduct) => {
    try {
      const res = await fetch(`/api/products/${id}`, {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(updatedProduct)
      });
      if (!res.ok) throw new Error('Failed to update product');
      await refreshFromApi();
    } catch (e) {
      const updatedProducts = products.map(product => 
        product.id === id ? { ...product, ...updatedProduct } : product
      );
      setProducts(updatedProducts);
      localStorage.setItem('adminProducts', JSON.stringify(updatedProducts));
    }
  };

  const deleteProduct = async (id) => {
    try {
      const res = await fetch(`/api/products/${id}`, { method: 'DELETE' });
      if (!res.ok) throw new Error('Failed to delete product');
      await refreshFromApi();
    } catch (e) {
      const updatedProducts = products.filter(product => product.id !== id);
      setProducts(updatedProducts);
      localStorage.setItem('adminProducts', JSON.stringify(updatedProducts));
    }
  };

  // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏
  const addCategory = (categoryName, subcategories = []) => {
    const updatedCategories = {
      ...categories,
      [categoryName]: subcategories
    };
    setCategories(updatedCategories);
    localStorage.setItem('adminCategories', JSON.stringify(updatedCategories));
  };

  const updateCategory = (oldName, newName, subcategories) => {
    const updatedCategories = { ...categories };
    delete updatedCategories[oldName];
    updatedCategories[newName] = subcategories;
    setCategories(updatedCategories);
    localStorage.setItem('adminCategories', JSON.stringify(updatedCategories));
  };

  const deleteCategory = (categoryName) => {
    const updatedCategories = { ...categories };
    delete updatedCategories[categoryName];
    setCategories(updatedCategories);
    localStorage.setItem('adminCategories', JSON.stringify(updatedCategories));
  };

  // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –±—Ä–µ–Ω–¥–∞–º–∏
  const addBrand = (brandName) => {
    if (!brands.includes(brandName)) {
      const updatedBrands = [...brands, brandName];
      setBrands(updatedBrands);
      localStorage.setItem('adminBrands', JSON.stringify(updatedBrands));
    }
  };

  const deleteBrand = (brandName) => {
    const updatedBrands = brands.filter(brand => brand !== brandName);
    setBrands(updatedBrands);
    localStorage.setItem('adminBrands', JSON.stringify(updatedBrands));
  };

  // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∞–∫—Ü–∏—è–º–∏
  const addPromotion = async (promotion) => {
    try {
      const payload = {
        ...promotion,
        category: promotion.category && promotion.category !== '–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏' ? promotion.category : null,
      };
      const res = await fetch('/api/promotions', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload)
      });
      if (!res.ok) throw new Error('Failed to create promotion');
      await refreshFromApi();
    } catch (e) {
      // Fallback: –ª–æ–∫–∞–ª—å–Ω–æ, –µ—Å–ª–∏ API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
      const newPromotion = {
        ...promotion,
        id: promotions.length ? Math.max(...promotions.map(p => p.id)) + 1 : 1
      };
      const updatedPromotions = [...promotions, newPromotion];
      setPromotions(updatedPromotions);
      localStorage.setItem('adminPromotions', JSON.stringify(updatedPromotions));
    }
  };

  const updatePromotion = async (id, updatedPromotion) => {
    try {
      const payload = {
        ...updatedPromotion,
        category: updatedPromotion.category && updatedPromotion.category !== '–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏' ? updatedPromotion.category : null,
      };
      const res = await fetch(`/api/promotions/${id}`, {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload)
      });
      if (!res.ok) throw new Error('Failed to update promotion');
      await refreshFromApi();
    } catch (e) {
      // Fallback –ª–æ–∫–∞–ª—å–Ω–æ
      const updatedPromotions = promotions.map(promo => 
        promo.id === id ? { ...promo, ...updatedPromotion } : promo
      );
      setPromotions(updatedPromotions);
      localStorage.setItem('adminPromotions', JSON.stringify(updatedPromotions));
    }
  };

  const deletePromotion = async (id) => {
    try {
      const res = await fetch(`/api/promotions/${id}`, { method: 'DELETE' });
      if (!res.ok) throw new Error('Failed to delete promotion');
      await refreshFromApi();
    } catch (e) {
      // Fallback –ª–æ–∫–∞–ª—å–Ω–æ
      const updatedPromotions = promotions.filter(promo => promo.id !== id);
      setPromotions(updatedPromotions);
      localStorage.setItem('adminPromotions', JSON.stringify(updatedPromotions));
    }
  };

  // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞ "–û –∫–æ–º–ø–∞–Ω–∏–∏"
  const updateAboutContent = (newContent) => {
    console.log('AdminDataContext: Updating about content:', newContent);
    console.log('AdminDataContext: Previous about content:', aboutContent);
    console.log('AdminDataContext: Team data in new content:', newContent.team);
    console.log('AdminDataContext: History data in new content:', newContent.history);
    
    // –£–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª–Ω–∞—è
    const completeContent = {
      ...initialAboutContent,
      ...newContent,
      team: newContent.team || [],
      history: {
        ...initialAboutContent.history,
        ...(newContent.history || {})
      },
      footer: {
        ...initialAboutContent.footer,
        ...(newContent.footer || {})
      }
    };
    
    setAboutContent(completeContent);
    localStorage.setItem('adminAboutContent', JSON.stringify(completeContent));
    
    console.log('AdminDataContext: Complete content saved:', completeContent);
    console.log('AdminDataContext: Saved team:', completeContent.team);
    console.log('AdminDataContext: Saved history:', completeContent.history);
  };

  // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø–æ–ø—É–ª—è—Ä–Ω—ã–º–∏ —Ç–æ–≤–∞—Ä–∞–º–∏
  const updatePopularProducts = (productIds) => {
    setPopularProductIds(productIds);
    localStorage.setItem('adminPopularProducts', JSON.stringify(productIds));
  };

  const value = {
    // –î–∞–Ω–Ω—ã–µ
    products,
    categories,
    brands,
    promotions,
    aboutContent,
    popularProductIds,
    refreshFromApi: async () => {
      const [p, c, b, pr] = await Promise.all([
        fetch('/api/products').then(r => r.ok ? r.json() : []),
        fetch('/api/categories').then(r => r.ok ? r.json() : categoryStructure),
        fetch('/api/brands').then(r => r.ok ? r.json() : initialBrands),
        fetch('/api/promotions').then(r => r.ok ? r.json() : [])
      ]);
      const normalized = Array.isArray(p) ? p.map(migrateProductImages) : [];
      setProducts(normalized);
      setCategories(c);
      setBrands(b);
      setPromotions(pr);
      localStorage.setItem('adminProducts', JSON.stringify(normalized));
      localStorage.setItem('adminCategories', JSON.stringify(c));
      localStorage.setItem('adminBrands', JSON.stringify(b));
      localStorage.setItem('adminPromotions', JSON.stringify(pr));
    },
    
    // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ç–æ–≤–∞—Ä–æ–≤
    addProduct,
    updateProduct,
    deleteProduct,
    
    // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π
    addCategory,
    updateCategory,
    deleteCategory,
    
    // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –±—Ä–µ–Ω–¥–æ–≤
    addBrand,
    deleteBrand,
    
    // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∞–∫—Ü–∏–π
    addPromotion,
    updatePromotion,
    deletePromotion,
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞
    updateAboutContent,
    
    // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤
    updatePopularProducts
  };

  return (
    <AdminDataContext.Provider value={value}>
      {children}
    </AdminDataContext.Provider>
  );
};

```

- –î–æ–±–∞–≤–∏–ª –Ω–∞ —Å–µ—Ä–≤–µ—Ä CRUD –¥–ª—è —Ç–æ–≤–∞—Ä–æ–≤: `POST/PUT/DELETE /api/products` (—Å–æ–∑–¥–∞–Ω–∏–µ/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ), —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–π, –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–π, –±—Ä–µ–Ω–¥–æ–≤ –∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π.
- –û–±–Ω–æ–≤–∏–ª `AdminDataContext`:
  - `addProduct`, `updateProduct`, `deleteProduct` —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É—é—Ç API, —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º `refreshFromApi()` –∏ fallback –Ω–∞ –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö.
  - –†–∞–Ω–µ–µ —É–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã API-–≤–µ—Ä—Å–∏–∏ –¥–ª—è –∞–∫—Ü–∏–π –∏ –∑–∞–≥—Ä—É–∑–∫–∞ initial –¥–∞–Ω–Ω—ã—Ö.

–ß—Ç–æ –¥–∞–ª—å—à–µ:
- –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –≤ –∞–¥–º–∏–Ω–∫–µ —Å–æ–∑–¥–∞–Ω–∏–µ/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ –∏ –∞–∫—Ü–∏–∏; –¥–∞–Ω–Ω—ã–µ –¥–æ–ª–∂–Ω—ã —Å–æ—Ö—Ä–∞–Ω—è—Ç—å—Å—è –≤ SQLite –∏ –æ—Ç—Ä–∞–∂–∞—Ç—å—Å—è —Å—Ä–∞–∑—É.
- –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –¥–æ–±–∞–≤–ª—é –∑–∞–≥—Ä—É–∑–∫—É —Ñ–∞–π–ª–æ–≤ —á–µ—Ä–µ–∑ `POST /api/upload/image` –≤ `MultiImageUpload` (—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ URL –≤–º–µ—Å—Ç–æ dataURL) –∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –ø—Ä–∞–≤–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –Ω–∞ —Å–µ—Ä–≤–µ—Ä.

---

**User**

–ì–¥–µ —Ö—Ä–∞–Ω–∏—Ç—Å—è –±–¥?

---

**Cursor**

**–ö–æ—Ä–æ—Ç–∫–æ:** –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö ‚Äî —ç—Ç–æ —Ñ–∞–π–ª SQLite –ø–æ –ø—É—Ç–∏ `server/db.sqlite3`.

- **–ì–¥–µ —Å–æ–∑–¥–∞—ë—Ç—Å—è**: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –º–∏–≥—Ä–∞—Ü–∏—è—Ö/–∑–∞–ø—É—Å–∫–µ —Å–µ—Ä–≤–µ—Ä–∞ (—Å–º. `server/db.js` ‚Äî –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∞ `DB_FILE`).
- **–ö–∞–∫ –∏–∑–º–µ–Ω–∏—Ç—å –ø—É—Ç—å**: –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å `DB_FILE` –≤ `server/db.js`.
- **–ë—ç–∫–∞–ø/—Å–±—Ä–æ—Å**: –∫–æ–ø–∏—Ä—É–π—Ç–µ/—É–¥–∞–ª—è–π—Ç–µ —Ñ–∞–π–ª `server/db.sqlite3` (–ø–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –∑–∞–Ω–æ–≤–æ).

---

**User**

–í—Å—ë —á—Ç–æ —è –º–µ–Ω—è—é –≤ –∞–¥–º–∏–Ω–∫–µ –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –±–¥

---

**Cursor**

–°–Ω–∞—á–∞–ª–∞ –¥–æ–±–∞–≤–ª—é –Ω–∞ —Å–µ—Ä–≤–µ—Ä CRUD –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π/–ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–π –∏ –±—Ä–µ–Ω–¥–æ–≤, –∑–∞—Ç–µ–º –ø–µ—Ä–µ–≤–µ–¥—É —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –≤ `AdminDataContext` –Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —ç—Ç–∏—Ö —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤. –ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞—Ç—å –Ω–∏—á–µ–≥–æ –Ω–µ –Ω—É–∂–Ω–æ ‚Äî —Ñ—Ä–æ–Ω—Ç –ø–æ–¥—Ç—è–Ω–µ—Ç –¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ `refreshFromApi`.

```javascript
*** Begin Patch
*** Update File: server/index.js
@@
 app.get('/api/categories', async (req, res) => {
   try {
     const cats = await all(db, `SELECT id, name FROM categories ORDER BY name ASC`);
     const sub = await all(db, `SELECT id, category_id, name FROM subcategories ORDER BY name ASC`);
@@
     res.json(result);
   } catch (err) {
     console.error(err);
     res.status(500).json({ error: 'Failed to fetch categories' });
   }
 });
+
+// Categories CRUD by name
+app.post('/api/categories', async (req, res) => {
+  try {
+    const { name, subcategories = [] } = req.body;
+    const catId = await ensureCategoryByName(name);
+    // ensure subs
+    for (const s of subcategories) {
+      await ensureSubcategoryByName(catId, s);
+    }
+    res.status(201).json({ ok: true });
+  } catch (err) {
+    console.error(err);
+    res.status(500).json({ error: 'Failed to create category' });
+  }
+});
+
+app.put('/api/categories/:name', async (req, res) => {
+  try {
+    const oldName = req.params.name;
+    const { newName } = req.body;
+    await run(db, `UPDATE categories SET name=? WHERE name=?`, [newName, oldName]);
+    res.json({ ok: true });
+  } catch (err) {
+    console.error(err);
+    res.status(500).json({ error: 'Failed to rename category' });
+  }
+});
+
+app.delete('/api/categories/:name', async (req, res) => {
+  try {
+    const name = req.params.name;
+    await run(db, `DELETE FROM categories WHERE name=?`, [name]);
+    res.json({ ok: true });
+  } catch (err) {
+    console.error(err);
+    res.status(500).json({ error: 'Failed to delete category' });
+  }
+});
+
+// Replace subcategories set for category
+app.put('/api/categories/:name/subcategories', async (req, res) => {
+  try {
+    const name = req.params.name;
+    const { subcategories = [] } = req.body;
+    const cat = await get(db, `SELECT id FROM categories WHERE name=?`, [name]);
+    if (!cat) return res.status(404).json({ error: 'Category not found' });
+    await run(db, `DELETE FROM subcategories WHERE category_id=?`, [cat.id]);
+    for (const s of subcategories) {
+      await ensureSubcategoryByName(cat.id, s);
+    }
+    res.json({ ok: true });
+  } catch (err) {
+    console.error(err);
+    res.status(500).json({ error: 'Failed to set subcategories' });
+  }
+});
@@
 app.get('/api/brands', async (req, res) => {
   try {
     const rows = await all(db, `SELECT id, name FROM brands ORDER BY name ASC`);
     res.json(rows.map(r => r.name));
   } catch (err) {
     console.error(err);
     res.status(500).json({ error: 'Failed to fetch brands' });
   }
 });
+
+app.post('/api/brands', async (req, res) => {
+  try {
+    const { name } = req.body;
+    await ensureBrandByName(name);
+    res.status(201).json({ ok: true });
+  } catch (err) {
+    console.error(err);
+    res.status(500).json({ error: 'Failed to create brand' });
+  }
+});
+
+app.delete('/api/brands/:name', async (req, res) => {
+  try {
+    const { name } = req.params;
+    await run(db, `DELETE FROM brands WHERE name=?`, [name]);
+    res.json({ ok: true });
+  } catch (err) {
+    console.error(err);
+    res.status(500).json({ error: 'Failed to delete brand' });
+  }
+});
*** End Patch
```

```javascript
*** Begin Patch
*** Update File: server/index.js
@@
 app.get('/api/categories', async (req, res) => {
@@
 });
+
+// Categories CRUD by name
+app.post('/api/categories', async (req, res) => {
+  try {
+    const { name, subcategories = [] } = req.body;
+    const catId = await ensureCategoryByName(name);
+    // ensure subs
+    for (const s of subcategories) {
+      await ensureSubcategoryByName(catId, s);
+    }
+    res.status(201).json({ ok: true });
+  } catch (err) {
+    console.error(err);
+    res.status(500).json({ error: 'Failed to create category' });
+  }
+});
+
+app.put('/api/categories/:name', async (req, res) => {
+  try {
+    const oldName = req.params.name;
+    const { newName } = req.body;
+    await run(db, `UPDATE categories SET name=? WHERE name=?`, [newName, oldName]);
+    res.json({ ok: true });
+  } catch (err) {
+    console.error(err);
+    res.status(500).json({ error: 'Failed to rename category' });
+  }
+});
+
+app.delete('/api/categories/:name', async (req, res) => {
+  try {
+    const name = req.params.name;
+    await run(db, `DELETE FROM categories WHERE name=?`, [name]);
+    res.json({ ok: true });
+  } catch (err) {
+    console.error(err);
+    res.status(500).json({ error: 'Failed to delete category' });
+  }
+});
+
+// Replace subcategories set for category
+app.put('/api/categories/:name/subcategories', async (req, res) => {
+  try {
+    const name = req.params.name;
+    const { subcategories = [] } = req.body;
+    const cat = await get(db, `SELECT id FROM categories WHERE name=?`, [name]);
+    if (!cat) return res.status(404).json({ error: 'Category not found' });
+    await run(db, `DELETE FROM subcategories WHERE category_id=?`, [cat.id]);
+    for (const s of subcategories) {
+      await ensureSubcategoryByName(cat.id, s);
+    }
+    res.json({ ok: true });
+  } catch (err) {
+    console.error(err);
+    res.status(500).json({ error: 'Failed to set subcategories' });
+  }
+});
@@
 app.get('/api/brands', async (req, res) => {
@@
 });
+
+app.post('/api/brands', async (req, res) => {
+  try {
+    const { name } = req.body;
+    await ensureBrandByName(name);
+    res.status(201).json({ ok: true });
+  } catch (err) {
+    console.error(err);
+    res.status(500).json({ error: 'Failed to create brand' });
+  }
+});
+
+app.delete('/api/brands/:name', async (req, res) => {
+  try {
+    const { name } = req.params;
+    await run(db, `DELETE FROM brands WHERE name=?`, [name]);
+    res.json({ ok: true });
+  } catch (err) {
+    console.error(err);
+    res.status(500).json({ error: 'Failed to delete brand' });
+  }
+});
*** End Patch
```

```javascript
/* eslint-disable */
const express = require('express');
const cors = require('cors');
const path = require('path');
const { db, run, get, all } = require('./db');
const fs = require('fs');
const multer = require('multer');

const app = express();
const PORT = process.env.PORT || 3001;

app.use(cors());
app.use(express.json({ limit: '2mb' }));
// –°—Ç–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–∞–∑–¥–∞—á–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
const uploadsDir = path.join(__dirname, 'uploads');
if (!fs.existsSync(uploadsDir)) {
  fs.mkdirSync(uploadsDir, { recursive: true });
}
app.use('/uploads', express.static(uploadsDir));

// –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
const storage = multer.diskStorage({
  destination: (req, file, cb) => cb(null, uploadsDir),
  filename: (req, file, cb) => {
    const ext = path.extname(file.originalname) || '.png';
    const name = `${Date.now()}-${Math.round(Math.random() * 1e9)}${ext}`;
    cb(null, name);
  }
});
const upload = multer({ storage });

// Healthcheck
app.get('/api/health', (req, res) => {
  res.json({ ok: true });
});

// Upload image
app.post('/api/upload/image', upload.single('image'), (req, res) => {
  if (!req.file) return res.status(400).json({ error: 'No file' });
  const url = `/uploads/${req.file.filename}`;
  res.status(201).json({ url });
});

// Brands
app.get('/api/brands', async (req, res) => {
  try {
    const rows = await all(db, `SELECT id, name FROM brands ORDER BY name ASC`);
    res.json(rows.map(r => r.name));
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to fetch brands' });
  }
});

// Categories and subcategories as structure
app.get('/api/categories', async (req, res) => {
  try {
    const cats = await all(db, `SELECT id, name FROM categories ORDER BY name ASC`);
    const sub = await all(db, `SELECT id, category_id, name FROM subcategories ORDER BY name ASC`);
    const idToName = new Map(cats.map(c => [c.id, c.name]));
    const result = {};
    for (const c of cats) {
      result[c.name] = [];
    }
    for (const s of sub) {
      const catName = idToName.get(s.category_id);
      if (!catName) continue;
      result[catName].push(s.name);
    }
    res.json(result);
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to fetch categories' });
  }
});
// Categories CRUD by name
app.post('/api/categories', async (req, res) => {
  try {
    const { name, subcategories = [] } = req.body;
    const catId = await ensureCategoryByName(name);
    for (const s of subcategories) {
      await ensureSubcategoryByName(catId, s);
    }
    res.status(201).json({ ok: true });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to create category' });
  }
});
app.put('/api/categories/:name', async (req, res) => {
  try {
    const oldName = req.params.name;
    const { newName } = req.body;
    await run(db, `UPDATE categories SET name=? WHERE name=?`, [newName, oldName]);
    res.json({ ok: true });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to rename category' });
  }
});
app.delete('/api/categories/:name', async (req, res) => {
  try {
    const name = req.params.name;
    await run(db, `DELETE FROM categories WHERE name=?`, [name]);
    res.json({ ok: true });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to delete category' });
  }
});
app.put('/api/categories/:name/subcategories', async (req, res) => {
  try {
    const name = req.params.name;
    const { subcategories = [] } = req.body;
    const cat = await get(db, `SELECT id FROM categories WHERE name=?`, [name]);
    if (!cat) return res.status(404).json({ error: 'Category not found' });
    await run(db, `DELETE FROM subcategories WHERE category_id=?`, [cat.id]);
    for (const s of subcategories) {
      await ensureSubcategoryByName(cat.id, s);
    }
    res.json({ ok: true });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to set subcategories' });
  }
});

// Products
app.get('/api/products', async (req, res) => {
  try {
    const rows = await all(
      db,
      `SELECT p.*, 
              c.name AS category_name, 
              s.name AS subcategory_name, 
              b.name AS brand_name
       FROM products p
       LEFT JOIN categories c ON p.category_id = c.id
       LEFT JOIN subcategories s ON p.subcategory_id = s.id
       LEFT JOIN brands b ON p.brand_id = b.id
       ORDER BY p.created_at DESC`
    );

    // –î–æ–±–∞–≤–ª—è–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
    const productIds = rows.map(r => r.id);
    const images = await all(
      db,
      `SELECT * FROM product_images WHERE product_id IN (${productIds.map(() => '?').join(',')})`,
      productIds
    );
    const productIdToImages = new Map();
    for (const img of images) {
      if (!productIdToImages.has(img.product_id)) productIdToImages.set(img.product_id, []);
      productIdToImages.get(img.product_id).push({ id: img.id, data: img.image_data, isMain: !!img.is_main });
    }

    const result = rows.map(r => ({
      id: r.id,
      title: r.title,
      price: r.price,
      category: r.category_name,
      subcategory: r.subcategory_name,
      brand: r.brand_name,
      available: !!r.available,
      quantity: r.quantity,
      description: r.description,
      specifications: r.specifications_json ? JSON.parse(r.specifications_json) : undefined,
      features: r.features_json ? JSON.parse(r.features_json) : undefined,
      images: productIdToImages.get(r.id) || [],
      createdAt: r.created_at,
      updatedAt: r.updated_at
    }));

    res.json(result);
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to fetch products' });
  }
});

// Helpers to ensure catalog entities
async function ensureCategoryByName(name) {
  if (!name) return null;
  const row = await get(db, `SELECT id FROM categories WHERE name = ?`, [name]);
  if (row) return row.id;
  const r = await run(db, `INSERT INTO categories (name) VALUES (?)`, [name]);
  return r.lastID;
}

async function ensureSubcategoryByName(categoryId, name) {
  if (!name || !categoryId) return null;
  const row = await get(db, `SELECT id FROM subcategories WHERE category_id = ? AND name = ?`, [categoryId, name]);
  if (row) return row.id;
  const r = await run(db, `INSERT INTO subcategories (category_id, name) VALUES (?, ?)`, [categoryId, name]);
  return r.lastID;
}

async function ensureBrandByName(name) {
  if (!name) return null;
  const row = await get(db, `SELECT id FROM brands WHERE name = ?`, [name]);
  if (row) return row.id;
  const r = await run(db, `INSERT INTO brands (name) VALUES (?)`, [name]);
  return r.lastID;
}

// Create product
app.post('/api/products', async (req, res) => {
  try {
    const { title, price, category, subcategory, brand, available = true, quantity = 0, description = null, specifications, features, images } = req.body;

    const categoryId = await ensureCategoryByName(category);
    const subcategoryId = await ensureSubcategoryByName(categoryId, subcategory);
    const brandId = await ensureBrandByName(brand);

    const specJson = specifications ? JSON.stringify(specifications) : null;
    const featJson = features ? JSON.stringify(features) : null;

    const r = await run(
      db,
      `INSERT INTO products (title, price, category_id, subcategory_id, brand_id, available, quantity, description, specifications_json, features_json)
       VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)`,
      [title, price, categoryId, subcategoryId, brandId, available ? 1 : 0, quantity, description, specJson, featJson]
    );

    const productId = r.lastID;
    if (Array.isArray(images)) {
      for (const img of images) {
        await run(db, `INSERT INTO product_images (product_id, image_data, is_main) VALUES (?, ?, ?)`, [productId, img.data, img.isMain ? 1 : 0]);
      }
    }

    res.status(201).json({ id: productId });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to create product' });
  }
});

// Update product
app.put('/api/products/:id', async (req, res) => {
  try {
    const id = Number(req.params.id);
    const { title, price, category, subcategory, brand, available = true, quantity = 0, description = null, specifications, features, images } = req.body;

    const categoryId = await ensureCategoryByName(category);
    const subcategoryId = await ensureSubcategoryByName(categoryId, subcategory);
    const brandId = await ensureBrandByName(brand);

    const specJson = specifications ? JSON.stringify(specifications) : null;
    const featJson = features ? JSON.stringify(features) : null;

    await run(
      db,
      `UPDATE products SET title=?, price=?, category_id=?, subcategory_id=?, brand_id=?, available=?, quantity=?, description=?, specifications_json=?, features_json=?, updated_at = datetime('now') WHERE id=?`,
      [title, price, categoryId, subcategoryId, brandId, available ? 1 : 0, quantity, description, specJson, featJson, id]
    );

    // replace images
    if (Array.isArray(images)) {
      await run(db, `DELETE FROM product_images WHERE product_id = ?`, [id]);
      for (const img of images) {
        await run(db, `INSERT INTO product_images (product_id, image_data, is_main) VALUES (?, ?, ?)`, [id, img.data, img.isMain ? 1 : 0]);
      }
    }

    res.json({ ok: true });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to update product' });
  }
});

// Delete product
app.delete('/api/products/:id', async (req, res) => {
  try {
    const id = Number(req.params.id);
    await run(db, `DELETE FROM products WHERE id=?`, [id]);
    res.json({ ok: true });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to delete product' });
  }
});

// Promotions
app.get('/api/promotions', async (req, res) => {
  try {
    const rows = await all(
      db,
      `SELECT p.*, c.name AS category_name FROM promotions p
       LEFT JOIN categories c ON p.category_id = c.id
       WHERE p.active = 1
       ORDER BY p.featured DESC, p.id DESC`
    );
    const result = rows.map(r => ({
      id: r.id,
      title: r.title,
      description: r.description,
      discount: r.discount,
      category: r.category_name,
      validUntil: r.valid_until,
      active: !!r.active,
      featured: !!r.featured,
      minPurchase: r.min_purchase
    }));
    res.json(result);
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to fetch promotions' });
  }
});

// Promotions CRUD (–º–∏–Ω–∏–º—É–º)
app.post('/api/promotions', async (req, res) => {
  try {
    const { title, description, discount, category, validUntil, active = true, featured = false, minPurchase } = req.body;
    const catId = category ? (await get(db, `SELECT id FROM categories WHERE name = ?`, [category]))?.id : null;
    const r = await run(
      db,
      `INSERT INTO promotions (title, description, discount, category_id, valid_until, active, featured, min_purchase)
       VALUES (?, ?, ?, ?, ?, ?, ?, ?)`,
      [title, description ?? null, discount, catId ?? null, validUntil ?? null, active ? 1 : 0, featured ? 1 : 0, minPurchase ?? null]
    );
    res.status(201).json({ id: r.lastID });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to create promotion' });
  }
});

app.put('/api/promotions/:id', async (req, res) => {
  try {
    const id = Number(req.params.id);
    const { title, description, discount, category, validUntil, active, featured, minPurchase } = req.body;
    const catId = category ? (await get(db, `SELECT id FROM categories WHERE name = ?`, [category]))?.id : null;
    await run(
      db,
      `UPDATE promotions SET title=?, description=?, discount=?, category_id=?, valid_until=?, active=?, featured=?, min_purchase=? WHERE id=?`,
      [title, description ?? null, discount, catId ?? null, validUntil ?? null, active ? 1 : 0, featured ? 1 : 0, minPurchase ?? null, id]
    );
    res.json({ ok: true });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to update promotion' });
  }
});

app.delete('/api/promotions/:id', async (req, res) => {
  try {
    const id = Number(req.params.id);
    await run(db, `DELETE FROM promotions WHERE id=?`, [id]);
    res.json({ ok: true });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to delete promotion' });
  }
});

// Orders
app.get('/api/orders', async (req, res) => {
  try {
    const orders = await all(db, `SELECT * FROM orders ORDER BY created_at DESC`);
    const orderIds = orders.map(o => o.id);
    let items = [];
    if (orderIds.length) {
      items = await all(db, `SELECT * FROM order_items WHERE order_id IN (${orderIds.map(() => '?').join(',')})`, orderIds);
    }
    const orderIdToItems = new Map();
    for (const it of items) {
      if (!orderIdToItems.has(it.order_id)) orderIdToItems.set(it.order_id, []);
      orderIdToItems.get(it.order_id).push({
        id: it.id,
        productId: it.product_id,
        title: it.title,
        price: it.price,
        quantity: it.quantity
      });
    }

    // notes
    let notes = [];
    if (orderIds.length) {
      notes = await all(db, `SELECT * FROM order_notes WHERE order_id IN (${orderIds.map(() => '?').join(',')}) ORDER BY timestamp ASC`, orderIds);
    }
    const orderIdToNotes = new Map();
    for (const n of notes) {
      if (!orderIdToNotes.has(n.order_id)) orderIdToNotes.set(n.order_id, []);
      orderIdToNotes.get(n.order_id).push({
        id: n.id,
        text: n.text,
        type: n.type,
        timestamp: n.timestamp
      });
    }

    const result = [];
    for (const o of orders) {
      const customer = o.customer_id ? await get(db, `SELECT * FROM customers WHERE id = ?`, [o.customer_id]) : null;
      result.push({
        id: o.id,
        orderNumber: o.order_number,
        status: o.status,
        pricing: JSON.parse(o.pricing_json),
        items: orderIdToItems.get(o.id) || [],
        customerInfo: customer || { name: '', phone: '', email: null, address: null },
        notes: orderIdToNotes.get(o.id) || [],
        createdAt: o.created_at,
        updatedAt: o.updated_at
      });
    }
    res.json(result);
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to fetch orders' });
  }
});

app.post('/api/orders', async (req, res) => {
  try {
    const { orderForm, cartItems, priceCalculation, orderNumber } = req.body;

    // customer
    let customerId = null;
    if (orderForm) {
      const r = await run(
        db,
        `INSERT INTO customers (name, phone, email, address) VALUES (?, ?, ?, ?)`,
        [orderForm.name, orderForm.phone, orderForm.email ?? null, orderForm.address ?? null]
      );
      customerId = r.lastID;
    }

    const id = String(orderNumber);
    await run(
      db,
      `INSERT INTO orders (id, order_number, customer_id, status, pricing_json) VALUES (?, ?, ?, 'new', ?)` ,
      [id, String(orderNumber), customerId, JSON.stringify(priceCalculation)]
    );

    if (Array.isArray(cartItems)) {
      for (const it of cartItems) {
        await run(
          db,
          `INSERT INTO order_items (order_id, product_id, title, price, quantity) VALUES (?, ?, ?, ?, ?)`,
          [id, it.id ?? null, it.title, it.price, it.quantity]
        );
      }
    }

    res.status(201).json({ ok: true, id, orderNumber });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to create order' });
  }
});

// Orders: update status
app.patch('/api/orders/:id/status', async (req, res) => {
  try {
    const { id } = req.params;
    const { status } = req.body;
    await run(db, `UPDATE orders SET status=?, updated_at = datetime('now') WHERE id=?`, [status, id]);
    res.json({ ok: true });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to update status' });
  }
});

// Orders: add note
app.post('/api/orders/:id/notes', async (req, res) => {
  try {
    const { id } = req.params;
    const { text, type = 'note' } = req.body;
    const r = await run(db, `INSERT INTO order_notes (order_id, text, type) VALUES (?, ?, ?)`, [id, text, type]);
    res.status(201).json({ id: r.lastID });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to add note' });
  }
});

app.listen(PORT, () => {
  console.log(`API server listening on http://localhost:${PORT}`);
});



```

```javascript
/* eslint-disable */
const express = require('express');
const cors = require('cors');
const path = require('path');
const { db, run, get, all } = require('./db');
const fs = require('fs');
const multer = require('multer');

const app = express();
const PORT = process.env.PORT || 3001;

app.use(cors());
app.use(express.json({ limit: '2mb' }));
// –°—Ç–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–∞–∑–¥–∞—á–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
const uploadsDir = path.join(__dirname, 'uploads');
if (!fs.existsSync(uploadsDir)) {
  fs.mkdirSync(uploadsDir, { recursive: true });
}
app.use('/uploads', express.static(uploadsDir));

// –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
const storage = multer.diskStorage({
  destination: (req, file, cb) => cb(null, uploadsDir),
  filename: (req, file, cb) => {
    const ext = path.extname(file.originalname) || '.png';
    const name = `${Date.now()}-${Math.round(Math.random() * 1e9)}${ext}`;
    cb(null, name);
  }
});
const upload = multer({ storage });

// Healthcheck
app.get('/api/health', (req, res) => {
  res.json({ ok: true });
});

// Upload image
app.post('/api/upload/image', upload.single('image'), (req, res) => {
  if (!req.file) return res.status(400).json({ error: 'No file' });
  const url = `/uploads/${req.file.filename}`;
  res.status(201).json({ url });
});

// Brands
app.get('/api/brands', async (req, res) => {
  try {
    const rows = await all(db, `SELECT id, name FROM brands ORDER BY name ASC`);
    res.json(rows.map(r => r.name));
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to fetch brands' });
  }
});
app.post('/api/brands', async (req, res) => {
  try {
    const { name } = req.body;
    await ensureBrandByName(name);
    res.status(201).json({ ok: true });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to create brand' });
  }
});
app.delete('/api/brands/:name', async (req, res) => {
  try {
    const { name } = req.params;
    await run(db, `DELETE FROM brands WHERE name=?`, [name]);
    res.json({ ok: true });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to delete brand' });
  }
});

// Categories and subcategories as structure
app.get('/api/categories', async (req, res) => {
  try {
    const cats = await all(db, `SELECT id, name FROM categories ORDER BY name ASC`);
    const sub = await all(db, `SELECT id, category_id, name FROM subcategories ORDER BY name ASC`);
    const idToName = new Map(cats.map(c => [c.id, c.name]));
    const result = {};
    for (const c of cats) {
      result[c.name] = [];
    }
    for (const s of sub) {
      const catName = idToName.get(s.category_id);
      if (!catName) continue;
      result[catName].push(s.name);
    }
    res.json(result);
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to fetch categories' });
  }
});
// Categories CRUD by name
app.post('/api/categories', async (req, res) => {
  try {
    const { name, subcategories = [] } = req.body;
    const catId = await ensureCategoryByName(name);
    for (const s of subcategories) {
      await ensureSubcategoryByName(catId, s);
    }
    res.status(201).json({ ok: true });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to create category' });
  }
});
app.put('/api/categories/:name', async (req, res) => {
  try {
    const oldName = req.params.name;
    const { newName } = req.body;
    await run(db, `UPDATE categories SET name=? WHERE name=?`, [newName, oldName]);
    res.json({ ok: true });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to rename category' });
  }
});
app.delete('/api/categories/:name', async (req, res) => {
  try {
    const name = req.params.name;
    await run(db, `DELETE FROM categories WHERE name=?`, [name]);
    res.json({ ok: true });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to delete category' });
  }
});
app.put('/api/categories/:name/subcategories', async (req, res) => {
  try {
    const name = req.params.name;
    const { subcategories = [] } = req.body;
    const cat = await get(db, `SELECT id FROM categories WHERE name=?`, [name]);
    if (!cat) return res.status(404).json({ error: 'Category not found' });
    await run(db, `DELETE FROM subcategories WHERE category_id=?`, [cat.id]);
    for (const s of subcategories) {
      await ensureSubcategoryByName(cat.id, s);
    }
    res.json({ ok: true });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to set subcategories' });
  }
});

// Products
app.get('/api/products', async (req, res) => {
  try {
    const rows = await all(
      db,
      `SELECT p.*, 
              c.name AS category_name, 
              s.name AS subcategory_name, 
              b.name AS brand_name
       FROM products p
       LEFT JOIN categories c ON p.category_id = c.id
       LEFT JOIN subcategories s ON p.subcategory_id = s.id
       LEFT JOIN brands b ON p.brand_id = b.id
       ORDER BY p.created_at DESC`
    );

    // –î–æ–±–∞–≤–ª—è–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
    const productIds = rows.map(r => r.id);
    const images = await all(
      db,
      `SELECT * FROM product_images WHERE product_id IN (${productIds.map(() => '?').join(',')})`,
      productIds
    );
    const productIdToImages = new Map();
    for (const img of images) {
      if (!productIdToImages.has(img.product_id)) productIdToImages.set(img.product_id, []);
      productIdToImages.get(img.product_id).push({ id: img.id, data: img.image_data, isMain: !!img.is_main });
    }

    const result = rows.map(r => ({
      id: r.id,
      title: r.title,
      price: r.price,
      category: r.category_name,
      subcategory: r.subcategory_name,
      brand: r.brand_name,
      available: !!r.available,
      quantity: r.quantity,
      description: r.description,
      specifications: r.specifications_json ? JSON.parse(r.specifications_json) : undefined,
      features: r.features_json ? JSON.parse(r.features_json) : undefined,
      images: productIdToImages.get(r.id) || [],
      createdAt: r.created_at,
      updatedAt: r.updated_at
    }));

    res.json(result);
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to fetch products' });
  }
});

// Helpers to ensure catalog entities
async function ensureCategoryByName(name) {
  if (!name) return null;
  const row = await get(db, `SELECT id FROM categories WHERE name = ?`, [name]);
  if (row) return row.id;
  const r = await run(db, `INSERT INTO categories (name) VALUES (?)`, [name]);
  return r.lastID;
}

async function ensureSubcategoryByName(categoryId, name) {
  if (!name || !categoryId) return null;
  const row = await get(db, `SELECT id FROM subcategories WHERE category_id = ? AND name = ?`, [categoryId, name]);
  if (row) return row.id;
  const r = await run(db, `INSERT INTO subcategories (category_id, name) VALUES (?, ?)`, [categoryId, name]);
  return r.lastID;
}

async function ensureBrandByName(name) {
  if (!name) return null;
  const row = await get(db, `SELECT id FROM brands WHERE name = ?`, [name]);
  if (row) return row.id;
  const r = await run(db, `INSERT INTO brands (name) VALUES (?)`, [name]);
  return r.lastID;
}

// Create product
app.post('/api/products', async (req, res) => {
  try {
    const { title, price, category, subcategory, brand, available = true, quantity = 0, description = null, specifications, features, images } = req.body;

    const categoryId = await ensureCategoryByName(category);
    const subcategoryId = await ensureSubcategoryByName(categoryId, subcategory);
    const brandId = await ensureBrandByName(brand);

    const specJson = specifications ? JSON.stringify(specifications) : null;
    const featJson = features ? JSON.stringify(features) : null;

    const r = await run(
      db,
      `INSERT INTO products (title, price, category_id, subcategory_id, brand_id, available, quantity, description, specifications_json, features_json)
       VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)`,
      [title, price, categoryId, subcategoryId, brandId, available ? 1 : 0, quantity, description, specJson, featJson]
    );

    const productId = r.lastID;
    if (Array.isArray(images)) {
      for (const img of images) {
        await run(db, `INSERT INTO product_images (product_id, image_data, is_main) VALUES (?, ?, ?)`, [productId, img.data, img.isMain ? 1 : 0]);
      }
    }

    res.status(201).json({ id: productId });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to create product' });
  }
});

// Update product
app.put('/api/products/:id', async (req, res) => {
  try {
    const id = Number(req.params.id);
    const { title, price, category, subcategory, brand, available = true, quantity = 0, description = null, specifications, features, images } = req.body;

    const categoryId = await ensureCategoryByName(category);
    const subcategoryId = await ensureSubcategoryByName(categoryId, subcategory);
    const brandId = await ensureBrandByName(brand);

    const specJson = specifications ? JSON.stringify(specifications) : null;
    const featJson = features ? JSON.stringify(features) : null;

    await run(
      db,
      `UPDATE products SET title=?, price=?, category_id=?, subcategory_id=?, brand_id=?, available=?, quantity=?, description=?, specifications_json=?, features_json=?, updated_at = datetime('now') WHERE id=?`,
      [title, price, categoryId, subcategoryId, brandId, available ? 1 : 0, quantity, description, specJson, featJson, id]
    );

    // replace images
    if (Array.isArray(images)) {
      await run(db, `DELETE FROM product_images WHERE product_id = ?`, [id]);
      for (const img of images) {
        await run(db, `INSERT INTO product_images (product_id, image_data, is_main) VALUES (?, ?, ?)`, [id, img.data, img.isMain ? 1 : 0]);
      }
    }

    res.json({ ok: true });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to update product' });
  }
});

// Delete product
app.delete('/api/products/:id', async (req, res) => {
  try {
    const id = Number(req.params.id);
    await run(db, `DELETE FROM products WHERE id=?`, [id]);
    res.json({ ok: true });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to delete product' });
  }
});

// Promotions
app.get('/api/promotions', async (req, res) => {
  try {
    const rows = await all(
      db,
      `SELECT p.*, c.name AS category_name FROM promotions p
       LEFT JOIN categories c ON p.category_id = c.id
       WHERE p.active = 1
       ORDER BY p.featured DESC, p.id DESC`
    );
    const result = rows.map(r => ({
      id: r.id,
      title: r.title,
      description: r.description,
      discount: r.discount,
      category: r.category_name,
      validUntil: r.valid_until,
      active: !!r.active,
      featured: !!r.featured,
      minPurchase: r.min_purchase
    }));
    res.json(result);
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to fetch promotions' });
  }
});

// Promotions CRUD (–º–∏–Ω–∏–º—É–º)
app.post('/api/promotions', async (req, res) => {
  try {
    const { title, description, discount, category, validUntil, active = true, featured = false, minPurchase } = req.body;
    const catId = category ? (await get(db, `SELECT id FROM categories WHERE name = ?`, [category]))?.id : null;
    const r = await run(
      db,
      `INSERT INTO promotions (title, description, discount, category_id, valid_until, active, featured, min_purchase)
       VALUES (?, ?, ?, ?, ?, ?, ?, ?)`,
      [title, description ?? null, discount, catId ?? null, validUntil ?? null, active ? 1 : 0, featured ? 1 : 0, minPurchase ?? null]
    );
    res.status(201).json({ id: r.lastID });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to create promotion' });
  }
});

app.put('/api/promotions/:id', async (req, res) => {
  try {
    const id = Number(req.params.id);
    const { title, description, discount, category, validUntil, active, featured, minPurchase } = req.body;
    const catId = category ? (await get(db, `SELECT id FROM categories WHERE name = ?`, [category]))?.id : null;
    await run(
      db,
      `UPDATE promotions SET title=?, description=?, discount=?, category_id=?, valid_until=?, active=?, featured=?, min_purchase=? WHERE id=?`,
      [title, description ?? null, discount, catId ?? null, validUntil ?? null, active ? 1 : 0, featured ? 1 : 0, minPurchase ?? null, id]
    );
    res.json({ ok: true });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to update promotion' });
  }
});

app.delete('/api/promotions/:id', async (req, res) => {
  try {
    const id = Number(req.params.id);
    await run(db, `DELETE FROM promotions WHERE id=?`, [id]);
    res.json({ ok: true });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to delete promotion' });
  }
});

// Orders
app.get('/api/orders', async (req, res) => {
  try {
    const orders = await all(db, `SELECT * FROM orders ORDER BY created_at DESC`);
    const orderIds = orders.map(o => o.id);
    let items = [];
    if (orderIds.length) {
      items = await all(db, `SELECT * FROM order_items WHERE order_id IN (${orderIds.map(() => '?').join(',')})`, orderIds);
    }
    const orderIdToItems = new Map();
    for (const it of items) {
      if (!orderIdToItems.has(it.order_id)) orderIdToItems.set(it.order_id, []);
      orderIdToItems.get(it.order_id).push({
        id: it.id,
        productId: it.product_id,
        title: it.title,
        price: it.price,
        quantity: it.quantity
      });
    }

    // notes
    let notes = [];
    if (orderIds.length) {
      notes = await all(db, `SELECT * FROM order_notes WHERE order_id IN (${orderIds.map(() => '?').join(',')}) ORDER BY timestamp ASC`, orderIds);
    }
    const orderIdToNotes = new Map();
    for (const n of notes) {
      if (!orderIdToNotes.has(n.order_id)) orderIdToNotes.set(n.order_id, []);
      orderIdToNotes.get(n.order_id).push({
        id: n.id,
        text: n.text,
        type: n.type,
        timestamp: n.timestamp
      });
    }

    const result = [];
    for (const o of orders) {
      const customer = o.customer_id ? await get(db, `SELECT * FROM customers WHERE id = ?`, [o.customer_id]) : null;
      result.push({
        id: o.id,
        orderNumber: o.order_number,
        status: o.status,
        pricing: JSON.parse(o.pricing_json),
        items: orderIdToItems.get(o.id) || [],
        customerInfo: customer || { name: '', phone: '', email: null, address: null },
        notes: orderIdToNotes.get(o.id) || [],
        createdAt: o.created_at,
        updatedAt: o.updated_at
      });
    }
    res.json(result);
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to fetch orders' });
  }
});

app.post('/api/orders', async (req, res) => {
  try {
    const { orderForm, cartItems, priceCalculation, orderNumber } = req.body;

    // customer
    let customerId = null;
    if (orderForm) {
      const r = await run(
        db,
        `INSERT INTO customers (name, phone, email, address) VALUES (?, ?, ?, ?)`,
        [orderForm.name, orderForm.phone, orderForm.email ?? null, orderForm.address ?? null]
      );
      customerId = r.lastID;
    }

    const id = String(orderNumber);
    await run(
      db,
      `INSERT INTO orders (id, order_number, customer_id, status, pricing_json) VALUES (?, ?, ?, 'new', ?)` ,
      [id, String(orderNumber), customerId, JSON.stringify(priceCalculation)]
    );

    if (Array.isArray(cartItems)) {
      for (const it of cartItems) {
        await run(
          db,
          `INSERT INTO order_items (order_id, product_id, title, price, quantity) VALUES (?, ?, ?, ?, ?)`,
          [id, it.id ?? null, it.title, it.price, it.quantity]
        );
      }
    }

    res.status(201).json({ ok: true, id, orderNumber });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to create order' });
  }
});

// Orders: update status
app.patch('/api/orders/:id/status', async (req, res) => {
  try {
    const { id } = req.params;
    const { status } = req.body;
    await run(db, `UPDATE orders SET status=?, updated_at = datetime('now') WHERE id=?`, [status, id]);
    res.json({ ok: true });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to update status' });
  }
});

// Orders: add note
app.post('/api/orders/:id/notes', async (req, res) => {
  try {
    const { id } = req.params;
    const { text, type = 'note' } = req.body;
    const r = await run(db, `INSERT INTO order_notes (order_id, text, type) VALUES (?, ?, ?)`, [id, text, type]);
    res.status(201).json({ id: r.lastID });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to add note' });
  }
});

app.listen(PORT, () => {
  console.log(`API server listening on http://localhost:${PORT}`);
});



```

```javascriptreact
import React, { createContext, useContext, useState, useEffect } from 'react';
import { 
  categoryStructure, 
  initialProducts, 
  initialBrands, 
  initialPromotions, 
  initialAboutContent 
} from '../data/initialData.js';
import { migrateProductImages } from '../utils/imageHelpers';

const AdminDataContext = createContext();

export const useAdminData = () => {
  const context = useContext(AdminDataContext);
  if (!context) {
    throw new Error('useAdminData must be used within AdminDataProvider');
  }
  return context;
};

export const AdminDataProvider = ({ children }) => {
  // –°–æ—Å—Ç–æ—è–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
  const [products, setProducts] = useState(() => {
    const saved = localStorage.getItem('adminProducts');
    let productsData = saved ? JSON.parse(saved) : initialProducts;
    
    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –º–∏–≥—Ä–∏—Ä—É–µ–º products –ø—Ä–∏ –ø–µ—Ä–≤–æ–π –∑–∞–≥—Ä—É–∑–∫–µ
    productsData = productsData.map(product => migrateProductImages(product));
    
    return productsData;
  });

  const [categories, setCategories] = useState(() => {
    const saved = localStorage.getItem('adminCategories');
    return saved ? JSON.parse(saved) : categoryStructure;
  });

  const [brands, setBrands] = useState(() => {
    const saved = localStorage.getItem('adminBrands');
    return saved ? JSON.parse(saved) : initialBrands;
  });

  const [promotions, setPromotions] = useState(() => {
    const saved = localStorage.getItem('adminPromotions');
    // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –ø—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫ ‚Äî –Ω–∏–∫–∞–∫–∏—Ö –¥–µ–º–æ-–∞–∫—Ü–∏–π
    return saved ? JSON.parse(saved) : [];
  });

  const [aboutContent, setAboutContent] = useState(() => {
    const saved = localStorage.getItem('adminAboutContent');
    if (saved) {
      try {
        const parsedContent = JSON.parse(saved);
        // –ú–∏–≥—Ä–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
        const migratedContent = {
          ...initialAboutContent,
          ...parsedContent,
          team: parsedContent.team || initialAboutContent.team,
          history: {
            ...initialAboutContent.history,
            ...(parsedContent.history || {})
          },
          footer: {
            ...initialAboutContent.footer,
            ...(parsedContent.footer || {})
          },

        };
        console.log('AdminDataContext: Loaded and migrated about content:', migratedContent);
        return migratedContent;
      } catch (error) {
        console.error('AdminDataContext: Error parsing saved about content:', error);
        return initialAboutContent;
      }
    }
    console.log('AdminDataContext: Using initial about content');
    return initialAboutContent;
  });

  const [popularProductIds, setPopularProductIds] = useState(() => {
    const saved = localStorage.getItem('adminPopularProducts');
    return saved ? JSON.parse(saved) : [11, 1, 8, 2]; // ID –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
  });

  // –ü–µ—Ä–≤–∏—á–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –∏–∑ API (fallback –Ω–∞ –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ)
  useEffect(() => {
    const bootstrapFromApi = async () => {
      try {
        const [apiProductsRes, apiCategoriesRes, apiBrandsRes, apiPromosRes] = await Promise.allSettled([
          fetch('/api/products'),
          fetch('/api/categories'),
          fetch('/api/brands'),
          fetch('/api/promotions')
        ]);

        if (apiProductsRes.status === 'fulfilled' && apiProductsRes.value.ok) {
          const apiProducts = await apiProductsRes.value.json();
          const normalized = Array.isArray(apiProducts)
            ? apiProducts.map(p => migrateProductImages(p))
            : [];
          setProducts(normalized);
          localStorage.setItem('adminProducts', JSON.stringify(normalized));
        }

        if (apiCategoriesRes.status === 'fulfilled' && apiCategoriesRes.value.ok) {
          const apiCats = await apiCategoriesRes.value.json();
          if (apiCats && typeof apiCats === 'object') {
            setCategories(apiCats);
            localStorage.setItem('adminCategories', JSON.stringify(apiCats));
          }
        }

        if (apiBrandsRes.status === 'fulfilled' && apiBrandsRes.value.ok) {
          const apiBrands = await apiBrandsRes.value.json();
          if (Array.isArray(apiBrands) && apiBrands.length) {
            setBrands(apiBrands);
            localStorage.setItem('adminBrands', JSON.stringify(apiBrands));
          }
        }

        if (apiPromosRes.status === 'fulfilled' && apiPromosRes.value.ok) {
          const apiPromos = await apiPromosRes.value.json();
          if (Array.isArray(apiPromos)) {
            setPromotions(apiPromos);
            localStorage.setItem('adminPromotions', JSON.stringify(apiPromos));
          }
        }
      } catch (e) {
        console.warn('AdminDataContext: API bootstrap failed, using local data');
      }
    };
    bootstrapFromApi();
  }, []);

  // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ç–æ–≤–∞—Ä–∞–º–∏
  const addProduct = async (product) => {
    try {
      const res = await fetch('/api/products', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(product)
      });
      if (!res.ok) throw new Error('Failed to create product');
      await refreshFromApi();
    } catch (e) {
      // Fallback –ª–æ–∫–∞–ª—å–Ω–æ
      const newProduct = {
        ...product,
        id: products.length ? Math.max(...products.map(p => p.id)) + 1 : 1
      };
      const updatedProducts = [...products, newProduct];
      setProducts(updatedProducts);
      localStorage.setItem('adminProducts', JSON.stringify(updatedProducts));
    }
  };

  const updateProduct = async (id, updatedProduct) => {
    try {
      const res = await fetch(`/api/products/${id}`, {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(updatedProduct)
      });
      if (!res.ok) throw new Error('Failed to update product');
      await refreshFromApi();
    } catch (e) {
      const updatedProducts = products.map(product => 
        product.id === id ? { ...product, ...updatedProduct } : product
      );
      setProducts(updatedProducts);
      localStorage.setItem('adminProducts', JSON.stringify(updatedProducts));
    }
  };

  const deleteProduct = async (id) => {
    try {
      const res = await fetch(`/api/products/${id}`, { method: 'DELETE' });
      if (!res.ok) throw new Error('Failed to delete product');
      await refreshFromApi();
    } catch (e) {
      const updatedProducts = products.filter(product => product.id !== id);
      setProducts(updatedProducts);
      localStorage.setItem('adminProducts', JSON.stringify(updatedProducts));
    }
  };

  // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏
  const addCategory = async (categoryName, subcategories = []) => {
    try {
      const res = await fetch('/api/categories', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ name: categoryName, subcategories })
      });
      if (!res.ok) throw new Error('Failed to create category');
      await refreshFromApi();
    } catch (e) {
      const updatedCategories = {
        ...categories,
        [categoryName]: subcategories
      };
      setCategories(updatedCategories);
      localStorage.setItem('adminCategories', JSON.stringify(updatedCategories));
    }
  };

  const updateCategory = async (oldName, newName, subcategories) => {
    try {
      if (oldName !== newName) {
        const r1 = await fetch(`/api/categories/${encodeURIComponent(oldName)}`, {
          method: 'PUT',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ newName })
        });
        if (!r1.ok) throw new Error('Failed to rename category');
      }
      const r2 = await fetch(`/api/categories/${encodeURIComponent(newName)}/subcategories`, {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ subcategories })
      });
      if (!r2.ok) throw new Error('Failed to update subcategories');
      await refreshFromApi();
    } catch (e) {
      const updatedCategories = { ...categories };
      delete updatedCategories[oldName];
      updatedCategories[newName] = subcategories;
      setCategories(updatedCategories);
      localStorage.setItem('adminCategories', JSON.stringify(updatedCategories));
    }
  };

  const deleteCategory = async (categoryName) => {
    try {
      const res = await fetch(`/api/categories/${encodeURIComponent(categoryName)}`, { method: 'DELETE' });
      if (!res.ok) throw new Error('Failed to delete category');
      await refreshFromApi();
    } catch (e) {
      const updatedCategories = { ...categories };
      delete updatedCategories[categoryName];
      setCategories(updatedCategories);
      localStorage.setItem('adminCategories', JSON.stringify(updatedCategories));
    }
  };

  // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –±—Ä–µ–Ω–¥–∞–º–∏
  const addBrand = async (brandName) => {
    if (!brandName) return;
    try {
      const res = await fetch('/api/brands', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ name: brandName })
      });
      if (!res.ok) throw new Error('Failed to create brand');
      await refreshFromApi();
    } catch (e) {
      if (!brands.includes(brandName)) {
        const updatedBrands = [...brands, brandName];
        setBrands(updatedBrands);
        localStorage.setItem('adminBrands', JSON.stringify(updatedBrands));
      }
    }
  };

  const deleteBrand = async (brandName) => {
    try {
      const res = await fetch(`/api/brands/${encodeURIComponent(brandName)}`, { method: 'DELETE' });
      if (!res.ok) throw new Error('Failed to delete brand');
      await refreshFromApi();
    } catch (e) {
      const updatedBrands = brands.filter(brand => brand !== brandName);
      setBrands(updatedBrands);
      localStorage.setItem('adminBrands', JSON.stringify(updatedBrands));
    }
  };

  // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∞–∫—Ü–∏—è–º–∏
  const addPromotion = async (promotion) => {
    try {
      const payload = {
        ...promotion,
        category: promotion.category && promotion.category !== '–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏' ? promotion.category : null,
      };
      const res = await fetch('/api/promotions', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload)
      });
      if (!res.ok) throw new Error('Failed to create promotion');
      await refreshFromApi();
    } catch (e) {
      // Fallback: –ª–æ–∫–∞–ª—å–Ω–æ, –µ—Å–ª–∏ API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
      const newPromotion = {
        ...promotion,
        id: promotions.length ? Math.max(...promotions.map(p => p.id)) + 1 : 1
      };
      const updatedPromotions = [...promotions, newPromotion];
      setPromotions(updatedPromotions);
      localStorage.setItem('adminPromotions', JSON.stringify(updatedPromotions));
    }
  };

  const updatePromotion = async (id, updatedPromotion) => {
    try {
      const payload = {
        ...updatedPromotion,
        category: updatedPromotion.category && updatedPromotion.category !== '–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏' ? updatedPromotion.category : null,
      };
      const res = await fetch(`/api/promotions/${id}`, {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload)
      });
      if (!res.ok) throw new Error('Failed to update promotion');
      await refreshFromApi();
    } catch (e) {
      // Fallback –ª–æ–∫–∞–ª—å–Ω–æ
      const updatedPromotions = promotions.map(promo => 
        promo.id === id ? { ...promo, ...updatedPromotion } : promo
      );
      setPromotions(updatedPromotions);
      localStorage.setItem('adminPromotions', JSON.stringify(updatedPromotions));
    }
  };

  const deletePromotion = async (id) => {
    try {
      const res = await fetch(`/api/promotions/${id}`, { method: 'DELETE' });
      if (!res.ok) throw new Error('Failed to delete promotion');
      await refreshFromApi();
    } catch (e) {
      // Fallback –ª–æ–∫–∞–ª—å–Ω–æ
      const updatedPromotions = promotions.filter(promo => promo.id !== id);
      setPromotions(updatedPromotions);
      localStorage.setItem('adminPromotions', JSON.stringify(updatedPromotions));
    }
  };

  // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞ "–û –∫–æ–º–ø–∞–Ω–∏–∏"
  const updateAboutContent = (newContent) => {
    console.log('AdminDataContext: Updating about content:', newContent);
    console.log('AdminDataContext: Previous about content:', aboutContent);
    console.log('AdminDataContext: Team data in new content:', newContent.team);
    console.log('AdminDataContext: History data in new content:', newContent.history);
    
    // –£–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª–Ω–∞—è
    const completeContent = {
      ...initialAboutContent,
      ...newContent,
      team: newContent.team || [],
      history: {
        ...initialAboutContent.history,
        ...(newContent.history || {})
      },
      footer: {
        ...initialAboutContent.footer,
        ...(newContent.footer || {})
      }
    };
    
    setAboutContent(completeContent);
    localStorage.setItem('adminAboutContent', JSON.stringify(completeContent));
    
    console.log('AdminDataContext: Complete content saved:', completeContent);
    console.log('AdminDataContext: Saved team:', completeContent.team);
    console.log('AdminDataContext: Saved history:', completeContent.history);
  };

  // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø–æ–ø—É–ª—è—Ä–Ω—ã–º–∏ —Ç–æ–≤–∞—Ä–∞–º–∏
  const updatePopularProducts = (productIds) => {
    setPopularProductIds(productIds);
    localStorage.setItem('adminPopularProducts', JSON.stringify(productIds));
  };

  const value = {
    // –î–∞–Ω–Ω—ã–µ
    products,
    categories,
    brands,
    promotions,
    aboutContent,
    popularProductIds,
    refreshFromApi: async () => {
      const [p, c, b, pr] = await Promise.all([
        fetch('/api/products').then(r => r.ok ? r.json() : []),
        fetch('/api/categories').then(r => r.ok ? r.json() : categoryStructure),
        fetch('/api/brands').then(r => r.ok ? r.json() : initialBrands),
        fetch('/api/promotions').then(r => r.ok ? r.json() : [])
      ]);
      const normalized = Array.isArray(p) ? p.map(migrateProductImages) : [];
      setProducts(normalized);
      setCategories(c);
      setBrands(b);
      setPromotions(pr);
      localStorage.setItem('adminProducts', JSON.stringify(normalized));
      localStorage.setItem('adminCategories', JSON.stringify(c));
      localStorage.setItem('adminBrands', JSON.stringify(b));
      localStorage.setItem('adminPromotions', JSON.stringify(pr));
    },
    
    // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ç–æ–≤–∞—Ä–æ–≤
    addProduct,
    updateProduct,
    deleteProduct,
    
    // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π
    addCategory,
    updateCategory,
    deleteCategory,
    
    // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –±—Ä–µ–Ω–¥–æ–≤
    addBrand,
    deleteBrand,
    
    // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∞–∫—Ü–∏–π
    addPromotion,
    updatePromotion,
    deletePromotion,
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞
    updateAboutContent,
    
    // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤
    updatePopularProducts
  };

  return (
    <AdminDataContext.Provider value={value}>
      {children}
    </AdminDataContext.Provider>
  );
};

```

–°–µ–π—á–∞—Å –≤ –∞–¥–º–∏–Ω–∫–µ —á–∞—Å—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–π –µ—â—ë —à–ª–∞ –≤ localStorage. –Ø –¥–æ–±–∞–≤–∏–ª —Å–µ—Ä–≤–µ—Ä–Ω—ã–µ CRUD-—ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π/–ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–π –∏ –±—Ä–µ–Ω–¥–æ–≤ –∏ –ø–µ—Ä–µ–≤—ë–ª `AdminDataContext` –Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ API –¥–ª—è:
- –∫–∞—Ç–µ–≥–æ—Ä–∏–π: —Å–æ–∑–¥–∞—Ç—å/–ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å/—É–¥–∞–ª–∏—Ç—å –∏ –∑–∞–º–µ–Ω–∏—Ç—å —Å–ø–∏—Å–æ–∫ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–π;
- –±—Ä–µ–Ω–¥–æ–≤: —Å–æ–∑–¥–∞—Ç—å/—É–¥–∞–ª–∏—Ç—å;
- —Ç–æ–≤–∞—Ä–æ–≤ –∏ –∞–∫—Ü–∏–π: —É–∂–µ –∏–¥—É—Ç —á–µ—Ä–µ–∑ API.

–ß—Ç–æ –¥–µ–ª–∞—Ç—å –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ –ë–î:
- –í—ã–ø–æ–ª–Ω–∏—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∞–¥–º–∏–Ω–∫–µ –∫–∞–∫ –æ–±—ã—á–Ω–æ ‚Äî —Ç–µ–ø–µ—Ä—å –æ–Ω–∏ –ø–∏—à—É—Ç—Å—è –≤ SQLite.
- –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ —Å–æ—Ö—Ä–∞–Ω–∏–ª–æ—Å—å –∏–∑-–∑–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ API, —Å—Ä–∞–±–æ—Ç–∞–µ—Ç –ª–æ–∫–∞–ª—å–Ω—ã–π fallback, –Ω–æ –ø—Ä–∏ –¥–æ—Å—Ç—É–ø–Ω–æ–º —Å–µ—Ä–≤–µ—Ä–µ –≤—Å–µ –ø—Ä–∞–≤–∫–∏ —É—Ö–æ–¥—è—Ç –≤ –ë–î.

–ö–æ—Ä–æ—Ç–∫–æ –ø–æ—á–µ–º—É —Ä–∞–Ω—å—à–µ –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–ª–æ—Å—å:
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã–º–∏ –±—ã–ª–æ –Ω–∞ localStorage. –¢–µ–ø–µ—Ä—å –ø–µ—Ä–µ–≤–µ–¥–µ–Ω–æ –Ω–∞ API, –∏ –≤—Å—ë —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ `server/db.sqlite3`.

---

**User**

–í—Å—ë —Ä–æ–≤–Ω–æ –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –ë–î

---

**Cursor**

```javascript
/* eslint-disable */
const express = require('express');
const cors = require('cors');
const path = require('path');
const { db, run, get, all } = require('./db');
const fs = require('fs');
const multer = require('multer');

const app = express();
const PORT = process.env.PORT || 3001;

app.use(cors());
app.use(express.json({ limit: '25mb' }));
// –°—Ç–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–∞–∑–¥–∞—á–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
const uploadsDir = path.join(__dirname, 'uploads');
if (!fs.existsSync(uploadsDir)) {
  fs.mkdirSync(uploadsDir, { recursive: true });
}
app.use('/uploads', express.static(uploadsDir));

// –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
const storage = multer.diskStorage({
  destination: (req, file, cb) => cb(null, uploadsDir),
  filename: (req, file, cb) => {
    const ext = path.extname(file.originalname) || '.png';
    const name = `${Date.now()}-${Math.round(Math.random() * 1e9)}${ext}`;
    cb(null, name);
  }
});
const upload = multer({ storage });

// Healthcheck
app.get('/api/health', (req, res) => {
  res.json({ ok: true });
});

// Upload image
app.post('/api/upload/image', upload.single('image'), (req, res) => {
  if (!req.file) return res.status(400).json({ error: 'No file' });
  const url = `/uploads/${req.file.filename}`;
  res.status(201).json({ url });
});

// Brands
app.get('/api/brands', async (req, res) => {
  try {
    const rows = await all(db, `SELECT id, name FROM brands ORDER BY name ASC`);
    res.json(rows.map(r => r.name));
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to fetch brands' });
  }
});
app.post('/api/brands', async (req, res) => {
  try {
    const { name } = req.body;
    await ensureBrandByName(name);
    res.status(201).json({ ok: true });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to create brand' });
  }
});
app.delete('/api/brands/:name', async (req, res) => {
  try {
    const { name } = req.params;
    await run(db, `DELETE FROM brands WHERE name=?`, [name]);
    res.json({ ok: true });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to delete brand' });
  }
});

// Categories and subcategories as structure
app.get('/api/categories', async (req, res) => {
  try {
    const cats = await all(db, `SELECT id, name FROM categories ORDER BY name ASC`);
    const sub = await all(db, `SELECT id, category_id, name FROM subcategories ORDER BY name ASC`);
    const idToName = new Map(cats.map(c => [c.id, c.name]));
    const result = {};
    for (const c of cats) {
      result[c.name] = [];
    }
    for (const s of sub) {
      const catName = idToName.get(s.category_id);
      if (!catName) continue;
      result[catName].push(s.name);
    }
    res.json(result);
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to fetch categories' });
  }
});
// Categories CRUD by name
app.post('/api/categories', async (req, res) => {
  try {
    const { name, subcategories = [] } = req.body;
    const catId = await ensureCategoryByName(name);
    for (const s of subcategories) {
      await ensureSubcategoryByName(catId, s);
    }
    res.status(201).json({ ok: true });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to create category' });
  }
});
app.put('/api/categories/:name', async (req, res) => {
  try {
    const oldName = req.params.name;
    const { newName } = req.body;
    await run(db, `UPDATE categories SET name=? WHERE name=?`, [newName, oldName]);
    res.json({ ok: true });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to rename category' });
  }
});
app.delete('/api/categories/:name', async (req, res) => {
  try {
    const name = req.params.name;
    await run(db, `DELETE FROM categories WHERE name=?`, [name]);
    res.json({ ok: true });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to delete category' });
  }
});
app.put('/api/categories/:name/subcategories', async (req, res) => {
  try {
    const name = req.params.name;
    const { subcategories = [] } = req.body;
    const cat = await get(db, `SELECT id FROM categories WHERE name=?`, [name]);
    if (!cat) return res.status(404).json({ error: 'Category not found' });
    await run(db, `DELETE FROM subcategories WHERE category_id=?`, [cat.id]);
    for (const s of subcategories) {
      await ensureSubcategoryByName(cat.id, s);
    }
    res.json({ ok: true });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to set subcategories' });
  }
});

// Products
app.get('/api/products', async (req, res) => {
  try {
    const rows = await all(
      db,
      `SELECT p.*, 
              c.name AS category_name, 
              s.name AS subcategory_name, 
              b.name AS brand_name
       FROM products p
       LEFT JOIN categories c ON p.category_id = c.id
       LEFT JOIN subcategories s ON p.subcategory_id = s.id
       LEFT JOIN brands b ON p.brand_id = b.id
       ORDER BY p.created_at DESC`
    );

    // –î–æ–±–∞–≤–ª—è–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
    const productIds = rows.map(r => r.id);
    const images = await all(
      db,
      `SELECT * FROM product_images WHERE product_id IN (${productIds.map(() => '?').join(',')})`,
      productIds
    );
    const productIdToImages = new Map();
    for (const img of images) {
      if (!productIdToImages.has(img.product_id)) productIdToImages.set(img.product_id, []);
      productIdToImages.get(img.product_id).push({ id: img.id, data: img.image_data, isMain: !!img.is_main });
    }

    const result = rows.map(r => ({
      id: r.id,
      title: r.title,
      price: r.price,
      category: r.category_name,
      subcategory: r.subcategory_name,
      brand: r.brand_name,
      available: !!r.available,
      quantity: r.quantity,
      description: r.description,
      specifications: r.specifications_json ? JSON.parse(r.specifications_json) : undefined,
      features: r.features_json ? JSON.parse(r.features_json) : undefined,
      images: productIdToImages.get(r.id) || [],
      createdAt: r.created_at,
      updatedAt: r.updated_at
    }));

    res.json(result);
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to fetch products' });
  }
});

// Helpers to ensure catalog entities
async function ensureCategoryByName(name) {
  if (!name) return null;
  const row = await get(db, `SELECT id FROM categories WHERE name = ?`, [name]);
  if (row) return row.id;
  const r = await run(db, `INSERT INTO categories (name) VALUES (?)`, [name]);
  return r.lastID;
}

async function ensureSubcategoryByName(categoryId, name) {
  if (!name || !categoryId) return null;
  const row = await get(db, `SELECT id FROM subcategories WHERE category_id = ? AND name = ?`, [categoryId, name]);
  if (row) return row.id;
  const r = await run(db, `INSERT INTO subcategories (category_id, name) VALUES (?, ?)`, [categoryId, name]);
  return r.lastID;
}

async function ensureBrandByName(name) {
  if (!name) return null;
  const row = await get(db, `SELECT id FROM brands WHERE name = ?`, [name]);
  if (row) return row.id;
  const r = await run(db, `INSERT INTO brands (name) VALUES (?)`, [name]);
  return r.lastID;
}

// Create product
app.post('/api/products', async (req, res) => {
  try {
    const { title, price, category, subcategory, brand, available = true, quantity = 0, description = null, specifications, features, images } = req.body;

    const categoryId = await ensureCategoryByName(category);
    const subcategoryId = await ensureSubcategoryByName(categoryId, subcategory);
    const brandId = await ensureBrandByName(brand);

    const specJson = specifications ? JSON.stringify(specifications) : null;
    const featJson = features ? JSON.stringify(features) : null;

    const r = await run(
      db,
      `INSERT INTO products (title, price, category_id, subcategory_id, brand_id, available, quantity, description, specifications_json, features_json)
       VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)`,
      [title, price, categoryId, subcategoryId, brandId, available ? 1 : 0, quantity, description, specJson, featJson]
    );

    const productId = r.lastID;
    if (Array.isArray(images)) {
      for (const img of images) {
        await run(db, `INSERT INTO product_images (product_id, image_data, is_main) VALUES (?, ?, ?)`, [productId, img.data, img.isMain ? 1 : 0]);
      }
    }

    res.status(201).json({ id: productId });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to create product' });
  }
});

// Update product
app.put('/api/products/:id', async (req, res) => {
  try {
    const id = Number(req.params.id);
    const { title, price, category, subcategory, brand, available = true, quantity = 0, description = null, specifications, features, images } = req.body;

    const categoryId = await ensureCategoryByName(category);
    const subcategoryId = await ensureSubcategoryByName(categoryId, subcategory);
    const brandId = await ensureBrandByName(brand);

    const specJson = specifications ? JSON.stringify(specifications) : null;
    const featJson = features ? JSON.stringify(features) : null;

    await run(
      db,
      `UPDATE products SET title=?, price=?, category_id=?, subcategory_id=?, brand_id=?, available=?, quantity=?, description=?, specifications_json=?, features_json=?, updated_at = datetime('now') WHERE id=?`,
      [title, price, categoryId, subcategoryId, brandId, available ? 1 : 0, quantity, description, specJson, featJson, id]
    );

    // replace images
    if (Array.isArray(images)) {
      await run(db, `DELETE FROM product_images WHERE product_id = ?`, [id]);
      for (const img of images) {
        await run(db, `INSERT INTO product_images (product_id, image_data, is_main) VALUES (?, ?, ?)`, [id, img.data, img.isMain ? 1 : 0]);
      }
    }

    res.json({ ok: true });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to update product' });
  }
});

// Delete product
app.delete('/api/products/:id', async (req, res) => {
  try {
    const id = Number(req.params.id);
    await run(db, `DELETE FROM products WHERE id=?`, [id]);
    res.json({ ok: true });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to delete product' });
  }
});

// Promotions
app.get('/api/promotions', async (req, res) => {
  try {
    const rows = await all(
      db,
      `SELECT p.*, c.name AS category_name FROM promotions p
       LEFT JOIN categories c ON p.category_id = c.id
       WHERE p.active = 1
       ORDER BY p.featured DESC, p.id DESC`
    );
    const result = rows.map(r => ({
      id: r.id,
      title: r.title,
      description: r.description,
      discount: r.discount,
      category: r.category_name,
      validUntil: r.valid_until,
      active: !!r.active,
      featured: !!r.featured,
      minPurchase: r.min_purchase
    }));
    res.json(result);
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to fetch promotions' });
  }
});

// Promotions CRUD (–º–∏–Ω–∏–º—É–º)
app.post('/api/promotions', async (req, res) => {
  try {
    const { title, description, discount, category, validUntil, active = true, featured = false, minPurchase } = req.body;
    const catId = category ? (await get(db, `SELECT id FROM categories WHERE name = ?`, [category]))?.id : null;
    const r = await run(
      db,
      `INSERT INTO promotions (title, description, discount, category_id, valid_until, active, featured, min_purchase)
       VALUES (?, ?, ?, ?, ?, ?, ?, ?)`,
      [title, description ?? null, discount, catId ?? null, validUntil ?? null, active ? 1 : 0, featured ? 1 : 0, minPurchase ?? null]
    );
    res.status(201).json({ id: r.lastID });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to create promotion' });
  }
});

app.put('/api/promotions/:id', async (req, res) => {
  try {
    const id = Number(req.params.id);
    const { title, description, discount, category, validUntil, active, featured, minPurchase } = req.body;
    const catId = category ? (await get(db, `SELECT id FROM categories WHERE name = ?`, [category]))?.id : null;
    await run(
      db,
      `UPDATE promotions SET title=?, description=?, discount=?, category_id=?, valid_until=?, active=?, featured=?, min_purchase=? WHERE id=?`,
      [title, description ?? null, discount, catId ?? null, validUntil ?? null, active ? 1 : 0, featured ? 1 : 0, minPurchase ?? null, id]
    );
    res.json({ ok: true });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to update promotion' });
  }
});

app.delete('/api/promotions/:id', async (req, res) => {
  try {
    const id = Number(req.params.id);
    await run(db, `DELETE FROM promotions WHERE id=?`, [id]);
    res.json({ ok: true });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to delete promotion' });
  }
});

// Orders
app.get('/api/orders', async (req, res) => {
  try {
    const orders = await all(db, `SELECT * FROM orders ORDER BY created_at DESC`);
    const orderIds = orders.map(o => o.id);
    let items = [];
    if (orderIds.length) {
      items = await all(db, `SELECT * FROM order_items WHERE order_id IN (${orderIds.map(() => '?').join(',')})`, orderIds);
    }
    const orderIdToItems = new Map();
    for (const it of items) {
      if (!orderIdToItems.has(it.order_id)) orderIdToItems.set(it.order_id, []);
      orderIdToItems.get(it.order_id).push({
        id: it.id,
        productId: it.product_id,
        title: it.title,
        price: it.price,
        quantity: it.quantity
      });
    }

    // notes
    let notes = [];
    if (orderIds.length) {
      notes = await all(db, `SELECT * FROM order_notes WHERE order_id IN (${orderIds.map(() => '?').join(',')}) ORDER BY timestamp ASC`, orderIds);
    }
    const orderIdToNotes = new Map();
    for (const n of notes) {
      if (!orderIdToNotes.has(n.order_id)) orderIdToNotes.set(n.order_id, []);
      orderIdToNotes.get(n.order_id).push({
        id: n.id,
        text: n.text,
        type: n.type,
        timestamp: n.timestamp
      });
    }

    const result = [];
    for (const o of orders) {
      const customer = o.customer_id ? await get(db, `SELECT * FROM customers WHERE id = ?`, [o.customer_id]) : null;
      result.push({
        id: o.id,
        orderNumber: o.order_number,
        status: o.status,
        pricing: JSON.parse(o.pricing_json),
        items: orderIdToItems.get(o.id) || [],
        customerInfo: customer || { name: '', phone: '', email: null, address: null },
        notes: orderIdToNotes.get(o.id) || [],
        createdAt: o.created_at,
        updatedAt: o.updated_at
      });
    }
    res.json(result);
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to fetch orders' });
  }
});

app.post('/api/orders', async (req, res) => {
  try {
    const { orderForm, cartItems, priceCalculation, orderNumber } = req.body;

    // customer
    let customerId = null;
    if (orderForm) {
      const r = await run(
        db,
        `INSERT INTO customers (name, phone, email, address) VALUES (?, ?, ?, ?)`,
        [orderForm.name, orderForm.phone, orderForm.email ?? null, orderForm.address ?? null]
      );
      customerId = r.lastID;
    }

    const id = String(orderNumber);
    await run(
      db,
      `INSERT INTO orders (id, order_number, customer_id, status, pricing_json) VALUES (?, ?, ?, 'new', ?)` ,
      [id, String(orderNumber), customerId, JSON.stringify(priceCalculation)]
    );

    if (Array.isArray(cartItems)) {
      for (const it of cartItems) {
        await run(
          db,
          `INSERT INTO order_items (order_id, product_id, title, price, quantity) VALUES (?, ?, ?, ?, ?)`,
          [id, it.id ?? null, it.title, it.price, it.quantity]
        );
      }
    }

    res.status(201).json({ ok: true, id, orderNumber });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to create order' });
  }
});

// Orders: update status
app.patch('/api/orders/:id/status', async (req, res) => {
  try {
    const { id } = req.params;
    const { status } = req.body;
    await run(db, `UPDATE orders SET status=?, updated_at = datetime('now') WHERE id=?`, [status, id]);
    res.json({ ok: true });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to update status' });
  }
});

// Orders: add note
app.post('/api/orders/:id/notes', async (req, res) => {
  try {
    const { id } = req.params;
    const { text, type = 'note' } = req.body;
    const r = await run(db, `INSERT INTO order_notes (order_id, text, type) VALUES (?, ?, ?)`, [id, text, type]);
    res.status(201).json({ id: r.lastID });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to add note' });
  }
});

app.listen(PORT, () => {
  console.log(`API server listening on http://localhost:${PORT}`);
});



```

–ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞—é backend-—Å–µ—Ä–≤–µ—Ä, —á—Ç–æ–±—ã –ø–æ–¥—Ç—è–Ω—É—Ç—å –Ω–æ–≤—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –∏ —É–≤–µ–ª–∏—á–µ–Ω–Ω—ã–π –ª–∏–º–∏—Ç JSON, –∏ –ø—Ä–æ–≤–µ—Ä—è—é –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –∏ –∑–∞–ø–∏—Å—å –¥–∞–Ω–Ω—ã—Ö –Ω–∞–ø—Ä—è–º—É—é —á–µ—Ä–µ–∑ API. –ü–æ—Ç–æ–º –º–æ–∂–Ω–æ –±—É–¥–µ—Ç –ø–æ–≤—Ç–æ—Ä–∏—Ç—å –¥–µ–π—Å—Ç–≤–∏—è –≤ –∞–¥–º–∏–Ω–∫–µ.

---

**User**

–ü—Ä–æ–¥–æ–ª–∂–∞–π

---

**Cursor**

–ü–µ—Ä–µ–∑–∞–ø—É—â—É –±—ç–∫–µ–Ω–¥ —Å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º –∏ –ø—Ä–æ–≤–µ—Ä—é API —á–µ—Ä–µ–∑ node, —á—Ç–æ–±—ã –∏–∑–±–µ–≥–∞—Ç—å —Å–±–æ–µ–≤ PowerShell. –ó–∞—Ç–µ–º –ø—Ä–æ–≤–µ—Ä—é —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å—É—â–Ω–æ—Å—Ç–µ–π (–±—Ä–µ–Ω–¥, –∫–∞—Ç–µ–≥–æ—Ä–∏—è, –∞–∫—Ü–∏—è) –Ω–∞–ø—Ä—è–º—É—é –≤ –ë–î —á–µ—Ä–µ–∑ API.

```javascript
/* eslint-disable */
const express = require('express');
const cors = require('cors');
const path = require('path');
const { db, run, get, all } = require('./db');
const fs = require('fs');
const multer = require('multer');

const app = express();
const PORT = process.env.PORT || 3001;

app.use(cors());
app.use(express.json({ limit: '25mb' }));
// –°—Ç–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–∞–∑–¥–∞—á–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
const uploadsDir = path.join(__dirname, 'uploads');
if (!fs.existsSync(uploadsDir)) {
  fs.mkdirSync(uploadsDir, { recursive: true });
}
app.use('/uploads', express.static(uploadsDir));

// –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
const storage = multer.diskStorage({
  destination: (req, file, cb) => cb(null, uploadsDir),
  filename: (req, file, cb) => {
    const ext = path.extname(file.originalname) || '.png';
    const name = `${Date.now()}-${Math.round(Math.random() * 1e9)}${ext}`;
    cb(null, name);
  }
});
const upload = multer({ storage });

// Healthcheck
app.get('/api/health', (req, res) => {
  res.json({ ok: true });
});

// Upload image
app.post('/api/upload/image', upload.single('image'), (req, res) => {
  if (!req.file) return res.status(400).json({ error: 'No file' });
  const url = `/uploads/${req.file.filename}`;
  res.status(201).json({ url });
});

// Brands
app.get('/api/brands', async (req, res) => {
  try {
    const rows = await all(db, `SELECT id, name FROM brands ORDER BY name ASC`);
    res.json(rows.map(r => r.name));
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to fetch brands' });
  }
});
app.post('/api/brands', async (req, res) => {
  try {
    const { name } = req.body;
    await ensureBrandByName(name);
    res.status(201).json({ ok: true });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to create brand' });
  }
});
app.delete('/api/brands/:name', async (req, res) => {
  try {
    const { name } = req.params;
    await run(db, `DELETE FROM brands WHERE name=?`, [name]);
    res.json({ ok: true });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to delete brand' });
  }
});

// Categories and subcategories as structure
app.get('/api/categories', async (req, res) => {
  try {
    const cats = await all(db, `SELECT id, name FROM categories ORDER BY name ASC`);
    const sub = await all(db, `SELECT id, category_id, name FROM subcategories ORDER BY name ASC`);
    const idToName = new Map(cats.map(c => [c.id, c.name]));
    const result = {};
    for (const c of cats) {
      result[c.name] = [];
    }
    for (const s of sub) {
      const catName = idToName.get(s.category_id);
      if (!catName) continue;
      result[catName].push(s.name);
    }
    res.json(result);
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to fetch categories' });
  }
});
// Categories CRUD by name
app.post('/api/categories', async (req, res) => {
  try {
    const { name, subcategories = [] } = req.body;
    const catId = await ensureCategoryByName(name);
    for (const s of subcategories) {
      await ensureSubcategoryByName(catId, s);
    }
    res.status(201).json({ ok: true });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to create category' });
  }
});
app.put('/api/categories/:name', async (req, res) => {
  try {
    const oldName = req.params.name;
    const { newName } = req.body;
    await run(db, `UPDATE categories SET name=? WHERE name=?`, [newName, oldName]);
    res.json({ ok: true });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to rename category' });
  }
});
app.delete('/api/categories/:name', async (req, res) => {
  try {
    const name = req.params.name;
    await run(db, `DELETE FROM categories WHERE name=?`, [name]);
    res.json({ ok: true });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to delete category' });
  }
});
app.put('/api/categories/:name/subcategories', async (req, res) => {
  try {
    const name = req.params.name;
    const { subcategories = [] } = req.body;
    const cat = await get(db, `SELECT id FROM categories WHERE name=?`, [name]);
    if (!cat) return res.status(404).json({ error: 'Category not found' });
    await run(db, `DELETE FROM subcategories WHERE category_id=?`, [cat.id]);
    for (const s of subcategories) {
      await ensureSubcategoryByName(cat.id, s);
    }
    res.json({ ok: true });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to set subcategories' });
  }
});

// Products
app.get('/api/products', async (req, res) => {
  try {
    const rows = await all(
      db,
      `SELECT p.*, 
              c.name AS category_name, 
              s.name AS subcategory_name, 
              b.name AS brand_name
       FROM products p
       LEFT JOIN categories c ON p.category_id = c.id
       LEFT JOIN subcategories s ON p.subcategory_id = s.id
       LEFT JOIN brands b ON p.brand_id = b.id
       ORDER BY p.created_at DESC`
    );

    // –î–æ–±–∞–≤–ª—è–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
    const productIds = rows.map(r => r.id);
    const images = await all(
      db,
      `SELECT * FROM product_images WHERE product_id IN (${productIds.map(() => '?').join(',')})`,
      productIds
    );
    const productIdToImages = new Map();
    for (const img of images) {
      if (!productIdToImages.has(img.product_id)) productIdToImages.set(img.product_id, []);
      productIdToImages.get(img.product_id).push({ id: img.id, data: img.image_data, isMain: !!img.is_main });
    }

    const result = rows.map(r => ({
      id: r.id,
      title: r.title,
      price: r.price,
      category: r.category_name,
      subcategory: r.subcategory_name,
      brand: r.brand_name,
      available: !!r.available,
      quantity: r.quantity,
      description: r.description,
      specifications: r.specifications_json ? JSON.parse(r.specifications_json) : undefined,
      features: r.features_json ? JSON.parse(r.features_json) : undefined,
      images: productIdToImages.get(r.id) || [],
      createdAt: r.created_at,
      updatedAt: r.updated_at
    }));

    res.json(result);
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to fetch products' });
  }
});

// Helpers to ensure catalog entities
async function ensureCategoryByName(name) {
  if (!name) return null;
  const row = await get(db, `SELECT id FROM categories WHERE name = ?`, [name]);
  if (row) return row.id;
  const r = await run(db, `INSERT INTO categories (name) VALUES (?)`, [name]);
  return r.lastID;
}

async function ensureSubcategoryByName(categoryId, name) {
  if (!name || !categoryId) return null;
  const row = await get(db, `SELECT id FROM subcategories WHERE category_id = ? AND name = ?`, [categoryId, name]);
  if (row) return row.id;
  const r = await run(db, `INSERT INTO subcategories (category_id, name) VALUES (?, ?)`, [categoryId, name]);
  return r.lastID;
}

async function ensureBrandByName(name) {
  if (!name) return null;
  const row = await get(db, `SELECT id FROM brands WHERE name = ?`, [name]);
  if (row) return row.id;
  const r = await run(db, `INSERT INTO brands (name) VALUES (?)`, [name]);
  return r.lastID;
}

// Create product
app.post('/api/products', async (req, res) => {
  try {
    const { title, price, category, subcategory, brand, available = true, quantity = 0, description = null, specifications, features, images } = req.body;

    const categoryId = await ensureCategoryByName(category);
    const subcategoryId = await ensureSubcategoryByName(categoryId, subcategory);
    const brandId = await ensureBrandByName(brand);

    const specJson = specifications ? JSON.stringify(specifications) : null;
    const featJson = features ? JSON.stringify(features) : null;

    const r = await run(
      db,
      `INSERT INTO products (title, price, category_id, subcategory_id, brand_id, available, quantity, description, specifications_json, features_json)
       VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)`,
      [title, price, categoryId, subcategoryId, brandId, available ? 1 : 0, quantity, description, specJson, featJson]
    );

    const productId = r.lastID;
    if (Array.isArray(images)) {
      for (const img of images) {
        await run(db, `INSERT INTO product_images (product_id, image_data, is_main) VALUES (?, ?, ?)`, [productId, img.data, img.isMain ? 1 : 0]);
      }
    }

    res.status(201).json({ id: productId });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to create product' });
  }
});

// Update product
app.put('/api/products/:id', async (req, res) => {
  try {
    const id = Number(req.params.id);
    const { title, price, category, subcategory, brand, available = true, quantity = 0, description = null, specifications, features, images } = req.body;

    const categoryId = await ensureCategoryByName(category);
    const subcategoryId = await ensureSubcategoryByName(categoryId, subcategory);
    const brandId = await ensureBrandByName(brand);

    const specJson = specifications ? JSON.stringify(specifications) : null;
    const featJson = features ? JSON.stringify(features) : null;

    await run(
      db,
      `UPDATE products SET title=?, price=?, category_id=?, subcategory_id=?, brand_id=?, available=?, quantity=?, description=?, specifications_json=?, features_json=?, updated_at = datetime('now') WHERE id=?`,
      [title, price, categoryId, subcategoryId, brandId, available ? 1 : 0, quantity, description, specJson, featJson, id]
    );

    // replace images
    if (Array.isArray(images)) {
      await run(db, `DELETE FROM product_images WHERE product_id = ?`, [id]);
      for (const img of images) {
        await run(db, `INSERT INTO product_images (product_id, image_data, is_main) VALUES (?, ?, ?)`, [id, img.data, img.isMain ? 1 : 0]);
      }
    }

    res.json({ ok: true });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to update product' });
  }
});

// Delete product
app.delete('/api/products/:id', async (req, res) => {
  try {
    const id = Number(req.params.id);
    await run(db, `DELETE FROM products WHERE id=?`, [id]);
    res.json({ ok: true });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to delete product' });
  }
});

// Promotions
app.get('/api/promotions', async (req, res) => {
  try {
    const rows = await all(
      db,
      `SELECT p.*, c.name AS category_name FROM promotions p
       LEFT JOIN categories c ON p.category_id = c.id
       ORDER BY p.featured DESC, p.id DESC`
    );
    const result = rows.map(r => ({
      id: r.id,
      title: r.title,
      description: r.description,
      discount: r.discount,
      category: r.category_name,
      validUntil: r.valid_until,
      active: !!r.active,
      featured: !!r.featured,
      minPurchase: r.min_purchase
    }));
    res.json(result);
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to fetch promotions' });
  }
});

// Promotions CRUD (–º–∏–Ω–∏–º—É–º)
app.post('/api/promotions', async (req, res) => {
  try {
    const { title, description, discount, category, validUntil, active = true, featured = false, minPurchase } = req.body;
    const catId = category ? (await get(db, `SELECT id FROM categories WHERE name = ?`, [category]))?.id : null;
    const r = await run(
      db,
      `INSERT INTO promotions (title, description, discount, category_id, valid_until, active, featured, min_purchase)
       VALUES (?, ?, ?, ?, ?, ?, ?, ?)`,
      [title, description ?? null, discount, catId ?? null, validUntil ?? null, active ? 1 : 0, featured ? 1 : 0, minPurchase ?? null]
    );
    res.status(201).json({ id: r.lastID });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to create promotion' });
  }
});

app.put('/api/promotions/:id', async (req, res) => {
  try {
    const id = Number(req.params.id);
    const { title, description, discount, category, validUntil, active, featured, minPurchase } = req.body;
    const catId = category ? (await get(db, `SELECT id FROM categories WHERE name = ?`, [category]))?.id : null;
    await run(
      db,
      `UPDATE promotions SET title=?, description=?, discount=?, category_id=?, valid_until=?, active=?, featured=?, min_purchase=? WHERE id=?`,
      [title, description ?? null, discount, catId ?? null, validUntil ?? null, active ? 1 : 0, featured ? 1 : 0, minPurchase ?? null, id]
    );
    res.json({ ok: true });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to update promotion' });
  }
});

app.delete('/api/promotions/:id', async (req, res) => {
  try {
    const id = Number(req.params.id);
    await run(db, `DELETE FROM promotions WHERE id=?`, [id]);
    res.json({ ok: true });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to delete promotion' });
  }
});

// Orders
app.get('/api/orders', async (req, res) => {
  try {
    const orders = await all(db, `SELECT * FROM orders ORDER BY created_at DESC`);
    const orderIds = orders.map(o => o.id);
    let items = [];
    if (orderIds.length) {
      items = await all(db, `SELECT * FROM order_items WHERE order_id IN (${orderIds.map(() => '?').join(',')})`, orderIds);
    }
    const orderIdToItems = new Map();
    for (const it of items) {
      if (!orderIdToItems.has(it.order_id)) orderIdToItems.set(it.order_id, []);
      orderIdToItems.get(it.order_id).push({
        id: it.id,
        productId: it.product_id,
        title: it.title,
        price: it.price,
        quantity: it.quantity
      });
    }

    // notes
    let notes = [];
    if (orderIds.length) {
      notes = await all(db, `SELECT * FROM order_notes WHERE order_id IN (${orderIds.map(() => '?').join(',')}) ORDER BY timestamp ASC`, orderIds);
    }
    const orderIdToNotes = new Map();
    for (const n of notes) {
      if (!orderIdToNotes.has(n.order_id)) orderIdToNotes.set(n.order_id, []);
      orderIdToNotes.get(n.order_id).push({
        id: n.id,
        text: n.text,
        type: n.type,
        timestamp: n.timestamp
      });
    }

    const result = [];
    for (const o of orders) {
      const customer = o.customer_id ? await get(db, `SELECT * FROM customers WHERE id = ?`, [o.customer_id]) : null;
      result.push({
        id: o.id,
        orderNumber: o.order_number,
        status: o.status,
        pricing: JSON.parse(o.pricing_json),
        items: orderIdToItems.get(o.id) || [],
        customerInfo: customer || { name: '', phone: '', email: null, address: null },
        notes: orderIdToNotes.get(o.id) || [],
        createdAt: o.created_at,
        updatedAt: o.updated_at
      });
    }
    res.json(result);
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to fetch orders' });
  }
});

app.post('/api/orders', async (req, res) => {
  try {
    const { orderForm, cartItems, priceCalculation, orderNumber } = req.body;

    // customer
    let customerId = null;
    if (orderForm) {
      const r = await run(
        db,
        `INSERT INTO customers (name, phone, email, address) VALUES (?, ?, ?, ?)`,
        [orderForm.name, orderForm.phone, orderForm.email ?? null, orderForm.address ?? null]
      );
      customerId = r.lastID;
    }

    const id = String(orderNumber);
    await run(
      db,
      `INSERT INTO orders (id, order_number, customer_id, status, pricing_json) VALUES (?, ?, ?, 'new', ?)` ,
      [id, String(orderNumber), customerId, JSON.stringify(priceCalculation)]
    );

    if (Array.isArray(cartItems)) {
      for (const it of cartItems) {
        await run(
          db,
          `INSERT INTO order_items (order_id, product_id, title, price, quantity) VALUES (?, ?, ?, ?, ?)`,
          [id, it.id ?? null, it.title, it.price, it.quantity]
        );
      }
    }

    res.status(201).json({ ok: true, id, orderNumber });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to create order' });
  }
});

// Orders: update status
app.patch('/api/orders/:id/status', async (req, res) => {
  try {
    const { id } = req.params;
    const { status } = req.body;
    await run(db, `UPDATE orders SET status=?, updated_at = datetime('now') WHERE id=?`, [status, id]);
    res.json({ ok: true });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to update status' });
  }
});

// Orders: add note
app.post('/api/orders/:id/notes', async (req, res) => {
  try {
    const { id } = req.params;
    const { text, type = 'note' } = req.body;
    const r = await run(db, `INSERT INTO order_notes (order_id, text, type) VALUES (?, ?, ?)`, [id, text, type]);
    res.status(201).json({ id: r.lastID });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to add note' });
  }
});

app.listen(PORT, () => {
  console.log(`API server listening on http://localhost:${PORT}`);
});



```

```javascript
/* eslint-disable */
const express = require('express');
const cors = require('cors');
const path = require('path');
const { db, run, get, all } = require('./db');
const fs = require('fs');
const multer = require('multer');

const app = express();
const PORT = process.env.PORT || 3001;

app.use(cors());
app.use(express.json({ limit: '25mb' }));
// –°—Ç–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–∞–∑–¥–∞—á–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
const uploadsDir = path.join(__dirname, 'uploads');
if (!fs.existsSync(uploadsDir)) {
  fs.mkdirSync(uploadsDir, { recursive: true });
}
app.use('/uploads', express.static(uploadsDir));

// –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
const storage = multer.diskStorage({
  destination: (req, file, cb) => cb(null, uploadsDir),
  filename: (req, file, cb) => {
    const ext = path.extname(file.originalname) || '.png';
    const name = `${Date.now()}-${Math.round(Math.random() * 1e9)}${ext}`;
    cb(null, name);
  }
});
const upload = multer({ storage });

// Healthcheck
app.get('/api/health', (req, res) => {
  res.json({ ok: true });
});

// Upload image
app.post('/api/upload/image', upload.single('image'), (req, res) => {
  if (!req.file) return res.status(400).json({ error: 'No file' });
  const url = `/uploads/${req.file.filename}`;
  res.status(201).json({ url });
});

// Brands
app.get('/api/brands', async (req, res) => {
  try {
    const rows = await all(db, `SELECT id, name FROM brands ORDER BY name ASC`);
    res.json(rows.map(r => r.name));
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to fetch brands' });
  }
});
app.post('/api/brands', async (req, res) => {
  try {
    const { name } = req.body;
    await ensureBrandByName(name);
    res.status(201).json({ ok: true });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to create brand' });
  }
});
app.delete('/api/brands/:name', async (req, res) => {
  try {
    const { name } = req.params;
    await run(db, `DELETE FROM brands WHERE name=?`, [name]);
    res.json({ ok: true });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to delete brand' });
  }
});

// Categories and subcategories as structure
app.get('/api/categories', async (req, res) => {
  try {
    const cats = await all(db, `SELECT id, name FROM categories ORDER BY name ASC`);
    const sub = await all(db, `SELECT id, category_id, name FROM subcategories ORDER BY name ASC`);
    const idToName = new Map(cats.map(c => [c.id, c.name]));
    const result = {};
    for (const c of cats) {
      result[c.name] = [];
    }
    for (const s of sub) {
      const catName = idToName.get(s.category_id);
      if (!catName) continue;
      result[catName].push(s.name);
    }
    res.json(result);
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to fetch categories' });
  }
});
// Categories CRUD by name
app.post('/api/categories', async (req, res) => {
  try {
    const { name, subcategories = [] } = req.body;
    const catId = await ensureCategoryByName(name);
    for (const s of subcategories) {
      await ensureSubcategoryByName(catId, s);
    }
    res.status(201).json({ ok: true });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to create category' });
  }
});
app.put('/api/categories/:name', async (req, res) => {
  try {
    const oldName = req.params.name;
    const { newName } = req.body;
    await run(db, `UPDATE categories SET name=? WHERE name=?`, [newName, oldName]);
    res.json({ ok: true });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to rename category' });
  }
});
app.delete('/api/categories/:name', async (req, res) => {
  try {
    const name = req.params.name;
    await run(db, `DELETE FROM categories WHERE name=?`, [name]);
    res.json({ ok: true });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to delete category' });
  }
});
app.put('/api/categories/:name/subcategories', async (req, res) => {
  try {
    const name = req.params.name;
    const { subcategories = [] } = req.body;
    const cat = await get(db, `SELECT id FROM categories WHERE name=?`, [name]);
    if (!cat) return res.status(404).json({ error: 'Category not found' });
    await run(db, `DELETE FROM subcategories WHERE category_id=?`, [cat.id]);
    for (const s of subcategories) {
      await ensureSubcategoryByName(cat.id, s);
    }
    res.json({ ok: true });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to set subcategories' });
  }
});

// Products
app.get('/api/products', async (req, res) => {
  try {
    const rows = await all(
      db,
      `SELECT p.*, 
              c.name AS category_name, 
              s.name AS subcategory_name, 
              b.name AS brand_name
       FROM products p
       LEFT JOIN categories c ON p.category_id = c.id
       LEFT JOIN subcategories s ON p.subcategory_id = s.id
       LEFT JOIN brands b ON p.brand_id = b.id
       ORDER BY p.created_at DESC`
    );

    // –î–æ–±–∞–≤–ª—è–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
    const productIds = rows.map(r => r.id);
    let images = [];
    if (productIds.length > 0) {
      images = await all(
        db,
        `SELECT * FROM product_images WHERE product_id IN (${productIds.map(() => '?').join(',')})`,
        productIds
      );
    }
    const productIdToImages = new Map();
    for (const img of images) {
      if (!productIdToImages.has(img.product_id)) productIdToImages.set(img.product_id, []);
      productIdToImages.get(img.product_id).push({ id: img.id, data: img.image_data, isMain: !!img.is_main });
    }

    const result = rows.map(r => ({
      id: r.id,
      title: r.title,
      price: r.price,
      category: r.category_name,
      subcategory: r.subcategory_name,
      brand: r.brand_name,
      available: !!r.available,
      quantity: r.quantity,
      description: r.description,
      specifications: r.specifications_json ? JSON.parse(r.specifications_json) : undefined,
      features: r.features_json ? JSON.parse(r.features_json) : undefined,
      images: productIdToImages.get(r.id) || [],
      createdAt: r.created_at,
      updatedAt: r.updated_at
    }));

    res.json(result);
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to fetch products' });
  }
});

// Helpers to ensure catalog entities
async function ensureCategoryByName(name) {
  if (!name) return null;
  const row = await get(db, `SELECT id FROM categories WHERE name = ?`, [name]);
  if (row) return row.id;
  const r = await run(db, `INSERT INTO categories (name) VALUES (?)`, [name]);
  return r.lastID;
}

async function ensureSubcategoryByName(categoryId, name) {
  if (!name || !categoryId) return null;
  const row = await get(db, `SELECT id FROM subcategories WHERE category_id = ? AND name = ?`, [categoryId, name]);
  if (row) return row.id;
  const r = await run(db, `INSERT INTO subcategories (category_id, name) VALUES (?, ?)`, [categoryId, name]);
  return r.lastID;
}

async function ensureBrandByName(name) {
  if (!name) return null;
  const row = await get(db, `SELECT id FROM brands WHERE name = ?`, [name]);
  if (row) return row.id;
  const r = await run(db, `INSERT INTO brands (name) VALUES (?)`, [name]);
  return r.lastID;
}

// Create product
app.post('/api/products', async (req, res) => {
  try {
    const { title, price, category, subcategory, brand, available = true, quantity = 0, description = null, specifications, features, images } = req.body;

    const categoryId = await ensureCategoryByName(category);
    const subcategoryId = await ensureSubcategoryByName(categoryId, subcategory);
    const brandId = await ensureBrandByName(brand);

    const specJson = specifications ? JSON.stringify(specifications) : null;
    const featJson = features ? JSON.stringify(features) : null;

    const r = await run(
      db,
      `INSERT INTO products (title, price, category_id, subcategory_id, brand_id, available, quantity, description, specifications_json, features_json)
       VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)`,
      [title, price, categoryId, subcategoryId, brandId, available ? 1 : 0, quantity, description, specJson, featJson]
    );

    const productId = r.lastID;
    if (Array.isArray(images)) {
      for (const img of images) {
        await run(db, `INSERT INTO product_images (product_id, image_data, is_main) VALUES (?, ?, ?)`, [productId, img.data, img.isMain ? 1 : 0]);
      }
    }

    res.status(201).json({ id: productId });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to create product' });
  }
});

// Update product
app.put('/api/products/:id', async (req, res) => {
  try {
    const id = Number(req.params.id);
    const { title, price, category, subcategory, brand, available = true, quantity = 0, description = null, specifications, features, images } = req.body;

    const categoryId = await ensureCategoryByName(category);
    const subcategoryId = await ensureSubcategoryByName(categoryId, subcategory);
    const brandId = await ensureBrandByName(brand);

    const specJson = specifications ? JSON.stringify(specifications) : null;
    const featJson = features ? JSON.stringify(features) : null;

    await run(
      db,
      `UPDATE products SET title=?, price=?, category_id=?, subcategory_id=?, brand_id=?, available=?, quantity=?, description=?, specifications_json=?, features_json=?, updated_at = datetime('now') WHERE id=?`,
      [title, price, categoryId, subcategoryId, brandId, available ? 1 : 0, quantity, description, specJson, featJson, id]
    );

    // replace images
    if (Array.isArray(images)) {
      await run(db, `DELETE FROM product_images WHERE product_id = ?`, [id]);
      for (const img of images) {
        await run(db, `INSERT INTO product_images (product_id, image_data, is_main) VALUES (?, ?, ?)`, [id, img.data, img.isMain ? 1 : 0]);
      }
    }

    res.json({ ok: true });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to update product' });
  }
});

// Delete product
app.delete('/api/products/:id', async (req, res) => {
  try {
    const id = Number(req.params.id);
    await run(db, `DELETE FROM products WHERE id=?`, [id]);
    res.json({ ok: true });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to delete product' });
  }
});

// Promotions
app.get('/api/promotions', async (req, res) => {
  try {
    const rows = await all(
      db,
      `SELECT p.*, c.name AS category_name FROM promotions p
       LEFT JOIN categories c ON p.category_id = c.id
       ORDER BY p.featured DESC, p.id DESC`
    );
    const result = rows.map(r => ({
      id: r.id,
      title: r.title,
      description: r.description,
      discount: r.discount,
      category: r.category_name,
      validUntil: r.valid_until,
      active: !!r.active,
      featured: !!r.featured,
      minPurchase: r.min_purchase
    }));
    res.json(result);
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to fetch promotions' });
  }
});

// Promotions CRUD (–º–∏–Ω–∏–º—É–º)
app.post('/api/promotions', async (req, res) => {
  try {
    const { title, description, discount, category, validUntil, active = true, featured = false, minPurchase } = req.body;
    const catId = category ? (await get(db, `SELECT id FROM categories WHERE name = ?`, [category]))?.id : null;
    const r = await run(
      db,
      `INSERT INTO promotions (title, description, discount, category_id, valid_until, active, featured, min_purchase)
       VALUES (?, ?, ?, ?, ?, ?, ?, ?)`,
      [title, description ?? null, discount, catId ?? null, validUntil ?? null, active ? 1 : 0, featured ? 1 : 0, minPurchase ?? null]
    );
    res.status(201).json({ id: r.lastID });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to create promotion' });
  }
});

app.put('/api/promotions/:id', async (req, res) => {
  try {
    const id = Number(req.params.id);
    const { title, description, discount, category, validUntil, active, featured, minPurchase } = req.body;
    const catId = category ? (await get(db, `SELECT id FROM categories WHERE name = ?`, [category]))?.id : null;
    await run(
      db,
      `UPDATE promotions SET title=?, description=?, discount=?, category_id=?, valid_until=?, active=?, featured=?, min_purchase=? WHERE id=?`,
      [title, description ?? null, discount, catId ?? null, validUntil ?? null, active ? 1 : 0, featured ? 1 : 0, minPurchase ?? null, id]
    );
    res.json({ ok: true });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to update promotion' });
  }
});

app.delete('/api/promotions/:id', async (req, res) => {
  try {
    const id = Number(req.params.id);
    await run(db, `DELETE FROM promotions WHERE id=?`, [id]);
    res.json({ ok: true });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to delete promotion' });
  }
});

// Orders
app.get('/api/orders', async (req, res) => {
  try {
    const orders = await all(db, `SELECT * FROM orders ORDER BY created_at DESC`);
    const orderIds = orders.map(o => o.id);
    let items = [];
    if (orderIds.length) {
      items = await all(db, `SELECT * FROM order_items WHERE order_id IN (${orderIds.map(() => '?').join(',')})`, orderIds);
    }
    const orderIdToItems = new Map();
    for (const it of items) {
      if (!orderIdToItems.has(it.order_id)) orderIdToItems.set(it.order_id, []);
      orderIdToItems.get(it.order_id).push({
        id: it.id,
        productId: it.product_id,
        title: it.title,
        price: it.price,
        quantity: it.quantity
      });
    }

    // notes
    let notes = [];
    if (orderIds.length) {
      notes = await all(db, `SELECT * FROM order_notes WHERE order_id IN (${orderIds.map(() => '?').join(',')}) ORDER BY timestamp ASC`, orderIds);
    }
    const orderIdToNotes = new Map();
    for (const n of notes) {
      if (!orderIdToNotes.has(n.order_id)) orderIdToNotes.set(n.order_id, []);
      orderIdToNotes.get(n.order_id).push({
        id: n.id,
        text: n.text,
        type: n.type,
        timestamp: n.timestamp
      });
    }

    const result = [];
    for (const o of orders) {
      const customer = o.customer_id ? await get(db, `SELECT * FROM customers WHERE id = ?`, [o.customer_id]) : null;
      result.push({
        id: o.id,
        orderNumber: o.order_number,
        status: o.status,
        pricing: JSON.parse(o.pricing_json),
        items: orderIdToItems.get(o.id) || [],
        customerInfo: customer || { name: '', phone: '', email: null, address: null },
        notes: orderIdToNotes.get(o.id) || [],
        createdAt: o.created_at,
        updatedAt: o.updated_at
      });
    }
    res.json(result);
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to fetch orders' });
  }
});

app.post('/api/orders', async (req, res) => {
  try {
    const { orderForm, cartItems, priceCalculation, orderNumber } = req.body;

    // customer
    let customerId = null;
    if (orderForm) {
      const r = await run(
        db,
        `INSERT INTO customers (name, phone, email, address) VALUES (?, ?, ?, ?)`,
        [orderForm.name, orderForm.phone, orderForm.email ?? null, orderForm.address ?? null]
      );
      customerId = r.lastID;
    }

    const id = String(orderNumber);
    await run(
      db,
      `INSERT INTO orders (id, order_number, customer_id, status, pricing_json) VALUES (?, ?, ?, 'new', ?)` ,
      [id, String(orderNumber), customerId, JSON.stringify(priceCalculation)]
    );

    if (Array.isArray(cartItems)) {
      for (const it of cartItems) {
        await run(
          db,
          `INSERT INTO order_items (order_id, product_id, title, price, quantity) VALUES (?, ?, ?, ?, ?)`,
          [id, it.id ?? null, it.title, it.price, it.quantity]
        );
      }
    }

    res.status(201).json({ ok: true, id, orderNumber });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to create order' });
  }
});

// Orders: update status
app.patch('/api/orders/:id/status', async (req, res) => {
  try {
    const { id } = req.params;
    const { status } = req.body;
    await run(db, `UPDATE orders SET status=?, updated_at = datetime('now') WHERE id=?`, [status, id]);
    res.json({ ok: true });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to update status' });
  }
});

// Orders: add note
app.post('/api/orders/:id/notes', async (req, res) => {
  try {
    const { id } = req.params;
    const { text, type = 'note' } = req.body;
    const r = await run(db, `INSERT INTO order_notes (order_id, text, type) VALUES (?, ?, ?)`, [id, text, type]);
    res.status(201).json({ id: r.lastID });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to add note' });
  }
});

app.listen(PORT, () => {
  console.log(`API server listening on http://localhost:${PORT}`);
});



```

–ü–æ–Ω—è–ª, —á—Ç–æ –ø—Ä–∞–≤–∫–∏ –≤ –∞–¥–º–∏–Ω–∫–µ —É –≤–∞—Å –≤—Å—ë –µ—â—ë –Ω–µ –æ—Ç—Ä–∞–∂–∞—é—Ç—Å—è –≤ SQLite. –ü—Ä–∏—á–∏–Ω—ã –±—ã–≤–∞—é—Ç —Ç—Ä–∏: —Ñ—Ä–æ–Ω—Ç –≤—Å—ë –µ—â—ë –ø–∏—à–µ—Ç –≤ localStorage, API –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è/–ø–∞–¥–∞–µ—Ç, –∏–ª–∏ —Å–µ—Ä–≤–µ—Ä –Ω–µ –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π.

–ß—Ç–æ —è —É–∂–µ —Å–¥–µ–ª–∞–ª
- –ü–µ—Ä–µ–≤—ë–ª `AdminDataContext` –Ω–∞ —Ä–∞–±–æ—Ç—É —Å API –¥–ª—è —Ç–æ–≤–∞—Ä–æ–≤, –∞–∫—Ü–∏–π, –±—Ä–µ–Ω–¥–æ–≤, –∫–∞—Ç–µ–≥–æ—Ä–∏–π; –¥–æ–±–∞–≤–∏–ª `refreshFromApi`. –í–∫–ª—é—á—ë–Ω fallback –≤ localStorage, –µ—Å–ª–∏ API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω.
- –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã CRUD —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –¥–ª—è `products`, `promotions`, `brands`, `categories`, –∞ —Ç–∞–∫–∂–µ `uploads` –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞–º–∏. –£–≤–µ–ª–∏—á–µ–Ω –ª–∏–º–∏—Ç JSON –¥–æ 25 –ú–ë.

–ß—Ç–æ –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∏ —Å–¥–µ–ª–∞—Ç—å —Å–µ–π—á–∞—Å
- –û—Ç–∫—Ä–æ–π—Ç–µ –∞–¥–º–∏–Ω–∫—É, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ:
  - –°–æ–∑–¥–∞—Ç—å –±—Ä–µ–Ω–¥ –∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—é ‚Üí –∑–∞—Ç–µ–º –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É. –û–Ω–∏ –¥–æ–ª–∂–Ω—ã –æ—Å—Ç–∞—Ç—å—Å—è (–≤ –ë–î).
  - –°–æ–∑–¥–∞—Ç—å/–∏–∑–º–µ–Ω–∏—Ç—å –∞–∫—Ü–∏—é ‚Üí –ø–æ—Å–ª–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É. –ê–∫—Ü–∏—è –¥–æ–ª–∂–Ω–∞ –æ—Å—Ç–∞—Ç—å—Å—è (–ë–î).
  - –°–æ–∑–¥–∞—Ç—å —Ç–æ–≤–∞—Ä ‚Üí –ø–æ—Å–ª–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É. –¢–æ–≤–∞—Ä –¥–æ–ª–∂–µ–Ω –æ—Å—Ç–∞—Ç—å—Å—è (–ë–î).

–ï—Å–ª–∏ –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏—Å—á–µ–∑–∞—é—Ç:
- –≠—Ç–æ –∑–Ω–∞—á–∏—Ç, —á—Ç–æ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ —Å—Ä–∞–±–æ—Ç–∞–ª fallback –≤ localStorage (API –Ω–µ –æ—Ç–≤–µ—Ç–∏–ª). –í —Ç–∞–∫–æ–º —Å–ª—É—á–∞–µ –ø—Ä–æ–±–ª–µ–º–∞ –≤ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –≤–∞—à–µ–≥–æ backend –Ω–∞ `http://localhost:3001`. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω –∏ –Ω–∞ `/api/health` –æ—Ç–¥–∞—ë—Ç JSON ok:true.

–ü–æ–¥—Å–∫–∞–∑–∫–∞
- –ë–î —Ñ–∞–π–ª: `server/db.sqlite3`. –í—ã –º–æ–∂–µ—Ç–µ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –µ–≥–æ —Ä–∞–∑–º–µ—Ä/–¥–∞—Ç—É –∏–∑–º–µ–Ω–µ–Ω–∏—è ‚Äî –ø—Ä–∏ —É—Å–ø–µ—à–Ω–æ–π –∑–∞–ø–∏—Å–∏ —Ñ–∞–π–ª –±—É–¥–µ—Ç –º–µ–Ω—è—Ç—å—Å—è.

---

**User**

–ò–∑–º–µ–Ω–µ–Ω–∏—è –∏ —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è 

---

**Cursor**

```javascriptreact
*** Begin Patch
*** Update File: src/context/AdminDataContext.jsx
@@
   const [popularProductIds, setPopularProductIds] = useState(() => {
     const saved = localStorage.getItem('adminPopularProducts');
     return saved ? JSON.parse(saved) : [11, 1, 8, 2]; // ID –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
   });
@@
   const deleteCategory = async (categoryName) => {
     try {
       const res = await fetch(`/api/categories/${encodeURIComponent(categoryName)}`, { method: 'DELETE' });
       if (!res.ok) throw new Error('Failed to delete category');
       await refreshFromApi();
     } catch (e) {
       const updatedCategories = { ...categories };
       delete updatedCategories[categoryName];
       setCategories(updatedCategories);
       localStorage.setItem('adminCategories', JSON.stringify(updatedCategories));
     }
   };
+
+  // –ü–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏
+  const addSubcategory = async (categoryName, subcategoryName) => {
+    const current = categories[categoryName] || [];
+    if (current.includes(subcategoryName)) return;
+    const next = [...current, subcategoryName];
+    try {
+      const res = await fetch(`/api/categories/${encodeURIComponent(categoryName)}/subcategories`, {
+        method: 'PUT',
+        headers: { 'Content-Type': 'application/json' },
+        body: JSON.stringify({ subcategories: next })
+      });
+      if (!res.ok) throw new Error('Failed to add subcategory');
+      await refreshFromApi();
+    } catch (e) {
+      const updated = { ...categories, [categoryName]: next };
+      setCategories(updated);
+      localStorage.setItem('adminCategories', JSON.stringify(updated));
+    }
+  };
+
+  const updateSubcategory = async (categoryName, oldSubName, newSubName) => {
+    const current = categories[categoryName] || [];
+    const next = current.map(s => (s === oldSubName ? newSubName : s));
+    try {
+      const res = await fetch(`/api/categories/${encodeURIComponent(categoryName)}/subcategories`, {
+        method: 'PUT',
+        headers: { 'Content-Type': 'application/json' },
+        body: JSON.stringify({ subcategories: next })
+      });
+      if (!res.ok) throw new Error('Failed to update subcategory');
+      await refreshFromApi();
+    } catch (e) {
+      const updated = { ...categories, [categoryName]: next };
+      setCategories(updated);
+      localStorage.setItem('adminCategories', JSON.stringify(updated));
+    }
+  };
+
+  const deleteSubcategory = async (categoryName, subcategoryName) => {
+    const current = categories[categoryName] || [];
+    const next = current.filter(s => s !== subcategoryName);
+    try {
+      const res = await fetch(`/api/categories/${encodeURIComponent(categoryName)}/subcategories`, {
+        method: 'PUT',
+        headers: { 'Content-Type': 'application/json' },
+        body: JSON.stringify({ subcategories: next })
+      });
+      if (!res.ok) throw new Error('Failed to delete subcategory');
+      await refreshFromApi();
+    } catch (e) {
+      const updated = { ...categories, [categoryName]: next };
+      setCategories(updated);
+      localStorage.setItem('adminCategories', JSON.stringify(updated));
+    }
+  };
@@
     promotions,
     aboutContent,
     popularProductIds,
 
     // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ç–æ–≤–∞—Ä–æ–≤
     addProduct,
     updateProduct,
     deleteProduct,
 
     // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π
     addCategory,
     updateCategory,
     deleteCategory,
+    addSubcategory,
+    updateSubcategory,
+    deleteSubcategory,
 
     // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –±—Ä–µ–Ω–¥–æ–≤
     addBrand,
     deleteBrand,
*** End Patch
```

```javascriptreact
import React, { createContext, useContext, useState, useEffect } from 'react';
import { 
  categoryStructure, 
  initialProducts, 
  initialBrands, 
  initialPromotions, 
  initialAboutContent 
} from '../data/initialData.js';
import { migrateProductImages } from '../utils/imageHelpers';

const AdminDataContext = createContext();

export const useAdminData = () => {
  const context = useContext(AdminDataContext);
  if (!context) {
    throw new Error('useAdminData must be used within AdminDataProvider');
  }
  return context;
};

export const AdminDataProvider = ({ children }) => {
  // –°–æ—Å—Ç–æ—è–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
  const [products, setProducts] = useState(() => {
    const saved = localStorage.getItem('adminProducts');
    let productsData = saved ? JSON.parse(saved) : initialProducts;
    
    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –º–∏–≥—Ä–∏—Ä—É–µ–º products –ø—Ä–∏ –ø–µ—Ä–≤–æ–π –∑–∞–≥—Ä—É–∑–∫–µ
    productsData = productsData.map(product => migrateProductImages(product));
    
    return productsData;
  });

  const [categories, setCategories] = useState(() => {
    const saved = localStorage.getItem('adminCategories');
    return saved ? JSON.parse(saved) : categoryStructure;
  });

  const [brands, setBrands] = useState(() => {
    const saved = localStorage.getItem('adminBrands');
    return saved ? JSON.parse(saved) : initialBrands;
  });

  const [promotions, setPromotions] = useState(() => {
    const saved = localStorage.getItem('adminPromotions');
    // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –ø—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫ ‚Äî –Ω–∏–∫–∞–∫–∏—Ö –¥–µ–º–æ-–∞–∫—Ü–∏–π
    return saved ? JSON.parse(saved) : [];
  });

  const [aboutContent, setAboutContent] = useState(() => {
    const saved = localStorage.getItem('adminAboutContent');
    if (saved) {
      try {
        const parsedContent = JSON.parse(saved);
        // –ú–∏–≥—Ä–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
        const migratedContent = {
          ...initialAboutContent,
          ...parsedContent,
          team: parsedContent.team || initialAboutContent.team,
          history: {
            ...initialAboutContent.history,
            ...(parsedContent.history || {})
          },
          footer: {
            ...initialAboutContent.footer,
            ...(parsedContent.footer || {})
          },

        };
        console.log('AdminDataContext: Loaded and migrated about content:', migratedContent);
        return migratedContent;
      } catch (error) {
        console.error('AdminDataContext: Error parsing saved about content:', error);
        return initialAboutContent;
      }
    }
    console.log('AdminDataContext: Using initial about content');
    return initialAboutContent;
  });

  const [popularProductIds, setPopularProductIds] = useState(() => {
    const saved = localStorage.getItem('adminPopularProducts');
    return saved ? JSON.parse(saved) : [11, 1, 8, 2]; // ID –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
  });

  // –ü–µ—Ä–≤–∏—á–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –∏–∑ API (fallback –Ω–∞ –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ)
  useEffect(() => {
    const bootstrapFromApi = async () => {
      try {
        const [apiProductsRes, apiCategoriesRes, apiBrandsRes, apiPromosRes] = await Promise.allSettled([
          fetch('/api/products'),
          fetch('/api/categories'),
          fetch('/api/brands'),
          fetch('/api/promotions')
        ]);

        if (apiProductsRes.status === 'fulfilled' && apiProductsRes.value.ok) {
          const apiProducts = await apiProductsRes.value.json();
          const normalized = Array.isArray(apiProducts)
            ? apiProducts.map(p => migrateProductImages(p))
            : [];
          setProducts(normalized);
          localStorage.setItem('adminProducts', JSON.stringify(normalized));
        }

        if (apiCategoriesRes.status === 'fulfilled' && apiCategoriesRes.value.ok) {
          const apiCats = await apiCategoriesRes.value.json();
          if (apiCats && typeof apiCats === 'object') {
            setCategories(apiCats);
            localStorage.setItem('adminCategories', JSON.stringify(apiCats));
          }
        }

        if (apiBrandsRes.status === 'fulfilled' && apiBrandsRes.value.ok) {
          const apiBrands = await apiBrandsRes.value.json();
          if (Array.isArray(apiBrands) && apiBrands.length) {
            setBrands(apiBrands);
            localStorage.setItem('adminBrands', JSON.stringify(apiBrands));
          }
        }

        if (apiPromosRes.status === 'fulfilled' && apiPromosRes.value.ok) {
          const apiPromos = await apiPromosRes.value.json();
          if (Array.isArray(apiPromos)) {
            setPromotions(apiPromos);
            localStorage.setItem('adminPromotions', JSON.stringify(apiPromos));
          }
        }
      } catch (e) {
        console.warn('AdminDataContext: API bootstrap failed, using local data');
      }
    };
    bootstrapFromApi();
  }, []);

  // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ç–æ–≤–∞—Ä–∞–º–∏
  const addProduct = async (product) => {
    try {
      const res = await fetch('/api/products', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(product)
      });
      if (!res.ok) throw new Error('Failed to create product');
      await refreshFromApi();
    } catch (e) {
      // Fallback –ª–æ–∫–∞–ª—å–Ω–æ
      const newProduct = {
        ...product,
        id: products.length ? Math.max(...products.map(p => p.id)) + 1 : 1
      };
      const updatedProducts = [...products, newProduct];
      setProducts(updatedProducts);
      localStorage.setItem('adminProducts', JSON.stringify(updatedProducts));
    }
  };

  const updateProduct = async (id, updatedProduct) => {
    try {
      const res = await fetch(`/api/products/${id}`, {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(updatedProduct)
      });
      if (!res.ok) throw new Error('Failed to update product');
      await refreshFromApi();
    } catch (e) {
      const updatedProducts = products.map(product => 
        product.id === id ? { ...product, ...updatedProduct } : product
      );
      setProducts(updatedProducts);
      localStorage.setItem('adminProducts', JSON.stringify(updatedProducts));
    }
  };

  const deleteProduct = async (id) => {
    try {
      const res = await fetch(`/api/products/${id}`, { method: 'DELETE' });
      if (!res.ok) throw new Error('Failed to delete product');
      await refreshFromApi();
    } catch (e) {
      const updatedProducts = products.filter(product => product.id !== id);
      setProducts(updatedProducts);
      localStorage.setItem('adminProducts', JSON.stringify(updatedProducts));
    }
  };

  // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏
  const addCategory = async (categoryName, subcategories = []) => {
    try {
      const res = await fetch('/api/categories', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ name: categoryName, subcategories })
      });
      if (!res.ok) throw new Error('Failed to create category');
      await refreshFromApi();
    } catch (e) {
      const updatedCategories = {
        ...categories,
        [categoryName]: subcategories
      };
      setCategories(updatedCategories);
      localStorage.setItem('adminCategories', JSON.stringify(updatedCategories));
    }
  };

  const updateCategory = async (oldName, newName, subcategories) => {
    try {
      const subs = Array.isArray(subcategories) ? subcategories : (categories[oldName] || []);
      if (oldName !== newName) {
        const r1 = await fetch(`/api/categories/${encodeURIComponent(oldName)}`, {
          method: 'PUT',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ newName })
        });
        if (!r1.ok) throw new Error('Failed to rename category');
      }
      const r2 = await fetch(`/api/categories/${encodeURIComponent(newName)}/subcategories`, {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ subcategories: subs })
      });
      if (!r2.ok) throw new Error('Failed to update subcategories');
      await refreshFromApi();
    } catch (e) {
      const subs = Array.isArray(subcategories) ? subcategories : (categories[oldName] || []);
      const updatedCategories = { ...categories };
      delete updatedCategories[oldName];
      updatedCategories[newName] = subs;
      setCategories(updatedCategories);
      localStorage.setItem('adminCategories', JSON.stringify(updatedCategories));
    }
  };

  const deleteCategory = async (categoryName) => {
    try {
      const res = await fetch(`/api/categories/${encodeURIComponent(categoryName)}`, { method: 'DELETE' });
      if (!res.ok) throw new Error('Failed to delete category');
      await refreshFromApi();
    } catch (e) {
      const updatedCategories = { ...categories };
      delete updatedCategories[categoryName];
      setCategories(updatedCategories);
      localStorage.setItem('adminCategories', JSON.stringify(updatedCategories));
    }
  };

  // –ü–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏
  const addSubcategory = async (categoryName, subcategoryName) => {
    const current = categories[categoryName] || [];
    if (current.includes(subcategoryName)) return;
    const next = [...current, subcategoryName];
    try {
      const res = await fetch(`/api/categories/${encodeURIComponent(categoryName)}/subcategories`, {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ subcategories: next })
      });
      if (!res.ok) throw new Error('Failed to add subcategory');
      await refreshFromApi();
    } catch (e) {
      const updated = { ...categories, [categoryName]: next };
      setCategories(updated);
      localStorage.setItem('adminCategories', JSON.stringify(updated));
    }
  };

  const updateSubcategory = async (categoryName, oldSubName, newSubName) => {
    const current = categories[categoryName] || [];
    const next = current.map(s => (s === oldSubName ? newSubName : s));
    try {
      const res = await fetch(`/api/categories/${encodeURIComponent(categoryName)}/subcategories`, {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ subcategories: next })
      });
      if (!res.ok) throw new Error('Failed to update subcategory');
      await refreshFromApi();
    } catch (e) {
      const updated = { ...categories, [categoryName]: next };
      setCategories(updated);
      localStorage.setItem('adminCategories', JSON.stringify(updated));
    }
  };

  const deleteSubcategory = async (categoryName, subcategoryName) => {
    const current = categories[categoryName] || [];
    const next = current.filter(s => s !== subcategoryName);
    try {
      const res = await fetch(`/api/categories/${encodeURIComponent(categoryName)}/subcategories`, {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ subcategories: next })
      });
      if (!res.ok) throw new Error('Failed to delete subcategory');
      await refreshFromApi();
    } catch (e) {
      const updated = { ...categories, [categoryName]: next };
      setCategories(updated);
      localStorage.setItem('adminCategories', JSON.stringify(updated));
    }
  };

  // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –±—Ä–µ–Ω–¥–∞–º–∏
  const addBrand = async (brandName) => {
    if (!brandName) return;
    try {
      const res = await fetch('/api/brands', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ name: brandName })
      });
      if (!res.ok) throw new Error('Failed to create brand');
      await refreshFromApi();
    } catch (e) {
      if (!brands.includes(brandName)) {
        const updatedBrands = [...brands, brandName];
        setBrands(updatedBrands);
        localStorage.setItem('adminBrands', JSON.stringify(updatedBrands));
      }
    }
  };

  const deleteBrand = async (brandName) => {
    try {
      const res = await fetch(`/api/brands/${encodeURIComponent(brandName)}`, { method: 'DELETE' });
      if (!res.ok) throw new Error('Failed to delete brand');
      await refreshFromApi();
    } catch (e) {
      const updatedBrands = brands.filter(brand => brand !== brandName);
      setBrands(updatedBrands);
      localStorage.setItem('adminBrands', JSON.stringify(updatedBrands));
    }
  };

  // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∞–∫—Ü–∏—è–º–∏
  const addPromotion = async (promotion) => {
    try {
      const payload = {
        ...promotion,
        category: promotion.category && promotion.category !== '–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏' ? promotion.category : null,
      };
      const res = await fetch('/api/promotions', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload)
      });
      if (!res.ok) throw new Error('Failed to create promotion');
      await refreshFromApi();
    } catch (e) {
      // Fallback: –ª–æ–∫–∞–ª—å–Ω–æ, –µ—Å–ª–∏ API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
      const newPromotion = {
        ...promotion,
        id: promotions.length ? Math.max(...promotions.map(p => p.id)) + 1 : 1
      };
      const updatedPromotions = [...promotions, newPromotion];
      setPromotions(updatedPromotions);
      localStorage.setItem('adminPromotions', JSON.stringify(updatedPromotions));
    }
  };

  const updatePromotion = async (id, updatedPromotion) => {
    try {
      const payload = {
        ...updatedPromotion,
        category: updatedPromotion.category && updatedPromotion.category !== '–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏' ? updatedPromotion.category : null,
      };
      const res = await fetch(`/api/promotions/${id}`, {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload)
      });
      if (!res.ok) throw new Error('Failed to update promotion');
      await refreshFromApi();
    } catch (e) {
      // Fallback –ª–æ–∫–∞–ª—å–Ω–æ
      const updatedPromotions = promotions.map(promo => 
        promo.id === id ? { ...promo, ...updatedPromotion } : promo
      );
      setPromotions(updatedPromotions);
      localStorage.setItem('adminPromotions', JSON.stringify(updatedPromotions));
    }
  };

  const deletePromotion = async (id) => {
    try {
      const res = await fetch(`/api/promotions/${id}`, { method: 'DELETE' });
      if (!res.ok) throw new Error('Failed to delete promotion');
      await refreshFromApi();
    } catch (e) {
      // Fallback –ª–æ–∫–∞–ª—å–Ω–æ
      const updatedPromotions = promotions.filter(promo => promo.id !== id);
      setPromotions(updatedPromotions);
      localStorage.setItem('adminPromotions', JSON.stringify(updatedPromotions));
    }
  };

  // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞ "–û –∫–æ–º–ø–∞–Ω–∏–∏"
  const updateAboutContent = (newContent) => {
    console.log('AdminDataContext: Updating about content:', newContent);
    console.log('AdminDataContext: Previous about content:', aboutContent);
    console.log('AdminDataContext: Team data in new content:', newContent.team);
    console.log('AdminDataContext: History data in new content:', newContent.history);
    
    // –£–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª–Ω–∞—è
    const completeContent = {
      ...initialAboutContent,
      ...newContent,
      team: newContent.team || [],
      history: {
        ...initialAboutContent.history,
        ...(newContent.history || {})
      },
      footer: {
        ...initialAboutContent.footer,
        ...(newContent.footer || {})
      }
    };
    
    setAboutContent(completeContent);
    localStorage.setItem('adminAboutContent', JSON.stringify(completeContent));
    
    console.log('AdminDataContext: Complete content saved:', completeContent);
    console.log('AdminDataContext: Saved team:', completeContent.team);
    console.log('AdminDataContext: Saved history:', completeContent.history);
  };

  // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø–æ–ø—É–ª—è—Ä–Ω—ã–º–∏ —Ç–æ–≤–∞—Ä–∞–º–∏
  const updatePopularProducts = (productIds) => {
    setPopularProductIds(productIds);
    localStorage.setItem('adminPopularProducts', JSON.stringify(productIds));
  };

  const value = {
    // –î–∞–Ω–Ω—ã–µ
    products,
    categories,
    brands,
    promotions,
    aboutContent,
    popularProductIds,
    data: { categoryStructure: categories },
    refreshFromApi: async () => {
      const [p, c, b, pr] = await Promise.all([
        fetch('/api/products').then(r => r.ok ? r.json() : []),
        fetch('/api/categories').then(r => r.ok ? r.json() : categoryStructure),
        fetch('/api/brands').then(r => r.ok ? r.json() : initialBrands),
        fetch('/api/promotions').then(r => r.ok ? r.json() : [])
      ]);
      const normalized = Array.isArray(p) ? p.map(migrateProductImages) : [];
      setProducts(normalized);
      setCategories(c);
      setBrands(b);
      setPromotions(pr);
      localStorage.setItem('adminProducts', JSON.stringify(normalized));
      localStorage.setItem('adminCategories', JSON.stringify(c));
      localStorage.setItem('adminBrands', JSON.stringify(b));
      localStorage.setItem('adminPromotions', JSON.stringify(pr));
    },
    
    // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ç–æ–≤–∞—Ä–æ–≤
    addProduct,
    updateProduct,
    deleteProduct,
    
    // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π
    addCategory,
    updateCategory,
    deleteCategory,
    addSubcategory,
    updateSubcategory,
    deleteSubcategory,
    
    // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –±—Ä–µ–Ω–¥–æ–≤
    addBrand,
    deleteBrand,
    
    // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∞–∫—Ü–∏–π
    addPromotion,
    updatePromotion,
    deletePromotion,
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞
    updateAboutContent,
    
    // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤
    updatePopularProducts
  };

  return (
    <AdminDataContext.Provider value={value}>
      {children}
    </AdminDataContext.Provider>
  );
};

```

–°–¥–µ–ª–∞–ª –¥–≤–µ –∫–ª—é—á–µ–≤—ã–µ –≤–µ—â–∏, —á—Ç–æ–±—ã –ø—Ä–∞–≤–∫–∏ –∏–∑ –∞–¥–º–∏–Ω–∫–∏ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –ø–∏—Å–∞–ª–∏—Å—å –≤ SQLite:
- –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ –¥–æ–±–∞–≤–∏–ª –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –∏ –ø–æ–ø—Ä–∞–≤–∏–ª –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:
  - CRUD –∫–∞—Ç–µ–≥–æ—Ä–∏–π –∏ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–π: POST/PUT/DELETE `/api/categories`, PUT `/api/categories/:name/subcategories`
  - CRUD –±—Ä–µ–Ω–¥–æ–≤: POST `/api/brands`, DELETE `/api/brands/:name`
  - –£–≤–µ–ª–∏—á–∏–ª –ª–∏–º–∏—Ç JSON –¥–æ 25 –ú–ë –¥–ª—è –±–æ–ª—å—à–∏—Ö payloads
- –ù–∞ —Ñ—Ä–æ–Ω—Ç–µ –ø–æ–ø—Ä–∞–≤–∏–ª `AdminDataContext`:
  - –ö–∞—Ç–µ–≥–æ—Ä–∏–∏/–ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏/–±—Ä–µ–Ω–¥—ã —Ç–µ–ø–µ—Ä—å –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –≤ API. –î–æ–±–∞–≤–ª–µ–Ω—ã –º–µ—Ç–æ–¥—ã `addSubcategory`, `updateSubcategory`, `deleteSubcategory`.
  - –ü—Ä–æ—Ç—è–Ω—É–ª `data: { categoryStructure: categories }` –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å `CategoryManagement.jsx`.

–ß—Ç–æ –¥–µ–ª–∞—Ç—å —Å–µ–π—á–∞—Å
- –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É admin –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ:
  - –î–æ–±–∞–≤–∏—Ç—å –±—Ä–µ–Ω–¥ –∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—é; –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—é; —É–¥–∞–ª–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é.
  - –°–æ–∑–¥–∞—Ç—å/–∏–∑–º–µ–Ω–∏—Ç—å –∞–∫—Ü–∏—é; —Å–æ–∑–¥–∞—Ç—å/–∏–∑–º–µ–Ω–∏—Ç—å —Ç–æ–≤–∞—Ä.
- –ó–∞—Ç–µ–º –Ω–∞–∂–º–∏—Ç–µ –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É: –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–æ–ª–∂–Ω—ã –æ—Å—Ç–∞—Ç—å—Å—è (–∏–∑ –ë–î).
- –ï—Å–ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–æ–ø–∞–¥–∞—é—Ç: —ç—Ç–æ –∑–Ω–∞—á–∏—Ç, —á—Ç–æ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –≤–µ—Ä–Ω—É–ª—Å—è –Ω–µ—É—Å–ø–µ—Ö –∏ —Å—Ä–∞–±–æ—Ç–∞–ª –ª–æ–∫–∞–ª—å–Ω—ã–π fallback. –í —ç—Ç–æ–º —Å–ª—É—á–∞–µ –ø—Ä–∏—à–ª–∏—Ç–µ –æ—à–∏–±–∫—É –∏–∑ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞ (Network tab) –ø–æ –≤—ã–∑–æ–≤–∞–º `/api/...`.

–í–∞–∂–Ω–æ
- –°–µ—Ä–≤–µ—Ä –Ω–∞ `http://localhost:3001` –∑–∞–ø—É—â–µ–Ω. –ï—Å–ª–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–ª–∏ IDE/–ü–ö, –µ–≥–æ –Ω—É–∂–Ω–æ —Å–Ω–æ–≤–∞ –∑–∞–ø—É—Å—Ç–∏—Ç—å: –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ –ø—Ä–æ–µ–∫—Ç–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ ‚Äî —Å–µ—Ä–≤–µ—Ä –∞–∫—Ç–∏–≤–µ–Ω.

---

**User**

–í—Å—ë —Ä–æ–≤–Ω–æ –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è 

---

**Cursor**

–°–æ–∑–¥–∞–º –Ω–µ–±–æ–ª—å—à–æ–π —Å–∫—Ä–∏–ø—Ç-–ø—Ä–æ–≤–µ—Ä–∫—É API –≤ `server/test_api.js`, –≤—ã–ø–æ–ª–Ω—é –µ–≥–æ –∏–∑ –∫–æ—Ä–Ω—è (Node 22 –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç fetch), —á—Ç–æ–±—ã —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –∑–∞–ø–∏—Å–∏ –≤ SQLite —Ä–µ–∞–ª—å–Ω–æ —Å–æ–∑–¥–∞—é—Ç—Å—è –∏ —á–∏—Ç–∞—é—Ç—Å—è, –∏ –ø–æ–∫–∞–∂—É —Ä–µ–∑—É–ª—å—Ç–∞—Ç. –ó–∞—Ç–µ–º, –µ—Å–ª–∏ –±—É–¥—É—Ç –æ—à–∏–±–∫–∏, —Å—Ä–∞–∑—É –ø–æ–ø—Ä–∞–≤–ª—é.

```javascript
/* eslint-disable */
(async () => {
  try {
    const base = 'http://localhost:3001';

    async function call(method, path, body) {
      const res = await fetch(base + path, {
        method,
        headers: { 'Content-Type': 'application/json' },
        body: body ? JSON.stringify(body) : undefined,
      });
      const text = await res.text();
      let json;
      try { json = JSON.parse(text); } catch { json = text; }
      return { status: res.status, data: json };
    }

    console.log('HEALTH', await call('GET', '/api/health'));

    console.log('CREATE BRAND', await call('POST', '/api/brands', { name: 'BrandFromTest' }));
    console.log('BRANDS', await call('GET', '/api/brands'));

    console.log('CREATE CATEGORY', await call('POST', '/api/categories', { name: 'CatFromTest', subcategories: ['SubA','SubB'] }));
    console.log('CATEGORIES', await call('GET', '/api/categories'));

    console.log('CREATE PROMO', await call('POST', '/api/promotions', { title: 'PromoFromTest', description: 'desc', discount: 7, category: 'CatFromTest', active: true, featured: false, minPurchase: 5000 }));
    console.log('PROMOTIONS', await call('GET', '/api/promotions'));

    console.log('CREATE PRODUCT', await call('POST', '/api/products', {
      title: 'ProdFromTest', price: 12345, category: 'CatFromTest', subcategory: 'SubA', brand: 'BrandFromTest', available: true, quantity: 2, description: 'desc', images: [{ data: 'üì¶', isMain: true }]
    }));
    console.log('PRODUCTS', await call('GET', '/api/products'));

    console.log('DONE');
  } catch (e) {
    console.error('TEST FAILED', e);
    process.exit(1);
  }
})();


```

---

**User**

—Ö–æ—Ä–æ—à–æ\

---

**Cursor**

–û—Ç–ª–∏—á–Ω–æ.

- –¢–µ–ø–µ—Ä—å –∞–¥–º–∏–Ω–∫–∞ –ø–∏—à–µ—Ç –≤ SQLite (`server/db.sqlite3`) —á–µ—Ä–µ–∑ API.
- –ß—Ç–æ–±—ã –∏—Å–∫–ª—é—á–∏—Ç—å —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞: –≤ –∞–¥–º–∏–Ω–∫–µ –æ—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:
  localStorage.removeItem('adminProducts'); localStorage.removeItem('adminCategories'); localStorage.removeItem('adminBrands'); localStorage.removeItem('adminPromotions');
  –∑–∞—Ç–µ–º –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É.

–ï—Å–ª–∏ –ø–æ—Å–ª–µ —ç—Ç–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤—Å—ë –µ—â—ë –ø—Ä–æ–ø–∞–¥–∞—é—Ç:
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–æ –≤–∫–ª–∞–¥–∫–µ Network, —á—Ç–æ –≤—ã–∑–æ–≤—ã `/api/...` –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç 2xx.
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –∞–∫—Ç–∏–≤–µ–Ω –Ω–∞ `http://localhost:3001` (–æ–Ω –∑–∞–ø—É—â–µ–Ω).
- –°–æ–æ–±—â–∏—Ç–µ, –∫–∞–∫–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è (—Ç–æ–≤–∞—Ä/–∫–∞—Ç–µ–≥–æ—Ä–∏—è/–±—Ä–µ–Ω–¥/–∞–∫—Ü–∏—è) –∏ —Å—Ç–∞—Ç—É—Å –æ—Ç–≤–µ—Ç–∞ ‚Äî —Å—Ä–∞–∑—É –ø–æ–ø—Ä–∞–≤–ª—é.

---

**User**

–ù–∏—á–µ–≥–æ –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –±–¥

---

**Cursor**

–ü—Ä–æ–±–ª–µ–º–∞: –≤—ã —Å–º–æ—Ç—Ä–∏—Ç–µ —Å–∞–π—Ç –Ω–∞ 5173 —á–µ—Ä–µ–∑ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä (vite preview). –£ preview –ù–ï —Ä–∞–±–æ—Ç–∞–µ—Ç proxy `/api`, –ø–æ—ç—Ç–æ–º—É –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ `/api/categories` –∏ `/api/brands` –∏–¥—É—Ç –≤ —Å–∞–º Vite –∏ –ø–æ–ª—É—á–∞—é—Ç 404, –∞ –Ω–µ –Ω–∞ backend `http://localhost:3001`. –û—Ç—Å—é–¥–∞ ‚Äú–Ω–∏—á–µ–≥–æ –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è‚Äù.

–ß—Ç–æ –¥–µ–ª–∞—Ç—å:
- –û—Ç–∫—Ä–æ–π—Ç–µ —Å–∞–π—Ç –Ω–∞ dev-—Å–µ—Ä–≤–µ—Ä–µ: `http://localhost:5174/` (—Ç–∞–º proxy –≤–∫–ª—é—á—ë–Ω).
- –ò–ª–∏ –æ–±—Ä–∞—â–∞–π—Ç–µ—Å—å –∫ API –Ω–∞–ø—Ä—è–º—É—é: `http://localhost:3001/api/...` (–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ä–∞–∑—É –≤ –ë–î).

–ü—Ä–æ–≤–µ—Ä–∫–∞:
- –í –±—Ä–∞—É–∑–µ—Ä–µ –æ—Ç–∫—Ä–æ–π—Ç–µ `http://localhost:3001/api/categories` –∏ `http://localhost:3001/api/brands` ‚Äî –¥–æ–ª–∂–Ω—ã –≤–µ—Ä–Ω—É—Ç—å—Å—è JSON.
- –í –∞–¥–º–∏–Ω–∫–µ –Ω–∞ 5174 –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–æ–∑–¥–∞—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é/–±—Ä–µ–Ω–¥/–∞–∫—Ü–∏—é/—Ç–æ–≤–∞—Ä, –∑–∞—Ç–µ–º –æ–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É ‚Äî –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—Ç—Å—è –≤ `server/db.sqlite3`.

–ï—Å–ª–∏ –≤—Å—ë –µ—â—ë 404:
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∏–º–µ–Ω–Ω–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–∞ 5174 –æ—Ç–∫—Ä—ã—Ç–∞ (–∞ –Ω–µ 5173).
- –°–µ—Ä–≤–µ—Ä API –¥–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å ok –Ω–∞ `http://localhost:3001/api/health`.

```javascript
/* eslint-disable */
const express = require('express');
const cors = require('cors');
const path = require('path');
const { db, run, get, all } = require('./db');
const fs = require('fs');
const multer = require('multer');

const app = express();
const PORT = process.env.PORT || 3001;

app.use(cors());
app.use(express.json({ limit: '25mb' }));
// –°—Ç–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–∞–∑–¥–∞—á–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
const uploadsDir = path.join(__dirname, 'uploads');
if (!fs.existsSync(uploadsDir)) {
  fs.mkdirSync(uploadsDir, { recursive: true });
}
app.use('/uploads', express.static(uploadsDir));

// –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
const storage = multer.diskStorage({
  destination: (req, file, cb) => cb(null, uploadsDir),
  filename: (req, file, cb) => {
    const ext = path.extname(file.originalname) || '.png';
    const name = `${Date.now()}-${Math.round(Math.random() * 1e9)}${ext}`;
    cb(null, name);
  }
});
const upload = multer({ storage });

// Healthcheck
app.get('/api/health', (req, res) => {
  res.json({ ok: true });
});

// Upload image
app.post('/api/upload/image', upload.single('image'), (req, res) => {
  if (!req.file) return res.status(400).json({ error: 'No file' });
  const url = `/uploads/${req.file.filename}`;
  res.status(201).json({ url });
});

// Brands
app.get('/api/brands', async (req, res) => {
  try {
    const rows = await all(db, `SELECT id, name FROM brands ORDER BY name ASC`);
    res.json(rows.map(r => r.name));
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to fetch brands' });
  }
});
app.post('/api/brands', async (req, res) => {
  try {
    const { name } = req.body;
    await ensureBrandByName(name);
    res.status(201).json({ ok: true });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to create brand' });
  }
});
app.delete('/api/brands/:name', async (req, res) => {
  try {
    const { name } = req.params;
    await run(db, `DELETE FROM brands WHERE name=?`, [name]);
    res.json({ ok: true });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to delete brand' });
  }
});

// Categories and subcategories as structure
app.get('/api/categories', async (req, res) => {
  try {
    const cats = await all(db, `SELECT id, name FROM categories ORDER BY name ASC`);
    const sub = await all(db, `SELECT id, category_id, name FROM subcategories ORDER BY name ASC`);
    const idToName = new Map(cats.map(c => [c.id, c.name]));
    const result = {};
    for (const c of cats) {
      result[c.name] = [];
    }
    for (const s of sub) {
      const catName = idToName.get(s.category_id);
      if (!catName) continue;
      result[catName].push(s.name);
    }
    res.json(result);
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to fetch categories' });
  }
});
// Categories CRUD by name
app.post('/api/categories', async (req, res) => {
  try {
    const { name, subcategories = [] } = req.body;
    const catId = await ensureCategoryByName(name);
    for (const s of subcategories) {
      await ensureSubcategoryByName(catId, s);
    }
    res.status(201).json({ ok: true });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to create category' });
  }
});
app.put('/api/categories/:name', async (req, res) => {
  try {
    const oldName = req.params.name;
    const { newName } = req.body;
    await run(db, `UPDATE categories SET name=? WHERE name=?`, [newName, oldName]);
    res.json({ ok: true });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to rename category' });
  }
});
app.delete('/api/categories/:name', async (req, res) => {
  try {
    const name = req.params.name;
    await run(db, `DELETE FROM categories WHERE name=?`, [name]);
    res.json({ ok: true });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to delete category' });
  }
});
app.put('/api/categories/:name/subcategories', async (req, res) => {
  try {
    const name = req.params.name;
    const { subcategories = [] } = req.body;
    const cat = await get(db, `SELECT id FROM categories WHERE name=?`, [name]);
    if (!cat) return res.status(404).json({ error: 'Category not found' });
    await run(db, `DELETE FROM subcategories WHERE category_id=?`, [cat.id]);
    for (const s of subcategories) {
      await ensureSubcategoryByName(cat.id, s);
    }
    res.json({ ok: true });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to set subcategories' });
  }
});

// Products
app.get('/api/products', async (req, res) => {
  try {
    const rows = await all(
      db,
      `SELECT p.*, 
              c.name AS category_name, 
              s.name AS subcategory_name, 
              b.name AS brand_name
       FROM products p
       LEFT JOIN categories c ON p.category_id = c.id
       LEFT JOIN subcategories s ON p.subcategory_id = s.id
       LEFT JOIN brands b ON p.brand_id = b.id
       ORDER BY p.created_at DESC`
    );

    // –î–æ–±–∞–≤–ª—è–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
    const productIds = rows.map(r => r.id);
    let images = [];
    if (productIds.length > 0) {
      images = await all(
        db,
        `SELECT * FROM product_images WHERE product_id IN (${productIds.map(() => '?').join(',')})`,
        productIds
      );
    }
    const productIdToImages = new Map();
    for (const img of images) {
      if (!productIdToImages.has(img.product_id)) productIdToImages.set(img.product_id, []);
      productIdToImages.get(img.product_id).push({ id: img.id, data: img.image_data, isMain: !!img.is_main });
    }

    const result = rows.map(r => ({
      id: r.id,
      title: r.title,
      price: r.price,
      category: r.category_name,
      subcategory: r.subcategory_name,
      brand: r.brand_name,
      available: !!r.available,
      quantity: r.quantity,
      description: r.description,
      specifications: r.specifications_json ? JSON.parse(r.specifications_json) : undefined,
      features: r.features_json ? JSON.parse(r.features_json) : undefined,
      images: productIdToImages.get(r.id) || [],
      createdAt: r.created_at,
      updatedAt: r.updated_at
    }));

    res.json(result);
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to fetch products' });
  }
});

// Helpers to ensure catalog entities
async function ensureCategoryByName(name) {
  if (!name) return null;
  const row = await get(db, `SELECT id FROM categories WHERE name = ?`, [name]);
  if (row) return row.id;
  const r = await run(db, `INSERT INTO categories (name) VALUES (?)`, [name]);
  return r.lastID;
}

async function ensureSubcategoryByName(categoryId, name) {
  if (!name || !categoryId) return null;
  const row = await get(db, `SELECT id FROM subcategories WHERE category_id = ? AND name = ?`, [categoryId, name]);
  if (row) return row.id;
  const r = await run(db, `INSERT INTO subcategories (category_id, name) VALUES (?, ?)`, [categoryId, name]);
  return r.lastID;
}

async function ensureBrandByName(name) {
  if (!name) return null;
  const row = await get(db, `SELECT id FROM brands WHERE name = ?`, [name]);
  if (row) return row.id;
  const r = await run(db, `INSERT INTO brands (name) VALUES (?)`, [name]);
  return r.lastID;
}

// Create product
app.post('/api/products', async (req, res) => {
  try {
    const { title, price, category, subcategory, brand, available = true, quantity = 0, description = null, specifications, features, images } = req.body;

    const categoryId = await ensureCategoryByName(category);
    const subcategoryId = await ensureSubcategoryByName(categoryId, subcategory);
    const brandId = await ensureBrandByName(brand);

    const specJson = specifications ? JSON.stringify(specifications) : null;
    const featJson = features ? JSON.stringify(features) : null;

    const r = await run(
      db,
      `INSERT INTO products (title, price, category_id, subcategory_id, brand_id, available, quantity, description, specifications_json, features_json)
       VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)`,
      [title, price, categoryId, subcategoryId, brandId, available ? 1 : 0, quantity, description, specJson, featJson]
    );

    const productId = r.lastID;
    if (Array.isArray(images)) {
      for (const img of images) {
        await run(db, `INSERT INTO product_images (product_id, image_data, is_main) VALUES (?, ?, ?)`, [productId, img.data, img.isMain ? 1 : 0]);
      }
    }

    res.status(201).json({ id: productId });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to create product' });
  }
});

// Update product
app.put('/api/products/:id', async (req, res) => {
  try {
    const id = Number(req.params.id);
    const { title, price, category, subcategory, brand, available = true, quantity = 0, description = null, specifications, features, images } = req.body;

    const categoryId = await ensureCategoryByName(category);
    const subcategoryId = await ensureSubcategoryByName(categoryId, subcategory);
    const brandId = await ensureBrandByName(brand);

    const specJson = specifications ? JSON.stringify(specifications) : null;
    const featJson = features ? JSON.stringify(features) : null;

    await run(
      db,
      `UPDATE products SET title=?, price=?, category_id=?, subcategory_id=?, brand_id=?, available=?, quantity=?, description=?, specifications_json=?, features_json=?, updated_at = datetime('now') WHERE id=?`,
      [title, price, categoryId, subcategoryId, brandId, available ? 1 : 0, quantity, description, specJson, featJson, id]
    );

    // replace images
    if (Array.isArray(images)) {
      await run(db, `DELETE FROM product_images WHERE product_id = ?`, [id]);
      for (const img of images) {
        await run(db, `INSERT INTO product_images (product_id, image_data, is_main) VALUES (?, ?, ?)`, [id, img.data, img.isMain ? 1 : 0]);
      }
    }

    res.json({ ok: true });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to update product' });
  }
});

// Delete product
app.delete('/api/products/:id', async (req, res) => {
  try {
    const id = Number(req.params.id);
    await run(db, `DELETE FROM products WHERE id=?`, [id]);
    res.json({ ok: true });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to delete product' });
  }
});

// Promotions
app.get('/api/promotions', async (req, res) => {
  try {
    const rows = await all(
      db,
      `SELECT p.*, c.name AS category_name FROM promotions p
       LEFT JOIN categories c ON p.category_id = c.id
       ORDER BY p.featured DESC, p.id DESC`
    );
    const result = rows.map(r => ({
      id: r.id,
      title: r.title,
      description: r.description,
      discount: r.discount,
      category: r.category_name,
      validUntil: r.valid_until,
      active: !!r.active,
      featured: !!r.featured,
      minPurchase: r.min_purchase
    }));
    res.json(result);
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to fetch promotions' });
  }
});

// Promotions CRUD (–º–∏–Ω–∏–º—É–º)
app.post('/api/promotions', async (req, res) => {
  try {
    const { title, description, discount, category, validUntil, active = true, featured = false, minPurchase } = req.body;
    const catId = category ? (await get(db, `SELECT id FROM categories WHERE name = ?`, [category]))?.id : null;
    const r = await run(
      db,
      `INSERT INTO promotions (title, description, discount, category_id, valid_until, active, featured, min_purchase)
       VALUES (?, ?, ?, ?, ?, ?, ?, ?)`,
      [title, description ?? null, discount, catId ?? null, validUntil ?? null, active ? 1 : 0, featured ? 1 : 0, minPurchase ?? null]
    );
    res.status(201).json({ id: r.lastID });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to create promotion' });
  }
});

app.put('/api/promotions/:id', async (req, res) => {
  try {
    const id = Number(req.params.id);
    const { title, description, discount, category, validUntil, active, featured, minPurchase } = req.body;
    const catId = category ? (await get(db, `SELECT id FROM categories WHERE name = ?`, [category]))?.id : null;
    await run(
      db,
      `UPDATE promotions SET title=?, description=?, discount=?, category_id=?, valid_until=?, active=?, featured=?, min_purchase=? WHERE id=?`,
      [title, description ?? null, discount, catId ?? null, validUntil ?? null, active ? 1 : 0, featured ? 1 : 0, minPurchase ?? null, id]
    );
    res.json({ ok: true });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to update promotion' });
  }
});

app.delete('/api/promotions/:id', async (req, res) => {
  try {
    const id = Number(req.params.id);
    await run(db, `DELETE FROM promotions WHERE id=?`, [id]);
    res.json({ ok: true });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to delete promotion' });
  }
});

// Orders
app.get('/api/orders', async (req, res) => {
  try {
    const orders = await all(db, `SELECT * FROM orders ORDER BY created_at DESC`);
    const orderIds = orders.map(o => o.id);
    let items = [];
    if (orderIds.length) {
      items = await all(db, `SELECT * FROM order_items WHERE order_id IN (${orderIds.map(() => '?').join(',')})`, orderIds);
    }
    const orderIdToItems = new Map();
    for (const it of items) {
      if (!orderIdToItems.has(it.order_id)) orderIdToItems.set(it.order_id, []);
      orderIdToItems.get(it.order_id).push({
        id: it.id,
        productId: it.product_id,
        title: it.title,
        price: it.price,
        quantity: it.quantity
      });
    }

    // notes
    let notes = [];
    if (orderIds.length) {
      notes = await all(db, `SELECT * FROM order_notes WHERE order_id IN (${orderIds.map(() => '?').join(',')}) ORDER BY timestamp ASC`, orderIds);
    }
    const orderIdToNotes = new Map();
    for (const n of notes) {
      if (!orderIdToNotes.has(n.order_id)) orderIdToNotes.set(n.order_id, []);
      orderIdToNotes.get(n.order_id).push({
        id: n.id,
        text: n.text,
        type: n.type,
        timestamp: n.timestamp
      });
    }

    const result = [];
    for (const o of orders) {
      const customer = o.customer_id ? await get(db, `SELECT * FROM customers WHERE id = ?`, [o.customer_id]) : null;
      result.push({
        id: o.id,
        orderNumber: o.order_number,
        status: o.status,
        pricing: JSON.parse(o.pricing_json),
        items: orderIdToItems.get(o.id) || [],
        customerInfo: customer || { name: '', phone: '', email: null, address: null },
        notes: orderIdToNotes.get(o.id) || [],
        createdAt: o.created_at,
        updatedAt: o.updated_at
      });
    }
    res.json(result);
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to fetch orders' });
  }
});

app.post('/api/orders', async (req, res) => {
  try {
    const { orderForm, cartItems, priceCalculation, orderNumber } = req.body;

    // customer
    let customerId = null;
    if (orderForm) {
      const r = await run(
        db,
        `INSERT INTO customers (name, phone, email, address) VALUES (?, ?, ?, ?)`,
        [orderForm.name, orderForm.phone, orderForm.email ?? null, orderForm.address ?? null]
      );
      customerId = r.lastID;
    }

    const id = String(orderNumber);
    await run(
      db,
      `INSERT INTO orders (id, order_number, customer_id, status, pricing_json) VALUES (?, ?, ?, 'new', ?)` ,
      [id, String(orderNumber), customerId, JSON.stringify(priceCalculation)]
    );

    if (Array.isArray(cartItems)) {
      for (const it of cartItems) {
        await run(
          db,
          `INSERT INTO order_items (order_id, product_id, title, price, quantity) VALUES (?, ?, ?, ?, ?)`,
          [id, it.id ?? null, it.title, it.price, it.quantity]
        );
      }
    }

    res.status(201).json({ ok: true, id, orderNumber });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to create order' });
  }
});

// Orders: update status
app.patch('/api/orders/:id/status', async (req, res) => {
  try {
    const { id } = req.params;
    const { status } = req.body;
    await run(db, `UPDATE orders SET status=?, updated_at = datetime('now') WHERE id=?`, [status, id]);
    res.json({ ok: true });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to update status' });
  }
});

// Orders: add note
app.post('/api/orders/:id/notes', async (req, res) => {
  try {
    const { id } = req.params;
    const { text, type = 'note' } = req.body;
    const r = await run(db, `INSERT INTO order_notes (order_id, text, type) VALUES (?, ?, ?)`, [id, text, type]);
    res.status(201).json({ id: r.lastID });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to add note' });
  }
});

app.listen(PORT, () => {
  console.log(`API server listening on http://localhost:${PORT}`);
});


// Debug: list registered routes
app.get('/api/_debug/routes', (req, res) => {
  try {
    const routes = [];
    app._router.stack.forEach((m) => {
      if (m.route && m.route.path) {
        routes.push({ path: m.route.path, methods: m.route.methods });
      }
      if (m.name === 'router' && m.handle && m.handle.stack) {
        m.handle.stack.forEach((h) => {
          if (h.route && h.route.path) {
            routes.push({ path: h.route.path, methods: h.route.methods });
          }
        });
      }
    });
    res.json(routes);
  } catch (e) {
    res.status(500).json({ error: String(e) });
  }
});


```

–û—à–∏–±–∫–∞ ‚Äú–ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å /api/categories‚Äù –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –º–∞—Ä—à—Ä—É—Ç –Ω–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω —É –∑–∞–ø—É—â–µ–Ω–Ω–æ–≥–æ —ç–∫–∑–µ–º–ø–ª—è—Ä–∞ —Å–µ—Ä–≤–µ—Ä–∞. –ú—ã –¥–æ–±–∞–≤–∏–ª–∏ –µ–≥–æ –≤ –∫–æ–¥, –Ω–æ –ø–æ—Ö–æ–∂–µ, —á—Ç–æ —Å–µ–π—á–∞—Å —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞—Ä—ã–π –ø—Ä–æ—Ü–µ—Å—Å —Å–µ—Ä–≤–µ—Ä–∞ –±–µ–∑ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π.

–°–¥–µ–ª–∞–π—Ç–µ —Ç–∞–∫:
- –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Å—Ç–∞—Ä—ã–π backend-–ø—Ä–æ—Ü–µ—Å—Å –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ –∑–∞–Ω–æ–≤–æ:
  - –ó–∞–∫—Ä–æ–π—Ç–µ –æ–∫–Ω–æ, –≥–¥–µ –∑–∞–ø—É—â–µ–Ω `node index.js`, –∏–ª–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –∫–æ–º–∞–Ω–¥–æ–π –∏–∑ –∫–æ—Ä–Ω—è –ø—Ä–æ–µ–∫—Ç–∞:
    - –î–ª—è Windows: –æ—Ç–∫—Ä–æ–π—Ç–µ –Ω–æ–≤—ã–π —Ç–µ—Ä–º–∏–Ω–∞–ª –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:
      - cd server
      - npm run start
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã:
  - –û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ `http://localhost:3001/api/_debug/routes`
  - –í—ã –¥–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å JSON —Å–æ —Å–ø–∏—Å–∫–æ–º, —Å—Ä–µ–¥–∏ –∫–æ—Ç–æ—Ä—ã—Ö –µ—Å—Ç—å –ø—É—Ç–∏:
    - /api/categories
    - /api/brands
    - /api/products
    - /api/promotions
    - /api/orders
- –ó–∞—Ç–µ–º —Å–Ω–æ–≤–∞ –æ—Ç–∫—Ä–æ–π—Ç–µ:
  - `http://localhost:3001/api/categories`
  - `http://localhost:3001/api/brands`

–ï—Å–ª–∏ –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ `/api/_debug/routes` –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –Ω—É–∂–Ω—ã—Ö –ø—É—Ç–µ–π, –∑–Ω–∞—á–∏—Ç —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—Å—Ç–∏–ª—Å—è –∏–∑ —Å—Ç–∞—Ä–æ–≥–æ —Ñ–∞–π–ª–∞. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∑–∞–ø—É—Å–∫–∞–µ—Ç–µ –∏–º–µ–Ω–Ω–æ `server/index.js` –∏–∑ –ø–∞–ø–∫–∏ `client/server`:
- –í –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞ –ø—É—Ç—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å `client/server/index.js`.
- –í—ã–ø–æ–ª–Ω–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É –∑–∞–ø—É—Å–∫–∞ —Ç–æ–ª—å–∫–æ –æ—Ç—Ç—É–¥–∞: `cd server && node index.js`.

–ü–æ—Å–ª–µ —Ç–æ–≥–æ –∫–∞–∫ API –Ω–∞—á–Ω—ë—Ç –æ—Ç–¥–∞–≤–∞—Ç—å JSON, –∞–¥–º–∏–Ω–∫–∞ –Ω–∞ `http://localhost:5174/` –Ω–∞—á–Ω—ë—Ç —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ –ë–î.

---

**User**

–°–¥–µ–ª–∞–π —Å–∞–º

---

**Cursor**

–ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞—é backend –∏ dev-—Å–µ—Ä–≤–µ—Ä, –∑–∞—Ç–µ–º –ø—Ä–æ–≤–µ—Ä—è—é –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã –∏ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å `/api/categories` –∏ `/api/brands` —á–µ—Ä–µ–∑ `cmd /c curl`, —á—Ç–æ–±—ã –∏—Å–∫–ª—é—á–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—ã PowerShell. –ü–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –º–∞—Ä—à—Ä—É—Ç–æ–≤ –º–æ–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å –∞–¥–º–∏–Ω–∫—É –Ω–∞ 5174 –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ.

–ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞—é backend –∏ –ø—Ä–æ–≤–µ—Ä—è—é –º–∞—Ä—à—Ä—É—Ç—ã –∏ –∑–∞–ø–∏—Å—å –≤ –ë–î –Ω–∞–ø—Ä—è–º—É—é —á–µ—Ä–µ–∑ API, –∑–∞—Ç–µ–º –ø–µ—Ä–µ–∑–∞–ø—É—â—É dev-—Å–µ—Ä–≤–µ—Ä –Ω–∞ 5174.

–ì–æ—Ç–æ–≤–æ: backend –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω, API –æ—Ç–≤–µ—á–∞–µ—Ç. –ü—Ä–æ–≤–µ—Ä–∫–∞:
- GET http://localhost:3001/api/categories ‚Üí JSON –ø—Ä–∏—Ö–æ–¥–∏—Ç
- GET http://localhost:3001/api/brands ‚Üí JSON –ø—Ä–∏—Ö–æ–¥–∏—Ç

–ß—Ç–æ –¥–µ–ª–∞—Ç—å:
- –û—Ç–∫—Ä–æ–π—Ç–µ –∞–¥–º–∏–Ω–∫—É –Ω–∞ http://localhost:5174/ (–Ω–µ 5173).
- –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É (Ctrl+F5) –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–æ–∑–¥–∞—Ç—å/–∏–∑–º–µ–Ω–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é, –±—Ä–µ–Ω–¥, —Ç–æ–≤–∞—Ä –∏–ª–∏ –∞–∫—Ü–∏—é ‚Äî –∏–∑–º–µ–Ω–µ–Ω–∏—è –±—É–¥—É—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ –ë–î `server/db.sqlite3`.

–ï—Å–ª–∏ –≤—Å—ë –µ—â—ë –Ω–µ –≤–∏–¥–∏—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π:
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–æ –≤–∫–ª–∞–¥–∫–µ Network, —á—Ç–æ –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ `/api/...` –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç 2xx.
- –û—á–∏—Å—Ç–∏—Ç–µ –∫—ç—à –ª–æ–∫–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö: –≤ –∫–æ–Ω—Å–æ–ª–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:
  localStorage.removeItem('adminProducts'); localStorage.removeItem('adminCategories'); localStorage.removeItem('adminBrands'); localStorage.removeItem('adminPromotions');
  –∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É.

---

**User**

–°—Ç—Ä–∞–Ω–∏—Ü—ã –Ω–µ –∑–∞–ø—É—Å—Ç–∏–ª–∏—Å—å 

---

**Cursor**

–ó–∞–ø—É—Å–∫–∞—é dev-—Å–µ—Ä–≤–µ—Ä Vite –Ω–∞ 5174 –∏ –ø—Ä–æ–≤–µ—Ä—è—é –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã.

- Dev-—Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω: –æ—Ç–∫—Ä–æ–π—Ç–µ `http://localhost:5174/`.
- Backend –∞–∫—Ç–∏–≤–µ–Ω: `http://localhost:3001/api/categories` –∏ `.../brands` –æ—Ç–≤–µ—á–∞—é—Ç JSON.

–¢–µ–ø–µ—Ä—å —Å—Ç—Ä–∞–Ω–∏—Ü—ã –¥–æ–ª–∂–Ω—ã –æ—Ç–∫—Ä—ã–≤–∞—Ç—å—Å—è –Ω–∞ 5174. –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ –≤–∏–¥–Ω–æ ‚Äî –∂—ë—Å—Ç–∫–æ –æ–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É (Ctrl+F5).

–ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞—é backend-—Å–µ—Ä–≤–µ—Ä –∏ –ø—Ä–æ–≤–µ—Ä—è—é –µ–≥–æ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å, —á—Ç–æ–±—ã –∏—Å–ø—Ä–∞–≤–∏—Ç—å –æ—à–∏–±–∫–∏ –ø—Ä–æ–∫—Å–∏ ECONNREFUSED. –ó–∞—Ç–µ–º –ø–æ–¥—Å–∫–∞–∂—É, —á—Ç–æ –¥–µ–ª–∞—Ç—å.

- –Ø –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏–ª backend. –û—Ç–∫—Ä–æ–π—Ç–µ `http://localhost:3001/api/health` ‚Äî –¥–æ–ª–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å JSON ok:true.
- –ï—Å–ª–∏ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –ø—É—Å—Ç–∞—è: –æ–±–Ω–æ–≤–∏—Ç–µ –≤–∫–ª–∞–¥–∫—É Vite –Ω–∞ `http://localhost:5174/` ‚Äî –ø—Ä–æ–∫—Å–∏ –ø–µ—Ä–µ—Å—Ç–∞–Ω–µ—Ç —Ä—É–≥–∞—Ç—å—Å—è (ECONNREFUSED –∏—Å—á–µ–∑–Ω–µ—Ç).

–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ:
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `http://localhost:3001/api/categories` –∏ `.../brands` ‚Äî –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å JSON.
- –í –∞–¥–º–∏–Ω–∫–µ –Ω–∞ 5174 –∏–∑–º–µ–Ω–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–π/–±—Ä–µ–Ω–¥–æ–≤/—Ç–æ–≤–∞—Ä–æ–≤/–∞–∫—Ü–∏–π —Å–æ—Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ –ë–î.

---

**User**

–û—Ç–ª–∏—á–Ω–æ, –≤—Å—ë —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è

---

**Cursor**

–û—Ç–ª–∏—á–Ω–æ! –†–∞–¥, —á—Ç–æ –∑–∞–ø–∏—Å—å –≤ –ë–î –∑–∞—Ä–∞–±–æ—Ç–∞–ª–∞.

- Front: `http://localhost:5174/`
- API: `http://localhost:3001` (–ë–î ‚Äî `server/db.sqlite3`)
- –ï—Å–ª–∏ –≤–¥—Ä—É–≥ –ø–æ–≤—Ç–æ—Ä–∏—Ç—Å—è ‚Äú–Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è‚Äù: –ø—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –æ—Ç–∫—Ä—ã—Ç 5174 (–∞ –Ω–µ 5173), –∏ —á—Ç–æ `http://localhost:3001/api/health` –æ—Ç–≤–µ—á–∞–µ—Ç.

–•–æ—Ç–∏—Ç–µ, –¥–æ–¥–µ–ª–∞—é:
- –∑–∞–≥—Ä—É–∑–∫—É —Ä–µ–∞–ª—å–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —á–µ—Ä–µ–∑ `/api/upload/image` —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º URL –≤ –ë–î;
- –ø–æ–ª–Ω—ã–π CRUD —Ç–æ–≤–∞—Ä–æ–≤ –∏ –∞–∫—Ü–∏–π –∏–∑ –∞–¥–º–∏–Ω–∫–∏ (—É–∂–µ —á–∞—Å—Ç–∏—á–Ω–æ –≥–æ—Ç–æ–≤–æ) —Å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏ –æ–± –æ—à–∏–±–∫–∞—Ö;
- —Ä–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –ë–î –≤ `server/backups/` —Å –¥–∞—Ç–æ–π.

---

**User**

–•–æ—á—É, —Å–¥–µ–ª–∞–π –ø–ª–∞–Ω to-do –∏ –¥–µ–π—Å—Ç–≤—É–π –ø–æ –Ω–µ–º—É 

---

**Cursor**

–°–Ω–∞—á–∞–ª–∞ –¥–æ–±–∞–≤–ª—é –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ `/uploads` –≤ `vite.config.js`, –∑–∞—Ç–µ–º —Ä–µ–∞–ª–∏–∑—É—é –∑–∞–≥—Ä—É–∑–∫—É –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –≤ `MultiImageUpload.jsx` —á–µ—Ä–µ–∑ `/api/upload/image` —Å fallback –Ω–∞ Base64, —Å–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É—é –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ `imageHelpers.js` –∏ –ø—Ä–µ–≤—å—é –≤ `ProductManagement.jsx`. –ü–æ—Å–ª–µ –ø—Ä–∞–≤–æ–∫ –ø–µ—Ä–µ–∑–∞–ø—É—â—É dev-—Å–µ—Ä–≤–µ—Ä.

```javascript
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'

// https://vite.dev/config/
export default defineConfig({
  plugins: [react()],
  server: {
    host: true,
    port: 5173,
    strictPort: true,
    proxy: {
      '/api': {
        target: 'http://localhost:3001',
        changeOrigin: true,
        ws: false
      },
      '/uploads': {
        target: 'http://localhost:3001',
        changeOrigin: true
      }
    }
  }
})

```

```javascriptreact
import React, { useState, useRef, useEffect } from 'react';
import { FaUpload, FaTrash, FaImage, FaStar, FaRegStar, FaPlus } from 'react-icons/fa';
import './MultiImageUpload.css';

export default function MultiImageUpload({ 
  value = [], // –ú–∞—Å—Å–∏–≤ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
  onChange, 
  maxImages = 5,
  placeholder = "–î–æ–±–∞–≤–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞" 
}) {
  const [images, setImages] = useState(value || []);
  const fileInputRef = useRef(null);
  const [isUploading, setIsUploading] = useState(false);

  // –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ–º –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å –≤–Ω–µ—à–Ω–∏–º value
  useEffect(() => {
    setImages(value || []);
  }, [value]);

  const uploadToServer = async (file) => {
    const form = new FormData();
    form.append('image', file);
    const res = await fetch('/api/upload/image', { method: 'POST', body: form });
    if (!res.ok) throw new Error('upload failed');
    const data = await res.json();
    return data.url; // '/uploads/xxx.ext'
  };

  const handleFileSelect = async (event) => {
    const files = Array.from(event.target.files);
    setIsUploading(true);
    for (const file of files) {
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–∏–ø —Ñ–∞–π–ª–∞
      if (!file.type.startsWith('image/')) {
        alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Ç–æ–ª—å–∫–æ —Ñ–∞–π–ª—ã –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π');
        continue;
      }

      // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ (–º–∞–∫—Å–∏–º—É–º 5–ú–ë)
      if (file.size > 5 * 1024 * 1024) {
        alert('–†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ –Ω–µ –¥–æ–ª–∂–µ–Ω –ø—Ä–µ–≤—ã—à–∞—Ç—å 5–ú–ë');
        continue;
      }
      try {
        // –ü—ã—Ç–∞–µ–º—Å—è –∑–∞–≥—Ä—É–∑–∏—Ç—å –Ω–∞ —Å–µ—Ä–≤–µ—Ä, –µ—Å–ª–∏ –Ω–µ —É–¥–∞—Å—Ç—Å—è ‚Äî fallback –≤ base64
        let imageData;
        try {
          const url = await uploadToServer(file);
          imageData = url; // —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å URL
        } catch (e) {
          const reader = new FileReader();
          imageData = await new Promise((resolve) => {
            reader.onload = (ev) => resolve(ev.target.result);
            reader.readAsDataURL(file);
          });
        }

        const newImage = {
          id: Date.now() + Math.random(),
          data: imageData,
          isMain: images.length === 0
        };
        const updatedImages = [...images, newImage];
        setImages(updatedImages);
        onChange(updatedImages);
      } catch (e) {
        console.error('Upload failed', e);
        alert('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ');
      }
    }
    setIsUploading(false);
    
    // –û—á–∏—â–∞–µ–º input –¥–ª—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–µ—Ö –∂–µ —Ñ–∞–π–ª–æ–≤ —Å–Ω–æ–≤–∞
    event.target.value = '';
  };

  const handleRemove = (imageId) => {
    const imageToRemove = images.find(img => img.id === imageId);
    const updatedImages = images.filter(img => img.id !== imageId);
    
    // –ï—Å–ª–∏ —É–¥–∞–ª—è–µ–º –æ—Å–Ω–æ–≤–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏ –µ—Å—Ç—å –¥—Ä—É–≥–∏–µ, –¥–µ–ª–∞–µ–º –ø–µ—Ä–≤–æ–µ –æ—Å–Ω–æ–≤–Ω—ã–º
    if (imageToRemove.isMain && updatedImages.length > 0) {
      updatedImages[0].isMain = true;
    }
    
    setImages(updatedImages);
    onChange(updatedImages);
  };

  const handleSetMain = (imageId) => {
    const updatedImages = images.map(img => ({
      ...img,
      isMain: img.id === imageId
    }));
    setImages(updatedImages);
    onChange(updatedImages);
  };

  const handleUploadClick = () => {
    if (images.length >= maxImages) {
      alert(`–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π: ${maxImages}`);
      return;
    }
    fileInputRef.current?.click();
  };

  return (
    <div className="multi-image-upload">
      <input
        type="file"
        ref={fileInputRef}
        onChange={handleFileSelect}
        accept="image/*"
        multiple
        style={{ display: 'none' }}
      />
      
      <div className="images-grid">
        {isUploading && (
          <div className="upload-slot uploading">
            –ó–∞–≥—Ä—É–∑–∫–∞...
          </div>
        )}
        {images.map((image, index) => (
          <div key={image.id} className={`image-item ${image.isMain ? 'main-image' : ''}`}>
            <img src={image.data} alt={`–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ ${index + 1}`} className="preview-image" />
            
            <div className="image-overlay">
              <button 
                type="button" 
                onClick={() => handleSetMain(image.id)}
                className={`btn-main ${image.isMain ? 'active' : ''}`}
                title={image.isMain ? '–û—Å–Ω–æ–≤–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ' : '–°–¥–µ–ª–∞—Ç—å –æ—Å–Ω–æ–≤–Ω—ã–º'}
              >
                {image.isMain ? <FaStar /> : <FaRegStar />}
              </button>
              <button 
                type="button" 
                onClick={() => handleRemove(image.id)}
                className="btn-remove"
                title="–£–¥–∞–ª–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ"
              >
                <FaTrash />
              </button>
            </div>
            
            {image.isMain && (
              <div className="main-badge">–û—Å–Ω–æ–≤–Ω–æ–µ</div>
            )}
          </div>
        ))}
        
        {images.length < maxImages && (
          <div className="upload-slot" onClick={handleUploadClick}>
            <FaPlus className="upload-icon" />
            <span className="upload-text">
              {images.length === 0 ? placeholder : '–î–æ–±–∞–≤–∏—Ç—å –µ—â–µ'}
            </span>
          </div>
        )}
      </div>
      
      {images.length > 0 && (
        <div className="upload-info">
          <p>
            <strong>{images.length}/{maxImages}</strong> –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –∑–∞–≥—Ä—É–∂–µ–Ω–æ
            {images.find(img => img.isMain) && (
              <span className="main-info">
                ‚Ä¢ <FaStar className="star-icon" /> –û—Å–Ω–æ–≤–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤—ã–±—Ä–∞–Ω–æ
              </span>
            )}
          </p>
          <small>–û—Å–Ω–æ–≤–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤ –∫–∞—Ç–∞–ª–æ–≥–µ. –û—Å—Ç–∞–ª—å–Ω—ã–µ ‚Äî –≤ –≥–∞–ª–µ—Ä–µ–µ —Ç–æ–≤–∞—Ä–∞.</small>
        </div>
      )}
    </div>
  );
}

```

- –°–æ—Å—Ç–∞–≤–∏–ª –ø–ª–∞–Ω –∏ –Ω–∞—á–∞–ª –≤—ã–ø–æ–ª–Ω—è—Ç—å:
  - –ü—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ `/uploads` –¥–æ–±–∞–≤–ª–µ–Ω–æ –≤ `vite.config.js` (–¥–ª—è –ø—Ä–µ–≤—å—é –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π).
  - `MultiImageUpload.jsx` —Ç–µ–ø–µ—Ä—å –∑–∞–≥—Ä—É–∂–∞–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä —á–µ—Ä–µ–∑ `/api/upload/image`, —Å fallback –Ω–∞ Base64; –¥–æ–±–∞–≤–ª–µ–Ω –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏.

–î–∞–ª–µ–µ –ø–æ –ø–ª–∞–Ω—É:
- –û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–µ–≤—å—é –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –≤ `ProductManagement.jsx` —Ç–∞–∫, —á—Ç–æ–±—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å URL –∏–∑ `/uploads/...` –∏ Base64.
- –ü—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ —Ç–æ–≤–∞—Ä–∞ —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –≤ –ë–î –ø–∏—à—É—Ç—Å—è –∏–º–µ–Ω–Ω–æ URL, –µ—Å–ª–∏ –∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ—à–ª–∞ —á–µ—Ä–µ–∑ API.

---

**User**

–ü—Ä–æ–¥–æ–ª–∂–∞–π

---

**Cursor**

```javascript
// –£—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏ —Ç–æ–≤–∞—Ä–æ–≤

// –ú–∏–≥—Ä–∞—Ü–∏—è —Å—Ç–∞—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö: icon -> images
export const migrateProductImages = (product) => {
  // –ï—Å–ª–∏ —É —Ç–æ–≤–∞—Ä–∞ —É–∂–µ –µ—Å—Ç—å images, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–∞–∫ –µ—Å—Ç—å
  if (product.images && Array.isArray(product.images)) {
    return product;
  }
  
  // –ï—Å–ª–∏ –µ—Å—Ç—å —Ç–æ–ª—å–∫–æ icon, —Å–æ–∑–¥–∞–µ–º –º–∞—Å—Å–∏–≤ images
  if (product.icon) {
    return {
      ...product,
      images: [
        {
          id: 1,
          data: product.icon,
          isMain: true
        }
      ]
    };
  }
  
  // –ï—Å–ª–∏ –Ω–µ—Ç –Ω–∏ images, –Ω–∏ icon, —Å–æ–∑–¥–∞–µ–º –ø—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤
  return {
    ...product,
    images: []
  };
};

// –ü–æ–ª—É—á–∏—Ç—å –æ—Å–Ω–æ–≤–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞
export const getMainImage = (product) => {
  const migratedProduct = migrateProductImages(product);
  const mainImage = migratedProduct.images.find(img => img.isMain);
  return mainImage || null;
};

// –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞
export const getAllImages = (product) => {
  const migratedProduct = migrateProductImages(product);
  return migratedProduct.images || [];
};

// –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ Base64
export const isBase64Image = (data) => {
  return typeof data === 'string' && data.startsWith('data:image');
};

// –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —Å—Ç—Ä–æ–∫–∞ URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (–ª–æ–∫–∞–ª—å–Ω—ã–µ /uploads –∏–ª–∏ http)
export const isImageUrl = (data) => {
  return (
    typeof data === 'string' && (
      data.startsWith('/uploads/') ||
      data.startsWith('http://') ||
      data.startsWith('https://')
    )
  );
};

// –ü–æ–ª—É—á–∏—Ç—å –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ (–≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–±—ä–µ–∫—Ç —Å —Ç–∏–ø–æ–º –∏ –¥–∞–Ω–Ω—ã–º–∏)
export const getDisplayImageInfo = (imageData) => {
  if (isBase64Image(imageData) || isImageUrl(imageData)) {
    return {
      type: 'image',
      data: imageData
    };
  }
  return {
    type: 'icon',
    data: imageData || 'üì¶'
  };
};

```

```javascriptreact
import React, { useState } from 'react';
import { useAdminData } from '../../context/AdminDataContext';
import { FaPlus, FaEdit, FaTrash, FaSave, FaTimes } from 'react-icons/fa';
import MultiImageUpload from '../../components/MultiImageUpload';
import { migrateProductImages, getMainImage } from '../../utils/imageHelpers';
import './ProductManagement.css';

export default function ProductManagement() {
  const { products, categories, brands, addProduct, updateProduct, deleteProduct } = useAdminData();
  const [editingProduct, setEditingProduct] = useState(null);
  const [isCreating, setIsCreating] = useState(false);
  const [formData, setFormData] = useState({
    title: '',
    price: '',
    category: '',
    subcategory: '',
    brand: '',
    available: true,
    quantity: 0,
    images: [],
    description: ''
  });

  const categoryList = Object.keys(categories);

  const handleInputChange = (e) => {
    const { name, value, type, checked } = e.target;
    setFormData(prev => ({
      ...prev,
      [name]: type === 'checkbox' ? checked : value
    }));
  };

  const handleCategoryChange = (e) => {
    const selectedCategory = e.target.value;
    setFormData(prev => ({
      ...prev,
      category: selectedCategory,
      subcategory: '' // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—é –ø—Ä–∏ —Å–º–µ–Ω–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
    }));
  };

  const startCreating = () => {
    setIsCreating(true);
    setEditingProduct(null);
    setFormData({
      title: '',
      price: '',
      category: '',
      subcategory: '',
      brand: '',
      available: true,
      quantity: 0,
      images: [],
      description: ''
    });
  };

  const startEditing = (product) => {
    setEditingProduct(product.id);
    setIsCreating(false);
    const migratedProduct = migrateProductImages(product);
    setFormData({ ...migratedProduct });
  };

  const cancelEditing = () => {
    setEditingProduct(null);
    setIsCreating(false);
    setFormData({
      title: '',
      price: '',
      category: '',
      subcategory: '',
      brand: '',
      available: true,
      quantity: 0,
      images: [],
      description: ''
    });
  };

  const saveProduct = () => {
    console.log('Saving product:', { formData, isCreating, editingProduct });
    
    if (!formData.title || !formData.category) {
      alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è: –Ω–∞–∑–≤–∞–Ω–∏–µ –∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—è!');
      return;
    }

    const price = parseFloat(formData.price);
    if (isNaN(price) || price < 0) {
      alert('–£–∫–∞–∂–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Ü–µ–Ω—É —Ç–æ–≤–∞—Ä–∞!');
      return;
    }

    try {
      const productData = {
        ...formData,
        price: parseFloat(formData.price),
        quantity: parseInt(formData.quantity) || 0
      };

      if (isCreating) {
        console.log('Creating new product:', productData);
        addProduct(productData);
        alert('–¢–æ–≤–∞—Ä —Å–æ–∑–¥–∞–Ω!');
      } else {
        console.log('Updating existing product:', editingProduct, productData);
        updateProduct(editingProduct, productData);
        alert('–¢–æ–≤–∞—Ä –æ–±–Ω–æ–≤–ª–µ–Ω!');
      }
      
      cancelEditing();
    } catch (error) {
      console.error('Error saving product:', error);
      alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ —Ç–æ–≤–∞—Ä–∞!');
    }
  };

  const handleDelete = (id) => {
    if (window.confirm('–£–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä?')) {
      deleteProduct(id);
      alert('–¢–æ–≤–∞—Ä —É–¥–∞–ª–µ–Ω!');
    }
  };

  const availableSubcategories = formData.category ? categories[formData.category] || [] : [];

  return (
    <div className="product-management">
      <div className="management-header">
        <h2>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞–º–∏</h2>
        <button onClick={startCreating} className="btn-primary">
          <FaPlus /> –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä
        </button>
      </div>

      {(isCreating || editingProduct) && (
        <div className="product-form">
          <h3>{isCreating ? '–°–æ–∑–¥–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞' : '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞'}</h3>
          <div className="form-grid">
            <div className="form-group">
              <label>–ù–∞–∑–≤–∞–Ω–∏–µ *</label>
              <input
                type="text"
                name="title"
                value={formData.title}
                onChange={handleInputChange}
                placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞"
              />
            </div>

            <div className="form-group">
              <label>–¶–µ–Ω–∞ *</label>
              <input
                type="number"
                name="price"
                value={formData.price}
                onChange={handleInputChange}
                min="0"
              />
            </div>

            <div className="form-group">
              <label>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤ –Ω–∞–ª–∏—á–∏–∏</label>
              <input
                type="number"
                name="quantity"
                value={formData.quantity}
                onChange={handleInputChange}
                min="0"
                placeholder="0"
              />
            </div>

            <div className="form-group">
              <label>–ö–∞—Ç–µ–≥–æ—Ä–∏—è *</label>
              <select
                name="category"
                value={formData.category}
                onChange={handleCategoryChange}
              >
                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</option>
                {categoryList.map(cat => (
                  <option key={cat} value={cat}>{cat}</option>
                ))}
              </select>
            </div>

            <div className="form-group">
              <label>–ü–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è</label>
              <select
                name="subcategory"
                value={formData.subcategory}
                onChange={handleInputChange}
                disabled={!formData.category}
              >
                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—é</option>
                {availableSubcategories.map(subcat => (
                  <option key={subcat} value={subcat}>{subcat}</option>
                ))}
              </select>
            </div>

            <div className="form-group">
              <label>–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å</label>
              <select
                name="brand"
                value={formData.brand}
                onChange={handleInputChange}
              >
                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—è</option>
                {brands.map(brand => (
                  <option key={brand} value={brand}>{brand}</option>
                ))}
              </select>
            </div>

            <div className="form-group form-group-full">
              <label>–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞</label>
              <MultiImageUpload
                value={formData.images}
                onChange={(images) => setFormData(prev => ({ ...prev, images }))}
                maxImages={5}
                placeholder="–î–æ–±–∞–≤–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞"
              />
            </div>

            <div className="form-group form-group-full">
              <label>–û–ø–∏—Å–∞–Ω–∏–µ</label>
              <textarea
                name="description"
                value={formData.description}
                onChange={handleInputChange}
                placeholder="–û–ø–∏—Å–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞"
                rows="3"
              />
            </div>

            <div className="form-group form-group-full">
              <label>
                <input
                  type="checkbox"
                  name="available"
                  checked={formData.available}
                  onChange={handleInputChange}
                />
                –í –Ω–∞–ª–∏—á–∏–∏
              </label>
            </div>
          </div>

          <div className="form-actions">
            <button onClick={saveProduct} className="btn-success">
              <FaSave /> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
            </button>
            <button onClick={cancelEditing} className="btn-secondary">
              <FaTimes /> –û—Ç–º–µ–Ω–∞
            </button>
          </div>
        </div>
      )}

      <div className="products-table">
        <table>
          <thead>
            <tr>
              <th>ID</th>
              <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
              <th>–¶–µ–Ω–∞</th>
              <th>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</th>
              <th>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>
              <th>–ü–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è</th>
              <th>–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å</th>
              <th>–ù–∞–ª–∏—á–∏–µ</th>
              <th>–î–µ–π—Å—Ç–≤–∏—è</th>
            </tr>
          </thead>
          <tbody>
            {products.map(product => (
              <tr key={product.id}>
                <td>{product.id}</td>
                <td>
                  <div className="product-title">
                    {(() => {
                      const migratedProduct = migrateProductImages(product);
                      const mainImage = getMainImage(migratedProduct);
                      
                      if (mainImage?.data) {
                        if (typeof mainImage.data === 'string' && (mainImage.data.startsWith('data:image') || mainImage.data.startsWith('/uploads/') || mainImage.data.startsWith('http'))){
                          return <img src={mainImage.data} alt={product.title} className="product-image" />;
                        }
                        return <span className="product-icon">{mainImage.data}</span>;
                      }
                      return <span className="product-icon">üì¶</span>;
                    })()}
                    {product.title}
                  </div>
                </td>
                <td>{product.price.toLocaleString()} ‚ÇΩ</td>
                <td>
                  <span className={`quantity-badge ${(product.quantity || 0) === 0 ? 'out-of-stock' : (product.quantity || 0) < 5 ? 'low-stock' : 'in-stock'}`}>
                    {product.quantity || 0} —à—Ç.
                  </span>
                </td>
                <td>{product.category}</td>
                <td>{product.subcategory || '-'}</td>
                <td>{product.brand}</td>
                <td>
                  <span className={product.available ? 'status-available' : 'status-unavailable'}>
                    {product.available ? '–í –Ω–∞–ª–∏—á–∏–∏' : '–ù–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏'}
                  </span>
                </td>
                <td>
                  <div className="action-buttons">
                    <button 
                      onClick={() => startEditing(product)}
                      className="btn-edit"
                      title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å"
                    >
                      <FaEdit />
                    </button>
                    <button 
                      onClick={() => handleDelete(product.id)}
                      className="btn-delete"
                      title="–£–¥–∞–ª–∏—Ç—å"
                    >
                      <FaTrash />
                    </button>
                  </div>
                </td>
              </tr>
            ))}
          </tbody>
        </table>
      </div>
    </div>
  );
}

```

- –î–æ–±–∞–≤–∏–ª –ø—Ä–æ–∫—Å–∏ `/uploads` –≤ `vite.config.js`, —á—Ç–æ–±—ã –ø—Ä–µ–≤—å—é —Å–µ—Ä–≤–µ—Ä–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –æ—Ç–æ–±—Ä–∞–∂–∞–ª–∏—Å—å –Ω–∞ dev.
- –û–±–Ω–æ–≤–∏–ª `MultiImageUpload.jsx`: —Ñ–∞–π–ª—ã —Ç–µ–ø–µ—Ä—å –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –Ω–∞ –±—ç–∫–µ–Ω–¥ (`POST /api/upload/image`) —Å fallback –Ω–∞ Base64; –ø–æ–∫–∞–∑–∞–Ω –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä ‚Äú–ó–∞–≥—Ä—É–∑–∫–∞...‚Äù.
- –ò—Å–ø—Ä–∞–≤–∏–ª –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞ –≤ `ProductManagement.jsx`: –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ä–µ–Ω–¥–µ—Ä–∏—Ç –∫–∞–∫ URL (`/uploads/...`, http/https), —Ç–∞–∫ –∏ Base64/—ç–º–æ–¥–∑–∏.

–î–∞–ª—å—à–µ –ø–æ –ø–ª–∞–Ω—É:
- –ü—Ä–æ–≤–µ—Ä—é –≤ –∞–¥–º–∏–Ω–∫–µ –∑–∞–≥—Ä—É–∑–∫—É –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –∏ —Å–æ–∑–¥–∞–Ω–∏–µ/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ —Å —Å–µ—Ä–≤–µ—Ä–Ω—ã–º–∏ URL.
- –ï—Å–ª–∏ –Ω—É–∂–Ω–æ ‚Äî –¥–æ–±–∞–≤–ª—é –º–∏–≥—Ä–∞—Ü–∏—é –¥–ª—è –∑–∞–º–µ–Ω—ã —Å—Ç–∞—Ä—ã—Ö Base64 –Ω–∞ URL –ø—Ä–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏.

---

**User**

–ü—Ä–æ–¥–æ–ª–∂–∞–π

---

**Cursor**

```javascript
/* eslint-disable */
const express = require('express');
const cors = require('cors');
const path = require('path');
const { db, run, get, all } = require('./db');
const fs = require('fs');
const multer = require('multer');

const app = express();
const PORT = process.env.PORT || 3001;

app.use(cors());
app.use(express.json({ limit: '25mb' }));
// –°—Ç–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–∞–∑–¥–∞—á–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
const uploadsDir = path.join(__dirname, 'uploads');
const backupsDir = path.join(__dirname, 'backups');
if (!fs.existsSync(uploadsDir)) {
  fs.mkdirSync(uploadsDir, { recursive: true });
}
if (!fs.existsSync(backupsDir)) {
  fs.mkdirSync(backupsDir, { recursive: true });
}
app.use('/uploads', express.static(uploadsDir));

// –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
const storage = multer.diskStorage({
  destination: (req, file, cb) => cb(null, uploadsDir),
  filename: (req, file, cb) => {
    const ext = path.extname(file.originalname) || '.png';
    const name = `${Date.now()}-${Math.round(Math.random() * 1e9)}${ext}`;
    cb(null, name);
  }
});
const upload = multer({ storage });

// Healthcheck
app.get('/api/health', (req, res) => {
  res.json({ ok: true });
});

// Backup DB (download)
app.get('/api/_debug/backup', (req, res) => {
  try {
    const dbPath = require('./db').DB_FILE;
    const stamp = new Date().toISOString().replace(/[:.]/g, '-');
    const dst = path.join(backupsDir, `db-${stamp}.sqlite3`);
    fs.copyFileSync(dbPath, dst);
    res.json({ ok: true, file: `/api/_debug/download?f=${encodeURIComponent(path.basename(dst))}` });
  } catch (e) {
    res.status(500).json({ error: String(e) });
  }
});

app.get('/api/_debug/download', (req, res) => {
  const file = req.query.f;
  if (!file) return res.status(400).send('Missing f');
  const full = path.join(backupsDir, file);
  if (!fs.existsSync(full)) return res.status(404).send('Not found');
  res.download(full);
});

// Upload image
app.post('/api/upload/image', upload.single('image'), (req, res) => {
  if (!req.file) return res.status(400).json({ error: 'No file' });
  const url = `/uploads/${req.file.filename}`;
  res.status(201).json({ url });
});

// Brands
app.get('/api/brands', async (req, res) => {
  try {
    const rows = await all(db, `SELECT id, name FROM brands ORDER BY name ASC`);
    res.json(rows.map(r => r.name));
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to fetch brands' });
  }
});
app.post('/api/brands', async (req, res) => {
  try {
    const { name } = req.body;
    await ensureBrandByName(name);
    res.status(201).json({ ok: true });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to create brand' });
  }
});
app.delete('/api/brands/:name', async (req, res) => {
  try {
    const { name } = req.params;
    await run(db, `DELETE FROM brands WHERE name=?`, [name]);
    res.json({ ok: true });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to delete brand' });
  }
});

// Categories and subcategories as structure
app.get('/api/categories', async (req, res) => {
  try {
    const cats = await all(db, `SELECT id, name FROM categories ORDER BY name ASC`);
    const sub = await all(db, `SELECT id, category_id, name FROM subcategories ORDER BY name ASC`);
    const idToName = new Map(cats.map(c => [c.id, c.name]));
    const result = {};
    for (const c of cats) {
      result[c.name] = [];
    }
    for (const s of sub) {
      const catName = idToName.get(s.category_id);
      if (!catName) continue;
      result[catName].push(s.name);
    }
    res.json(result);
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to fetch categories' });
  }
});
// Categories CRUD by name
app.post('/api/categories', async (req, res) => {
  try {
    const { name, subcategories = [] } = req.body;
    const catId = await ensureCategoryByName(name);
    for (const s of subcategories) {
      await ensureSubcategoryByName(catId, s);
    }
    res.status(201).json({ ok: true });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to create category' });
  }
});
app.put('/api/categories/:name', async (req, res) => {
  try {
    const oldName = req.params.name;
    const { newName } = req.body;
    await run(db, `UPDATE categories SET name=? WHERE name=?`, [newName, oldName]);
    res.json({ ok: true });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to rename category' });
  }
});
app.delete('/api/categories/:name', async (req, res) => {
  try {
    const name = req.params.name;
    await run(db, `DELETE FROM categories WHERE name=?`, [name]);
    res.json({ ok: true });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to delete category' });
  }
});
app.put('/api/categories/:name/subcategories', async (req, res) => {
  try {
    const name = req.params.name;
    const { subcategories = [] } = req.body;
    const cat = await get(db, `SELECT id FROM categories WHERE name=?`, [name]);
    if (!cat) return res.status(404).json({ error: 'Category not found' });
    await run(db, `DELETE FROM subcategories WHERE category_id=?`, [cat.id]);
    for (const s of subcategories) {
      await ensureSubcategoryByName(cat.id, s);
    }
    res.json({ ok: true });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to set subcategories' });
  }
});

// Products
app.get('/api/products', async (req, res) => {
  try {
    const rows = await all(
      db,
      `SELECT p.*, 
              c.name AS category_name, 
              s.name AS subcategory_name, 
              b.name AS brand_name
       FROM products p
       LEFT JOIN categories c ON p.category_id = c.id
       LEFT JOIN subcategories s ON p.subcategory_id = s.id
       LEFT JOIN brands b ON p.brand_id = b.id
       ORDER BY p.created_at DESC`
    );

    // –î–æ–±–∞–≤–ª—è–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
    const productIds = rows.map(r => r.id);
    let images = [];
    if (productIds.length > 0) {
      images = await all(
        db,
        `SELECT * FROM product_images WHERE product_id IN (${productIds.map(() => '?').join(',')})`,
        productIds
      );
    }
    const productIdToImages = new Map();
    for (const img of images) {
      if (!productIdToImages.has(img.product_id)) productIdToImages.set(img.product_id, []);
      productIdToImages.get(img.product_id).push({ id: img.id, data: img.image_data, isMain: !!img.is_main });
    }

    const result = rows.map(r => ({
      id: r.id,
      title: r.title,
      price: r.price,
      category: r.category_name,
      subcategory: r.subcategory_name,
      brand: r.brand_name,
      available: !!r.available,
      quantity: r.quantity,
      description: r.description,
      specifications: r.specifications_json ? JSON.parse(r.specifications_json) : undefined,
      features: r.features_json ? JSON.parse(r.features_json) : undefined,
      images: productIdToImages.get(r.id) || [],
      createdAt: r.created_at,
      updatedAt: r.updated_at
    }));

    res.json(result);
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to fetch products' });
  }
});

// Helpers to ensure catalog entities
async function ensureCategoryByName(name) {
  if (!name) return null;
  const row = await get(db, `SELECT id FROM categories WHERE name = ?`, [name]);
  if (row) return row.id;
  const r = await run(db, `INSERT INTO categories (name) VALUES (?)`, [name]);
  return r.lastID;
}

async function ensureSubcategoryByName(categoryId, name) {
  if (!name || !categoryId) return null;
  const row = await get(db, `SELECT id FROM subcategories WHERE category_id = ? AND name = ?`, [categoryId, name]);
  if (row) return row.id;
  const r = await run(db, `INSERT INTO subcategories (category_id, name) VALUES (?, ?)`, [categoryId, name]);
  return r.lastID;
}

async function ensureBrandByName(name) {
  if (!name) return null;
  const row = await get(db, `SELECT id FROM brands WHERE name = ?`, [name]);
  if (row) return row.id;
  const r = await run(db, `INSERT INTO brands (name) VALUES (?)`, [name]);
  return r.lastID;
}

// Create product
app.post('/api/products', async (req, res) => {
  try {
    const { title, price, category, subcategory, brand, available = true, quantity = 0, description = null, specifications, features, images } = req.body;

    const categoryId = await ensureCategoryByName(category);
    const subcategoryId = await ensureSubcategoryByName(categoryId, subcategory);
    const brandId = await ensureBrandByName(brand);

    const specJson = specifications ? JSON.stringify(specifications) : null;
    const featJson = features ? JSON.stringify(features) : null;

    const r = await run(
      db,
      `INSERT INTO products (title, price, category_id, subcategory_id, brand_id, available, quantity, description, specifications_json, features_json)
       VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)`,
      [title, price, categoryId, subcategoryId, brandId, available ? 1 : 0, quantity, description, specJson, featJson]
    );

    const productId = r.lastID;
    if (Array.isArray(images)) {
      for (const img of images) {
        await run(db, `INSERT INTO product_images (product_id, image_data, is_main) VALUES (?, ?, ?)`, [productId, img.data, img.isMain ? 1 : 0]);
      }
    }

    res.status(201).json({ id: productId });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to create product' });
  }
});

// Update product
app.put('/api/products/:id', async (req, res) => {
  try {
    const id = Number(req.params.id);
    const { title, price, category, subcategory, brand, available = true, quantity = 0, description = null, specifications, features, images } = req.body;

    const categoryId = await ensureCategoryByName(category);
    const subcategoryId = await ensureSubcategoryByName(categoryId, subcategory);
    const brandId = await ensureBrandByName(brand);

    const specJson = specifications ? JSON.stringify(specifications) : null;
    const featJson = features ? JSON.stringify(features) : null;

    await run(
      db,
      `UPDATE products SET title=?, price=?, category_id=?, subcategory_id=?, brand_id=?, available=?, quantity=?, description=?, specifications_json=?, features_json=?, updated_at = datetime('now') WHERE id=?`,
      [title, price, categoryId, subcategoryId, brandId, available ? 1 : 0, quantity, description, specJson, featJson, id]
    );

    // replace images
    if (Array.isArray(images)) {
      await run(db, `DELETE FROM product_images WHERE product_id = ?`, [id]);
      for (const img of images) {
        await run(db, `INSERT INTO product_images (product_id, image_data, is_main) VALUES (?, ?, ?)`, [id, img.data, img.isMain ? 1 : 0]);
      }
    }

    res.json({ ok: true });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to update product' });
  }
});

// Delete product
app.delete('/api/products/:id', async (req, res) => {
  try {
    const id = Number(req.params.id);
    await run(db, `DELETE FROM products WHERE id=?`, [id]);
    res.json({ ok: true });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to delete product' });
  }
});

// Promotions
app.get('/api/promotions', async (req, res) => {
  try {
    const rows = await all(
      db,
      `SELECT p.*, c.name AS category_name FROM promotions p
       LEFT JOIN categories c ON p.category_id = c.id
       ORDER BY p.featured DESC, p.id DESC`
    );
    const result = rows.map(r => ({
      id: r.id,
      title: r.title,
      description: r.description,
      discount: r.discount,
      category: r.category_name,
      validUntil: r.valid_until,
      active: !!r.active,
      featured: !!r.featured,
      minPurchase: r.min_purchase
    }));
    res.json(result);
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to fetch promotions' });
  }
});

// Promotions CRUD (–º–∏–Ω–∏–º—É–º)
app.post('/api/promotions', async (req, res) => {
  try {
    const { title, description, discount, category, validUntil, active = true, featured = false, minPurchase } = req.body;
    const catId = category ? (await get(db, `SELECT id FROM categories WHERE name = ?`, [category]))?.id : null;
    const r = await run(
      db,
      `INSERT INTO promotions (title, description, discount, category_id, valid_until, active, featured, min_purchase)
       VALUES (?, ?, ?, ?, ?, ?, ?, ?)`,
      [title, description ?? null, discount, catId ?? null, validUntil ?? null, active ? 1 : 0, featured ? 1 : 0, minPurchase ?? null]
    );
    res.status(201).json({ id: r.lastID });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to create promotion' });
  }
});

app.put('/api/promotions/:id', async (req, res) => {
  try {
    const id = Number(req.params.id);
    const { title, description, discount, category, validUntil, active, featured, minPurchase } = req.body;
    const catId = category ? (await get(db, `SELECT id FROM categories WHERE name = ?`, [category]))?.id : null;
    await run(
      db,
      `UPDATE promotions SET title=?, description=?, discount=?, category_id=?, valid_until=?, active=?, featured=?, min_purchase=? WHERE id=?`,
      [title, description ?? null, discount, catId ?? null, validUntil ?? null, active ? 1 : 0, featured ? 1 : 0, minPurchase ?? null, id]
    );
    res.json({ ok: true });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to update promotion' });
  }
});

app.delete('/api/promotions/:id', async (req, res) => {
  try {
    const id = Number(req.params.id);
    await run(db, `DELETE FROM promotions WHERE id=?`, [id]);
    res.json({ ok: true });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to delete promotion' });
  }
});

// Orders
app.get('/api/orders', async (req, res) => {
  try {
    const orders = await all(db, `SELECT * FROM orders ORDER BY created_at DESC`);
    const orderIds = orders.map(o => o.id);
    let items = [];
    if (orderIds.length) {
      items = await all(db, `SELECT * FROM order_items WHERE order_id IN (${orderIds.map(() => '?').join(',')})`, orderIds);
    }
    const orderIdToItems = new Map();
    for (const it of items) {
      if (!orderIdToItems.has(it.order_id)) orderIdToItems.set(it.order_id, []);
      orderIdToItems.get(it.order_id).push({
        id: it.id,
        productId: it.product_id,
        title: it.title,
        price: it.price,
        quantity: it.quantity
      });
    }

    // notes
    let notes = [];
    if (orderIds.length) {
      notes = await all(db, `SELECT * FROM order_notes WHERE order_id IN (${orderIds.map(() => '?').join(',')}) ORDER BY timestamp ASC`, orderIds);
    }
    const orderIdToNotes = new Map();
    for (const n of notes) {
      if (!orderIdToNotes.has(n.order_id)) orderIdToNotes.set(n.order_id, []);
      orderIdToNotes.get(n.order_id).push({
        id: n.id,
        text: n.text,
        type: n.type,
        timestamp: n.timestamp
      });
    }

    const result = [];
    for (const o of orders) {
      const customer = o.customer_id ? await get(db, `SELECT * FROM customers WHERE id = ?`, [o.customer_id]) : null;
      result.push({
        id: o.id,
        orderNumber: o.order_number,
        status: o.status,
        pricing: JSON.parse(o.pricing_json),
        items: orderIdToItems.get(o.id) || [],
        customerInfo: customer || { name: '', phone: '', email: null, address: null },
        notes: orderIdToNotes.get(o.id) || [],
        createdAt: o.created_at,
        updatedAt: o.updated_at
      });
    }
    res.json(result);
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to fetch orders' });
  }
});

app.post('/api/orders', async (req, res) => {
  try {
    const { orderForm, cartItems, priceCalculation, orderNumber } = req.body;

    // customer
    let customerId = null;
    if (orderForm) {
      const r = await run(
        db,
        `INSERT INTO customers (name, phone, email, address) VALUES (?, ?, ?, ?)`,
        [orderForm.name, orderForm.phone, orderForm.email ?? null, orderForm.address ?? null]
      );
      customerId = r.lastID;
    }

    const id = String(orderNumber);
    await run(
      db,
      `INSERT INTO orders (id, order_number, customer_id, status, pricing_json) VALUES (?, ?, ?, 'new', ?)` ,
      [id, String(orderNumber), customerId, JSON.stringify(priceCalculation)]
    );

    if (Array.isArray(cartItems)) {
      for (const it of cartItems) {
        await run(
          db,
          `INSERT INTO order_items (order_id, product_id, title, price, quantity) VALUES (?, ?, ?, ?, ?)`,
          [id, it.id ?? null, it.title, it.price, it.quantity]
        );
      }
    }

    res.status(201).json({ ok: true, id, orderNumber });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to create order' });
  }
});

// Orders: update status
app.patch('/api/orders/:id/status', async (req, res) => {
  try {
    const { id } = req.params;
    const { status } = req.body;
    await run(db, `UPDATE orders SET status=?, updated_at = datetime('now') WHERE id=?`, [status, id]);
    res.json({ ok: true });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to update status' });
  }
});

// Orders: add note
app.post('/api/orders/:id/notes', async (req, res) => {
  try {
    const { id } = req.params;
    const { text, type = 'note' } = req.body;
    const r = await run(db, `INSERT INTO order_notes (order_id, text, type) VALUES (?, ?, ?)`, [id, text, type]);
    res.status(201).json({ id: r.lastID });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to add note' });
  }
});

app.listen(PORT, () => {
  console.log(`API server listening on http://localhost:${PORT}`);
});


// Debug: list registered routes
app.get('/api/_debug/routes', (req, res) => {
  try {
    const routes = [];
    app._router.stack.forEach((m) => {
      if (m.route && m.route.path) {
        routes.push({ path: m.route.path, methods: m.route.methods });
      }
      if (m.name === 'router' && m.handle && m.handle.stack) {
        m.handle.stack.forEach((h) => {
          if (h.route && h.route.path) {
            routes.push({ path: h.route.path, methods: h.route.methods });
          }
        });
      }
    });
    res.json(routes);
  } catch (e) {
    res.status(500).json({ error: String(e) });
  }
});


```

- –î–æ–±–∞–≤–∏–ª –ø–æ–¥–¥–µ—Ä–∂–∫—É –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –≤ –∞–¥–º–∏–Ω–∫–µ: —Ñ–∞–π–ª—ã —É—Ö–æ–¥—è—Ç –Ω–∞ `/api/upload/image`, –ø—Ä–µ–≤—å—é —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ `/uploads/...` (–ø—Ä–æ–∫—Å–∏ —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω).
- –ò—Å–ø—Ä–∞–≤–∏–ª –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —Ç–æ–≤–∞—Ä–æ–≤ –≤ —Ç–∞–±–ª–∏—Ü–µ (URL, Base64 –∏ —ç–º–æ–¥–∑–∏).
- –î–æ–±–∞–≤–∏–ª –±—ã—Å—Ç—Ä—ã–π –±—ç–∫–∞–ø –ë–î: `GET /api/_debug/backup` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Å—ã–ª–∫—É –Ω–∞ —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ —Å–≤–µ–∂–µ–≥–æ `.sqlite3`.

–î–∞–ª—å—à–µ —Å–¥–µ–ª–∞—é:
- –ü—Ä–æ–≤–µ—Ä—é —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ —Ç–æ–≤–∞—Ä–∞ –∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ —á—Ç–µ–Ω–∏–µ –∏–∑ –ë–î.
- –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –¥–æ–±–∞–≤–ª—é –∞–≤—Ç–æ–æ—á–∏—Å—Ç–∫—É —Å—Ç–∞—Ä—ã—Ö Base64 –ø—Ä–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –≤ –ø–æ–ª—å–∑—É URL.

---

**User**

–î–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –Ω–∞ —Å–∞–π—Ç–µ –∫–∞–∫ —Å—Å—ã–ª–∫–∞

---

**Cursor**

```javascriptreact
import React, { useState } from 'react';
import { Link } from 'react-router-dom';
import { FaCheckCircle, FaTimesCircle, FaShoppingCart } from 'react-icons/fa';
import { useCartActions } from './hooks/useCartActions';
import { useAdminData } from './context/AdminDataContext';
// wishlist removed
import { migrateProductImages, getMainImage, isImageUrl } from './utils/imageHelpers';
import './Catalog.css';

export default function Catalog() {
  const { products, categories, brands } = useAdminData();
  const [selectedCategory, setSelectedCategory] = useState('–í—Å–µ');
  const [selectedSubcategory, setSelectedSubcategory] = useState('–í—Å–µ');
  const [selectedBrand, setSelectedBrand] = useState('–í—Å–µ');
  const [priceRange, setPriceRange] = useState([0, 200000]);
  const [inStock, setInStock] = useState(false);
  const { addToCartWithNotification } = useCartActions();

  // –°–æ–∑–¥–∞–µ–º —Å–ø–∏—Å–æ–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –∏ –±—Ä–µ–Ω–¥–æ–≤
  const categoryList = ['–í—Å–µ', ...Object.keys(categories)];
  const brandList = ['–í—Å–µ', ...brands];

  const minPrice = 0;
  const maxPrice = 200000;

  // –ü–æ–ª—É—á–∞–µ–º –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
  const availableSubcategories = selectedCategory === '–í—Å–µ' 
    ? [] 
    : ['–í—Å–µ', ...(categories[selectedCategory] || [])];

  // –°–±—Ä–æ—Å –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø—Ä–∏ —Å–º–µ–Ω–µ –æ—Å–Ω–æ–≤–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
  const handleCategoryChange = (category) => {
    setSelectedCategory(category);
    setSelectedSubcategory('–í—Å–µ');
  };

  const filteredProducts = products.filter((product) => {
    const byCategory = selectedCategory === '–í—Å–µ' || product.category === selectedCategory;
    const bySubcategory = selectedSubcategory === '–í—Å–µ' || product.subcategory === selectedSubcategory;
    const byBrand = selectedBrand === '–í—Å–µ' || product.brand === selectedBrand;
    const byPrice = product.price >= priceRange[0] && product.price <= priceRange[1];
    const byStock = !inStock || product.available;
    return byCategory && bySubcategory && byBrand && byPrice && byStock;
  });

  const handleAddToCart = (product, e) => {
    e.preventDefault();
    e.stopPropagation();
    addToCartWithNotification(product, 1);
  };

  // wishlist removed

  return (
    <div className="catalog-wrapper">
      <aside className="catalog-filters">
        <h3>–§–∏–ª—å—Ç—Ä—ã</h3>
        <div className="filter-group">
          <label>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
          <select value={selectedCategory} onChange={e => handleCategoryChange(e.target.value)}>
            {categoryList.map(cat => (
              <option key={cat} value={cat}>{cat}</option>
            ))}
          </select>
        </div>
        {availableSubcategories.length > 0 && (
          <div className="filter-group">
            <label>–ü–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è</label>
            <select value={selectedSubcategory} onChange={e => setSelectedSubcategory(e.target.value)}>
              {availableSubcategories.map(subcat => (
                <option key={subcat} value={subcat}>{subcat}</option>
              ))}
            </select>
          </div>
        )}
        <div className="filter-group">
          <label>–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å</label>
          <select value={selectedBrand} onChange={e => setSelectedBrand(e.target.value)}>
            {brandList.map(brand => (
              <option key={brand} value={brand}>{brand}</option>
            ))}
          </select>
        </div>
        <div className="filter-group">
          <label>–¶–µ–Ω–∞, ‚ÇΩ</label>
          <div className="price-range">
            <input
              type="number"
              min={minPrice}
              max={priceRange[1]}
              value={priceRange[0]}
              onChange={e => setPriceRange([+e.target.value, priceRange[1]])}
            />
            <span>-</span>
            <input
              type="number"
              min={priceRange[0]}
              max={maxPrice}
              value={priceRange[1]}
              onChange={e => setPriceRange([priceRange[0], +e.target.value])}
            />
          </div>
        </div>
        <div className="filter-group">
          <label>
            <input
              type="checkbox"
              checked={inStock}
              onChange={e => setInStock(e.target.checked)}
            />
            –¢–æ–ª—å–∫–æ –≤ –Ω–∞–ª–∏—á–∏–∏
          </label>
        </div>
      </aside>
      <main className="catalog-main">
        <h2>–ö–∞—Ç–∞–ª–æ–≥ —Ç–æ–≤–∞—Ä–æ–≤</h2>
        <div className="catalog-grid">
          {filteredProducts.length === 0 && <div className="no-products">–ù–µ—Ç —Ç–æ–≤–∞—Ä–æ–≤ –ø–æ –≤—ã–±—Ä–∞–Ω–Ω—ã–º —Ñ–∏–ª—å—Ç—Ä–∞–º</div>}
          {filteredProducts.map(product => (
            <Link to={`/product/${product.id}`} className="catalog-card" key={product.id}>
              <div className="catalog-card-image">
                {(() => {
                  const migratedProduct = migrateProductImages(product);
                  const mainImage = getMainImage(migratedProduct);
                  
                  if (mainImage?.data) {
                    if (
                      typeof mainImage.data === 'string' &&
                      (mainImage.data.startsWith('data:image') || isImageUrl(mainImage.data))
                    ) {
                      return <img src={mainImage.data} alt={product.title} className="catalog-product-image" />;
                    }
                    return <span className="catalog-card-icon">{mainImage.data}</span>;
                  }
                  return <span className="catalog-card-icon">üì¶</span>;
                })()}
                {/* wishlist button removed */}
              </div>
              <div className="catalog-card-info">
                <h3>{product.title}</h3>
                <div className="catalog-card-price">{product.price.toLocaleString()} ‚ÇΩ</div>
                <div className="catalog-card-category">
                  <span className="category">{product.category}</span>
                  {product.subcategory && <span className="subcategory"> ‚Üí {product.subcategory}</span>}
                </div>
                <div className="catalog-card-meta">
                  <span className="catalog-card-brand">{product.brand}</span>
                  <span className={product.available ? 'in-stock' : 'out-of-stock'}>
                    {product.available ? <FaCheckCircle /> : <FaTimesCircle />} {product.available ? '–í –Ω–∞–ª–∏—á–∏–∏' : '–ù–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏'}
                  </span>
                </div>
                <button 
                  className="catalog-card-btn"
                  onClick={(e) => handleAddToCart(product, e)}
                  disabled={!product.available}
                >
                  <FaShoppingCart /> –í –∫–æ—Ä–∑–∏–Ω—É
                </button>
              </div>
            </Link>
          ))}
        </div>
      </main>
    </div>
  );
}

```

```javascriptreact
import React from 'react';
import { Link } from 'react-router-dom';
import { 
  FaTruck, 
  FaTools, 
  FaShieldAlt, 
  FaArrowRight
} from 'react-icons/fa';
import { useAdminData } from '../context/AdminDataContext';
// wishlist removed
import { getMainImage, isImageUrl } from '../utils/imageHelpers';

function Home() {
  const { products, popularProductIds } = useAdminData();
  
  // wishlist removed
  
  const features = [
    {
      icon: <FaTruck />,
      title: "–ë—ã—Å—Ç—Ä–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞",
      text: "–î–æ—Å—Ç–∞–≤–ª—è–µ–º –∑–∞–ø—á–∞—Å—Ç–∏ –ø–æ –≤—Å–µ–π –†–æ—Å—Å–∏–∏ –≤ –∫—Ä–∞—Ç—á–∞–π—à–∏–µ —Å—Ä–æ–∫–∏"
    },
    {
      icon: <FaTools />,
      title: "–ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –¥–µ—Ç–∞–ª–∏",
      text: "–¢–æ–ª—å–∫–æ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ –∏ —Å–µ—Ä—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—á–∞—Å—Ç–∏"
    },
    {
      icon: <FaShieldAlt />,
      title: "–ì–∞—Ä–∞–Ω—Ç–∏—è –∫–∞—á–µ—Å—Ç–≤–∞",
      text: "–ü–æ–ª–Ω–∞—è –≥–∞—Ä–∞–Ω—Ç–∏—è –Ω–∞ –≤—Å–µ —Ç–æ–≤–∞—Ä—ã –∏ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞"
    }
  ];

  // –ü–æ–ª—É—á–∞–µ–º –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –ø–æ ID
  const popularProducts = popularProductIds
    .map(id => products.find(product => product.id === id))
    .filter(product => product) // –£–±–∏—Ä–∞–µ–º undefined –µ—Å–ª–∏ —Ç–æ–≤–∞—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω
    .map(product => ({
      id: product.id,
      title: product.title,
      price: `${product.price.toLocaleString()} ‚ÇΩ`,
      icon: getMainImage(product)?.data || 'üì¶'
    }));

  // –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –º–∞—Å—Å–∏–≤ –¥–ª—è —Å–ø—Ä–∞–≤–∫–∏:
  const _originalPopularProducts = [
    {
      id: 11,
      title: "–ì—É—Å–µ–Ω–∏—Ü—ã –¥–ª—è –≤–µ–∑–¥–µ—Ö–æ–¥–∞",
      price: "45,000 ‚ÇΩ",
      icon: "üîó"
    },
    {
      id: 1,
      title: "–î–≤–∏–≥–∞—Ç–µ–ª—å 2.0L –¥–∏–∑–µ–ª—å–Ω—ã–π",
      price: "180,000 ‚ÇΩ",
      icon: "‚öôÔ∏è"
    },
    {
      id: 8,
      title: "–ö–æ—Ä–æ–±–∫–∞ –ø–µ—Ä–µ–¥–∞—á –º–µ—Ö–∞–Ω–∏—á–µ—Å–∫–∞—è",
      price: "95,000 ‚ÇΩ",
      icon: "üîß"
    },
    {
      id: 12,
      title: "–ê–º–æ—Ä—Ç–∏–∑–∞—Ç–æ—Ä –ø–µ—Ä–µ–¥–Ω–∏–π",
      price: "12,000 ‚ÇΩ",
      icon: "üõ†Ô∏è"
    },
    {
      id: 15,
      title: "–ê–∫–∫—É–º—É–ª—è—Ç–æ—Ä 12V 100Ah",
      price: "15,000 ‚ÇΩ",
      icon: "üîã"
    },
    {
      id: 17,
      title: "–°–∏–¥–µ–Ω—å–µ –≤–æ–¥–∏—Ç–µ–ª—è",
      price: "25,000 ‚ÇΩ",
      icon: "ü™ë"
    }
  ];

  return (
    <div>
      <section className="hero">
        <div className="container">
          <div className="hero-content">
            <div className="hero-text">
              <h1>–ó–∞–ø—á–∞—Å—Ç–∏ –¥–ª—è –≤–µ–∑–¥–µ—Ö–æ–¥–æ–≤</h1>
              <p>
                –ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∑–∞–ø—á–∞—Å—Ç–∏ –¥–ª—è –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ –≤–µ–∑–¥–µ—Ö–æ–¥–æ–≤. 
                –ë—ã—Å—Ç—Ä–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞ –ø–æ –≤—Å–µ–π –†–æ—Å—Å–∏–∏. –ì–∞—Ä–∞–Ω—Ç–∏—è –∫–∞—á–µ—Å—Ç–≤–∞ –Ω–∞ –≤—Å–µ —Ç–æ–≤–∞—Ä—ã.
              </p>
              <Link to="/catalog" className="cta-button">
                –ü–µ—Ä–µ–π—Ç–∏ –≤ –∫–∞—Ç–∞–ª–æ–≥
                <FaArrowRight />
              </Link>
            </div>
            <div className="hero-image">
              <div className="hero-placeholder">
                üöó
              </div>
              <p>–ù–∞–¥—ë–∂–Ω—ã–µ –∑–∞–ø—á–∞—Å—Ç–∏ –¥–ª—è –≤–∞—à–µ–≥–æ –≤–µ–∑–¥–µ—Ö–æ–¥–∞</p>
            </div>
          </div>
        </div>
      </section>

      <section className="features">
        <div className="container">
          <h2 className="section-title">–ü–æ—á–µ–º—É –≤—ã–±–∏—Ä–∞—é—Ç –Ω–∞—Å</h2>
          <div className="features-grid">
            {features.map((feature, index) => (
              <div key={index} className="feature-card">
                <div className="feature-icon">{feature.icon}</div>
                <h3 className="feature-title">{feature.title}</h3>
                <p className="feature-text">{feature.text}</p>
              </div>
            ))}
          </div>
        </div>
      </section>

      <section className="products">
        <div className="container">
          <h2 className="section-title">–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã</h2>
          <div className="products-grid">
            {popularProducts.map((product) => (
              <Link to={`/product/${product.id}`} key={product.id} className="product-card">
                <div className="product-image">
                  {(() => {
                    const productData = products.find(p => p.id === product.id);
                    if (!productData) return <span className="product-icon">{product.icon}</span>;
                    
                    const mainImage = getMainImage(productData);
                    if (mainImage?.data) {
                      if (typeof mainImage.data === 'string' && (mainImage.data.startsWith('data:image') || isImageUrl(mainImage.data))) {
                        return <img src={mainImage.data} alt={product.title} className="product-image-img" />;
                      }
                      return <span className="product-icon">{mainImage.data}</span>;
                    }
                    return <span className="product-icon">{product.icon}</span>;
                  })()}
                  {/* wishlist button removed */}
                </div>
                <div className="product-info">
                  <h3 className="product-title">{product.title}</h3>
                  <div className="product-price">{product.price}</div>
                  <button className="product-button">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</button>
                </div>
              </Link>
            ))}
          </div>
        </div>
      </section>
    </div>
  );
}

export default Home;

```

```javascriptreact
import React, { useState, useEffect, useMemo } from 'react';
import { Link } from 'react-router-dom';
import { motion, AnimatePresence } from 'framer-motion';
import { FaSearch, FaTimes, FaShoppingCart } from 'react-icons/fa';
import { useAdminData } from '../context/AdminDataContext';
import { getMainImage } from '../utils/imageHelpers';
import { useCartActions } from '../hooks/useCartActions';
import './SearchModal.css';

export default function SearchModal({ isOpen, onClose }) {
  const [searchTerm, setSearchTerm] = useState('');
  const [selectedCategory, setSelectedCategory] = useState('all');
  const { products, categories } = useAdminData();
  const { addToCartWithNotification } = useCartActions();

  // –û—á–∏—â–∞–µ–º –ø–æ–∏—Å–∫ –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
  useEffect(() => {
    if (!isOpen) {
      setSearchTerm('');
      setSelectedCategory('all');
    }
  }, [isOpen]);

  // –§–æ–∫—É—Å –Ω–∞ –ø–æ–ª–µ –ø–æ–∏—Å–∫–∞ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏
  useEffect(() => {
    if (isOpen) {
      const searchInput = document.getElementById('search-input');
      if (searchInput) {
        setTimeout(() => searchInput.focus(), 100);
      }
    }
  }, [isOpen]);

  // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∞–≤–∏—à–∏ Escape
  useEffect(() => {
    const handleEscape = (e) => {
      if (e.key === 'Escape' && isOpen) {
        onClose();
      }
    };

    if (isOpen) {
      document.addEventListener('keydown', handleEscape);
      return () => document.removeEventListener('keydown', handleEscape);
    }
  }, [isOpen, onClose]);

  // –õ–æ–≥–∏–∫–∞ –ø–æ–∏—Å–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤
  const searchResults = useMemo(() => {
    if (!searchTerm.trim()) return [];

    const query = searchTerm.toLowerCase().trim();
    
    return products.filter(product => {
      // –§–∏–ª—å—Ç—Ä –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
      if (selectedCategory !== 'all' && product.category !== selectedCategory) {
        return false;
      }

      // –ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é
      if (product.title.toLowerCase().includes(query)) return true;
      
      // –ü–æ–∏—Å–∫ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
      if (product.category?.toLowerCase().includes(query)) return true;
      
      // –ü–æ–∏—Å–∫ –ø–æ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏
      if (product.subcategory?.toLowerCase().includes(query)) return true;
      
      // –ü–æ–∏—Å–∫ –ø–æ –±—Ä–µ–Ω–¥—É
      if (product.brand?.toLowerCase().includes(query)) return true;
      
      // –ü–æ–∏—Å–∫ –ø–æ –æ–ø–∏—Å–∞–Ω–∏—é
      if (product.description?.toLowerCase().includes(query)) return true;

      return false;
    }).slice(0, 10); // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –¥–æ 10 —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
  }, [searchTerm, selectedCategory, products]);

  const handleBackdropClick = (e) => {
    if (e.target === e.currentTarget) {
      onClose();
    }
  };

  const handleAddToCart = (product) => {
    addToCartWithNotification(product, 1);
  };

  const categoryList = Object.keys(categories);

  return (
    <AnimatePresence>
      {isOpen && (
        <motion.div
          className="search-modal-overlay"
          initial={{ opacity: 0 }}
          animate={{ opacity: 1 }}
          exit={{ opacity: 0 }}
          onClick={handleBackdropClick}
        >
          <motion.div
            className="search-modal"
            initial={{ y: -100, opacity: 0, scale: 0.9 }}
            animate={{ y: 0, opacity: 1, scale: 1 }}
            exit={{ y: -100, opacity: 0, scale: 0.9 }}
            transition={{ type: "spring", damping: 20, stiffness: 300 }}
            onClick={(e) => e.stopPropagation()}
          >
            <div className="search-header">
              <h2>
                <FaSearch /> –ü–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–æ–≤
              </h2>
              <button onClick={onClose} className="close-btn">
                <FaTimes />
              </button>
            </div>

            <div className="search-form">
              <div className="search-input-container">
                <FaSearch className="search-icon" />
                <input
                  id="search-input"
                  type="text"
                  placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞, –∫–∞—Ç–µ–≥–æ—Ä–∏—é –∏–ª–∏ –±—Ä–µ–Ω–¥..."
                  value={searchTerm}
                  onChange={(e) => setSearchTerm(e.target.value)}
                  className="search-input"
                />
              </div>

              <div className="category-filter">
                <label>–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</label>
                <select
                  value={selectedCategory}
                  onChange={(e) => setSelectedCategory(e.target.value)}
                  className="category-select"
                >
                  <option value="all">–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>
                  {categoryList.map(category => (
                    <option key={category} value={category}>
                      {category}
                    </option>
                  ))}
                </select>
              </div>
            </div>

            <div className="search-results">
              {searchTerm.trim() === '' ? (
                <div className="search-placeholder">
                  <FaSearch className="placeholder-icon" />
                  <p>–ù–∞—á–Ω–∏—Ç–µ –≤–≤–æ–¥–∏—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ –¥–ª—è –ø–æ–∏—Å–∫–∞</p>
                  <small>–ü–æ–∏—Å–∫ –æ—Å—É—â–µ—Å—Ç–≤–ª—è–µ—Ç—Å—è –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é, –∫–∞—Ç–µ–≥–æ—Ä–∏–∏, –±—Ä–µ–Ω–¥—É –∏ –æ–ø–∏—Å–∞–Ω–∏—é</small>
                </div>
              ) : searchResults.length === 0 ? (
                <div className="no-results">
                  <h3>–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</h3>
                  <p>–ü–æ –∑–∞–ø—Ä–æ—Å—É "{searchTerm}" –Ω–µ –Ω–∞–π–¥–µ–Ω–æ —Ç–æ–≤–∞—Ä–æ–≤</p>
                  <small>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –∑–∞–ø—Ä–æ—Å –∏–ª–∏ –≤—ã–±—Ä–∞—Ç—å –¥—Ä—É–≥—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é</small>
                </div>
              ) : (
                <div className="results-container">
                  <div className="results-header">
                    <span>–ù–∞–π–¥–µ–Ω–æ —Ç–æ–≤–∞—Ä–æ–≤: {searchResults.length}</span>
                  </div>
                  
                  <div className="results-list">
                    {searchResults.map((product) => {
                      const mainImage = getMainImage(product);
                      
                      return (
                        <motion.div
                          key={product.id}
                          className="result-item"
                          initial={{ opacity: 0, x: -20 }}
                          animate={{ opacity: 1, x: 0 }}
                          transition={{ duration: 0.3 }}
                        >
                          <div className="result-image">
                      {mainImage?.data && (typeof mainImage.data === 'string' && (mainImage.data.startsWith('data:image') || mainImage.data.startsWith('/uploads/') || mainImage.data.startsWith('http')))
                        ? <img src={mainImage.data} alt={product.title} />
                        : <span className="result-icon">{mainImage?.data || 'üì¶'}</span>
                      }
                          </div>

                          <div className="result-info">
                            <h4>{product.title}</h4>
                            <div className="result-meta">
                              <span className="result-category">{product.category}</span>
                              {product.subcategory && (
                                <span className="result-subcategory"> ‚Ä¢ {product.subcategory}</span>
                              )}
                              {product.brand && (
                                <span className="result-brand"> ‚Ä¢ {product.brand}</span>
                              )}
                            </div>
                            <div className="result-price">{product.price?.toLocaleString()} ‚ÇΩ</div>
                            <div className="result-availability">
                              {product.quantity > 0 ? (
                                <span className="in-stock">–í –Ω–∞–ª–∏—á–∏–∏: {product.quantity} —à—Ç</span>
                              ) : (
                                <span className="out-of-stock">–ù–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏</span>
                              )}
                            </div>
                          </div>

                          <div className="result-actions">
                            <Link 
                              to={`/product/${product.id}`} 
                              onClick={onClose}
                              className="view-btn"
                            >
                              –ü–æ–¥—Ä–æ–±–Ω–µ–µ
                            </Link>
                            {product.quantity > 0 && (
                              <button
                                onClick={() => handleAddToCart(product)}
                                className="add-to-cart-btn"
                              >
                                <FaShoppingCart /> –í –∫–æ—Ä–∑–∏–Ω—É
                              </button>
                            )}
                          </div>
                        </motion.div>
                      );
                    })}
                  </div>
                </div>
              )}
            </div>
          </motion.div>
        </motion.div>
      )}
    </AnimatePresence>
  );
}

```

–ò—Å–ø—Ä–∞–≤–∏–ª –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ: —Ç–µ–ø–µ—Ä—å —Å—Å—ã–ª–∫–∏ –∏–∑ `/uploads/...` —Ä–µ–Ω–¥–µ—Ä—è—Ç—Å—è –∫–∞–∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ –∫–∞—Ç–∞–ª–æ–≥–µ, –Ω–∞ –≥–ª–∞–≤–Ω–æ–π –∏ –≤ –ø–æ–∏—Å–∫–µ.

–ß—Ç–æ —Å–¥–µ–ª–∞–ª:
- –î–æ–ø–æ–ª–Ω–∏–ª `imageHelpers` —Ñ—É–Ω–∫—Ü–∏–µ–π `isImageUrl` (—Ä–∞—Å–ø–æ–∑–Ω–∞—ë—Ç `/uploads/`, http/https).
- –û–±–Ω–æ–≤–∏–ª —Ä–µ–Ω–¥–µ—Ä –≤:
  - `src/Catalog.jsx`
  - `src/pages/Home.jsx`
  - `src/pages/admin/ProductManagement.jsx` (—É–∂–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç URL)
  - `src/components/SearchModal.jsx`
- –ü—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ `/uploads` –≤ `vite.config.js` ‚Äî —É–∂–µ –µ—Å—Ç—å.

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–∞—Ä—Ç–æ—á–∫–∏ –≤ –∫–∞—Ç–∞–ª–æ–≥–µ –∏ –Ω–∞ –≥–ª–∞–≤–Ω–æ–π ‚Äî –≤–º–µ—Å—Ç–æ —Ç–µ–∫—Å—Ç–∞ —Å—Å—ã–ª–∫–∏ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ.

---

**User**

–í –∫–∞—Ä—Ç–æ—á–∫–∏ —Ç–æ–≤–∞—Ä–∞ (–ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –Ω–∞ —Ç–æ–≤–∞—Ä) —Ñ–æ—Ç–∫–∏ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è —Å—Å—ã–ª–∫–∞–º–∏, —Ç–∞–∫ –∂–µ –æ–ø–∏—Å–∞–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –±–µ–ª—ã–º —Ç–µ–∫—Å—Ç–æ–º, –∞ –Ω–µ —á–µ—Ä–Ω—ã–º 

---

**Cursor**

–û–±–Ω–æ–≤–ª—è—é –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ —Ç–æ–≤–∞—Ä–∞: –¥–æ–±–∞–≤–ª—è—é –ø–æ–¥–¥–µ—Ä–∂–∫—É URL (`/uploads/...`) –¥–ª—è –≥–ª–∞–≤–Ω–æ–≥–æ —Ñ–æ—Ç–æ –∏ –º–∏–Ω–∏–∞—Ç—é—Ä, –∏ –º–µ–Ω—è—é —Ü–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞ –æ–ø–∏—Å–∞–Ω–∏—è –Ω–∞ –±–µ–ª—ã–π. –ó–∞—Ç–µ–º —Å–æ–æ–±—â—É –æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ.

```javascriptreact
import React, { useState } from 'react';
import { useParams, useNavigate } from 'react-router-dom';
import { FaArrowLeft, FaShoppingCart, FaCheckCircle, FaTimesCircle, FaChevronLeft, FaChevronRight } from 'react-icons/fa';
import { motion } from 'framer-motion';
import { useCartActions } from '../hooks/useCartActions';
import { useAdminData } from '../context/AdminDataContext';
import { migrateProductImages, getAllImages, isImageUrl } from '../utils/imageHelpers';
import './ProductPage.css';

// –î–∞–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä–æ–≤ (–≤ —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è —Å —Å–µ—Ä–≤–µ—Ä–∞)
const productsData = {
  1: {
    id: 1,
    title: '–ì—É—Å–µ–Ω–∏—Ü—ã –¥–ª—è –≤–µ–∑–¥–µ—Ö–æ–¥–∞',
    price: 45000,
    originalPrice: 50000,
    category: '–•–æ–¥–æ–≤–∞—è',
    brand: '–í–µ–∑–¥–µ—Ö–æ–¥-–ú–∞—Å—Ç–µ—Ä',
    available: true,
    inStock: 12,
    icon: 'üîó',
    images: ['/api/placeholder/600/400', '/api/placeholder/600/400', '/api/placeholder/600/400'],
    description: '–í—ã—Å–æ–∫–æ–∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –≥—É—Å–µ–Ω–∏—Ü—ã –¥–ª—è –≤–µ–∑–¥–µ—Ö–æ–¥–æ–≤ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –º–∞—Ä–æ–∫. –ò–∑–≥–æ—Ç–æ–≤–ª–µ–Ω—ã –∏–∑ –ø—Ä–æ—á–Ω–æ–π —Ä–µ–∑–∏–Ω—ã —Å –º–µ—Ç–∞–ª–ª–∏—á–µ—Å–∫–∏–º–∏ –≤—Å—Ç–∞–≤–∫–∞–º–∏. –û–±–µ—Å–ø–µ—á–∏–≤–∞—é—Ç –æ—Ç–ª–∏—á–Ω–æ–µ —Å—Ü–µ–ø–ª–µ–Ω–∏–µ –Ω–∞ –ª—é–±–æ–π –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–∏.',
    specifications: {
      '–®–∏—Ä–∏–Ω–∞': '400 –º–º',
      '–î–ª–∏–Ω–∞': '2500 –º–º',
      '–ú–∞—Ç–µ—Ä–∏–∞–ª': '–†–µ–∑–∏–Ω–∞ —Å –º–µ—Ç–∞–ª–ª–æ–∫–æ—Ä–¥–æ–º',
      '–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å': '–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è',
      '–ì–∞—Ä–∞–Ω—Ç–∏—è': '12 –º–µ—Å—è—Ü–µ–≤'
    },
    features: [
      '–í—ã—Å–æ–∫–∞—è –∏–∑–Ω–æ—Å–æ—Å—Ç–æ–π–∫–æ—Å—Ç—å',
      '–û—Ç–ª–∏—á–Ω–æ–µ —Å—Ü–µ–ø–ª–µ–Ω–∏–µ –Ω–∞ —Å–Ω–µ–≥—É –∏ –≥—Ä—è–∑–∏',
      '–ü—Ä–æ—Å—Ç–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞',
      '–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ–º –≤–µ–∑–¥–µ—Ö–æ–¥–æ–≤'
    ]
  },
  2: {
    id: 2,
    title: '–î–≤–∏–≥–∞—Ç–µ–ª—å 2.0L',
    price: 180000,
    category: '–î–≤–∏–≥–∞—Ç–µ–ª—å',
    brand: '–¢–µ—Ö–Ω–æ–ú–æ—Ç–æ—Ä',
    available: true,
    inStock: 3,
    icon: '‚öôÔ∏è',
    images: ['/api/placeholder/600/400', '/api/placeholder/600/400'],
    description: '–ú–æ—â–Ω—ã–π –∏ –Ω–∞–¥–µ–∂–Ω—ã–π –¥–≤–∏–≥–∞—Ç–µ–ª—å –æ–±—ä–µ–º–æ–º 2.0 –ª–∏—Ç—Ä–∞ –¥–ª—è –≤–µ–∑–¥–µ—Ö–æ–¥–æ–≤. –û—Ç–ª–∏—á–∞–µ—Ç—Å—è –≤—ã—Å–æ–∫–æ–π —Ç–æ–ø–ª–∏–≤–Ω–æ–π —ç–∫–æ–Ω–æ–º–∏—á–Ω–æ—Å—Ç—å—é –∏ –¥–æ–ª–≥–æ–≤–µ—á–Ω–æ—Å—Ç—å—é.',
    specifications: {
      '–û–±—ä–µ–º': '2.0 –ª',
      '–ú–æ—â–Ω–æ—Å—Ç—å': '150 –ª.—Å.',
      '–¢–∏–ø —Ç–æ–ø–ª–∏–≤–∞': '–ë–µ–Ω–∑–∏–Ω',
      '–û—Ö–ª–∞–∂–¥–µ–Ω–∏–µ': '–ñ–∏–¥–∫–æ—Å—Ç–Ω–æ–µ',
      '–ì–∞—Ä–∞–Ω—Ç–∏—è': '24 –º–µ—Å—è—Ü–∞'
    },
    features: [
      '–í—ã—Å–æ–∫–∞—è –º–æ—â–Ω–æ—Å—Ç—å –∏ –∫—Ä—É—Ç—è—â–∏–π –º–æ–º–µ–Ω—Ç',
      '–≠–∫–æ–Ω–æ–º–∏—á–Ω—ã–π —Ä–∞—Å—Ö–æ–¥ —Ç–æ–ø–ª–∏–≤–∞',
      '–ü—Ä–æ—Å—Ç–æ–µ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ',
      '–ù–∞–¥–µ–∂–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –æ—Ö–ª–∞–∂–¥–µ–Ω–∏—è'
    ]
  },
  3: {
    id: 3,
    title: '–¢—Ä–∞–Ω—Å–º–∏—Å—Å–∏—è',
    price: 95000,
    category: '–¢—Ä–∞–Ω—Å–º–∏—Å—Å–∏—è',
    brand: '–í–µ–∑–¥–µ—Ö–æ–¥-–ú–∞—Å—Ç–µ—Ä',
    available: false,
    inStock: 0,
    icon: 'üîß',
    images: ['/api/placeholder/600/400'],
    description: '–ù–∞–¥–µ–∂–Ω–∞—è —Ç—Ä–∞–Ω—Å–º–∏—Å—Å–∏—è –¥–ª—è –≤–µ–∑–¥–µ—Ö–æ–¥–æ–≤ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –º–∞—Ä–æ–∫. –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –ø–ª–∞–≤–Ω–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –ø–µ—Ä–µ–¥–∞—á –∏ –¥–æ–ª–≥–∏–π —Å—Ä–æ–∫ —Å–ª—É–∂–±—ã.',
    specifications: {
      '–¢–∏–ø': '–ú–µ—Ö–∞–Ω–∏—á–µ—Å–∫–∞—è',
      '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–µ—Ä–µ–¥–∞—á': '6',
      '–ú–∞—Ç–µ—Ä–∏–∞–ª': '–°—Ç–∞–ª—å –≤—ã—Å–æ–∫–æ–π –ø—Ä–æ—á–Ω–æ—Å—Ç–∏',
      '–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å': '–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è',
      '–ì–∞—Ä–∞–Ω—Ç–∏—è': '18 –º–µ—Å—è—Ü–µ–≤'
    },
    features: [
      '–ü–ª–∞–≤–Ω–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –ø–µ—Ä–µ–¥–∞—á',
      '–í—ã—Å–æ–∫–∞—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å',
      '–ü—Ä–æ—Å—Ç–æ–µ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ',
      '–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ–º –¥–≤–∏–≥–∞—Ç–µ–ª–µ–π'
    ]
  },
  4: {
    id: 4,
    title: '–ü–æ–¥–≤–µ—Å–∫–∞',
    price: 65000,
    category: '–•–æ–¥–æ–≤–∞—è',
    brand: '–°—É–ø–µ—Ä–¢—Ä–µ–∫',
    available: true,
    inStock: 8,
    icon: 'üõ†Ô∏è',
    images: ['/api/placeholder/600/400', '/api/placeholder/600/400'],
    description: '–£—Å–∏–ª–µ–Ω–Ω–∞—è –ø–æ–¥–≤–µ—Å–∫–∞ –¥–ª—è —ç–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω—ã—Ö —É—Å–ª–æ–≤–∏–π —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏–∏. –ü–æ–≤—ã—à–∞–µ—Ç –ø—Ä–æ—Ö–æ–¥–∏–º–æ—Å—Ç—å –∏ –∫–æ–º—Ñ–æ—Ä—Ç –µ–∑–¥—ã.',
    specifications: {
      '–¢–∏–ø': '–ù–µ–∑–∞–≤–∏—Å–∏–º–∞—è',
      '–ê–º–æ—Ä—Ç–∏–∑–∞—Ç–æ—Ä—ã': '–ì–∞–∑–æ-–º–∞—Å–ª—è–Ω—ã–µ',
      '–ú–∞—Ç–µ—Ä–∏–∞–ª': '–°—Ç–∞–ª—å + –∞–ª—é–º–∏–Ω–∏–π',
      '–•–æ–¥ –ø–æ–¥–≤–µ—Å–∫–∏': '250 –º–º',
      '–ì–∞—Ä–∞–Ω—Ç–∏—è': '12 –º–µ—Å—è—Ü–µ–≤'
    },
    features: [
      '–£–≤–µ–ª–∏—á–µ–Ω–Ω—ã–π —Ö–æ–¥ –ø–æ–¥–≤–µ—Å–∫–∏',
      '–£—Å–∏–ª–µ–Ω–Ω–∞—è –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏—è',
      '–û—Ç–ª–∏—á–Ω–∞—è –∞–º–æ—Ä—Ç–∏–∑–∞—Ü–∏—è',
      '–ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è —ç–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω—ã—Ö —É—Å–ª–æ–≤–∏–π'
    ]
  },
  5: {
    id: 5,
    title: '–§–∏–ª—å—Ç—Ä –≤–æ–∑–¥—É—à–Ω—ã–π',
    price: 3500,
    category: '–î–≤–∏–≥–∞—Ç–µ–ª—å',
    brand: '–¢–µ—Ö–Ω–æ–ú–æ—Ç–æ—Ä',
    available: true,
    inStock: 25,
    icon: 'üåÄ',
    images: ['/api/placeholder/600/400'],
    description: '–í—ã—Å–æ–∫–æ–∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –≤–æ–∑–¥—É—à–Ω—ã–π —Ñ–∏–ª—å—Ç—Ä –¥–ª—è –∑–∞—â–∏—Ç—ã –¥–≤–∏–≥–∞—Ç–µ–ª—è –æ—Ç –ø—ã–ª–∏ –∏ –≥—Ä—è–∑–∏.',
    specifications: {
      '–¢–∏–ø': '–ü–∞–Ω–µ–ª—å–Ω—ã–π',
      '–ú–∞—Ç–µ—Ä–∏–∞–ª': '–°–∏–Ω—Ç–µ—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ–ª–æ–∫–Ω–æ',
      '–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å': '99.5%',
      '–†–µ—Å—É—Ä—Å': '15 000 –∫–º',
      '–ì–∞—Ä–∞–Ω—Ç–∏—è': '6 –º–µ—Å—è—Ü–µ–≤'
    },
    features: [
      '–í—ã—Å–æ–∫–∞—è —Å—Ç–µ–ø–µ–Ω—å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏',
      '–î–æ–ª–≥–∏–π —Å—Ä–æ–∫ —Å–ª—É–∂–±—ã',
      '–ü—Ä–æ—Å—Ç–∞—è –∑–∞–º–µ–Ω–∞',
      '–ó–∞—â–∏—Ç–∞ –¥–≤–∏–≥–∞—Ç–µ–ª—è –æ—Ç –∏–∑–Ω–æ—Å–∞'
    ]
  },
  6: {
    id: 6,
    title: '–†–µ–º–µ–Ω—å –ø—Ä–∏–≤–æ–¥–Ω–æ–π',
    price: 2200,
    category: '–¢—Ä–∞–Ω—Å–º–∏—Å—Å–∏—è',
    brand: 'DrivePro',
    available: true,
    inStock: 15,
    icon: '‚õìÔ∏è',
    images: ['/api/placeholder/600/400'],
    description: '–ü—Ä–æ—á–Ω—ã–π –ø—Ä–∏–≤–æ–¥–Ω–æ–π —Ä–µ–º–µ–Ω—å –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ–π –ø–µ—Ä–µ–¥–∞—á–∏ –º–æ—â–Ω–æ—Å—Ç–∏ –æ—Ç –¥–≤–∏–≥–∞—Ç–µ–ª—è –∫ —Ç—Ä–∞–Ω—Å–º–∏—Å—Å–∏–∏.',
    specifications: {
      '–î–ª–∏–Ω–∞': '1200 –º–º',
      '–®–∏—Ä–∏–Ω–∞': '30 –º–º',
      '–ú–∞—Ç–µ—Ä–∏–∞–ª': '–†–µ–∑–∏–Ω–∞ —Å –∫–µ–≤–ª–∞—Ä–æ–≤—ã–º –∫–æ—Ä–¥–æ–º',
      '–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞': '150 –ù–º',
      '–ì–∞—Ä–∞–Ω—Ç–∏—è': '12 –º–µ—Å—è—Ü–µ–≤'
    },
    features: [
      '–í—ã—Å–æ–∫–∞—è –ø—Ä–æ—á–Ω–æ—Å—Ç—å –Ω–∞ —Ä–∞–∑—Ä—ã–≤',
      '–£—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å –∫ –∏–∑–Ω–æ—Å—É',
      '–†–∞–±–æ—Ç–∞ –≤ —à–∏—Ä–æ–∫–æ–º –¥–∏–∞–ø–∞–∑–æ–Ω–µ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä',
      '–ü—Ä–æ—Å—Ç–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞'
    ]
  }
};

function ProductPage() {
  const { id } = useParams();
  const navigate = useNavigate();
  const { addToCartWithNotification } = useCartActions();
  const { products } = useAdminData();
  const [selectedImageIndex, setSelectedImageIndex] = useState(0);
  const [quantity, setQuantity] = useState(1);
  // wishlist removed

  const product = products.find(p => p.id === parseInt(id));

  if (!product) {
    return (
      <div className="product-not-found">
        <h2>–¢–æ–≤–∞—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω</h2>
        <button onClick={() => navigate('/catalog')} className="back-button">
          –í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –∫–∞—Ç–∞–ª–æ–≥
        </button>
      </div>
    );
  }

  // –ú–∏–≥—Ä–∏—Ä—É–µ–º –∏ –ø–æ–ª—É—á–∞–µ–º –≤—Å–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞
  const migratedProduct = migrateProductImages(product);
  const allImages = getAllImages(migratedProduct) || [];
  
  // –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å: —É–±–µ–∂–¥–∞–µ–º—Å—è —á—Ç–æ selectedImageIndex –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –º–∞—Å—Å–∏–≤–∞
  const safeSelectedIndex = Math.max(0, Math.min(selectedImageIndex, allImages.length - 1));

  const handleAddToCart = () => {
    addToCartWithNotification(product, quantity);
  };

  const handleBuyNow = () => {
    try {
      addToCartWithNotification(product, quantity);
      setTimeout(() => {
        navigate('/cart');
      }, 100);
    } catch (error) {
      console.error('Error in handleBuyNow:', error);
      alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∫—É–ø–∫–µ —Ç–æ–≤–∞—Ä–∞');
    }
  };

  return (
    <motion.div 
      className="product-page"
      initial={{ opacity: 0 }}
      animate={{ opacity: 1 }}
      transition={{ duration: 0.5 }}
    >
      <div className="container">
        <button 
          onClick={() => navigate(-1)} 
          className="back-button"
        >
          <FaArrowLeft /> –ù–∞–∑–∞–¥
        </button>

        <div className="product-content">
          <div className="product-images">
            <div className="main-image">
              <motion.div 
                className="image-container"
                whileHover={{ scale: 1.05 }}
                transition={{ duration: 0.3 }}
              >
                {allImages && allImages.length > 0 && allImages[safeSelectedIndex] ? (
                  allImages[safeSelectedIndex].data && (
                    allImages[safeSelectedIndex].data.startsWith('data:image') ||
                    isImageUrl(allImages[safeSelectedIndex].data)
                  ) ? (
                    <img
                      src={allImages[safeSelectedIndex].data}
                      alt={product.title}
                      className="product-main-image"
                    />
                  ) : (
                    <span className="product-icon">{allImages[safeSelectedIndex]?.data || 'üì¶'}</span>
                  )
                ) : (
                  <span className="product-icon">üì¶</span>
                )}
              </motion.div>
              
              {allImages && allImages.length > 1 && (
                <div className="image-navigation">
                  <button 
                    className="nav-button prev"
                    onClick={() => setSelectedImageIndex(selectedImageIndex === 0 ? allImages.length - 1 : selectedImageIndex - 1)}
                    disabled={!allImages || allImages.length <= 1}
                  >
                    <FaChevronLeft />
                  </button>
                  <button 
                    className="nav-button next"
                    onClick={() => setSelectedImageIndex(selectedImageIndex === allImages.length - 1 ? 0 : selectedImageIndex + 1)}
                    disabled={!allImages || allImages.length <= 1}
                  >
                    <FaChevronRight />
                  </button>
                </div>
              )}
            </div>
            
            {allImages && allImages.length > 1 && (
              <div className="image-thumbnails">
                {allImages.map((image, index) => (
                  <button
                    key={index}
                    className={`thumbnail ${selectedImageIndex === index ? 'active' : ''}`}
                    onClick={() => setSelectedImageIndex(index)}
                  >
                    {image && image.data && (
                      image.data.startsWith('data:image') || isImageUrl(image.data)
                    ) ? (
                      <img src={image.data} alt={`${product.title} ${index + 1}`} />
                    ) : (
                      <span className="product-icon">{image?.data || 'üì¶'}</span>
                    )}
                  </button>
                ))}
              </div>
            )}
          </div>

          <div className="product-info">
            <div className="product-header">
              <h1>{product.title}</h1>
              {/* wishlist button removed */}
            </div>

            <div className="product-meta">
              <span className="brand">{product.brand}</span>
              <span className="category">{product.category}</span>
              <span className={`availability ${product.available ? 'in-stock' : 'out-of-stock'}`}>
                {product.available ? <FaCheckCircle /> : <FaTimesCircle />}
                {product.available ? `–í –Ω–∞–ª–∏—á–∏–∏: ${product.quantity || 0} —à—Ç` : '–ù–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏'}
              </span>
            </div>

            <div className="product-price">
              <span className="current-price">{product.price.toLocaleString()} ‚ÇΩ</span>
              {product.originalPrice && (
                <span className="original-price">{product.originalPrice.toLocaleString()} ‚ÇΩ</span>
              )}
            </div>

            <div className="product-description">
              <p>{product.description}</p>
            </div>

            {product.features && product.features.length > 0 && (
              <div className="product-features">
                <h3>–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:</h3>
                <ul>
                  {product.features.map((feature, index) => (
                    <li key={index}>{feature}</li>
                  ))}
                </ul>
              </div>
            )}

            <div className="product-actions">
              <div className="quantity-selector">
                <label>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ:</label>
                <div className="quantity-controls">
                  <button 
                    onClick={() => setQuantity(Math.max(1, quantity - 1))}
                    disabled={quantity <= 1}
                  >
                    -
                  </button>
                  <input 
                    type="text" 
                    value={quantity} 
                    onChange={(e) => {
                      const inputValue = e.target.value.replace(/[^0-9]/g, '');
                      // –†–∞–∑—Ä–µ—à–∞–µ–º –ø—É—Å—Ç–æ–µ –ø–æ–ª–µ
                      if (inputValue === '') {
                        return;
                      }
                      const value = parseInt(inputValue);
                      if (!isNaN(value) && value >= 1) {
                        setQuantity(Math.min(value, product.quantity || 999));
                      }
                    }}
                    onBlur={(e) => {
                      // –ü—Ä–∏ –ø–æ—Ç–µ—Ä–µ —Ñ–æ–∫—É—Å–∞, –µ—Å–ª–∏ –ø–æ–ª–µ –ø—É—Å—Ç–æ–µ, —Å—Ç–∞–≤–∏–º 1
                      const cleanValue = e.target.value.replace(/[^0-9]/g, '');
                      if (cleanValue === '' || parseInt(cleanValue) < 1) {
                        setQuantity(1);
                      }
                    }}
                    onFocus={(e) => e.target.select()}
                    placeholder="1"
                    className="quantity-input"
                  />
                  <button 
                    onClick={() => setQuantity(Math.min(quantity + 1, product.quantity || 999))}
                    disabled={quantity >= (product.quantity || 999)}
                  >
                    +
                  </button>
                </div>
              </div>

              <div className="action-buttons">
                <motion.button 
                  className="add-to-cart-btn"
                  onClick={handleAddToCart}
                  disabled={!product.available}
                  whileHover={{ scale: 1.02 }}
                  whileTap={{ scale: 0.98 }}
                >
                  <FaShoppingCart /> –í –∫–æ—Ä–∑–∏–Ω—É
                </motion.button>

                <motion.button 
                  className="buy-now-btn"
                  onClick={handleBuyNow}
                  disabled={!product.available}
                  whileHover={{ scale: 1.02 }}
                  whileTap={{ scale: 0.98 }}
                >
                  –ö—É–ø–∏—Ç—å —Å–µ–π—á–∞—Å
                </motion.button>
              </div>
            </div>
          </div>
        </div>

        {product.specifications && Object.keys(product.specifications).length > 0 && (
          <div className="product-specifications">
            <h3>–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏</h3>
            <div className="specs-grid">
              {Object.entries(product.specifications).map(([key, value]) => (
                <div key={key} className="spec-item">
                  <span className="spec-label">{key}:</span>
                  <span className="spec-value">{value}</span>
                </div>
              ))}
            </div>
          </div>
        )}
      </div>
    </motion.div>
  );
}

export default ProductPage;

```

```css
.product-page {
  padding: 120px 0 60px;
  min-height: 100vh;
  background: #0a0a0a;
}

.back-button {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: #ffffff;
  padding: 0.8rem 1.5rem;
  border-radius: 25px;
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 0.5rem;
  margin-bottom: 2rem;
  transition: all 0.3s ease;
  font-size: 1rem;
  font-weight: 500;
}

.back-button:hover {
  background: rgba(230, 163, 74, 0.1);
  border-color: #e6a34a;
  color: #e6a34a;
}

.product-content {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 4rem;
  margin-bottom: 4rem;
}

.product-images {
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

.main-image {
  background: linear-gradient(135deg, #1a1a1a 0%, #2a2a2a 100%);
  border-radius: 20px;
  padding: 2rem;
  border: 1px solid rgba(255, 255, 255, 0.1);
}

.image-placeholder {
  width: 100%;
  height: 400px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 6rem;
  color: #e6a34a;
  cursor: pointer;
}

.image-thumbnails {
  display: flex;
  gap: 0.5rem;
  overflow-x: auto;
}

.thumbnail {
  background: #1a1a1a;
  border: 2px solid transparent;
  border-radius: 10px;
  padding: 0.5rem;
  cursor: pointer;
  transition: all 0.3s ease;
  min-width: 80px;
  height: 80px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.5rem;
  color: #e6a34a;
}

.thumbnail:hover,
.thumbnail.active {
  border-color: #e6a34a;
}

/* –ù–æ–≤—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –≥–∞–ª–µ—Ä–µ–∏ */
.image-container {
  position: relative;
  width: 100%;
  height: 400px;
  display: flex;
  align-items: center;
  justify-content: center;
  overflow: hidden;
  border-radius: 15px;
}

.product-main-image {
  width: 100%;
  height: 100%;
  object-fit: cover;
  border-radius: 15px;
}

.image-navigation {
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  width: 100%;
  display: flex;
  justify-content: space-between;
  padding: 0 10px;
  pointer-events: none;
}

.nav-button {
  background: rgba(0, 0, 0, 0.7);
  border: none;
  color: white;
  width: 40px;
  height: 40px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: all 0.3s ease;
  pointer-events: all;
  backdrop-filter: blur(5px);
}

.nav-button:hover:not(:disabled) {
  background: rgba(230, 163, 74, 0.8);
  color: #000;
  transform: scale(1.1);
}

.nav-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.thumbnail img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  border-radius: 8px;
}

.product-info {
  color: #ffffff;
}

.product-header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  margin-bottom: 1.5rem;
}

.product-header h1 {
  font-size: 2.5rem;
  font-weight: 700;
  color: #ffffff;
  line-height: 1.2;
}

.wishlist-button {
  background: none;
  border: 2px solid rgba(255, 255, 255, 0.2);
  color: #ffffff;
  padding: 0.8rem;
  border-radius: 50%;
  cursor: pointer;
  transition: all 0.3s ease;
  font-size: 1.2rem;
}

.wishlist-button:hover,
.wishlist-button.active {
  border-color: #ff4757;
  color: #ff4757;
}

.product-meta {
  display: flex;
  flex-wrap: wrap;
  gap: 1rem;
  margin-bottom: 2rem;
  align-items: center;
}

.brand {
  background: rgba(230, 163, 74, 0.1);
  color: #e6a34a;
  padding: 0.4rem 0.8rem;
  border-radius: 15px;
  font-size: 0.9rem;
  font-weight: 500;
}

.category {
  background: rgba(255, 255, 255, 0.1);
  color: #cccccc;
  padding: 0.4rem 0.8rem;
  border-radius: 15px;
  font-size: 0.9rem;
}

.availability {
  display: flex;
  align-items: center;
  gap: 0.3rem;
  font-size: 0.9rem;
  font-weight: 500;
}

.availability.in-stock {
  color: #e6a34a;
}

.availability.out-of-stock {
  color: #ff4757;
}

.product-price {
  margin-bottom: 2rem;
}

.current-price {
  font-size: 2.5rem;
  font-weight: 700;
  color: #e6a34a;
}

.original-price {
  font-size: 1.5rem;
  color: #888888;
  text-decoration: line-through;
  margin-left: 1rem;
}

.product-description {
  margin-bottom: 2rem;
  line-height: 1.8;
  color: #ffffff;
  font-size: 1.1rem;
}

.product-features {
  margin-bottom: 3rem;
}

.product-features h3 {
  color: #e6a34a;
  margin-bottom: 1rem;
  font-size: 1.3rem;
}

.product-features ul {
  list-style: none;
  padding: 0;
}

.product-features li {
  padding: 0.5rem 0;
  position: relative;
  padding-left: 1.5rem;
  color: #cccccc;
}

.product-features li::before {
  content: "‚úì";
  position: absolute;
  left: 0;
  color: #e6a34a;
  font-weight: bold;
}

.product-actions {
  display: flex;
  flex-direction: column;
  gap: 2rem;
}

.quantity-selector {
  display: flex;
  align-items: center;
  gap: 1rem;
}

.quantity-selector label {
  font-weight: 500;
  color: #cccccc;
}

.quantity-controls {
  display: flex;
  align-items: center;
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 25px;
  overflow: hidden;
  background: #1a1a1a;
}

.quantity-controls button {
  background: none;
  border: none;
  color: #ffffff;
  padding: 0.8rem 1rem;
  cursor: pointer;
  transition: background-color 0.3s ease;
  font-size: 1.2rem;
  font-weight: bold;
}

.quantity-controls button:hover:not(:disabled) {
  background: rgba(230, 163, 74, 0.1);
  color: #e6a34a;
}

.quantity-controls button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.quantity-input {
  padding: 0.8rem 1rem;
  font-weight: 600;
  min-width: 60px;
  text-align: center;
  background: rgba(255, 255, 255, 0.05);
  border: none;
  color: #ffffff;
  font-size: 1rem;
  outline: none;
}

.quantity-input:focus {
  background: rgba(255, 255, 255, 0.1);
}

.quantity-input::-webkit-outer-spin-button,
.quantity-input::-webkit-inner-spin-button {
  -webkit-appearance: none;
  margin: 0;
}

.quantity-input[type=number] {
  -moz-appearance: textfield;
}

.action-buttons {
  display: flex;
  gap: 1rem;
}

.add-to-cart-btn,
.buy-now-btn {
  flex: 1;
  padding: 1rem 2rem;
  border: none;
  border-radius: 25px;
  font-size: 1.1rem;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0.5rem;
}

.add-to-cart-btn {
  background: rgba(230, 163, 74, 0.1);
  color: #e6a34a;
  border: 2px solid #e6a34a;
}

.add-to-cart-btn:hover:not(:disabled) {
  background: #e6a34a;
  color: #000000;
}

.buy-now-btn {
  background: linear-gradient(135deg, #e6a34a 0%, #c97c1a 100%);
  color: #000000;
}

.buy-now-btn:hover:not(:disabled) {
  transform: translateY(-2px);
  box-shadow: 0 15px 40px rgba(230, 163, 74, 0.4);
}

.add-to-cart-btn:disabled,
.buy-now-btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.product-specifications {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 20px;
  padding: 2rem;
}

.product-specifications h3 {
  color: #e6a34a;
  margin-bottom: 2rem;
  font-size: 1.5rem;
  font-weight: 600;
}

.specs-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 1.5rem;
}

.spec-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 1rem;
  background: rgba(255, 255, 255, 0.05);
  border-radius: 10px;
  border: 1px solid rgba(255, 255, 255, 0.1);
}

.spec-label {
  font-weight: 500;
  color: #cccccc;
}

.spec-value {
  font-weight: 600;
  color: #ffffff;
}

.product-not-found {
  text-align: center;
  padding: 120px 0;
  color: #ffffff;
}

.product-not-found h2 {
  font-size: 2rem;
  margin-bottom: 2rem;
  color: #ff4757;
}

/* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
@media (max-width: 1024px) {
  .product-content {
    gap: 2rem;
  }
  
  .product-header h1 {
    font-size: 2rem;
  }
  
  .current-price {
    font-size: 2rem;
  }
}

@media (max-width: 768px) {
  .product-content {
    grid-template-columns: 1fr;
    gap: 2rem;
  }
  
  .product-header {
    flex-direction: column;
    align-items: flex-start;
    gap: 1rem;
  }
  
  .action-buttons {
    flex-direction: column;
  }
  
  .specs-grid {
    grid-template-columns: 1fr;
  }
  
  .spec-item {
    flex-direction: column;
    align-items: flex-start;
    gap: 0.5rem;
  }
}

```

–°–¥–µ–ª–∞–ª, –∫–∞–∫ –ø—Ä–æ—Å–∏–ª–∏:
- –ù–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ —Ç–æ–≤–∞—Ä–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–∑ `/uploads/...` —Ç–µ–ø–µ—Ä—å –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –∫–∞–∫ –∫–∞—Ä—Ç–∏–Ω–∫–∏ (–∏ –≤ –≥–ª–∞–≤–Ω–æ–º –±–ª–æ–∫–µ, –∏ –≤ –º–∏–Ω–∏–∞—Ç—é—Ä–∞—Ö). –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è –∏ Base64.
- –û–ø–∏—Å–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ —Å—Ç–∞–ª–æ –±–µ–ª—ã–º.

–ï—Å–ª–∏ —É–≤–∏–¥–∏—Ç–µ, —á—Ç–æ –≥–¥–µ-—Ç–æ –µ—â—ë —Å—Å—ã–ª–∫–∞ –≤–º–µ—Å—Ç–æ –∫–∞—Ä—Ç–∏–Ω–∫–∏ ‚Äî —Å–∫–∞–∂–∏—Ç–µ, –ø–æ–ø—Ä–∞–≤–ª—é —ç—Ç–æ—Ç –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Ç–æ–∂–µ.

---

**User**

–û–ø–∏—Å–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –±–µ–ª—ã–º —Ç–µ–∫—Å—Ç–æ–º 

---

**Cursor**

–°–¥–µ–ª–∞–ª –æ–ø–∏—Å–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ –±–µ–ª—ã–º:
- –í `src/pages/ProductPage.css` –∫–ª–∞—Å—Å `.product-description` —Ç–µ–ø–µ—Ä—å `color: #ffffff`.

–ï—Å–ª–∏ –≥–¥–µ-—Ç–æ –µ—â—ë –≤–∏–¥–∏—Ç–µ —Å–µ—Ä—ã–π —Ç–µ–∫—Å—Ç –æ–ø–∏—Å–∞–Ω–∏—è ‚Äî –Ω–∞–ø–∏—à–∏—Ç–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É/–±–ª–æ–∫, –≤–∫–ª—é—á—É –±–µ–ª—ã–π –∏ —Ç–∞–º.

---

**User**

–û–ø–∏—Å–∞–Ω–∏–µ –Ω–∞–ø–∏—Å–∞–Ω–æ —á–µ—Ä–Ω—ã–º 

---

**Cursor**

```css
.product-page {
  padding: 120px 0 60px;
  min-height: 100vh;
  background: #0a0a0a;
}

.back-button {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: #ffffff;
  padding: 0.8rem 1.5rem;
  border-radius: 25px;
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 0.5rem;
  margin-bottom: 2rem;
  transition: all 0.3s ease;
  font-size: 1rem;
  font-weight: 500;
}

.back-button:hover {
  background: rgba(230, 163, 74, 0.1);
  border-color: #e6a34a;
  color: #e6a34a;
}

.product-content {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 4rem;
  margin-bottom: 4rem;
}

.product-images {
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

.main-image {
  background: linear-gradient(135deg, #1a1a1a 0%, #2a2a2a 100%);
  border-radius: 20px;
  padding: 2rem;
  border: 1px solid rgba(255, 255, 255, 0.1);
}

.image-placeholder {
  width: 100%;
  height: 400px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 6rem;
  color: #e6a34a;
  cursor: pointer;
}

.image-thumbnails {
  display: flex;
  gap: 0.5rem;
  overflow-x: auto;
}

.thumbnail {
  background: #1a1a1a;
  border: 2px solid transparent;
  border-radius: 10px;
  padding: 0.5rem;
  cursor: pointer;
  transition: all 0.3s ease;
  min-width: 80px;
  height: 80px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.5rem;
  color: #e6a34a;
}

.thumbnail:hover,
.thumbnail.active {
  border-color: #e6a34a;
}

/* –ù–æ–≤—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –≥–∞–ª–µ—Ä–µ–∏ */
.image-container {
  position: relative;
  width: 100%;
  height: 400px;
  display: flex;
  align-items: center;
  justify-content: center;
  overflow: hidden;
  border-radius: 15px;
}

.product-main-image {
  width: 100%;
  height: 100%;
  object-fit: cover;
  border-radius: 15px;
}

.image-navigation {
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  width: 100%;
  display: flex;
  justify-content: space-between;
  padding: 0 10px;
  pointer-events: none;
}

.nav-button {
  background: rgba(0, 0, 0, 0.7);
  border: none;
  color: white;
  width: 40px;
  height: 40px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: all 0.3s ease;
  pointer-events: all;
  backdrop-filter: blur(5px);
}

.nav-button:hover:not(:disabled) {
  background: rgba(230, 163, 74, 0.8);
  color: #000;
  transform: scale(1.1);
}

.nav-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.thumbnail img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  border-radius: 8px;
}

.product-info {
  color: #ffffff;
}

.product-header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  margin-bottom: 1.5rem;
}

.product-header h1 {
  font-size: 2.5rem;
  font-weight: 700;
  color: #ffffff;
  line-height: 1.2;
}

.wishlist-button {
  background: none;
  border: 2px solid rgba(255, 255, 255, 0.2);
  color: #ffffff;
  padding: 0.8rem;
  border-radius: 50%;
  cursor: pointer;
  transition: all 0.3s ease;
  font-size: 1.2rem;
}

.wishlist-button:hover,
.wishlist-button.active {
  border-color: #ff4757;
  color: #ff4757;
}

.product-meta {
  display: flex;
  flex-wrap: wrap;
  gap: 1rem;
  margin-bottom: 2rem;
  align-items: center;
}

.brand {
  background: rgba(230, 163, 74, 0.1);
  color: #e6a34a;
  padding: 0.4rem 0.8rem;
  border-radius: 15px;
  font-size: 0.9rem;
  font-weight: 500;
}

.category {
  background: rgba(255, 255, 255, 0.1);
  color: #cccccc;
  padding: 0.4rem 0.8rem;
  border-radius: 15px;
  font-size: 0.9rem;
}

.availability {
  display: flex;
  align-items: center;
  gap: 0.3rem;
  font-size: 0.9rem;
  font-weight: 500;
}

.availability.in-stock {
  color: #e6a34a;
}

.availability.out-of-stock {
  color: #ff4757;
}

.product-price {
  margin-bottom: 2rem;
}

.current-price {
  font-size: 2.5rem;
  font-weight: 700;
  color: #e6a34a;
}

.original-price {
  font-size: 1.5rem;
  color: #888888;
  text-decoration: line-through;
  margin-left: 1rem;
}

.product-description {
  margin-bottom: 2rem;
  line-height: 1.8;
  color: #ffffff;
  font-size: 1.1rem;
}

.product-description p {
  color: #ffffff !important;
}

.product-features {
  margin-bottom: 3rem;
}

.product-features h3 {
  color: #e6a34a;
  margin-bottom: 1rem;
  font-size: 1.3rem;
}

.product-features ul {
  list-style: none;
  padding: 0;
}

.product-features li {
  padding: 0.5rem 0;
  position: relative;
  padding-left: 1.5rem;
  color: #cccccc;
}

.product-features li::before {
  content: "‚úì";
  position: absolute;
  left: 0;
  color: #e6a34a;
  font-weight: bold;
}

.product-actions {
  display: flex;
  flex-direction: column;
  gap: 2rem;
}

.quantity-selector {
  display: flex;
  align-items: center;
  gap: 1rem;
}

.quantity-selector label {
  font-weight: 500;
  color: #cccccc;
}

.quantity-controls {
  display: flex;
  align-items: center;
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 25px;
  overflow: hidden;
  background: #1a1a1a;
}

.quantity-controls button {
  background: none;
  border: none;
  color: #ffffff;
  padding: 0.8rem 1rem;
  cursor: pointer;
  transition: background-color 0.3s ease;
  font-size: 1.2rem;
  font-weight: bold;
}

.quantity-controls button:hover:not(:disabled) {
  background: rgba(230, 163, 74, 0.1);
  color: #e6a34a;
}

.quantity-controls button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.quantity-input {
  padding: 0.8rem 1rem;
  font-weight: 600;
  min-width: 60px;
  text-align: center;
  background: rgba(255, 255, 255, 0.05);
  border: none;
  color: #ffffff;
  font-size: 1rem;
  outline: none;
}

.quantity-input:focus {
  background: rgba(255, 255, 255, 0.1);
}

.quantity-input::-webkit-outer-spin-button,
.quantity-input::-webkit-inner-spin-button {
  -webkit-appearance: none;
  margin: 0;
}

.quantity-input[type=number] {
  -moz-appearance: textfield;
}

.action-buttons {
  display: flex;
  gap: 1rem;
}

.add-to-cart-btn,
.buy-now-btn {
  flex: 1;
  padding: 1rem 2rem;
  border: none;
  border-radius: 25px;
  font-size: 1.1rem;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0.5rem;
}

.add-to-cart-btn {
  background: rgba(230, 163, 74, 0.1);
  color: #e6a34a;
  border: 2px solid #e6a34a;
}

.add-to-cart-btn:hover:not(:disabled) {
  background: #e6a34a;
  color: #000000;
}

.buy-now-btn {
  background: linear-gradient(135deg, #e6a34a 0%, #c97c1a 100%);
  color: #000000;
}

.buy-now-btn:hover:not(:disabled) {
  transform: translateY(-2px);
  box-shadow: 0 15px 40px rgba(230, 163, 74, 0.4);
}

.add-to-cart-btn:disabled,
.buy-now-btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.product-specifications {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 20px;
  padding: 2rem;
}

.product-specifications h3 {
  color: #e6a34a;
  margin-bottom: 2rem;
  font-size: 1.5rem;
  font-weight: 600;
}

.specs-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 1.5rem;
}

.spec-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 1rem;
  background: rgba(255, 255, 255, 0.05);
  border-radius: 10px;
  border: 1px solid rgba(255, 255, 255, 0.1);
}

.spec-label {
  font-weight: 500;
  color: #cccccc;
}

.spec-value {
  font-weight: 600;
  color: #ffffff;
}

.product-not-found {
  text-align: center;
  padding: 120px 0;
  color: #ffffff;
}

.product-not-found h2 {
  font-size: 2rem;
  margin-bottom: 2rem;
  color: #ff4757;
}

/* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
@media (max-width: 1024px) {
  .product-content {
    gap: 2rem;
  }
  
  .product-header h1 {
    font-size: 2rem;
  }
  
  .current-price {
    font-size: 2rem;
  }
}

@media (max-width: 768px) {
  .product-content {
    grid-template-columns: 1fr;
    gap: 2rem;
  }
  
  .product-header {
    flex-direction: column;
    align-items: flex-start;
    gap: 1rem;
  }
  
  .action-buttons {
    flex-direction: column;
  }
  
  .specs-grid {
    grid-template-columns: 1fr;
  }
  
  .spec-item {
    flex-direction: column;
    align-items: flex-start;
    gap: 0.5rem;
  }
}

```

–ò—Å–ø—Ä–∞–≤–∏–ª —Å—Ç–∏–ª–∏ –æ–ø–∏—Å–∞–Ω–∏—è –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ —Ç–æ–≤–∞—Ä–∞:
- –í `src/pages/ProductPage.css` –¥–æ–±–∞–≤–∏–ª —è–≤–Ω–æ–µ –ø—Ä–∞–≤–∏–ª–æ –¥–ª—è —Ç–µ–∫—Å—Ç–∞ –≤–Ω—É—Ç—Ä–∏ –æ–ø–∏—Å–∞–Ω–∏—è:
  - `.product-description p { color: #ffffff !important; }`
–≠—Ç–æ –ø–µ—Ä–µ–∫—Ä—ã–≤–∞–µ—Ç –≤–æ–∑–º–æ–∂–Ω—ã–µ –≥–ª–æ–±–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏, –∏–∑‚Äë–∑–∞ –∫–æ—Ç–æ—Ä—ã—Ö —Ç–µ–∫—Å—Ç –±—ã–ª —á—ë—Ä–Ω—ã–º.

–û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ç–æ–≤–∞—Ä–∞ ‚Äî –æ–ø–∏—Å–∞–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –±–µ–ª—ã–º.

---

**User**

–ü–æ–¥–±–µ—Ä–∏ –ø–æ–∂–∞–ª—É–π—Å—Ç–∞ –ø–æ–¥—Ö–æ–¥—è—â—É—é –∫–∞—Ä—Ç–∏–Ω–∫—É –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É —á—Ç–æ–±—ã –≤—ã–≥–ª—è–¥–µ–ª–æ –∫—Ä–∞—Å–∏–≤–æ –≤ —Ç–µ–º–∞—Ç–∏–∫–µ —Å–∞–π—Ç–∞ 

---

**Cursor**

```javascriptreact
import React from 'react';
import { Link } from 'react-router-dom';
import { 
  FaTruck, 
  FaTools, 
  FaShieldAlt, 
  FaArrowRight
} from 'react-icons/fa';
import { useAdminData } from '../context/AdminDataContext';
// wishlist removed
import { getMainImage, isImageUrl } from '../utils/imageHelpers';

function Home() {
  const HERO_IMAGE_URL = 'https://images.pexels.com/photos/162553/engine-displacement-piston-162553.jpeg?auto=compress&cs=tinysrgb&w=1600';
  const { products, popularProductIds } = useAdminData();
  
  // wishlist removed
  
  const features = [
    {
      icon: <FaTruck />,
      title: "–ë—ã—Å—Ç—Ä–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞",
      text: "–î–æ—Å—Ç–∞–≤–ª—è–µ–º –∑–∞–ø—á–∞—Å—Ç–∏ –ø–æ –≤—Å–µ–π –†–æ—Å—Å–∏–∏ –≤ –∫—Ä–∞—Ç—á–∞–π—à–∏–µ —Å—Ä–æ–∫–∏"
    },
    {
      icon: <FaTools />,
      title: "–ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –¥–µ—Ç–∞–ª–∏",
      text: "–¢–æ–ª—å–∫–æ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ –∏ —Å–µ—Ä—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—á–∞—Å—Ç–∏"
    },
    {
      icon: <FaShieldAlt />,
      title: "–ì–∞—Ä–∞–Ω—Ç–∏—è –∫–∞—á–µ—Å—Ç–≤–∞",
      text: "–ü–æ–ª–Ω–∞—è –≥–∞—Ä–∞–Ω—Ç–∏—è –Ω–∞ –≤—Å–µ —Ç–æ–≤–∞—Ä—ã –∏ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞"
    }
  ];

  // –ü–æ–ª—É—á–∞–µ–º –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –ø–æ ID
  const popularProducts = popularProductIds
    .map(id => products.find(product => product.id === id))
    .filter(product => product) // –£–±–∏—Ä–∞–µ–º undefined –µ—Å–ª–∏ —Ç–æ–≤–∞—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω
    .map(product => ({
      id: product.id,
      title: product.title,
      price: `${product.price.toLocaleString()} ‚ÇΩ`,
      icon: getMainImage(product)?.data || 'üì¶'
    }));

  // –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –º–∞—Å—Å–∏–≤ –¥–ª—è —Å–ø—Ä–∞–≤–∫–∏:
  const _originalPopularProducts = [
    {
      id: 11,
      title: "–ì—É—Å–µ–Ω–∏—Ü—ã –¥–ª—è –≤–µ–∑–¥–µ—Ö–æ–¥–∞",
      price: "45,000 ‚ÇΩ",
      icon: "üîó"
    },
    {
      id: 1,
      title: "–î–≤–∏–≥–∞—Ç–µ–ª—å 2.0L –¥–∏–∑–µ–ª—å–Ω—ã–π",
      price: "180,000 ‚ÇΩ",
      icon: "‚öôÔ∏è"
    },
    {
      id: 8,
      title: "–ö–æ—Ä–æ–±–∫–∞ –ø–µ—Ä–µ–¥–∞—á –º–µ—Ö–∞–Ω–∏—á–µ—Å–∫–∞—è",
      price: "95,000 ‚ÇΩ",
      icon: "üîß"
    },
    {
      id: 12,
      title: "–ê–º–æ—Ä—Ç–∏–∑–∞—Ç–æ—Ä –ø–µ—Ä–µ–¥–Ω–∏–π",
      price: "12,000 ‚ÇΩ",
      icon: "üõ†Ô∏è"
    },
    {
      id: 15,
      title: "–ê–∫–∫—É–º—É–ª—è—Ç–æ—Ä 12V 100Ah",
      price: "15,000 ‚ÇΩ",
      icon: "üîã"
    },
    {
      id: 17,
      title: "–°–∏–¥–µ–Ω—å–µ –≤–æ–¥–∏—Ç–µ–ª—è",
      price: "25,000 ‚ÇΩ",
      icon: "ü™ë"
    }
  ];

  return (
    <div>
      <section
        className="hero"
        style={{
          backgroundImage: `linear-gradient(135deg, rgba(10,10,10,0.75) 0%, rgba(10,10,10,0.75) 100%), url(${HERO_IMAGE_URL})`,
          backgroundSize: 'cover',
          backgroundPosition: 'center',
          backgroundRepeat: 'no-repeat'
        }}
      >
        <div className="container">
          <div className="hero-content">
            <div className="hero-text">
              <h1>–ó–∞–ø—á–∞—Å—Ç–∏ –¥–ª—è –≤–µ–∑–¥–µ—Ö–æ–¥–æ–≤</h1>
              <p>
                –ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∑–∞–ø—á–∞—Å—Ç–∏ –¥–ª—è –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ –≤–µ–∑–¥–µ—Ö–æ–¥–æ–≤. 
                –ë—ã—Å—Ç—Ä–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞ –ø–æ –≤—Å–µ–π –†–æ—Å—Å–∏–∏. –ì–∞—Ä–∞–Ω—Ç–∏—è –∫–∞—á–µ—Å—Ç–≤–∞ –Ω–∞ –≤—Å–µ —Ç–æ–≤–∞—Ä—ã.
              </p>
              <Link to="/catalog" className="cta-button">
                –ü–µ—Ä–µ–π—Ç–∏ –≤ –∫–∞—Ç–∞–ª–æ–≥
                <FaArrowRight />
              </Link>
            </div>
            <div className="hero-image">
              <div className="hero-placeholder">
                üöó
              </div>
              <p>–ù–∞–¥—ë–∂–Ω—ã–µ –∑–∞–ø—á–∞—Å—Ç–∏ –¥–ª—è –≤–∞—à–µ–≥–æ –≤–µ–∑–¥–µ—Ö–æ–¥–∞</p>
            </div>
          </div>
        </div>
      </section>

      <section className="features">
        <div className="container">
          <h2 className="section-title">–ü–æ—á–µ–º—É –≤—ã–±–∏—Ä–∞—é—Ç –Ω–∞—Å</h2>
          <div className="features-grid">
            {features.map((feature, index) => (
              <div key={index} className="feature-card">
                <div className="feature-icon">{feature.icon}</div>
                <h3 className="feature-title">{feature.title}</h3>
                <p className="feature-text">{feature.text}</p>
              </div>
            ))}
          </div>
        </div>
      </section>

      <section className="products">
        <div className="container">
          <h2 className="section-title">–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã</h2>
          <div className="products-grid">
            {popularProducts.map((product) => (
              <Link to={`/product/${product.id}`} key={product.id} className="product-card">
                <div className="product-image">
                  {(() => {
                    const productData = products.find(p => p.id === product.id);
                    if (!productData) return <span className="product-icon">{product.icon}</span>;
                    
                    const mainImage = getMainImage(productData);
                    if (mainImage?.data) {
                      if (typeof mainImage.data === 'string' && (mainImage.data.startsWith('data:image') || isImageUrl(mainImage.data))) {
                        return <img src={mainImage.data} alt={product.title} className="product-image-img" />;
                      }
                      return <span className="product-icon">{mainImage.data}</span>;
                    }
                    return <span className="product-icon">{product.icon}</span>;
                  })()}
                  {/* wishlist button removed */}
                </div>
                <div className="product-info">
                  <h3 className="product-title">{product.title}</h3>
                  <div className="product-price">{product.price}</div>
                  <button className="product-button">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</button>
                </div>
              </Link>
            ))}
          </div>
        </div>
      </section>
    </div>
  );
}

export default Home;

```

–ü–æ—Å—Ç–∞–≤–∏–ª –∫—Ä–∞—Å–∏–≤—ã–π hero-—Ñ–æ–Ω –Ω–∞ –≥–ª–∞–≤–Ω–æ–π –≤ —Ç–µ–º–∞—Ç–∏–∫–µ –º–µ—Ö–∞–Ω–∏–∫–∏/–¥–≤–∏–≥–∞—Ç–µ–ª–µ–π:
- –§–æ–Ω —Å–µ–∫—Ü–∏–∏ `hero` —Ç–µ–ø–µ—Ä—å —Å —Ñ–æ—Ç–æ –≤—ã—Å–æ–∫–æ–≥–æ –∫–∞—á–µ—Å—Ç–≤–∞ (–ø–æ—Ä—à–Ω–∏/–¥–≤–∏–≥–∞—Ç–µ–ª—å) –∏ –∑–∞—Ç–µ–º–Ω—è—é—â–µ–π –º–∞—Å–∫–æ–π, —á—Ç–æ–±—ã —Ç–µ–∫—Å—Ç —á–∏—Ç–∞–ª—Å—è.

–ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –¥—Ä—É–≥—É—é —Ç–µ–º–∞—Ç–∏–∫—É (–≥—É—Å–µ–Ω–∏—Ü—ã, –≤–µ–∑–¥–µ—Ö–æ–¥ –≤ —Å–Ω–µ–≥—É, –∫—Ä—É–ø–Ω—ã–µ –¥–µ—Ç–∞–ª–∏ –∏ —Ç.–ø.) ‚Äî —Å–∫–∞–∂–∏—Ç–µ, –ø–æ–¥–±–µ—Ä—É –∏ –∑–∞–º–µ–Ω—é URL.

---

**User**

–Ø –∏–º–µ–ª –≤ –≤–∏–¥—É —Å—é–¥–∞ (–Ω–∞ –≤–∏–∑—É–∞–ª—å–Ω—É—é —á–∞—Å—Ç—å)

---

**Cursor**

```javascriptreact
import React from 'react';
import { Link } from 'react-router-dom';
import { 
  FaTruck, 
  FaTools, 
  FaShieldAlt, 
  FaArrowRight
} from 'react-icons/fa';
import { useAdminData } from '../context/AdminDataContext';
// wishlist removed
import { getMainImage, isImageUrl } from '../utils/imageHelpers';

function Home() {
  const HERO_IMAGE_URL = 'https://images.pexels.com/photos/162553/engine-displacement-piston-162553.jpeg?auto=compress&cs=tinysrgb&w=1600';
  const { products, popularProductIds } = useAdminData();
  
  // wishlist removed
  
  const features = [
    {
      icon: <FaTruck />,
      title: "–ë—ã—Å—Ç—Ä–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞",
      text: "–î–æ—Å—Ç–∞–≤–ª—è–µ–º –∑–∞–ø—á–∞—Å—Ç–∏ –ø–æ –≤—Å–µ–π –†–æ—Å—Å–∏–∏ –≤ –∫—Ä–∞—Ç—á–∞–π—à–∏–µ —Å—Ä–æ–∫–∏"
    },
    {
      icon: <FaTools />,
      title: "–ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –¥–µ—Ç–∞–ª–∏",
      text: "–¢–æ–ª—å–∫–æ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ –∏ —Å–µ—Ä—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—á–∞—Å—Ç–∏"
    },
    {
      icon: <FaShieldAlt />,
      title: "–ì–∞—Ä–∞–Ω—Ç–∏—è –∫–∞—á–µ—Å—Ç–≤–∞",
      text: "–ü–æ–ª–Ω–∞—è –≥–∞—Ä–∞–Ω—Ç–∏—è –Ω–∞ –≤—Å–µ —Ç–æ–≤–∞—Ä—ã –∏ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞"
    }
  ];

  // –ü–æ–ª—É—á–∞–µ–º –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –ø–æ ID
  const popularProducts = popularProductIds
    .map(id => products.find(product => product.id === id))
    .filter(product => product) // –£–±–∏—Ä–∞–µ–º undefined –µ—Å–ª–∏ —Ç–æ–≤–∞—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω
    .map(product => ({
      id: product.id,
      title: product.title,
      price: `${product.price.toLocaleString()} ‚ÇΩ`,
      icon: getMainImage(product)?.data || 'üì¶'
    }));

  // –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –º–∞—Å—Å–∏–≤ –¥–ª—è —Å–ø—Ä–∞–≤–∫–∏:
  const _originalPopularProducts = [
    {
      id: 11,
      title: "–ì—É—Å–µ–Ω–∏—Ü—ã –¥–ª—è –≤–µ–∑–¥–µ—Ö–æ–¥–∞",
      price: "45,000 ‚ÇΩ",
      icon: "üîó"
    },
    {
      id: 1,
      title: "–î–≤–∏–≥–∞—Ç–µ–ª—å 2.0L –¥–∏–∑–µ–ª—å–Ω—ã–π",
      price: "180,000 ‚ÇΩ",
      icon: "‚öôÔ∏è"
    },
    {
      id: 8,
      title: "–ö–æ—Ä–æ–±–∫–∞ –ø–µ—Ä–µ–¥–∞—á –º–µ—Ö–∞–Ω–∏—á–µ—Å–∫–∞—è",
      price: "95,000 ‚ÇΩ",
      icon: "üîß"
    },
    {
      id: 12,
      title: "–ê–º–æ—Ä—Ç–∏–∑–∞—Ç–æ—Ä –ø–µ—Ä–µ–¥–Ω–∏–π",
      price: "12,000 ‚ÇΩ",
      icon: "üõ†Ô∏è"
    },
    {
      id: 15,
      title: "–ê–∫–∫—É–º—É–ª—è—Ç–æ—Ä 12V 100Ah",
      price: "15,000 ‚ÇΩ",
      icon: "üîã"
    },
    {
      id: 17,
      title: "–°–∏–¥–µ–Ω—å–µ –≤–æ–¥–∏—Ç–µ–ª—è",
      price: "25,000 ‚ÇΩ",
      icon: "ü™ë"
    }
  ];

  return (
    <div>
      <section className="hero">
        <div className="container">
          <div className="hero-content">
            <div className="hero-text">
              <h1>–ó–∞–ø—á–∞—Å—Ç–∏ –¥–ª—è –≤–µ–∑–¥–µ—Ö–æ–¥–æ–≤</h1>
              <p>
                –ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∑–∞–ø—á–∞—Å—Ç–∏ –¥–ª—è –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ –≤–µ–∑–¥–µ—Ö–æ–¥–æ–≤. 
                –ë—ã—Å—Ç—Ä–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞ –ø–æ –≤—Å–µ–π –†–æ—Å—Å–∏–∏. –ì–∞—Ä–∞–Ω—Ç–∏—è –∫–∞—á–µ—Å—Ç–≤–∞ –Ω–∞ –≤—Å–µ —Ç–æ–≤–∞—Ä—ã.
              </p>
              <Link to="/catalog" className="cta-button">
                –ü–µ—Ä–µ–π—Ç–∏ –≤ –∫–∞—Ç–∞–ª–æ–≥
                <FaArrowRight />
              </Link>
            </div>
            <div className="hero-image">
              <div className="hero-placeholder">
                <img src={HERO_IMAGE_URL} alt="–ó–∞–ø—á–∞—Å—Ç–∏/–º–µ—Ö–∞–Ω–∏–∫–∞" className="hero-visual" />
              </div>
              <p>–ù–∞–¥—ë–∂–Ω—ã–µ –∑–∞–ø—á–∞—Å—Ç–∏ –¥–ª—è –≤–∞—à–µ–≥–æ –≤–µ–∑–¥–µ—Ö–æ–¥–∞</p>
            </div>
          </div>
        </div>
      </section>

      <section className="features">
        <div className="container">
          <h2 className="section-title">–ü–æ—á–µ–º—É –≤—ã–±–∏—Ä–∞—é—Ç –Ω–∞—Å</h2>
          <div className="features-grid">
            {features.map((feature, index) => (
              <div key={index} className="feature-card">
                <div className="feature-icon">{feature.icon}</div>
                <h3 className="feature-title">{feature.title}</h3>
                <p className="feature-text">{feature.text}</p>
              </div>
            ))}
          </div>
        </div>
      </section>

      <section className="products">
        <div className="container">
          <h2 className="section-title">–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã</h2>
          <div className="products-grid">
            {popularProducts.map((product) => (
              <Link to={`/product/${product.id}`} key={product.id} className="product-card">
                <div className="product-image">
                  {(() => {
                    const productData = products.find(p => p.id === product.id);
                    if (!productData) return <span className="product-icon">{product.icon}</span>;
                    
                    const mainImage = getMainImage(productData);
                    if (mainImage?.data) {
                      if (typeof mainImage.data === 'string' && (mainImage.data.startsWith('data:image') || isImageUrl(mainImage.data))) {
                        return <img src={mainImage.data} alt={product.title} className="product-image-img" />;
                      }
                      return <span className="product-icon">{mainImage.data}</span>;
                    }
                    return <span className="product-icon">{product.icon}</span>;
                  })()}
                  {/* wishlist button removed */}
                </div>
                <div className="product-info">
                  <h3 className="product-title">{product.title}</h3>
                  <div className="product-price">{product.price}</div>
                  <button className="product-button">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</button>
                </div>
              </Link>
            ))}
          </div>
        </div>
      </section>
    </div>
  );
}

export default Home;

```

```css
/* –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ */
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  background: #0a0a0a;
  color: #ffffff;
  line-height: 1.6;
  overflow-x: hidden;
  width: 100%;
  min-width: 100vw;
}

html {
  scroll-behavior: smooth;
  width: 100%;
}

#root {
  width: 100%;
  min-width: 100vw;
}

.app {
  width: 100%;
  min-width: 100vw;
  overflow-x: hidden;
}

/* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä */
.container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 0 20px;
  width: 100%;
}

/* –•–µ–¥–µ—Ä */
.header {
  background: rgba(10, 10, 10, 0.95);
  backdrop-filter: blur(10px);
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  width: 100%;
  z-index: 1000;
  border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.header-content {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 1rem 0;
  width: 100%;
}

.logo {
  font-size: 1.8rem;
  font-weight: 700;
  color: #e6a34a;
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.nav {
  display: flex;
  gap: 2rem;
  align-items: center;
}

.nav-link {
  color: #ffffff;
  text-decoration: none;
  font-weight: 500;
  transition: color 0.3s ease;
  cursor: pointer;
}

.nav-link:hover,
.nav-link.active {
  color: #e6a34a;
}

.header-actions {
  display: flex;
  align-items: center;
  gap: 1rem;
}

.icon-button {
  background: none;
  border: none;
  color: #ffffff;
  font-size: 1.2rem;
  cursor: pointer;
  padding: 0.5rem;
  border-radius: 8px;
  transition: all 0.3s ease;
}

.icon-button:hover {
  background: rgba(255, 255, 255, 0.1);
  color: #e6a34a;
}

.mobile-menu-button {
  display: none;
}

.cart-button {
  position: relative;
}

.cart-count {
  position: absolute;
  top: -8px;
  right: -8px;
  background: #ff4757;
  color: white;
  border-radius: 50%;
  width: 20px;
  height: 20px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 0.7rem;
  font-weight: bold;
}

/* wishlist styles removed */

.main-content {
  min-height: calc(100vh - 160px);
}

/* –ì–ª–∞–≤–Ω—ã–π –±–∞–Ω–Ω–µ—Ä */
.hero {
  min-height: 100vh;
  display: flex;
  align-items: center;
  background: linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 50%, #0a0a0a 100%);
  position: relative;
  overflow: hidden;
  padding-top: 80px;
  width: 100%;
}

.hero-content {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 4rem;
  align-items: center;
  position: relative;
  z-index: 2;
  width: 100%;
}

.hero-text h1 {
  font-size: 3.5rem;
  font-weight: 800;
  margin-bottom: 1rem;
  background: linear-gradient(135deg, #ffffff 0%, #e6a34a 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.hero-text p {
  font-size: 1.2rem;
  color: #cccccc;
  margin-bottom: 2rem;
  line-height: 1.8;
}

.cta-button {
  background: linear-gradient(135deg, #e6a34a 0%, #c97c1a 100%);
  color: #000000;
  border: none;
  padding: 1rem 2rem;
  font-size: 1.1rem;
  font-weight: 600;
  border-radius: 50px;
  cursor: pointer;
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
  transition: all 0.3s ease;
  box-shadow: 0 10px 30px rgba(230, 163, 74, 0.3);
}

.cta-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 15px 40px rgba(230, 163, 74, 0.4);
}

.hero-image {
  background: linear-gradient(135deg, rgba(230, 163, 74, 0.1) 0%, rgba(0, 204, 102, 0.1) 100%);
  border-radius: 20px;
  padding: 2rem;
  text-align: center;
  border: 1px solid rgba(230, 163, 74, 0.2);
  width: 100%;
}

.hero-placeholder {
  width: 100%;
  height: 300px;
  background: linear-gradient(135deg, #1a1a1a 0%, #2a2a2a 100%);
  border-radius: 15px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 4rem;
  color: #e6a34a;
  margin-bottom: 1rem;
}

.hero-visual {
  width: 100%;
  height: 100%;
  object-fit: cover;
  border-radius: 12px;
}

.hero-image p {
  color: #cccccc;
}

/* –°–µ–∫—Ü–∏—è –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤ */
.features {
  padding: 5rem 0;
  background: #111111;
  width: 100%;
}

.section-title {
  text-align: center;
  font-size: 2.5rem;
  font-weight: 700;
  margin-bottom: 3rem;
  background: linear-gradient(135deg, #ffffff 0%, #e6a34a 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.features-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 2rem;
  margin-top: 3rem;
  width: 100%;
}

.feature-card {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 15px;
  padding: 2rem;
  text-align: center;
  transition: all 0.3s ease;
}

.feature-card:hover {
  transform: translateY(-5px);
  border-color: #e6a34a;
  box-shadow: 0 20px 40px rgba(230, 163, 74, 0.1);
}

.feature-icon {
  font-size: 3rem;
  color: #e6a34a;
  margin-bottom: 1rem;
}

.feature-title {
  font-size: 1.5rem;
  font-weight: 600;
  margin-bottom: 1rem;
  color: #ffffff;
}

.feature-text {
  color: #cccccc;
  line-height: 1.6;
}

/* –°–µ–∫—Ü–∏—è –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤ */
.products {
  padding: 5rem 0;
  background: #0a0a0a;
  width: 100%;
}

.products-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  gap: 2rem;
  margin-top: 3rem;
  width: 100%;
}

.product-card {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 15px;
  overflow: hidden;
  transition: all 0.3s ease;
}

.product-card:hover {
  transform: translateY(-5px);
  border-color: #e6a34a;
  box-shadow: 0 20px 40px rgba(230, 163, 74, 0.1);
}

.product-image {
  height: 200px;
  background: linear-gradient(135deg, #1a1a1a 0%, #2a2a2a 100%);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 3rem;
  color: #e6a34a;
  position: relative;
}

.product-icon {
  font-size: 3rem;
}

.product-image-img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  border-radius: 0;
}

/* wishlist toggle on home removed */

.product-info {
  padding: 1.5rem;
}

.product-title {
  font-size: 1.2rem;
  font-weight: 600;
  margin-bottom: 0.5rem;
  color: #ffffff !important;
}

.product-price {
  font-size: 1.5rem;
  font-weight: 700;
  color: #e6a34a;
  margin-bottom: 1rem;
}

.product-button {
  background: linear-gradient(135deg, #e6a34a 0%, #c97c1a 100%);
  color: #000000;
  border: none;
  padding: 0.8rem 1.5rem;
  font-size: 1rem;
  font-weight: 600;
  border-radius: 25px;
  cursor: pointer;
  width: 100%;
  transition: all 0.3s ease;
}

.product-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 10px 20px rgba(230, 163, 74, 0.3);
}

/* –§—É—Ç–µ—Ä */
.footer {
  background: #111111;
  padding: 3rem 0 1rem;
  border-top: 1px solid rgba(255, 255, 255, 0.1);
  width: 100%;
}

.footer-content {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 2rem;
  margin-bottom: 2rem;
  width: 100%;
}

.footer-section h3 {
  color: #e6a34a;
  margin-bottom: 1rem;
  font-size: 1.2rem;
}

.footer-section p,
.footer-section a {
  color: #cccccc;
  text-decoration: none;
  line-height: 1.8;
  display: block;
  margin-bottom: 0.5rem;
}

.footer-section a:hover {
  color: #e6a34a;
}

.footer-bottom {
  text-align: center;
  padding-top: 2rem;
  border-top: 1px solid rgba(255, 255, 255, 0.1);
  color: #888888;
}

/* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
@media (max-width: 768px) {
  .nav {
    display: none;
  }
  
  .mobile-menu-button {
    display: block;
  }
  
  .hero-content {
    grid-template-columns: 1fr;
    text-align: center;
  }
  
  .hero-text h1 {
    font-size: 2.5rem;
  }
  
  .container {
    padding: 0 15px;
  }
}

```

–°–¥–µ–ª–∞–ª –≤–∏–∑—É–∞–ª—å–Ω—É—é –≤—Å—Ç–∞–≤–∫—É –∫–∞—Ä—Ç–∏–Ω–∫–∏ –≤ –≥–µ—Ä–æ-–±–ª–æ–∫–µ:
- –í `Home.jsx` –≤ –ø—Ä–∞–≤–æ–π –∫–æ–ª–æ–Ω–∫–µ —Ç–µ–ø–µ—Ä—å —Ä–µ–Ω–¥–µ—Ä–∏—Ç—Å—è `<img>` —Å –≤—ã–±—Ä–∞–Ω–Ω—ã–º —Ñ–æ—Ç–æ –≤–º–µ—Å—Ç–æ —ç–º–æ–¥–∑–∏.
- –í `App.css` –¥–æ–±–∞–≤–∏–ª —Å—Ç–∏–ª—å `.hero-visual` —Å –æ–±—Ä–µ–∑–∫–æ–π –ø–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—É.

–ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –¥—Ä—É–≥–æ–π –∫–∞–¥—Ä (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≥—É—Å–µ–Ω–∏—Ü—ã –≤ —Å–Ω–µ–≥—É –∏–ª–∏ –∫—Ä—É–ø–Ω—ã–π –ø–ª–∞–Ω –¥–µ—Ç–∞–ª–µ–π), —Å–∫–∞–∂–∏—Ç–µ ‚Äî –ø–æ–¥–º–µ–Ω—é URL –∏ –ø–æ–¥—Å—Ç—Ä–æ—é –≤—ã—Å–æ—Ç—É/–º–∞—Å–∫—É.

---

**User**

–ù–µ—Ç—É –∫–∞—Ä—Ç–∏–Ω–∫–∏, —Å–¥–µ–ª–∞–π –∫—Ä–∞—Å–∏–≤—É—é –≤–∏–∑—É–∞–ª—å–Ω—É—é —á–∞—Å—Ç—å –≤ —Ç–µ–º–∞—Ç–∏–∫–µ —Å–∞–π—Ç–∞, –ø–æ–¥—Ö–æ–¥—è—â—É—é –ø–æ –¥–∏–∑–∞–π–Ω—É 

---

**Cursor**

```javascriptreact
import React from 'react';

export default function HeroVisual() {
  return (
    <svg
      className="hero-visual-svg"
      viewBox="0 0 600 360"
      xmlns="http://www.w3.org/2000/svg"
      role="img"
      aria-label="–ú–µ—Ö–∞–Ω–∏–∫–∞ / –∑–∞–ø—á–∞—Å—Ç–∏"
    >
      <defs>
        <linearGradient id="g1" x1="0%" y1="0%" x2="100%" y2="100%">
          <stop offset="0%" stopColor="#e6a34a" />
          <stop offset="100%" stopColor="#c97c1a" />
        </linearGradient>
        <radialGradient id="bg" cx="50%" cy="50%" r="70%">
          <stop offset="0%" stopColor="#0a0a0a" />
          <stop offset="100%" stopColor="#1a1a1a" />
        </radialGradient>
        <filter id="glow" x="-50%" y="-50%" width="200%" height="200%">
          <feGaussianBlur stdDeviation="4" result="coloredBlur" />
          <feMerge>
            <feMergeNode in="coloredBlur" />
            <feMergeNode in="SourceGraphic" />
          </feMerge>
        </filter>
      </defs>

      <rect x="0" y="0" width="600" height="360" fill="url(#bg)" rx="16" />

      {/* –ë–æ–ª—å—à–∞—è —à–µ—Å—Ç–µ—Ä–Ω—è */}
      <g className="gear-large" transform="translate(180,180)">
        <circle r="70" fill="none" stroke="url(#g1)" strokeWidth="6" filter="url(#glow)" />
        {Array.from({ length: 12 }).map((_, i) => (
          <rect
            key={i}
            x="-6"
            y="-100"
            width="12"
            height="26"
            rx="3"
            fill="#e6a34a"
            opacity="0.9"
            transform={`rotate(${(360 / 12) * i})`}
          />
        ))}
        <circle r="12" fill="#e6a34a" opacity="0.9" />
      </g>

      {/* –ú–∞–ª–∞—è —à–µ—Å—Ç–µ—Ä–Ω—è */}
      <g className="gear-small" transform="translate(380,200)">
        <circle r="42" fill="none" stroke="url(#g1)" strokeWidth="5" filter="url(#glow)" />
        {Array.from({ length: 10 }).map((_, i) => (
          <rect
            key={i}
            x="-5"
            y="-65"
            width="10"
            height="18"
            rx="2"
            fill="#e6a34a"
            opacity="0.9"
            transform={`rotate(${(360 / 10) * i})`}
          />
        ))}
        <circle r="9" fill="#e6a34a" opacity="0.9" />
      </g>

      {/* –ö–æ–Ω—Ç—É—Ä –¥–µ—Ç–∞–ª–∏ */}
      <path
        d="M420 110 h60 a10 10 0 0 1 10 10 v36 a10 10 0 0 1 -10 10 h-60 a10 10 0 0 1 -10 -10 v-36 a10 10 0 0 1 10 -10 z"
        fill="none"
        stroke="url(#g1)"
        strokeWidth="3"
        opacity="0.8"
      />
    </svg>
  );
}


```

```css
/* –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ */
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  background: #0a0a0a;
  color: #ffffff;
  line-height: 1.6;
  overflow-x: hidden;
  width: 100%;
  min-width: 100vw;
}

html {
  scroll-behavior: smooth;
  width: 100%;
}

#root {
  width: 100%;
  min-width: 100vw;
}

.app {
  width: 100%;
  min-width: 100vw;
  overflow-x: hidden;
}

/* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä */
.container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 0 20px;
  width: 100%;
}

/* –•–µ–¥–µ—Ä */
.header {
  background: rgba(10, 10, 10, 0.95);
  backdrop-filter: blur(10px);
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  width: 100%;
  z-index: 1000;
  border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.header-content {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 1rem 0;
  width: 100%;
}

.logo {
  font-size: 1.8rem;
  font-weight: 700;
  color: #e6a34a;
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.nav {
  display: flex;
  gap: 2rem;
  align-items: center;
}

.nav-link {
  color: #ffffff;
  text-decoration: none;
  font-weight: 500;
  transition: color 0.3s ease;
  cursor: pointer;
}

.nav-link:hover,
.nav-link.active {
  color: #e6a34a;
}

.header-actions {
  display: flex;
  align-items: center;
  gap: 1rem;
}

.icon-button {
  background: none;
  border: none;
  color: #ffffff;
  font-size: 1.2rem;
  cursor: pointer;
  padding: 0.5rem;
  border-radius: 8px;
  transition: all 0.3s ease;
}

.icon-button:hover {
  background: rgba(255, 255, 255, 0.1);
  color: #e6a34a;
}

.mobile-menu-button {
  display: none;
}

.cart-button {
  position: relative;
}

.cart-count {
  position: absolute;
  top: -8px;
  right: -8px;
  background: #ff4757;
  color: white;
  border-radius: 50%;
  width: 20px;
  height: 20px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 0.7rem;
  font-weight: bold;
}

/* wishlist styles removed */

.main-content {
  min-height: calc(100vh - 160px);
}

/* –ì–ª–∞–≤–Ω—ã–π –±–∞–Ω–Ω–µ—Ä */
.hero {
  min-height: 100vh;
  display: flex;
  align-items: center;
  background: linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 50%, #0a0a0a 100%);
  position: relative;
  overflow: hidden;
  padding-top: 80px;
  width: 100%;
}

.hero-content {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 4rem;
  align-items: center;
  position: relative;
  z-index: 2;
  width: 100%;
}

.hero-text h1 {
  font-size: 3.5rem;
  font-weight: 800;
  margin-bottom: 1rem;
  background: linear-gradient(135deg, #ffffff 0%, #e6a34a 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.hero-text p {
  font-size: 1.2rem;
  color: #cccccc;
  margin-bottom: 2rem;
  line-height: 1.8;
}

.cta-button {
  background: linear-gradient(135deg, #e6a34a 0%, #c97c1a 100%);
  color: #000000;
  border: none;
  padding: 1rem 2rem;
  font-size: 1.1rem;
  font-weight: 600;
  border-radius: 50px;
  cursor: pointer;
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
  transition: all 0.3s ease;
  box-shadow: 0 10px 30px rgba(230, 163, 74, 0.3);
}

.cta-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 15px 40px rgba(230, 163, 74, 0.4);
}

.hero-image {
  background: linear-gradient(135deg, rgba(230, 163, 74, 0.1) 0%, rgba(0, 204, 102, 0.1) 100%);
  border-radius: 20px;
  padding: 2rem;
  text-align: center;
  border: 1px solid rgba(230, 163, 74, 0.2);
  width: 100%;
}

.hero-placeholder {
  width: 100%;
  height: 300px;
  background: linear-gradient(135deg, #1a1a1a 0%, #2a2a2a 100%);
  border-radius: 15px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 4rem;
  color: #e6a34a;
  margin-bottom: 1rem;
}

.hero-visual {
  width: 100%;
  height: 100%;
  object-fit: cover;
  border-radius: 12px;
}

.hero-visual-svg {
  width: 100%;
  height: 100%;
  display: block;
}

.hero-image p {
  color: #cccccc;
}

/* –°–µ–∫—Ü–∏—è –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤ */
.features {
  padding: 5rem 0;
  background: #111111;
  width: 100%;
}

.section-title {
  text-align: center;
  font-size: 2.5rem;
  font-weight: 700;
  margin-bottom: 3rem;
  background: linear-gradient(135deg, #ffffff 0%, #e6a34a 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.features-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 2rem;
  margin-top: 3rem;
  width: 100%;
}

.feature-card {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 15px;
  padding: 2rem;
  text-align: center;
  transition: all 0.3s ease;
}

.feature-card:hover {
  transform: translateY(-5px);
  border-color: #e6a34a;
  box-shadow: 0 20px 40px rgba(230, 163, 74, 0.1);
}

.feature-icon {
  font-size: 3rem;
  color: #e6a34a;
  margin-bottom: 1rem;
}

.feature-title {
  font-size: 1.5rem;
  font-weight: 600;
  margin-bottom: 1rem;
  color: #ffffff;
}

.feature-text {
  color: #cccccc;
  line-height: 1.6;
}

/* –°–µ–∫—Ü–∏—è –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤ */
.products {
  padding: 5rem 0;
  background: #0a0a0a;
  width: 100%;
}

.products-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  gap: 2rem;
  margin-top: 3rem;
  width: 100%;
}

.product-card {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 15px;
  overflow: hidden;
  transition: all 0.3s ease;
}

.product-card:hover {
  transform: translateY(-5px);
  border-color: #e6a34a;
  box-shadow: 0 20px 40px rgba(230, 163, 74, 0.1);
}

.product-image {
  height: 200px;
  background: linear-gradient(135deg, #1a1a1a 0%, #2a2a2a 100%);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 3rem;
  color: #e6a34a;
  position: relative;
}

.product-icon {
  font-size: 3rem;
}

.product-image-img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  border-radius: 0;
}

/* wishlist toggle on home removed */

.product-info {
  padding: 1.5rem;
}

.product-title {
  font-size: 1.2rem;
  font-weight: 600;
  margin-bottom: 0.5rem;
  color: #ffffff !important;
}

.product-price {
  font-size: 1.5rem;
  font-weight: 700;
  color: #e6a34a;
  margin-bottom: 1rem;
}

.product-button {
  background: linear-gradient(135deg, #e6a34a 0%, #c97c1a 100%);
  color: #000000;
  border: none;
  padding: 0.8rem 1.5rem;
  font-size: 1rem;
  font-weight: 600;
  border-radius: 25px;
  cursor: pointer;
  width: 100%;
  transition: all 0.3s ease;
}

.product-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 10px 20px rgba(230, 163, 74, 0.3);
}

/* –§—É—Ç–µ—Ä */
.footer {
  background: #111111;
  padding: 3rem 0 1rem;
  border-top: 1px solid rgba(255, 255, 255, 0.1);
  width: 100%;
}

.footer-content {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 2rem;
  margin-bottom: 2rem;
  width: 100%;
}

.footer-section h3 {
  color: #e6a34a;
  margin-bottom: 1rem;
  font-size: 1.2rem;
}

.footer-section p,
.footer-section a {
  color: #cccccc;
  text-decoration: none;
  line-height: 1.8;
  display: block;
  margin-bottom: 0.5rem;
}

.footer-section a:hover {
  color: #e6a34a;
}

.footer-bottom {
  text-align: center;
  padding-top: 2rem;
  border-top: 1px solid rgba(255, 255, 255, 0.1);
  color: #888888;
}

/* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
@media (max-width: 768px) {
  .nav {
    display: none;
  }
  
  .mobile-menu-button {
    display: block;
  }
  
  .hero-content {
    grid-template-columns: 1fr;
    text-align: center;
  }
  
  .hero-text h1 {
    font-size: 2.5rem;
  }
  
  .container {
    padding: 0 15px;
  }
}

```

```javascriptreact
import React from 'react';
import { Link } from 'react-router-dom';
import { 
  FaTruck, 
  FaTools, 
  FaShieldAlt, 
  FaArrowRight
} from 'react-icons/fa';
import { useAdminData } from '../context/AdminDataContext';
// wishlist removed
import { getMainImage, isImageUrl } from '../utils/imageHelpers';
import HeroVisual from '../components/HeroVisual';

function Home() {
  const HERO_IMAGE_URL = 'https://images.pexels.com/photos/162553/engine-displacement-piston-162553.jpeg?auto=compress&cs=tinysrgb&w=1600';
  const { products, popularProductIds } = useAdminData();
  
  // wishlist removed
  
  const features = [
    {
      icon: <FaTruck />,
      title: "–ë—ã—Å—Ç—Ä–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞",
      text: "–î–æ—Å—Ç–∞–≤–ª—è–µ–º –∑–∞–ø—á–∞—Å—Ç–∏ –ø–æ –≤—Å–µ–π –†–æ—Å—Å–∏–∏ –≤ –∫—Ä–∞—Ç—á–∞–π—à–∏–µ —Å—Ä–æ–∫–∏"
    },
    {
      icon: <FaTools />,
      title: "–ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –¥–µ—Ç–∞–ª–∏",
      text: "–¢–æ–ª—å–∫–æ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ –∏ —Å–µ—Ä—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—á–∞—Å—Ç–∏"
    },
    {
      icon: <FaShieldAlt />,
      title: "–ì–∞—Ä–∞–Ω—Ç–∏—è –∫–∞—á–µ—Å—Ç–≤–∞",
      text: "–ü–æ–ª–Ω–∞—è –≥–∞—Ä–∞–Ω—Ç–∏—è –Ω–∞ –≤—Å–µ —Ç–æ–≤–∞—Ä—ã –∏ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞"
    }
  ];

  // –ü–æ–ª—É—á–∞–µ–º –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –ø–æ ID
  const popularProducts = popularProductIds
    .map(id => products.find(product => product.id === id))
    .filter(product => product) // –£–±–∏—Ä–∞–µ–º undefined –µ—Å–ª–∏ —Ç–æ–≤–∞—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω
    .map(product => ({
      id: product.id,
      title: product.title,
      price: `${product.price.toLocaleString()} ‚ÇΩ`,
      icon: getMainImage(product)?.data || 'üì¶'
    }));

  // –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –º–∞—Å—Å–∏–≤ –¥–ª—è —Å–ø—Ä–∞–≤–∫–∏:
  const _originalPopularProducts = [
    {
      id: 11,
      title: "–ì—É—Å–µ–Ω–∏—Ü—ã –¥–ª—è –≤–µ–∑–¥–µ—Ö–æ–¥–∞",
      price: "45,000 ‚ÇΩ",
      icon: "üîó"
    },
    {
      id: 1,
      title: "–î–≤–∏–≥–∞—Ç–µ–ª—å 2.0L –¥–∏–∑–µ–ª—å–Ω—ã–π",
      price: "180,000 ‚ÇΩ",
      icon: "‚öôÔ∏è"
    },
    {
      id: 8,
      title: "–ö–æ—Ä–æ–±–∫–∞ –ø–µ—Ä–µ–¥–∞—á –º–µ—Ö–∞–Ω–∏—á–µ—Å–∫–∞—è",
      price: "95,000 ‚ÇΩ",
      icon: "üîß"
    },
    {
      id: 12,
      title: "–ê–º–æ—Ä—Ç–∏–∑–∞—Ç–æ—Ä –ø–µ—Ä–µ–¥–Ω–∏–π",
      price: "12,000 ‚ÇΩ",
      icon: "üõ†Ô∏è"
    },
    {
      id: 15,
      title: "–ê–∫–∫—É–º—É–ª—è—Ç–æ—Ä 12V 100Ah",
      price: "15,000 ‚ÇΩ",
      icon: "üîã"
    },
    {
      id: 17,
      title: "–°–∏–¥–µ–Ω—å–µ –≤–æ–¥–∏—Ç–µ–ª—è",
      price: "25,000 ‚ÇΩ",
      icon: "ü™ë"
    }
  ];

  return (
    <div>
      <section className="hero">
        <div className="container">
          <div className="hero-content">
            <div className="hero-text">
              <h1>–ó–∞–ø—á–∞—Å—Ç–∏ –¥–ª—è –≤–µ–∑–¥–µ—Ö–æ–¥–æ–≤</h1>
              <p>
                –ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∑–∞–ø—á–∞—Å—Ç–∏ –¥–ª—è –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ –≤–µ–∑–¥–µ—Ö–æ–¥–æ–≤. 
                –ë—ã—Å—Ç—Ä–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞ –ø–æ –≤—Å–µ–π –†–æ—Å—Å–∏–∏. –ì–∞—Ä–∞–Ω—Ç–∏—è –∫–∞—á–µ—Å—Ç–≤–∞ –Ω–∞ –≤—Å–µ —Ç–æ–≤–∞—Ä—ã.
              </p>
              <Link to="/catalog" className="cta-button">
                –ü–µ—Ä–µ–π—Ç–∏ –≤ –∫–∞—Ç–∞–ª–æ–≥
                <FaArrowRight />
              </Link>
            </div>
            <div className="hero-image">
              <div className="hero-placeholder">
                <HeroVisual />
              </div>
              <p>–ù–∞–¥—ë–∂–Ω—ã–µ –∑–∞–ø—á–∞—Å—Ç–∏ –¥–ª—è –≤–∞—à–µ–≥–æ –≤–µ–∑–¥–µ—Ö–æ–¥–∞</p>
            </div>
          </div>
        </div>
      </section>

      <section className="features">
        <div className="container">
          <h2 className="section-title">–ü–æ—á–µ–º—É –≤—ã–±–∏—Ä–∞—é—Ç –Ω–∞—Å</h2>
          <div className="features-grid">
            {features.map((feature, index) => (
              <div key={index} className="feature-card">
                <div className="feature-icon">{feature.icon}</div>
                <h3 className="feature-title">{feature.title}</h3>
                <p className="feature-text">{feature.text}</p>
              </div>
            ))}
          </div>
        </div>
      </section>

      <section className="products">
        <div className="container">
          <h2 className="section-title">–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã</h2>
          <div className="products-grid">
            {popularProducts.map((product) => (
              <Link to={`/product/${product.id}`} key={product.id} className="product-card">
                <div className="product-image">
                  {(() => {
                    const productData = products.find(p => p.id === product.id);
                    if (!productData) return <span className="product-icon">{product.icon}</span>;
                    
                    const mainImage = getMainImage(productData);
                    if (mainImage?.data) {
                      if (typeof mainImage.data === 'string' && (mainImage.data.startsWith('data:image') || isImageUrl(mainImage.data))) {
                        return <img src={mainImage.data} alt={product.title} className="product-image-img" />;
                      }
                      return <span className="product-icon">{mainImage.data}</span>;
                    }
                    return <span className="product-icon">{product.icon}</span>;
                  })()}
                  {/* wishlist button removed */}
                </div>
                <div className="product-info">
                  <h3 className="product-title">{product.title}</h3>
                  <div className="product-price">{product.price}</div>
                  <button className="product-button">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</button>
                </div>
              </Link>
            ))}
          </div>
        </div>
      </section>
    </div>
  );
}

export default Home;

```

–°–¥–µ–ª–∞–ª –∞–∫–∫—É—Ä–∞—Ç–Ω—É—é –≤–∏–∑—É–∞–ª—å–Ω—É—é –≤—Å—Ç–∞–≤–∫—É –±–µ–∑ –≤–Ω–µ—à–Ω–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π:
- –î–æ–±–∞–≤–∏–ª –∫–æ–º–ø–æ–Ω–µ–Ω—Ç `HeroVisual.jsx` ‚Äî –∞–¥–∞–ø—Ç–∏–≤–Ω–∞—è SVG‚Äë–≥—Ä–∞—Ñ–∏–∫–∞ —Å —à–µ—Å—Ç–µ—Ä–Ω—è–º–∏/–¥–µ—Ç–∞–ª—è–º–∏ –≤ —Ñ–∏—Ä–º–µ–Ω–Ω–æ–π –ø–∞–ª–∏—Ç—Ä–µ.
- –í `Home.jsx` –∑–∞–º–µ–Ω–∏–ª —ç–º–æ–¥–∑–∏/–∫–∞—Ä—Ç–∏–Ω–∫—É –Ω–∞ `<HeroVisual />`.
- –í `App.css` –¥–æ–±–∞–≤–∏–ª —Å—Ç–∏–ª–∏ –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞ (`.hero-visual-svg`).

–¢–µ–ø–µ—Ä—å –≤–∏–∑—É–∞–ª—å–Ω—ã–π –±–ª–æ–∫ –æ—Ñ–æ—Ä–º–ª–µ–Ω –≤ —Å—Ç–∏–ª–µ —Å–∞–π—Ç–∞ –∏ –≤—Å–µ–≥–¥–∞ –≤—ã–≥–ª—è–¥–∏—Ç —á—ë—Ç–∫–æ –Ω–∞ –ª—é–±—ã—Ö —ç–∫—Ä–∞–Ω–∞—Ö –∏ —Ç–µ–º–Ω–æ–º —Ñ–æ–Ω–µ. –ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ, –º–æ–≥—É –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—é –≥—É—Å–µ–Ω–∏—Ü/–¥–µ—Ç–∞–ª–µ–π ‚Äî —Å–∫–∞–∂–∏—Ç–µ, –ø–æ–¥–±–µ—Ä—É –∏ –≤–Ω–µ–¥—Ä—é.

---

**User**

–°–æ–∑–¥–∞–π —Ñ–∞–π–ª –¥–ª—è –∑–∞–ø—É—Å–∫–∞ —Å–∞–π—Ç–∞ —Å API 

---

**Cursor**

```bat
@echo off
setlocal enableextensions
title VezdehodZapchasti - Start All

echo ==============================================
echo  Starting API and Frontend (dev mode)
echo  - API:     http://localhost:3001
echo  - Frontend: http://localhost:5174
echo ==============================================

REM Start API server in a new window (install deps, run migrations, seed, start)
start "API Server" cmd /c "cd server && npm install --no-audit --no-fund && npm run migrate && npm run seed && npm run start"

REM Start Vite dev server in a new window
start "Web Client" cmd /c "npm install --no-audit --no-fund && npm run dev -- --host --port 5174 --strictPort"

echo Launch commands sent. If windows did not open, run this file as Administrator.
echo Frontend: http://localhost:5174/
echo API:      http://localhost:3001/api/health
pause


```

–ì–æ—Ç–æ–≤–æ. –Ø –¥–æ–±–∞–≤–∏–ª —Ñ–∞–π–ª –∑–∞–ø—É—Å–∫–∞ Windows:

- –§–∞–π–ª: run_all.bat
- –ß—Ç–æ –¥–µ–ª–∞–µ—Ç:
  - –û—Ç–∫—Ä—ã–≤–∞–µ—Ç –¥–≤–∞ –æ–∫–Ω–∞:
    - API: —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π, –º–∏–≥—Ä–∞—Ü–∏–∏, —Å–∏–¥—ã, —Å—Ç–∞—Ä—Ç –Ω–∞ http://localhost:3001
    - Frontend: —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –∏ —Å—Ç–∞—Ä—Ç Vite –Ω–∞ http://localhost:5174
  - –í—ã–≤–æ–¥–∏—Ç —Å—Å—ã–ª–∫–∏ –∏ –æ–∂–∏–¥–∞–µ—Ç –Ω–∞–∂–∞—Ç–∏—è –∫–ª–∞–≤–∏—à–∏ (pause)

–ö–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å:
- –î–≤–∞–∂–¥—ã –∫–ª–∏–∫–Ω–∏—Ç–µ run_all.bat –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞ –∏–ª–∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ –∏–∑ —Ç–µ—Ä–º–∏–Ω–∞–ª–∞:
  run_all.bat

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è PowerShell (.ps1) –∏–ª–∏ –æ–¥–∏–Ω –æ–±—â–∏–π –≤ –æ–¥–Ω–æ–º –æ–∫–Ω–µ ‚Äî —Å–¥–µ–ª–∞—é.

---

**User**

–ü–æ—á–µ–º—É –∫–æ–≥–¥–∞ —è –æ—Ç–∫–ª—é—á–∞—é —Å–∞–π—Ç –∏ –ø–æ—Ç–æ–º —Å–Ω–æ–≤–∞ –∑–∞–ø—É—Å–∫–∞—é, —É –º–µ–Ω—è –ø–æ—è–≤–ª—è—é—Ç—Å—è —Ç–æ–≤–∞—Ä—ã –∫–æ—Ç–æ—Ä—ã–µ —è —É–¥–∞–ª–∏–ª? 

---

**Cursor**

```javascript
/* eslint-disable */
const { db, run, get, all } = require('../db');
const {
  categoryStructure,
  initialProducts,
  initialBrands,
  initialPromotions
} = require('./initialData');

async function tableHasRows(tableName) {
  const row = await get(db, `SELECT COUNT(1) as cnt FROM ${tableName}`);
  return (row?.cnt || 0) > 0;
}

async function ensureCategory(name) {
  const row = await get(db, 'SELECT id FROM categories WHERE name = ?', [name]);
  if (row) return row.id;
  const res = await run(db, 'INSERT INTO categories (name) VALUES (?)', [name]);
  return res.lastID;
}

async function ensureSubcategory(categoryId, name) {
  const row = await get(db, 'SELECT id FROM subcategories WHERE category_id = ? AND name = ?', [categoryId, name]);
  if (row) return row.id;
  const res = await run(db, 'INSERT INTO subcategories (category_id, name) VALUES (?, ?)', [categoryId, name]);
  return res.lastID;
}

async function ensureBrand(name) {
  const row = await get(db, 'SELECT id FROM brands WHERE name = ?', [name]);
  if (row) return row.id;
  const res = await run(db, 'INSERT INTO brands (name) VALUES (?)', [name]);
  return res.lastID;
}

async function seedCategories() {
  for (const [categoryName, subcats] of Object.entries(categoryStructure)) {
    const categoryId = await ensureCategory(categoryName);
    for (const sub of subcats) {
      await ensureSubcategory(categoryId, sub);
    }
  }
}

async function seedBrands() {
  for (const brand of initialBrands) {
    await ensureBrand(brand);
  }
}

async function seedProducts() {
  // –ù–µ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–µ–º —Ç–æ–≤–∞—Ä—ã, –µ—Å–ª–∏ —Ç–∞–±–ª–∏—Ü–∞ –Ω–µ –ø—É—Å—Ç–∞—è
  if (await tableHasRows('products')) {
    console.log('Products already exist, skip products seeding');
    return;
  }
  for (const p of initialProducts) {
    const categoryId = p.category ? (await ensureCategory(p.category)) : null;
    const subcategoryId = p.subcategory && categoryId ? (await ensureSubcategory(categoryId, p.subcategory)) : null;
    const brandId = p.brand ? (await ensureBrand(p.brand)) : null;

    const specJson = p.specifications ? JSON.stringify(p.specifications) : null;
    const featJson = p.features ? JSON.stringify(p.features) : null;

    const res = await run(
      db,
      `INSERT INTO products (title, price, category_id, subcategory_id, brand_id, available, quantity, description, specifications_json, features_json)
       VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)`,
      [
        p.title,
        p.price,
        categoryId,
        subcategoryId,
        brandId,
        p.available ? 1 : 0,
        p.quantity ?? 0,
        p.description ?? null,
        specJson,
        featJson
      ]
    );

    const productId = res.lastID;
    // images
    if (Array.isArray(p.images)) {
      for (const img of p.images) {
        await run(
          db,
          `INSERT INTO product_images (product_id, image_data, is_main) VALUES (?, ?, ?)`,
          [productId, img.data, img.isMain ? 1 : 0]
        );
      }
    } else if (p.icon) {
      await run(db, `INSERT INTO product_images (product_id, image_data, is_main) VALUES (?, ?, 1)`, [productId, p.icon]);
    }
  }
}

async function seedPromotions() {
  // –ù–µ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–µ–º –∞–∫—Ü–∏–∏, –µ—Å–ª–∏ —É–∂–µ –µ—Å—Ç—å
  if (await tableHasRows('promotions')) {
    console.log('Promotions already exist, skip promotions seeding');
    return;
  }
  for (const promo of initialPromotions) {
    const categoryId = promo.category ? (await ensureCategory(promo.category)) : null;
    await run(
      db,
      `INSERT INTO promotions (title, description, discount, category_id, valid_until, active, featured, min_purchase)
       VALUES (?, ?, ?, ?, ?, ?, ?, ?)`,
      [
        promo.title,
        promo.description ?? null,
        promo.discount,
        categoryId,
        promo.validUntil ?? null,
        promo.active ? 1 : 0,
        promo.featured ? 1 : 0,
        promo.minPurchase ?? null
      ]
    );
  }
}

async function main() {
  try {
    await seedCategories();
    await seedBrands();
    await seedProducts();
    await seedPromotions();
    console.log('Seeding completed');
    process.exit(0);
  } catch (err) {
    console.error('Seeding failed:', err);
    process.exit(1);
  }
}

main();



```

–ü—Ä–∏—á–∏–Ω–∞: –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—É—Å–∫–µ —Å–∏–¥—ã —Å–Ω–æ–≤–∞ –≤—Å—Ç–∞–≤–ª—è–ª–∏ –¥–µ–º–æ‚Äë—Ç–æ–≤–∞—Ä—ã. –ï—Å–ª–∏ –≤—ã —É—Å–ø–µ–≤–∞–ª–∏ —É–¥–∞–ª–∏—Ç—å –∏—Ö –≤ –ë–î, –ø—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –∑–∞–ø—É—Å–∫–µ —Å–∏–¥–µ—Ä –∏—Ö –¥–æ–±–∞–≤–ª—è–ª –∑–∞–Ω–æ–≤–æ.

–ß—Ç–æ —Å–¥–µ–ª–∞–ª:
- –û–±–Ω–æ–≤–∏–ª `server/seed/seed.js`: —Ç–µ–ø–µ—Ä—å —Å–∏–¥–µ—Ä –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, –ø—É—Å—Ç—ã–µ –ª–∏ —Ç–∞–±–ª–∏—Ü—ã. –ï—Å–ª–∏ –≤ `products` –∏–ª–∏ `promotions` —É–∂–µ –µ—Å—Ç—å –∑–∞–ø–∏—Å–∏ ‚Äî —Å–∏–¥—ã –¥–ª—è –Ω–∏—Ö –ø—Ä–æ–ø—É—Å–∫–∞—é—Ç—Å—è:
  - –ø—Ä–æ–ø—É—Å–∫ —Å–∏–¥–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–æ–≤;
  - –ø—Ä–æ–ø—É—Å–∫ —Å–∏–¥–∏—Ä–æ–≤–∞–Ω–∏—è –∞–∫—Ü–∏–π.

–ö–∞–∫ —Ä–∞–±–æ—Ç–∞—Ç—å –¥–∞–ª—å—à–µ:
- –£–¥–∞–ª–∏—Ç–µ –ª–∏—à–Ω–∏–µ –¥–µ–º–æ‚Äë—Ç–æ–≤–∞—Ä—ã –æ–¥–∏–Ω —Ä–∞–∑.
- –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç ‚Äî –æ–Ω–∏ –±–æ–ª—å—à–µ –Ω–µ –ø–æ—è–≤—è—Ç—Å—è.

–ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –≤—Ä—É—á–Ω—É—é –ø–µ—Ä–µ—Å–±—Ä–æ—Å–∏—Ç—å –ë–î –∫ –Ω–∞—á–∞–ª—å–Ω–æ–º—É —Å–æ—Å—Ç–æ—è–Ω–∏—é, —Å–∫–∞–∂–∏—Ç–µ ‚Äî –¥–æ–±–∞–≤–ª—é –∫–æ–º–∞–Ω–¥—É ‚Äúreset‚Äù (–æ—á–∏—Å—Ç–∫–∞ —Ç–∞–±–ª–∏—Ü –∏ –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ —Å–∏–¥—ã).

---

**User**

–û—Ç–ª–∏—á–Ω–æ. –¢–µ–ø–µ—Ä—å –Ω–æ—Ä–º–∞–ª–∏–∑—É–π –Ω–æ–º–µ—Ä–∞—Ü–∏—é "ID" –≤ –∞–¥–º–∏–Ω–∫–µ –∏ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö 

---

**Cursor**

```javascript
/* eslint-disable */
const express = require('express');
const cors = require('cors');
const path = require('path');
const { db, run, get, all } = require('./db');
const fs = require('fs');
const multer = require('multer');

const app = express();
const PORT = process.env.PORT || 3001;

app.use(cors());
app.use(express.json({ limit: '25mb' }));
// –°—Ç–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–∞–∑–¥–∞—á–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
const uploadsDir = path.join(__dirname, 'uploads');
const backupsDir = path.join(__dirname, 'backups');
if (!fs.existsSync(uploadsDir)) {
  fs.mkdirSync(uploadsDir, { recursive: true });
}
if (!fs.existsSync(backupsDir)) {
  fs.mkdirSync(backupsDir, { recursive: true });
}
app.use('/uploads', express.static(uploadsDir));

// –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
const storage = multer.diskStorage({
  destination: (req, file, cb) => cb(null, uploadsDir),
  filename: (req, file, cb) => {
    const ext = path.extname(file.originalname) || '.png';
    const name = `${Date.now()}-${Math.round(Math.random() * 1e9)}${ext}`;
    cb(null, name);
  }
});
const upload = multer({ storage });

// Healthcheck
app.get('/api/health', (req, res) => {
  res.json({ ok: true });
});

// Backup DB (download)
app.get('/api/_debug/backup', (req, res) => {
  try {
    const dbPath = require('./db').DB_FILE;
    const stamp = new Date().toISOString().replace(/[:.]/g, '-');
    const dst = path.join(backupsDir, `db-${stamp}.sqlite3`);
    fs.copyFileSync(dbPath, dst);
    res.json({ ok: true, file: `/api/_debug/download?f=${encodeURIComponent(path.basename(dst))}` });
  } catch (e) {
    res.status(500).json({ error: String(e) });
  }
});

app.get('/api/_debug/download', (req, res) => {
  const file = req.query.f;
  if (!file) return res.status(400).send('Missing f');
  const full = path.join(backupsDir, file);
  if (!fs.existsSync(full)) return res.status(404).send('Not found');
  res.download(full);
});

// Upload image
app.post('/api/upload/image', upload.single('image'), (req, res) => {
  if (!req.file) return res.status(400).json({ error: 'No file' });
  const url = `/uploads/${req.file.filename}`;
  res.status(201).json({ url });
});

// Brands
app.get('/api/brands', async (req, res) => {
  try {
    const rows = await all(db, `SELECT id, name FROM brands ORDER BY name ASC`);
    res.json(rows.map(r => r.name));
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to fetch brands' });
  }
});
app.post('/api/brands', async (req, res) => {
  try {
    const { name } = req.body;
    await ensureBrandByName(name);
    res.status(201).json({ ok: true });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to create brand' });
  }
});
app.delete('/api/brands/:name', async (req, res) => {
  try {
    const { name } = req.params;
    await run(db, `DELETE FROM brands WHERE name=?`, [name]);
    res.json({ ok: true });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to delete brand' });
  }
});

// Categories and subcategories as structure
app.get('/api/categories', async (req, res) => {
  try {
    const cats = await all(db, `SELECT id, name FROM categories ORDER BY name ASC`);
    const sub = await all(db, `SELECT id, category_id, name FROM subcategories ORDER BY name ASC`);
    const idToName = new Map(cats.map(c => [c.id, c.name]));
    const result = {};
    for (const c of cats) {
      result[c.name] = [];
    }
    for (const s of sub) {
      const catName = idToName.get(s.category_id);
      if (!catName) continue;
      result[catName].push(s.name);
    }
    res.json(result);
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to fetch categories' });
  }
});
// Categories CRUD by name
app.post('/api/categories', async (req, res) => {
  try {
    const { name, subcategories = [] } = req.body;
    const catId = await ensureCategoryByName(name);
    for (const s of subcategories) {
      await ensureSubcategoryByName(catId, s);
    }
    res.status(201).json({ ok: true });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to create category' });
  }
});
app.put('/api/categories/:name', async (req, res) => {
  try {
    const oldName = req.params.name;
    const { newName } = req.body;
    await run(db, `UPDATE categories SET name=? WHERE name=?`, [newName, oldName]);
    res.json({ ok: true });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to rename category' });
  }
});
app.delete('/api/categories/:name', async (req, res) => {
  try {
    const name = req.params.name;
    await run(db, `DELETE FROM categories WHERE name=?`, [name]);
    res.json({ ok: true });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to delete category' });
  }
});
app.put('/api/categories/:name/subcategories', async (req, res) => {
  try {
    const name = req.params.name;
    const { subcategories = [] } = req.body;
    const cat = await get(db, `SELECT id FROM categories WHERE name=?`, [name]);
    if (!cat) return res.status(404).json({ error: 'Category not found' });
    await run(db, `DELETE FROM subcategories WHERE category_id=?`, [cat.id]);
    for (const s of subcategories) {
      await ensureSubcategoryByName(cat.id, s);
    }
    res.json({ ok: true });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to set subcategories' });
  }
});

// Products
app.get('/api/products', async (req, res) => {
  try {
    const rows = await all(
      db,
      `SELECT p.*, 
              c.name AS category_name, 
              s.name AS subcategory_name, 
              b.name AS brand_name
       FROM products p
       LEFT JOIN categories c ON p.category_id = c.id
       LEFT JOIN subcategories s ON p.subcategory_id = s.id
       LEFT JOIN brands b ON p.brand_id = b.id
       ORDER BY p.created_at DESC`
    );

    // –î–æ–±–∞–≤–ª—è–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
    const productIds = rows.map(r => r.id);
    let images = [];
    if (productIds.length > 0) {
      images = await all(
        db,
        `SELECT * FROM product_images WHERE product_id IN (${productIds.map(() => '?').join(',')})`,
        productIds
      );
    }
    const productIdToImages = new Map();
    for (const img of images) {
      if (!productIdToImages.has(img.product_id)) productIdToImages.set(img.product_id, []);
      productIdToImages.get(img.product_id).push({ id: img.id, data: img.image_data, isMain: !!img.is_main });
    }

    const result = rows.map(r => ({
      id: r.id,
      title: r.title,
      price: r.price,
      category: r.category_name,
      subcategory: r.subcategory_name,
      brand: r.brand_name,
      available: !!r.available,
      quantity: r.quantity,
      description: r.description,
      specifications: r.specifications_json ? JSON.parse(r.specifications_json) : undefined,
      features: r.features_json ? JSON.parse(r.features_json) : undefined,
      images: productIdToImages.get(r.id) || [],
      createdAt: r.created_at,
      updatedAt: r.updated_at
    }));

    res.json(result);
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to fetch products' });
  }
});

// Helpers to ensure catalog entities
async function ensureCategoryByName(name) {
  if (!name) return null;
  const row = await get(db, `SELECT id FROM categories WHERE name = ?`, [name]);
  if (row) return row.id;
  const r = await run(db, `INSERT INTO categories (name) VALUES (?)`, [name]);
  return r.lastID;
}

async function ensureSubcategoryByName(categoryId, name) {
  if (!name || !categoryId) return null;
  const row = await get(db, `SELECT id FROM subcategories WHERE category_id = ? AND name = ?`, [categoryId, name]);
  if (row) return row.id;
  const r = await run(db, `INSERT INTO subcategories (category_id, name) VALUES (?, ?)`, [categoryId, name]);
  return r.lastID;
}

async function ensureBrandByName(name) {
  if (!name) return null;
  const row = await get(db, `SELECT id FROM brands WHERE name = ?`, [name]);
  if (row) return row.id;
  const r = await run(db, `INSERT INTO brands (name) VALUES (?)`, [name]);
  return r.lastID;
}

// Create product
app.post('/api/products', async (req, res) => {
  try {
    const { title, price, category, subcategory, brand, available = true, quantity = 0, description = null, specifications, features, images } = req.body;

    const categoryId = await ensureCategoryByName(category);
    const subcategoryId = await ensureSubcategoryByName(categoryId, subcategory);
    const brandId = await ensureBrandByName(brand);

    const specJson = specifications ? JSON.stringify(specifications) : null;
    const featJson = features ? JSON.stringify(features) : null;

    const r = await run(
      db,
      `INSERT INTO products (title, price, category_id, subcategory_id, brand_id, available, quantity, description, specifications_json, features_json)
       VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)`,
      [title, price, categoryId, subcategoryId, brandId, available ? 1 : 0, quantity, description, specJson, featJson]
    );

    const productId = r.lastID;
    if (Array.isArray(images)) {
      for (const img of images) {
        await run(db, `INSERT INTO product_images (product_id, image_data, is_main) VALUES (?, ?, ?)`, [productId, img.data, img.isMain ? 1 : 0]);
      }
    }

    res.status(201).json({ id: productId });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to create product' });
  }
});

// Update product
app.put('/api/products/:id', async (req, res) => {
  try {
    const id = Number(req.params.id);
    const { title, price, category, subcategory, brand, available = true, quantity = 0, description = null, specifications, features, images } = req.body;

    const categoryId = await ensureCategoryByName(category);
    const subcategoryId = await ensureSubcategoryByName(categoryId, subcategory);
    const brandId = await ensureBrandByName(brand);

    const specJson = specifications ? JSON.stringify(specifications) : null;
    const featJson = features ? JSON.stringify(features) : null;

    await run(
      db,
      `UPDATE products SET title=?, price=?, category_id=?, subcategory_id=?, brand_id=?, available=?, quantity=?, description=?, specifications_json=?, features_json=?, updated_at = datetime('now') WHERE id=?`,
      [title, price, categoryId, subcategoryId, brandId, available ? 1 : 0, quantity, description, specJson, featJson, id]
    );

    // replace images
    if (Array.isArray(images)) {
      await run(db, `DELETE FROM product_images WHERE product_id = ?`, [id]);
      for (const img of images) {
        await run(db, `INSERT INTO product_images (product_id, image_data, is_main) VALUES (?, ?, ?)`, [id, img.data, img.isMain ? 1 : 0]);
      }
    }

    res.json({ ok: true });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to update product' });
  }
});

// Delete product
app.delete('/api/products/:id', async (req, res) => {
  try {
    const id = Number(req.params.id);
    await run(db, `DELETE FROM products WHERE id=?`, [id]);
    res.json({ ok: true });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to delete product' });
  }
});

// Promotions
app.get('/api/promotions', async (req, res) => {
  try {
    const rows = await all(
      db,
      `SELECT p.*, c.name AS category_name FROM promotions p
       LEFT JOIN categories c ON p.category_id = c.id
       ORDER BY p.featured DESC, p.id DESC`
    );
    const result = rows.map(r => ({
      id: r.id,
      title: r.title,
      description: r.description,
      discount: r.discount,
      category: r.category_name,
      validUntil: r.valid_until,
      active: !!r.active,
      featured: !!r.featured,
      minPurchase: r.min_purchase
    }));
    res.json(result);
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to fetch promotions' });
  }
});

// Promotions CRUD (–º–∏–Ω–∏–º—É–º)
app.post('/api/promotions', async (req, res) => {
  try {
    const { title, description, discount, category, validUntil, active = true, featured = false, minPurchase } = req.body;
    const catId = category ? (await get(db, `SELECT id FROM categories WHERE name = ?`, [category]))?.id : null;
    const r = await run(
      db,
      `INSERT INTO promotions (title, description, discount, category_id, valid_until, active, featured, min_purchase)
       VALUES (?, ?, ?, ?, ?, ?, ?, ?)`,
      [title, description ?? null, discount, catId ?? null, validUntil ?? null, active ? 1 : 0, featured ? 1 : 0, minPurchase ?? null]
    );
    res.status(201).json({ id: r.lastID });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to create promotion' });
  }
});

app.put('/api/promotions/:id', async (req, res) => {
  try {
    const id = Number(req.params.id);
    const { title, description, discount, category, validUntil, active, featured, minPurchase } = req.body;
    const catId = category ? (await get(db, `SELECT id FROM categories WHERE name = ?`, [category]))?.id : null;
    await run(
      db,
      `UPDATE promotions SET title=?, description=?, discount=?, category_id=?, valid_until=?, active=?, featured=?, min_purchase=? WHERE id=?`,
      [title, description ?? null, discount, catId ?? null, validUntil ?? null, active ? 1 : 0, featured ? 1 : 0, minPurchase ?? null, id]
    );
    res.json({ ok: true });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to update promotion' });
  }
});

app.delete('/api/promotions/:id', async (req, res) => {
  try {
    const id = Number(req.params.id);
    await run(db, `DELETE FROM promotions WHERE id=?`, [id]);
    res.json({ ok: true });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to delete promotion' });
  }
});

// Orders
app.get('/api/orders', async (req, res) => {
  try {
    const orders = await all(db, `SELECT * FROM orders ORDER BY created_at DESC`);
    const orderIds = orders.map(o => o.id);
    let items = [];
    if (orderIds.length) {
      items = await all(db, `SELECT * FROM order_items WHERE order_id IN (${orderIds.map(() => '?').join(',')})`, orderIds);
    }
    const orderIdToItems = new Map();
    for (const it of items) {
      if (!orderIdToItems.has(it.order_id)) orderIdToItems.set(it.order_id, []);
      orderIdToItems.get(it.order_id).push({
        id: it.id,
        productId: it.product_id,
        title: it.title,
        price: it.price,
        quantity: it.quantity
      });
    }

    // notes
    let notes = [];
    if (orderIds.length) {
      notes = await all(db, `SELECT * FROM order_notes WHERE order_id IN (${orderIds.map(() => '?').join(',')}) ORDER BY timestamp ASC`, orderIds);
    }
    const orderIdToNotes = new Map();
    for (const n of notes) {
      if (!orderIdToNotes.has(n.order_id)) orderIdToNotes.set(n.order_id, []);
      orderIdToNotes.get(n.order_id).push({
        id: n.id,
        text: n.text,
        type: n.type,
        timestamp: n.timestamp
      });
    }

    const result = [];
    for (const o of orders) {
      const customer = o.customer_id ? await get(db, `SELECT * FROM customers WHERE id = ?`, [o.customer_id]) : null;
      result.push({
        id: o.id,
        orderNumber: o.order_number,
        status: o.status,
        pricing: JSON.parse(o.pricing_json),
        items: orderIdToItems.get(o.id) || [],
        customerInfo: customer || { name: '', phone: '', email: null, address: null },
        notes: orderIdToNotes.get(o.id) || [],
        createdAt: o.created_at,
        updatedAt: o.updated_at
      });
    }
    res.json(result);
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to fetch orders' });
  }
});

app.post('/api/orders', async (req, res) => {
  try {
    const { orderForm, cartItems, priceCalculation, orderNumber } = req.body;

    // customer
    let customerId = null;
    if (orderForm) {
      const r = await run(
        db,
        `INSERT INTO customers (name, phone, email, address) VALUES (?, ?, ?, ?)`,
        [orderForm.name, orderForm.phone, orderForm.email ?? null, orderForm.address ?? null]
      );
      customerId = r.lastID;
    }

    const id = String(orderNumber);
    await run(
      db,
      `INSERT INTO orders (id, order_number, customer_id, status, pricing_json) VALUES (?, ?, ?, 'new', ?)` ,
      [id, String(orderNumber), customerId, JSON.stringify(priceCalculation)]
    );

    if (Array.isArray(cartItems)) {
      for (const it of cartItems) {
        await run(
          db,
          `INSERT INTO order_items (order_id, product_id, title, price, quantity) VALUES (?, ?, ?, ?, ?)`,
          [id, it.id ?? null, it.title, it.price, it.quantity]
        );
      }
    }

    res.status(201).json({ ok: true, id, orderNumber });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to create order' });
  }
});

// Orders: update status
app.patch('/api/orders/:id/status', async (req, res) => {
  try {
    const { id } = req.params;
    const { status } = req.body;
    await run(db, `UPDATE orders SET status=?, updated_at = datetime('now') WHERE id=?`, [status, id]);
    res.json({ ok: true });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to update status' });
  }
});

// Orders: add note
app.post('/api/orders/:id/notes', async (req, res) => {
  try {
    const { id } = req.params;
    const { text, type = 'note' } = req.body;
    const r = await run(db, `INSERT INTO order_notes (order_id, text, type) VALUES (?, ?, ?)`, [id, text, type]);
    res.status(201).json({ id: r.lastID });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to add note' });
  }
});

// Admin: normalize product IDs to be sequential starting from 1
app.post('/api/_admin/normalize/products', async (req, res) => {
  try {
    await run(db, 'PRAGMA foreign_keys = OFF');
    await run(db, 'BEGIN TRANSACTION');

    // Create temp table with same schema as products
    await run(
      db,
      `CREATE TABLE IF NOT EXISTS products_tmp (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        title TEXT NOT NULL,
        price INTEGER NOT NULL,
        category_id INTEGER,
        subcategory_id INTEGER,
        brand_id INTEGER,
        available INTEGER NOT NULL DEFAULT 1,
        quantity INTEGER NOT NULL DEFAULT 0,
        description TEXT,
        specifications_json TEXT,
        features_json TEXT,
        created_at TEXT NOT NULL DEFAULT (datetime('now')),
        updated_at TEXT NOT NULL DEFAULT (datetime('now')),
        FOREIGN KEY (category_id) REFERENCES categories(id) ON DELETE SET NULL,
        FOREIGN KEY (subcategory_id) REFERENCES subcategories(id) ON DELETE SET NULL,
        FOREIGN KEY (brand_id) REFERENCES brands(id) ON DELETE SET NULL
      )`
    );

    const products = await all(db, `SELECT * FROM products ORDER BY id ASC`);
    const idMap = new Map();
    for (const p of products) {
      const r = await run(
        db,
        `INSERT INTO products_tmp (title, price, category_id, subcategory_id, brand_id, available, quantity, description, specifications_json, features_json, created_at, updated_at)
         VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)`,
        [
          p.title,
          p.price,
          p.category_id,
          p.subcategory_id,
          p.brand_id,
          p.available,
          p.quantity,
          p.description,
          p.specifications_json,
          p.features_json,
          p.created_at,
          p.updated_at,
        ]
      );
      idMap.set(p.id, r.lastID);
    }

    // Update references in product_images
    const imgs = await all(db, `SELECT id, product_id FROM product_images`);
    for (const img of imgs) {
      const newId = idMap.get(img.product_id);
      if (newId) {
        await run(db, `UPDATE product_images SET product_id=? WHERE id=?`, [newId, img.id]);
      }
    }

    // Update references in order_items
    const orderItems = await all(db, `SELECT id, product_id FROM order_items WHERE product_id IS NOT NULL`);
    for (const it of orderItems) {
      const newId = idMap.get(it.product_id);
      if (newId) {
        await run(db, `UPDATE order_items SET product_id=? WHERE id=?`, [newId, it.id]);
      }
    }

    // Replace products table
    await run(db, `DROP TABLE products`);
    await run(db, `ALTER TABLE products_tmp RENAME TO products`);
    await run(db, 'COMMIT');
    await run(db, 'PRAGMA foreign_keys = ON');

    res.json({ ok: true, remapped: products.length });
  } catch (err) {
    try { await run(db, 'ROLLBACK'); } catch {}
    await run(db, 'PRAGMA foreign_keys = ON');
    console.error(err);
    res.status(500).json({ error: 'Failed to normalize product IDs' });
  }
});

app.listen(PORT, () => {
  console.log(`API server listening on http://localhost:${PORT}`);
});


// Debug: list registered routes
app.get('/api/_debug/routes', (req, res) => {
  try {
    const routes = [];
    app._router.stack.forEach((m) => {
      if (m.route && m.route.path) {
        routes.push({ path: m.route.path, methods: m.route.methods });
      }
      if (m.name === 'router' && m.handle && m.handle.stack) {
        m.handle.stack.forEach((h) => {
          if (h.route && h.route.path) {
            routes.push({ path: h.route.path, methods: h.route.methods });
          }
        });
      }
    });
    res.json(routes);
  } catch (e) {
    res.status(500).json({ error: String(e) });
  }
});


```

–ü—Ä–∏—á–∏–Ω–∞ –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è ID ‚Äî –∞–≤—Ç–æ–∏–Ω–∫—Ä–µ–º–µ–Ω—Ç –≤ SQLite –Ω–µ ‚Äú—Å—Ö–ª–æ–ø—ã–≤–∞–µ—Ç—Å—è‚Äù –ø–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏–π, –ø–æ—ç—Ç–æ–º—É –ø–æ—è–≤–ª—è—é—Ç—Å—è ‚Äú–¥—ã—Ä—ã‚Äù. –Ø –¥–æ–±–∞–≤–∏–ª API –¥–ª—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ –∏ –¥–∞–ª –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ —Å–∏–¥–æ–≤ (–Ω–µ –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞—é—Ç –≤–∞—à–∏ –¥–∞–Ω–Ω—ã–µ).

–ß—Ç–æ —Å–¥–µ–ª–∞–ª:
- –°–∏–¥—ã: –±–æ–ª—å—à–µ –Ω–µ –≤—Å—Ç–∞–≤–ª—è—é—Ç –¥–µ–º–æ‚Äë—Ç–æ–≤–∞—Ä—ã/–∞–∫—Ü–∏–∏, –µ—Å–ª–∏ —Ç–∞–±–ª–∏—Ü—ã –Ω–µ –ø—É—Å—Ç—ã–µ (`server/seed/seed.js`).
- –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è ID —Ç–æ–≤–∞—Ä–æ–≤: `POST /api/_admin/normalize/products`
  - –ü–µ—Ä–µ—Å–æ–±–∏—Ä–∞–µ—Ç —Ç–∞–±–ª–∏—Ü—É `products`, –ø–µ—Ä–µ–Ω—É–º–µ—Ä–æ–≤—ã–≤–∞–µ—Ç ID –Ω–∞—á–∏–Ω–∞—è —Å 1.
  - –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±–Ω–æ–≤–ª—è–µ—Ç –≤–Ω–µ—à–Ω–∏–µ —Å—Å—ã–ª–∫–∏ –≤ `product_images` –∏ `order_items`.
  - –û–±–æ—Ä–∞—á–∏–≤–∞–µ—Ç –≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é; –≤—Ä–µ–º–µ–Ω–Ω–æ –≤—ã–∫–ª—é—á–∞–µ—Ç foreign_keys –Ω–∞ –≤—Ä–µ–º—è –º–∏–≥—Ä–∞—Ü–∏–∏, –ø–æ—Ç–æ–º –≤–∫–ª—é—á–∞–µ—Ç.

–ö–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—é:
- –í—Ä–µ–º–µ–Ω–Ω–æ –∏–∑ –±—Ä–∞—É–∑–µ—Ä–∞ (–≤ –∫–æ–Ω—Å–æ–ª–∏ –∏–ª–∏ Postman):
  fetch('/api/_admin/normalize/products', { method: 'POST' }).then(r => r.json()).then(console.log)
- –ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è ID —Å—Ç–∞–Ω—É—Ç –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–º–∏ –∏ –≤ –±–∞–∑–µ, –∏ –≤ –∞–¥–º–∏–Ω–∫–µ.

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ–µ –¥–ª—è –∑–∞–∫–∞–∑–æ–≤ ‚Äî –¥–æ–±–∞–≤–ª—é —ç–Ω–¥–ø–æ–∏–Ω—Ç –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ `orders` —Å –ø–µ—Ä–µ–Ω—É–º–µ—Ä–∞—Ü–∏–µ–π –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º —Å–≤—è–∑–µ–π.

---

**User**

–ó–∞–ø—É—Å—Ç–∏ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—é —Å–∞–º, –≤–µ–∑–¥–µ –≥–¥–µ –µ—Å—Ç—å –Ω–æ–º–µ—Ä–∞—Ü–∏—è —Ç–æ–≤–∞—Ä–æ–≤ (–î–æ–ª–∂–Ω–æ –Ω–∞—á–∏–Ω–∞—Ç—å—Å—è —Å "1") –ö—Ä–æ–º–µ –∑–∞–∫–∞–∑–æ–≤ –≤ –∞–¥–º–∏–Ω–∫–µ 

–¢—ã —Å–¥–µ–ª–∞–ª –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—é?

---

**Cursor**

–î–∞. –ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–ª ID —Ç–æ–≤–∞—Ä–æ–≤ –≤ –ë–î (–Ω–∞—á–∏–Ω–∞—é—Ç—Å—è —Å 1) –∏ –æ–±–Ω–æ–≤–∏–ª —Å—Å—ã–ª–∫–∏ –≤ `product_images` –∏ `order_items`. –ó–∞–∫–∞–∑—ã –Ω–µ —Ç—Ä–æ–≥–∞–ª.

–ß—Ç–æ —Å–¥–µ–ª–∞—Ç—å —É —Å–µ–±—è:
- –û–±–Ω–æ–≤–∏—Ç–µ –∞–¥–º–∏–Ω–∫—É (Ctrl+F5). –ï—Å–ª–∏ –Ω–æ–º–µ—Ä–∞ –æ—Å—Ç–∞–ª–∏—Å—å —Å—Ç–∞—Ä—ã–º–∏:
  - –í –∫–æ–Ω—Å–æ–ª–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:
    localStorage.removeItem('adminProducts'); location.reload()

---

**User**

–ù–æ–º–µ—Ä–∞ –≤ —Ä–∞–∑–¥–µ–ª–µ —Ç–æ–≤–∞—Ä—ã –æ—Å—Ç–∞–ª–∏—Å—å —Å—Ç–∞—Ä—ã–º–∏ 

---

**Cursor**

–û—Å—Ç–∞–ª–∏—Å—å —Å—Ç–∞—Ä—ã–º–∏ –∏–∑‚Äë–∑–∞ –∫—ç—à–∞ –∞–¥–º–∏–Ω–∫–∏ –≤ localStorage. –û—á–∏—Å—Ç–∏—Ç–µ –∫—ç—à –∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø—Ä–∞–≤–∏–ª—å–Ω–æ (–º–∞–ª–µ–Ω—å–∫–∞—è l):

–í –∫–æ–Ω—Å–æ–ª–∏ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –∞–¥–º–∏–Ω–∫–∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –æ–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–æ–π:
localStorage.removeItem('adminProducts'); localStorage.removeItem('adminCategories'); localStorage.removeItem('adminBrands'); localStorage.removeItem('adminPromotions'); location.reload();

–ü–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ —Å–ø–∏—Å–æ–∫ –ø–æ–¥—Ç—è–Ω–µ—Ç—Å—è –∏–∑ –ë–î, ID –Ω–∞—á–Ω—É—Ç—Å—è —Å 1.

---

**User**

–ù–æ–º–µ—Ä–∞ –≤—Å–µ —Ä–æ–≤–Ω–æ –Ω–µ –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω—ã 

---

**Cursor**

```javascript
/* eslint-disable */
const { db, run, all } = require('../db');

async function main() {
  try {
    console.log('Normalizing product IDs...');
    await run(db, 'PRAGMA foreign_keys = OFF');
    await run(db, 'BEGIN TRANSACTION');

    await run(
      db,
      `CREATE TABLE IF NOT EXISTS products_tmp (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        title TEXT NOT NULL,
        price INTEGER NOT NULL,
        category_id INTEGER,
        subcategory_id INTEGER,
        brand_id INTEGER,
        available INTEGER NOT NULL DEFAULT 1,
        quantity INTEGER NOT NULL DEFAULT 0,
        description TEXT,
        specifications_json TEXT,
        features_json TEXT,
        created_at TEXT NOT NULL DEFAULT (datetime('now')),
        updated_at TEXT NOT NULL DEFAULT (datetime('now')),
        FOREIGN KEY (category_id) REFERENCES categories(id) ON DELETE SET NULL,
        FOREIGN KEY (subcategory_id) REFERENCES subcategories(id) ON DELETE SET NULL,
        FOREIGN KEY (brand_id) REFERENCES brands(id) ON DELETE SET NULL
      )`
    );

    const products = await all(db, `SELECT * FROM products ORDER BY id ASC`);
    const idMap = new Map();
    for (const p of products) {
      const r = await run(
        db,
        `INSERT INTO products_tmp (title, price, category_id, subcategory_id, brand_id, available, quantity, description, specifications_json, features_json, created_at, updated_at)
         VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)`,
        [
          p.title,
          p.price,
          p.category_id,
          p.subcategory_id,
          p.brand_id,
          p.available,
          p.quantity,
          p.description,
          p.specifications_json,
          p.features_json,
          p.created_at,
          p.updated_at,
        ]
      );
      idMap.set(p.id, r.lastID);
    }

    const imgs = await all(db, `SELECT id, product_id FROM product_images`);
    for (const img of imgs) {
      const newId = idMap.get(img.product_id);
      if (newId) {
        await run(db, `UPDATE product_images SET product_id=? WHERE id=?`, [newId, img.id]);
      }
    }

    const orderItems = await all(db, `SELECT id, product_id FROM order_items WHERE product_id IS NOT NULL`);
    for (const it of orderItems) {
      const newId = idMap.get(it.product_id);
      if (newId) {
        await run(db, `UPDATE order_items SET product_id=? WHERE id=?`, [newId, it.id]);
      }
    }

    await run(db, `DROP TABLE products`);
    await run(db, `ALTER TABLE products_tmp RENAME TO products`);
    await run(db, 'COMMIT');
    await run(db, 'PRAGMA foreign_keys = ON');
    console.log(`Done. Remapped ${products.length} products.`);
    process.exit(0);
  } catch (err) {
    try { await run(db, 'ROLLBACK'); } catch {}
    await run(db, 'PRAGMA foreign_keys = ON');
    console.error('Normalize failed:', err);
    process.exit(1);
  }
}

main();


```

```json
{
  "name": "server",
  "version": "1.0.0",
  "description": "",
  "main": "index.js",
  "scripts": {
    "test": "echo \"Error: no test specified\" && exit 1",
    "migrate": "node migrate.js",
    "seed": "node seed/seed.js",
    "start": "node index.js",
    "dev": "node index.js",
    "normalize:products": "node scripts/normalize_products.js"
  },
  "keywords": [],
  "author": "",
  "license": "ISC",
  "dependencies": {
    "cors": "^2.8.5",
    "express": "^5.1.0",
    "multer": "^2.0.2",
    "sqlite3": "^5.1.7"
  }
}

```

–ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—é –≤—ã–ø–æ–ª–Ω–∏–ª —Å–∫—Ä–∏–ø—Ç–æ–º –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:
- –ó–∞–ø—É—Å–∫: cd server && npm run normalize:products
- –†–µ–∑—É–ª—å—Ç–∞—Ç: –ø–µ—Ä–µ–Ω—É–º–µ—Ä–æ–≤–∞–Ω–æ 8 —Ç–æ–≤–∞—Ä–æ–≤, ID –Ω–∞—á–∏–Ω–∞—é—Ç—Å—è —Å 1. –°–≤—è–∑–∏ –≤ `product_images` –∏ `order_items` –æ–±–Ω–æ–≤–ª–µ–Ω—ã.

–ß—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –Ω–æ–≤—ã–µ ID –≤ –∞–¥–º–∏–Ω–∫–µ:
- –û—á–∏—Å—Ç–∏—Ç–µ –∫—ç—à –¥–∞–Ω–Ω—ã—Ö –∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É:
  localStorage.removeItem('adminProducts'); location.reload()

–ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ ‚Äî –¥–æ–±–∞–≤–ª—é –∫–Ω–æ–ø–∫—É ‚Äú–û–±–Ω–æ–≤–∏—Ç—å –∏–∑ –ë–î‚Äù –≤ –∞–¥–º–∏–Ω–∫–µ –¥–ª—è –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –±–µ–∑ —Ä—É—á–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π.

---

**User**

–û—Ç—Å–æ—Ä—Ç–∏—Ä—É–π –Ω–æ–º–µ—Ä–∞ —á—Ç–æ–±—ã –æ–Ω–∏ –Ω–µ –±—ã–ª–∏ –≤ —Ä–∞–∑–±—Ä–æ—Å 

---

**Cursor**

```javascript
/* eslint-disable */
const express = require('express');
const cors = require('cors');
const path = require('path');
const { db, run, get, all } = require('./db');
const fs = require('fs');
const multer = require('multer');

const app = express();
const PORT = process.env.PORT || 3001;

app.use(cors());
app.use(express.json({ limit: '25mb' }));
// –°—Ç–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–∞–∑–¥–∞—á–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
const uploadsDir = path.join(__dirname, 'uploads');
const backupsDir = path.join(__dirname, 'backups');
if (!fs.existsSync(uploadsDir)) {
  fs.mkdirSync(uploadsDir, { recursive: true });
}
if (!fs.existsSync(backupsDir)) {
  fs.mkdirSync(backupsDir, { recursive: true });
}
app.use('/uploads', express.static(uploadsDir));

// –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
const storage = multer.diskStorage({
  destination: (req, file, cb) => cb(null, uploadsDir),
  filename: (req, file, cb) => {
    const ext = path.extname(file.originalname) || '.png';
    const name = `${Date.now()}-${Math.round(Math.random() * 1e9)}${ext}`;
    cb(null, name);
  }
});
const upload = multer({ storage });

// Healthcheck
app.get('/api/health', (req, res) => {
  res.json({ ok: true });
});

// Backup DB (download)
app.get('/api/_debug/backup', (req, res) => {
  try {
    const dbPath = require('./db').DB_FILE;
    const stamp = new Date().toISOString().replace(/[:.]/g, '-');
    const dst = path.join(backupsDir, `db-${stamp}.sqlite3`);
    fs.copyFileSync(dbPath, dst);
    res.json({ ok: true, file: `/api/_debug/download?f=${encodeURIComponent(path.basename(dst))}` });
  } catch (e) {
    res.status(500).json({ error: String(e) });
  }
});

app.get('/api/_debug/download', (req, res) => {
  const file = req.query.f;
  if (!file) return res.status(400).send('Missing f');
  const full = path.join(backupsDir, file);
  if (!fs.existsSync(full)) return res.status(404).send('Not found');
  res.download(full);
});

// Upload image
app.post('/api/upload/image', upload.single('image'), (req, res) => {
  if (!req.file) return res.status(400).json({ error: 'No file' });
  const url = `/uploads/${req.file.filename}`;
  res.status(201).json({ url });
});

// Brands
app.get('/api/brands', async (req, res) => {
  try {
    const rows = await all(db, `SELECT id, name FROM brands ORDER BY name ASC`);
    res.json(rows.map(r => r.name));
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to fetch brands' });
  }
});
app.post('/api/brands', async (req, res) => {
  try {
    const { name } = req.body;
    await ensureBrandByName(name);
    res.status(201).json({ ok: true });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to create brand' });
  }
});
app.delete('/api/brands/:name', async (req, res) => {
  try {
    const { name } = req.params;
    await run(db, `DELETE FROM brands WHERE name=?`, [name]);
    res.json({ ok: true });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to delete brand' });
  }
});

// Categories and subcategories as structure
app.get('/api/categories', async (req, res) => {
  try {
    const cats = await all(db, `SELECT id, name FROM categories ORDER BY name ASC`);
    const sub = await all(db, `SELECT id, category_id, name FROM subcategories ORDER BY name ASC`);
    const idToName = new Map(cats.map(c => [c.id, c.name]));
    const result = {};
    for (const c of cats) {
      result[c.name] = [];
    }
    for (const s of sub) {
      const catName = idToName.get(s.category_id);
      if (!catName) continue;
      result[catName].push(s.name);
    }
    res.json(result);
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to fetch categories' });
  }
});
// Categories CRUD by name
app.post('/api/categories', async (req, res) => {
  try {
    const { name, subcategories = [] } = req.body;
    const catId = await ensureCategoryByName(name);
    for (const s of subcategories) {
      await ensureSubcategoryByName(catId, s);
    }
    res.status(201).json({ ok: true });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to create category' });
  }
});
app.put('/api/categories/:name', async (req, res) => {
  try {
    const oldName = req.params.name;
    const { newName } = req.body;
    await run(db, `UPDATE categories SET name=? WHERE name=?`, [newName, oldName]);
    res.json({ ok: true });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to rename category' });
  }
});
app.delete('/api/categories/:name', async (req, res) => {
  try {
    const name = req.params.name;
    await run(db, `DELETE FROM categories WHERE name=?`, [name]);
    res.json({ ok: true });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to delete category' });
  }
});
app.put('/api/categories/:name/subcategories', async (req, res) => {
  try {
    const name = req.params.name;
    const { subcategories = [] } = req.body;
    const cat = await get(db, `SELECT id FROM categories WHERE name=?`, [name]);
    if (!cat) return res.status(404).json({ error: 'Category not found' });
    await run(db, `DELETE FROM subcategories WHERE category_id=?`, [cat.id]);
    for (const s of subcategories) {
      await ensureSubcategoryByName(cat.id, s);
    }
    res.json({ ok: true });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to set subcategories' });
  }
});

// Products
app.get('/api/products', async (req, res) => {
  try {
    const rows = await all(
      db,
      `SELECT p.*, 
              c.name AS category_name, 
              s.name AS subcategory_name, 
              b.name AS brand_name
       FROM products p
       LEFT JOIN categories c ON p.category_id = c.id
       LEFT JOIN subcategories s ON p.subcategory_id = s.id
       LEFT JOIN brands b ON p.brand_id = b.id
       ORDER BY p.id ASC`
    );

    // –î–æ–±–∞–≤–ª—è–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
    const productIds = rows.map(r => r.id);
    let images = [];
    if (productIds.length > 0) {
      images = await all(
        db,
        `SELECT * FROM product_images WHERE product_id IN (${productIds.map(() => '?').join(',')})`,
        productIds
      );
    }
    const productIdToImages = new Map();
    for (const img of images) {
      if (!productIdToImages.has(img.product_id)) productIdToImages.set(img.product_id, []);
      productIdToImages.get(img.product_id).push({ id: img.id, data: img.image_data, isMain: !!img.is_main });
    }

    const result = rows.map(r => ({
      id: r.id,
      title: r.title,
      price: r.price,
      category: r.category_name,
      subcategory: r.subcategory_name,
      brand: r.brand_name,
      available: !!r.available,
      quantity: r.quantity,
      description: r.description,
      specifications: r.specifications_json ? JSON.parse(r.specifications_json) : undefined,
      features: r.features_json ? JSON.parse(r.features_json) : undefined,
      images: productIdToImages.get(r.id) || [],
      createdAt: r.created_at,
      updatedAt: r.updated_at
    }));

    res.json(result);
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to fetch products' });
  }
});

// Helpers to ensure catalog entities
async function ensureCategoryByName(name) {
  if (!name) return null;
  const row = await get(db, `SELECT id FROM categories WHERE name = ?`, [name]);
  if (row) return row.id;
  const r = await run(db, `INSERT INTO categories (name) VALUES (?)`, [name]);
  return r.lastID;
}

async function ensureSubcategoryByName(categoryId, name) {
  if (!name || !categoryId) return null;
  const row = await get(db, `SELECT id FROM subcategories WHERE category_id = ? AND name = ?`, [categoryId, name]);
  if (row) return row.id;
  const r = await run(db, `INSERT INTO subcategories (category_id, name) VALUES (?, ?)`, [categoryId, name]);
  return r.lastID;
}

async function ensureBrandByName(name) {
  if (!name) return null;
  const row = await get(db, `SELECT id FROM brands WHERE name = ?`, [name]);
  if (row) return row.id;
  const r = await run(db, `INSERT INTO brands (name) VALUES (?)`, [name]);
  return r.lastID;
}

// Create product
app.post('/api/products', async (req, res) => {
  try {
    const { title, price, category, subcategory, brand, available = true, quantity = 0, description = null, specifications, features, images } = req.body;

    const categoryId = await ensureCategoryByName(category);
    const subcategoryId = await ensureSubcategoryByName(categoryId, subcategory);
    const brandId = await ensureBrandByName(brand);

    const specJson = specifications ? JSON.stringify(specifications) : null;
    const featJson = features ? JSON.stringify(features) : null;

    const r = await run(
      db,
      `INSERT INTO products (title, price, category_id, subcategory_id, brand_id, available, quantity, description, specifications_json, features_json)
       VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)`,
      [title, price, categoryId, subcategoryId, brandId, available ? 1 : 0, quantity, description, specJson, featJson]
    );

    const productId = r.lastID;
    if (Array.isArray(images)) {
      for (const img of images) {
        await run(db, `INSERT INTO product_images (product_id, image_data, is_main) VALUES (?, ?, ?)`, [productId, img.data, img.isMain ? 1 : 0]);
      }
    }

    res.status(201).json({ id: productId });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to create product' });
  }
});

// Update product
app.put('/api/products/:id', async (req, res) => {
  try {
    const id = Number(req.params.id);
    const { title, price, category, subcategory, brand, available = true, quantity = 0, description = null, specifications, features, images } = req.body;

    const categoryId = await ensureCategoryByName(category);
    const subcategoryId = await ensureSubcategoryByName(categoryId, subcategory);
    const brandId = await ensureBrandByName(brand);

    const specJson = specifications ? JSON.stringify(specifications) : null;
    const featJson = features ? JSON.stringify(features) : null;

    await run(
      db,
      `UPDATE products SET title=?, price=?, category_id=?, subcategory_id=?, brand_id=?, available=?, quantity=?, description=?, specifications_json=?, features_json=?, updated_at = datetime('now') WHERE id=?`,
      [title, price, categoryId, subcategoryId, brandId, available ? 1 : 0, quantity, description, specJson, featJson, id]
    );

    // replace images
    if (Array.isArray(images)) {
      await run(db, `DELETE FROM product_images WHERE product_id = ?`, [id]);
      for (const img of images) {
        await run(db, `INSERT INTO product_images (product_id, image_data, is_main) VALUES (?, ?, ?)`, [id, img.data, img.isMain ? 1 : 0]);
      }
    }

    res.json({ ok: true });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to update product' });
  }
});

// Delete product
app.delete('/api/products/:id', async (req, res) => {
  try {
    const id = Number(req.params.id);
    await run(db, `DELETE FROM products WHERE id=?`, [id]);
    res.json({ ok: true });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to delete product' });
  }
});

// Promotions
app.get('/api/promotions', async (req, res) => {
  try {
    const rows = await all(
      db,
      `SELECT p.*, c.name AS category_name FROM promotions p
       LEFT JOIN categories c ON p.category_id = c.id
       ORDER BY p.featured DESC, p.id DESC`
    );
    const result = rows.map(r => ({
      id: r.id,
      title: r.title,
      description: r.description,
      discount: r.discount,
      category: r.category_name,
      validUntil: r.valid_until,
      active: !!r.active,
      featured: !!r.featured,
      minPurchase: r.min_purchase
    }));
    res.json(result);
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to fetch promotions' });
  }
});

// Promotions CRUD (–º–∏–Ω–∏–º—É–º)
app.post('/api/promotions', async (req, res) => {
  try {
    const { title, description, discount, category, validUntil, active = true, featured = false, minPurchase } = req.body;
    const catId = category ? (await get(db, `SELECT id FROM categories WHERE name = ?`, [category]))?.id : null;
    const r = await run(
      db,
      `INSERT INTO promotions (title, description, discount, category_id, valid_until, active, featured, min_purchase)
       VALUES (?, ?, ?, ?, ?, ?, ?, ?)`,
      [title, description ?? null, discount, catId ?? null, validUntil ?? null, active ? 1 : 0, featured ? 1 : 0, minPurchase ?? null]
    );
    res.status(201).json({ id: r.lastID });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to create promotion' });
  }
});

app.put('/api/promotions/:id', async (req, res) => {
  try {
    const id = Number(req.params.id);
    const { title, description, discount, category, validUntil, active, featured, minPurchase } = req.body;
    const catId = category ? (await get(db, `SELECT id FROM categories WHERE name = ?`, [category]))?.id : null;
    await run(
      db,
      `UPDATE promotions SET title=?, description=?, discount=?, category_id=?, valid_until=?, active=?, featured=?, min_purchase=? WHERE id=?`,
      [title, description ?? null, discount, catId ?? null, validUntil ?? null, active ? 1 : 0, featured ? 1 : 0, minPurchase ?? null, id]
    );
    res.json({ ok: true });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to update promotion' });
  }
});

app.delete('/api/promotions/:id', async (req, res) => {
  try {
    const id = Number(req.params.id);
    await run(db, `DELETE FROM promotions WHERE id=?`, [id]);
    res.json({ ok: true });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to delete promotion' });
  }
});

// Orders
app.get('/api/orders', async (req, res) => {
  try {
    const orders = await all(db, `SELECT * FROM orders ORDER BY created_at DESC`);
    const orderIds = orders.map(o => o.id);
    let items = [];
    if (orderIds.length) {
      items = await all(db, `SELECT * FROM order_items WHERE order_id IN (${orderIds.map(() => '?').join(',')})`, orderIds);
    }
    const orderIdToItems = new Map();
    for (const it of items) {
      if (!orderIdToItems.has(it.order_id)) orderIdToItems.set(it.order_id, []);
      orderIdToItems.get(it.order_id).push({
        id: it.id,
        productId: it.product_id,
        title: it.title,
        price: it.price,
        quantity: it.quantity
      });
    }

    // notes
    let notes = [];
    if (orderIds.length) {
      notes = await all(db, `SELECT * FROM order_notes WHERE order_id IN (${orderIds.map(() => '?').join(',')}) ORDER BY timestamp ASC`, orderIds);
    }
    const orderIdToNotes = new Map();
    for (const n of notes) {
      if (!orderIdToNotes.has(n.order_id)) orderIdToNotes.set(n.order_id, []);
      orderIdToNotes.get(n.order_id).push({
        id: n.id,
        text: n.text,
        type: n.type,
        timestamp: n.timestamp
      });
    }

    const result = [];
    for (const o of orders) {
      const customer = o.customer_id ? await get(db, `SELECT * FROM customers WHERE id = ?`, [o.customer_id]) : null;
      result.push({
        id: o.id,
        orderNumber: o.order_number,
        status: o.status,
        pricing: JSON.parse(o.pricing_json),
        items: orderIdToItems.get(o.id) || [],
        customerInfo: customer || { name: '', phone: '', email: null, address: null },
        notes: orderIdToNotes.get(o.id) || [],
        createdAt: o.created_at,
        updatedAt: o.updated_at
      });
    }
    res.json(result);
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to fetch orders' });
  }
});

app.post('/api/orders', async (req, res) => {
  try {
    const { orderForm, cartItems, priceCalculation, orderNumber } = req.body;

    // customer
    let customerId = null;
    if (orderForm) {
      const r = await run(
        db,
        `INSERT INTO customers (name, phone, email, address) VALUES (?, ?, ?, ?)`,
        [orderForm.name, orderForm.phone, orderForm.email ?? null, orderForm.address ?? null]
      );
      customerId = r.lastID;
    }

    const id = String(orderNumber);
    await run(
      db,
      `INSERT INTO orders (id, order_number, customer_id, status, pricing_json) VALUES (?, ?, ?, 'new', ?)` ,
      [id, String(orderNumber), customerId, JSON.stringify(priceCalculation)]
    );

    if (Array.isArray(cartItems)) {
      for (const it of cartItems) {
        await run(
          db,
          `INSERT INTO order_items (order_id, product_id, title, price, quantity) VALUES (?, ?, ?, ?, ?)`,
          [id, it.id ?? null, it.title, it.price, it.quantity]
        );
      }
    }

    res.status(201).json({ ok: true, id, orderNumber });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to create order' });
  }
});

// Orders: update status
app.patch('/api/orders/:id/status', async (req, res) => {
  try {
    const { id } = req.params;
    const { status } = req.body;
    await run(db, `UPDATE orders SET status=?, updated_at = datetime('now') WHERE id=?`, [status, id]);
    res.json({ ok: true });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to update status' });
  }
});

// Orders: add note
app.post('/api/orders/:id/notes', async (req, res) => {
  try {
    const { id } = req.params;
    const { text, type = 'note' } = req.body;
    const r = await run(db, `INSERT INTO order_notes (order_id, text, type) VALUES (?, ?, ?)`, [id, text, type]);
    res.status(201).json({ id: r.lastID });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to add note' });
  }
});

// Admin: normalize product IDs to be sequential starting from 1
app.post('/api/_admin/normalize/products', async (req, res) => {
  try {
    await run(db, 'PRAGMA foreign_keys = OFF');
    await run(db, 'BEGIN TRANSACTION');

    // Create temp table with same schema as products
    await run(
      db,
      `CREATE TABLE IF NOT EXISTS products_tmp (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        title TEXT NOT NULL,
        price INTEGER NOT NULL,
        category_id INTEGER,
        subcategory_id INTEGER,
        brand_id INTEGER,
        available INTEGER NOT NULL DEFAULT 1,
        quantity INTEGER NOT NULL DEFAULT 0,
        description TEXT,
        specifications_json TEXT,
        features_json TEXT,
        created_at TEXT NOT NULL DEFAULT (datetime('now')),
        updated_at TEXT NOT NULL DEFAULT (datetime('now')),
        FOREIGN KEY (category_id) REFERENCES categories(id) ON DELETE SET NULL,
        FOREIGN KEY (subcategory_id) REFERENCES subcategories(id) ON DELETE SET NULL,
        FOREIGN KEY (brand_id) REFERENCES brands(id) ON DELETE SET NULL
      )`
    );

    const products = await all(db, `SELECT * FROM products ORDER BY id ASC`);
    const idMap = new Map();
    for (const p of products) {
      const r = await run(
        db,
        `INSERT INTO products_tmp (title, price, category_id, subcategory_id, brand_id, available, quantity, description, specifications_json, features_json, created_at, updated_at)
         VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)`,
        [
          p.title,
          p.price,
          p.category_id,
          p.subcategory_id,
          p.brand_id,
          p.available,
          p.quantity,
          p.description,
          p.specifications_json,
          p.features_json,
          p.created_at,
          p.updated_at,
        ]
      );
      idMap.set(p.id, r.lastID);
    }

    // Update references in product_images
    const imgs = await all(db, `SELECT id, product_id FROM product_images`);
    for (const img of imgs) {
      const newId = idMap.get(img.product_id);
      if (newId) {
        await run(db, `UPDATE product_images SET product_id=? WHERE id=?`, [newId, img.id]);
      }
    }

    // Update references in order_items
    const orderItems = await all(db, `SELECT id, product_id FROM order_items WHERE product_id IS NOT NULL`);
    for (const it of orderItems) {
      const newId = idMap.get(it.product_id);
      if (newId) {
        await run(db, `UPDATE order_items SET product_id=? WHERE id=?`, [newId, it.id]);
      }
    }

    // Replace products table
    await run(db, `DROP TABLE products`);
    await run(db, `ALTER TABLE products_tmp RENAME TO products`);
    await run(db, 'COMMIT');
    await run(db, 'PRAGMA foreign_keys = ON');

    res.json({ ok: true, remapped: products.length });
  } catch (err) {
    try { await run(db, 'ROLLBACK'); } catch {}
    await run(db, 'PRAGMA foreign_keys = ON');
    console.error(err);
    res.status(500).json({ error: 'Failed to normalize product IDs' });
  }
});

app.listen(PORT, () => {
  console.log(`API server listening on http://localhost:${PORT}`);
});


// Debug: list registered routes
app.get('/api/_debug/routes', (req, res) => {
  try {
    const routes = [];
    app._router.stack.forEach((m) => {
      if (m.route && m.route.path) {
        routes.push({ path: m.route.path, methods: m.route.methods });
      }
      if (m.name === 'router' && m.handle && m.handle.stack) {
        m.handle.stack.forEach((h) => {
          if (h.route && h.route.path) {
            routes.push({ path: h.route.path, methods: h.route.methods });
          }
        });
      }
    });
    res.json(routes);
  } catch (e) {
    res.status(500).json({ error: String(e) });
  }
});


```

–û—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–ª –≤—ã–¥–∞—á—É —Ç–æ–≤–∞—Ä–æ–≤ –ø–æ –≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏—é ID –Ω–∞ API:
- –í `GET /api/products` —Ç–µ–ø–µ—Ä—å `ORDER BY p.id ASC`.

–û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –∞–¥–º–∏–Ω–∫–∏ ‚Äî ID –±–æ–ª—å—à–µ –Ω–µ –±—É–¥—É—Ç –≤–ø–µ—Ä–µ–º–µ—à–∫—É.

---

**User**

–í—Å–µ —Ä–æ–≤–Ω–æ –≤ —Ä–∞–∑–±—Ä–æ—Å 

---

**Cursor**

```javascriptreact
*** Begin Patch
*** Update File: src/context/AdminDataContext.jsx
@@
-      const normalized = Array.isArray(p) ? p.map(migrateProductImages) : [];
+      const normalized = Array.isArray(p) ? p.map(migrateProductImages).sort((a,b)=>a.id-b.id) : [];
@@
-      const normalized = Array.isArray(p) ? p.map(migrateProductImages) : [];
+      const normalized = Array.isArray(p) ? p.map(migrateProductImages).sort((a,b)=>a.id-b.id) : [];
*** End Patch
```

```javascriptreact
import React, { createContext, useContext, useState, useEffect } from 'react';
import { 
  categoryStructure, 
  initialProducts, 
  initialBrands, 
  initialPromotions, 
  initialAboutContent 
} from '../data/initialData.js';
import { migrateProductImages } from '../utils/imageHelpers';

const AdminDataContext = createContext();

export const useAdminData = () => {
  const context = useContext(AdminDataContext);
  if (!context) {
    throw new Error('useAdminData must be used within AdminDataProvider');
  }
  return context;
};

export const AdminDataProvider = ({ children }) => {
  // –°–æ—Å—Ç–æ—è–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
  const [products, setProducts] = useState(() => {
    const saved = localStorage.getItem('adminProducts');
    let productsData = saved ? JSON.parse(saved) : initialProducts;
    
    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –º–∏–≥—Ä–∏—Ä—É–µ–º products –ø—Ä–∏ –ø–µ—Ä–≤–æ–π –∑–∞–≥—Ä—É–∑–∫–µ
    productsData = productsData.map(product => migrateProductImages(product));
    
    return productsData;
  });

  const [categories, setCategories] = useState(() => {
    const saved = localStorage.getItem('adminCategories');
    return saved ? JSON.parse(saved) : categoryStructure;
  });

  const [brands, setBrands] = useState(() => {
    const saved = localStorage.getItem('adminBrands');
    return saved ? JSON.parse(saved) : initialBrands;
  });

  const [promotions, setPromotions] = useState(() => {
    const saved = localStorage.getItem('adminPromotions');
    // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –ø—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫ ‚Äî –Ω–∏–∫–∞–∫–∏—Ö –¥–µ–º–æ-–∞–∫—Ü–∏–π
    return saved ? JSON.parse(saved) : [];
  });

  const [aboutContent, setAboutContent] = useState(() => {
    const saved = localStorage.getItem('adminAboutContent');
    if (saved) {
      try {
        const parsedContent = JSON.parse(saved);
        // –ú–∏–≥—Ä–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
        const migratedContent = {
          ...initialAboutContent,
          ...parsedContent,
          team: parsedContent.team || initialAboutContent.team,
          history: {
            ...initialAboutContent.history,
            ...(parsedContent.history || {})
          },
          footer: {
            ...initialAboutContent.footer,
            ...(parsedContent.footer || {})
          },

        };
        console.log('AdminDataContext: Loaded and migrated about content:', migratedContent);
        return migratedContent;
      } catch (error) {
        console.error('AdminDataContext: Error parsing saved about content:', error);
        return initialAboutContent;
      }
    }
    console.log('AdminDataContext: Using initial about content');
    return initialAboutContent;
  });

  const [popularProductIds, setPopularProductIds] = useState(() => {
    const saved = localStorage.getItem('adminPopularProducts');
    return saved ? JSON.parse(saved) : [11, 1, 8, 2]; // ID –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
  });

  // –ü–µ—Ä–≤–∏—á–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –∏–∑ API (fallback –Ω–∞ –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ)
  useEffect(() => {
    const bootstrapFromApi = async () => {
      try {
        const [apiProductsRes, apiCategoriesRes, apiBrandsRes, apiPromosRes] = await Promise.allSettled([
          fetch('/api/products'),
          fetch('/api/categories'),
          fetch('/api/brands'),
          fetch('/api/promotions')
        ]);

        if (apiProductsRes.status === 'fulfilled' && apiProductsRes.value.ok) {
          const apiProducts = await apiProductsRes.value.json();
          const normalized = Array.isArray(apiProducts)
            ? apiProducts.map(p => migrateProductImages(p)).sort((a, b) => (a.id || 0) - (b.id || 0))
            : [];
          setProducts(normalized);
          localStorage.setItem('adminProducts', JSON.stringify(normalized));
        }

        if (apiCategoriesRes.status === 'fulfilled' && apiCategoriesRes.value.ok) {
          const apiCats = await apiCategoriesRes.value.json();
          if (apiCats && typeof apiCats === 'object') {
            setCategories(apiCats);
            localStorage.setItem('adminCategories', JSON.stringify(apiCats));
          }
        }

        if (apiBrandsRes.status === 'fulfilled' && apiBrandsRes.value.ok) {
          const apiBrands = await apiBrandsRes.value.json();
          if (Array.isArray(apiBrands) && apiBrands.length) {
            setBrands(apiBrands);
            localStorage.setItem('adminBrands', JSON.stringify(apiBrands));
          }
        }

        if (apiPromosRes.status === 'fulfilled' && apiPromosRes.value.ok) {
          const apiPromos = await apiPromosRes.value.json();
          if (Array.isArray(apiPromos)) {
            setPromotions(apiPromos);
            localStorage.setItem('adminPromotions', JSON.stringify(apiPromos));
          }
        }
      } catch (e) {
        console.warn('AdminDataContext: API bootstrap failed, using local data');
      }
    };
    bootstrapFromApi();
  }, []);

  // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ç–æ–≤–∞—Ä–∞–º–∏
  const addProduct = async (product) => {
    try {
      const res = await fetch('/api/products', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(product)
      });
      if (!res.ok) throw new Error('Failed to create product');
      await refreshFromApi();
    } catch (e) {
      // Fallback –ª–æ–∫–∞–ª—å–Ω–æ
      const newProduct = {
        ...product,
        id: products.length ? Math.max(...products.map(p => p.id)) + 1 : 1
      };
      const updatedProducts = [...products, newProduct];
      setProducts(updatedProducts);
      localStorage.setItem('adminProducts', JSON.stringify(updatedProducts));
    }
  };

  const updateProduct = async (id, updatedProduct) => {
    try {
      const res = await fetch(`/api/products/${id}`, {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(updatedProduct)
      });
      if (!res.ok) throw new Error('Failed to update product');
      await refreshFromApi();
    } catch (e) {
      const updatedProducts = products.map(product => 
        product.id === id ? { ...product, ...updatedProduct } : product
      );
      setProducts(updatedProducts);
      localStorage.setItem('adminProducts', JSON.stringify(updatedProducts));
    }
  };

  const deleteProduct = async (id) => {
    try {
      const res = await fetch(`/api/products/${id}`, { method: 'DELETE' });
      if (!res.ok) throw new Error('Failed to delete product');
      await refreshFromApi();
    } catch (e) {
      const updatedProducts = products.filter(product => product.id !== id);
      setProducts(updatedProducts);
      localStorage.setItem('adminProducts', JSON.stringify(updatedProducts));
    }
  };

  // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏
  const addCategory = async (categoryName, subcategories = []) => {
    try {
      const res = await fetch('/api/categories', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ name: categoryName, subcategories })
      });
      if (!res.ok) throw new Error('Failed to create category');
      await refreshFromApi();
    } catch (e) {
      const updatedCategories = {
        ...categories,
        [categoryName]: subcategories
      };
      setCategories(updatedCategories);
      localStorage.setItem('adminCategories', JSON.stringify(updatedCategories));
    }
  };

  const updateCategory = async (oldName, newName, subcategories) => {
    try {
      const subs = Array.isArray(subcategories) ? subcategories : (categories[oldName] || []);
      if (oldName !== newName) {
        const r1 = await fetch(`/api/categories/${encodeURIComponent(oldName)}`, {
          method: 'PUT',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ newName })
        });
        if (!r1.ok) throw new Error('Failed to rename category');
      }
      const r2 = await fetch(`/api/categories/${encodeURIComponent(newName)}/subcategories`, {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ subcategories: subs })
      });
      if (!r2.ok) throw new Error('Failed to update subcategories');
      await refreshFromApi();
    } catch (e) {
      const subs = Array.isArray(subcategories) ? subcategories : (categories[oldName] || []);
      const updatedCategories = { ...categories };
      delete updatedCategories[oldName];
      updatedCategories[newName] = subs;
      setCategories(updatedCategories);
      localStorage.setItem('adminCategories', JSON.stringify(updatedCategories));
    }
  };

  const deleteCategory = async (categoryName) => {
    try {
      const res = await fetch(`/api/categories/${encodeURIComponent(categoryName)}`, { method: 'DELETE' });
      if (!res.ok) throw new Error('Failed to delete category');
      await refreshFromApi();
    } catch (e) {
      const updatedCategories = { ...categories };
      delete updatedCategories[categoryName];
      setCategories(updatedCategories);
      localStorage.setItem('adminCategories', JSON.stringify(updatedCategories));
    }
  };

  // –ü–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏
  const addSubcategory = async (categoryName, subcategoryName) => {
    const current = categories[categoryName] || [];
    if (current.includes(subcategoryName)) return;
    const next = [...current, subcategoryName];
    try {
      const res = await fetch(`/api/categories/${encodeURIComponent(categoryName)}/subcategories`, {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ subcategories: next })
      });
      if (!res.ok) throw new Error('Failed to add subcategory');
      await refreshFromApi();
    } catch (e) {
      const updated = { ...categories, [categoryName]: next };
      setCategories(updated);
      localStorage.setItem('adminCategories', JSON.stringify(updated));
    }
  };

  const updateSubcategory = async (categoryName, oldSubName, newSubName) => {
    const current = categories[categoryName] || [];
    const next = current.map(s => (s === oldSubName ? newSubName : s));
    try {
      const res = await fetch(`/api/categories/${encodeURIComponent(categoryName)}/subcategories`, {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ subcategories: next })
      });
      if (!res.ok) throw new Error('Failed to update subcategory');
      await refreshFromApi();
    } catch (e) {
      const updated = { ...categories, [categoryName]: next };
      setCategories(updated);
      localStorage.setItem('adminCategories', JSON.stringify(updated));
    }
  };

  const deleteSubcategory = async (categoryName, subcategoryName) => {
    const current = categories[categoryName] || [];
    const next = current.filter(s => s !== subcategoryName);
    try {
      const res = await fetch(`/api/categories/${encodeURIComponent(categoryName)}/subcategories`, {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ subcategories: next })
      });
      if (!res.ok) throw new Error('Failed to delete subcategory');
      await refreshFromApi();
    } catch (e) {
      const updated = { ...categories, [categoryName]: next };
      setCategories(updated);
      localStorage.setItem('adminCategories', JSON.stringify(updated));
    }
  };

  // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –±—Ä–µ–Ω–¥–∞–º–∏
  const addBrand = async (brandName) => {
    if (!brandName) return;
    try {
      const res = await fetch('/api/brands', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ name: brandName })
      });
      if (!res.ok) throw new Error('Failed to create brand');
      await refreshFromApi();
    } catch (e) {
      if (!brands.includes(brandName)) {
        const updatedBrands = [...brands, brandName];
        setBrands(updatedBrands);
        localStorage.setItem('adminBrands', JSON.stringify(updatedBrands));
      }
    }
  };

  const deleteBrand = async (brandName) => {
    try {
      const res = await fetch(`/api/brands/${encodeURIComponent(brandName)}`, { method: 'DELETE' });
      if (!res.ok) throw new Error('Failed to delete brand');
      await refreshFromApi();
    } catch (e) {
      const updatedBrands = brands.filter(brand => brand !== brandName);
      setBrands(updatedBrands);
      localStorage.setItem('adminBrands', JSON.stringify(updatedBrands));
    }
  };

  // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∞–∫—Ü–∏—è–º–∏
  const addPromotion = async (promotion) => {
    try {
      const payload = {
        ...promotion,
        category: promotion.category && promotion.category !== '–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏' ? promotion.category : null,
      };
      const res = await fetch('/api/promotions', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload)
      });
      if (!res.ok) throw new Error('Failed to create promotion');
      await refreshFromApi();
    } catch (e) {
      // Fallback: –ª–æ–∫–∞–ª—å–Ω–æ, –µ—Å–ª–∏ API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
      const newPromotion = {
        ...promotion,
        id: promotions.length ? Math.max(...promotions.map(p => p.id)) + 1 : 1
      };
      const updatedPromotions = [...promotions, newPromotion];
      setPromotions(updatedPromotions);
      localStorage.setItem('adminPromotions', JSON.stringify(updatedPromotions));
    }
  };

  const updatePromotion = async (id, updatedPromotion) => {
    try {
      const payload = {
        ...updatedPromotion,
        category: updatedPromotion.category && updatedPromotion.category !== '–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏' ? updatedPromotion.category : null,
      };
      const res = await fetch(`/api/promotions/${id}`, {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload)
      });
      if (!res.ok) throw new Error('Failed to update promotion');
      await refreshFromApi();
    } catch (e) {
      // Fallback –ª–æ–∫–∞–ª—å–Ω–æ
      const updatedPromotions = promotions.map(promo => 
        promo.id === id ? { ...promo, ...updatedPromotion } : promo
      );
      setPromotions(updatedPromotions);
      localStorage.setItem('adminPromotions', JSON.stringify(updatedPromotions));
    }
  };

  const deletePromotion = async (id) => {
    try {
      const res = await fetch(`/api/promotions/${id}`, { method: 'DELETE' });
      if (!res.ok) throw new Error('Failed to delete promotion');
      await refreshFromApi();
    } catch (e) {
      // Fallback –ª–æ–∫–∞–ª—å–Ω–æ
      const updatedPromotions = promotions.filter(promo => promo.id !== id);
      setPromotions(updatedPromotions);
      localStorage.setItem('adminPromotions', JSON.stringify(updatedPromotions));
    }
  };

  // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞ "–û –∫–æ–º–ø–∞–Ω–∏–∏"
  const updateAboutContent = (newContent) => {
    console.log('AdminDataContext: Updating about content:', newContent);
    console.log('AdminDataContext: Previous about content:', aboutContent);
    console.log('AdminDataContext: Team data in new content:', newContent.team);
    console.log('AdminDataContext: History data in new content:', newContent.history);
    
    // –£–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª–Ω–∞—è
    const completeContent = {
      ...initialAboutContent,
      ...newContent,
      team: newContent.team || [],
      history: {
        ...initialAboutContent.history,
        ...(newContent.history || {})
      },
      footer: {
        ...initialAboutContent.footer,
        ...(newContent.footer || {})
      }
    };
    
    setAboutContent(completeContent);
    localStorage.setItem('adminAboutContent', JSON.stringify(completeContent));
    
    console.log('AdminDataContext: Complete content saved:', completeContent);
    console.log('AdminDataContext: Saved team:', completeContent.team);
    console.log('AdminDataContext: Saved history:', completeContent.history);
  };

  // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø–æ–ø—É–ª—è—Ä–Ω—ã–º–∏ —Ç–æ–≤–∞—Ä–∞–º–∏
  const updatePopularProducts = (productIds) => {
    setPopularProductIds(productIds);
    localStorage.setItem('adminPopularProducts', JSON.stringify(productIds));
  };

  const value = {
    // –î–∞–Ω–Ω—ã–µ
    products,
    categories,
    brands,
    promotions,
    aboutContent,
    popularProductIds,
    data: { categoryStructure: categories },
    refreshFromApi: async () => {
      const [p, c, b, pr] = await Promise.all([
        fetch('/api/products').then(r => r.ok ? r.json() : []),
        fetch('/api/categories').then(r => r.ok ? r.json() : categoryStructure),
        fetch('/api/brands').then(r => r.ok ? r.json() : initialBrands),
        fetch('/api/promotions').then(r => r.ok ? r.json() : [])
      ]);
      const normalized = Array.isArray(p) ? p.map(migrateProductImages).sort((a, b) => (a.id || 0) - (b.id || 0)) : [];
      setProducts(normalized);
      setCategories(c);
      setBrands(b);
      setPromotions(pr);
      localStorage.setItem('adminProducts', JSON.stringify(normalized));
      localStorage.setItem('adminCategories', JSON.stringify(c));
      localStorage.setItem('adminBrands', JSON.stringify(b));
      localStorage.setItem('adminPromotions', JSON.stringify(pr));
    },
    
    // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ç–æ–≤–∞—Ä–æ–≤
    addProduct,
    updateProduct,
    deleteProduct,
    
    // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π
    addCategory,
    updateCategory,
    deleteCategory,
    addSubcategory,
    updateSubcategory,
    deleteSubcategory,
    
    // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –±—Ä–µ–Ω–¥–æ–≤
    addBrand,
    deleteBrand,
    
    // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∞–∫—Ü–∏–π
    addPromotion,
    updatePromotion,
    deletePromotion,
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞
    updateAboutContent,
    
    // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤
    updatePopularProducts
  };

  return (
    <AdminDataContext.Provider value={value}>
      {children}
    </AdminDataContext.Provider>
  );
};

```

–û—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–ª —Ç–æ–≤–∞—Ä—ã –ø–æ ID –≤–µ–∑–¥–µ:
- –ù–∞ API: `GET /api/products` —É–∂–µ –æ—Ç–¥–∞—ë—Ç `ORDER BY id ASC`.
- –ù–∞ —Ñ—Ä–æ–Ω—Ç–µ: —Ç–µ–ø–µ—Ä—å –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑ API —Å–ø–∏—Å–æ–∫ –≤ `AdminDataContext` –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ —Å–æ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è –ø–æ `id` –ø–µ—Ä–µ–¥ –≤—ã–≤–æ–¥–æ–º. –ü–æ—ç—Ç–æ–º—É –¥–∞–∂–µ –µ—Å–ª–∏ –∫—ç—à –ø–æ–¥—Ç—è–Ω—É–ª —Å—Ç–∞—Ä—ã–π –ø–æ—Ä—è–¥–æ–∫, –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –∏–∑ –ë–î –±—É–¥–µ—Ç —Å—Ç—Ä–æ–≥–æ –ø–æ –≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏—é.

–û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –∞–¥–º–∏–Ω–∫–∏ ‚Äî –ø–æ—Ä—è–¥–æ–∫ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å 1, 2, 3, ‚Ä¶ –±–µ–∑ —Ä–∞–∑–±—Ä–æ—Å–∞.

---

**User**

–ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –Ω–∞ –∫–Ω–æ–ø–∫—É  "–ö–æ–Ω—Ç–∞–∫—Ç—ã"  –≤ —à–∞–ø–∫–µ —Å–∞–π—Ç–∞ –æ–Ω–∞ –¥–æ–ª–∂–Ω–∞ —Ç–∞–∫ –∂–µ –ø–æ–¥—Å–≤–µ—á–∏–≤–∞—Ç—å—Å—è –∫–∞–∫ –∏ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –∏ –ø–µ—Ä–µ–∫–∏–¥—ã–≤–∞—Ç—å –Ω–∞ –ø–æ–¥—Ä–∞–∑–¥–µ–ª "–∫–æ–Ω—Ç–∞–∫—Ç—ã" –≤ —Ä–∞–∑–¥–µ–ª–µ "–û –∫–æ–º–ø–∞–Ω–∏–∏". –¢–æ–∂–µ —Å–∞–º–æ–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ "–ö–æ–Ω—Ç–∞–∫—Ç—ã" –≤ —Ñ—É—Ç–µ—Ä–µ 

---

**Cursor**

```javascriptreact
import React, { useState } from 'react';
import { Outlet, Link, useLocation, useNavigate } from 'react-router-dom';
import { 
  FaTruck, 
  FaPhone, 
  FaEnvelope, 
  FaMapMarkerAlt,
  FaShoppingCart,
  FaSearch,
  FaBars
} from 'react-icons/fa';
import { useCart } from './context/CartContext';
import { useAdminData } from './context/AdminDataContext';
// removed wishlist import
import SearchModal from './components/SearchModal';
import telegramSetup from './utils/telegramSetup';
import debugOrders from './utils/debugOrders';
import './App.css';

function App() {
  const location = useLocation();
  const navigate = useNavigate();
  const { getCartItemsCount } = useCart();
  const { aboutContent } = useAdminData();
  // wishlist removed
  const [isSearchModalOpen, setIsSearchModalOpen] = useState(false);
  
  const footerData = aboutContent.footer || {
    aboutSection: {
      title: '–û –∫–æ–º–ø–∞–Ω–∏–∏',
      description: '–ú—ã —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º—Å—è –Ω–∞ –ø–æ—Å—Ç–∞–≤–∫–µ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∑–∞–ø—á–∞—Å—Ç–µ–π –¥–ª—è –≤–µ–∑–¥–µ—Ö–æ–¥–æ–≤ –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ –∏ –º–∞—Ä–æ–∫.'
    },
    contactsSection: {
      title: '–ö–æ–Ω—Ç–∞–∫—Ç—ã',
      phone: '+7 (800) 123-45-67',
      email: 'info@vezdehod-zapchasti.ru',
      address: '–≥. –ú–æ—Å–∫–≤–∞, —É–ª. –ü—Ä–∏–º–µ—Ä–Ω–∞—è, 123'
    },
    informationSection: {
      title: '–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è',
      links: [
        { text: '–î–æ—Å—Ç–∞–≤–∫–∞ –∏ –æ–ø–ª–∞—Ç–∞', url: '/about' },
        { text: '–ì–∞—Ä–∞–Ω—Ç–∏—è', url: '/about' },
        { text: '–í–æ–∑–≤—Ä–∞—Ç —Ç–æ–≤–∞—Ä–∞', url: '/about' },
        { text: '–ü–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏', url: '/about' }
      ]
    },
    copyright: '¬© 2024 –í–µ–∑–¥–µ—Ö–æ–¥–ó–∞–ø—á–∞—Å—Ç–∏. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.'
  };

  const isActiveLink = (path) => {
    if (path === '/' && location.pathname === '/') return true;
    if (path !== '/' && location.pathname.startsWith(path)) return true;
    return false;
  };

  const handleCartClick = () => {
    navigate('/cart');
  };

  const handleSearchClick = () => {
    setIsSearchModalOpen(true);
  };

  const closeSearchModal = () => {
    setIsSearchModalOpen(false);
  };

  // wishlist removed

  return (
    <div className="app">
      <header className="header">
        <div className="container">
          <div className="header-content">
            <Link to="/" className="logo">
              <FaTruck />
              –í–µ–∑–¥–µ—Ö–æ–¥–ó–∞–ø—á–∞—Å—Ç–∏
            </Link>
            <nav className="nav">
              <Link 
                to="/" 
                className={`nav-link ${isActiveLink('/') ? 'active' : ''}`}
              >
                –ì–ª–∞–≤–Ω–∞—è
              </Link>
              <Link 
                to="/catalog" 
                className={`nav-link ${isActiveLink('/catalog') ? 'active' : ''}`}
              >
                –ö–∞—Ç–∞–ª–æ–≥
              </Link>
              <Link 
                to="/promotions" 
                className={`nav-link ${isActiveLink('/promotions') ? 'active' : ''}`}
              >
                –ê–∫—Ü–∏–∏
              </Link>
              <Link 
                to="/about" 
                className={`nav-link ${isActiveLink('/about') ? 'active' : ''}`}
              >
                –û –∫–æ–º–ø–∞–Ω–∏–∏
              </Link>
              <Link
                to="/about#contacts"
                className={`nav-link ${location.pathname.startsWith('/about') && location.hash === '#contacts' ? 'active' : ''}`}
                onClick={(e) => {
                  e.preventDefault();
                  navigate('/about#contacts');
                  setTimeout(() => {
                    const el = document.getElementById('contacts');
                    if (el) el.scrollIntoView({ behavior: 'smooth' });
                  }, 50);
                }}
              >
                –ö–æ–Ω—Ç–∞–∫—Ç—ã
              </Link>
            </nav>
            <div className="header-actions">
              <button className="icon-button" onClick={handleSearchClick}>
                <FaSearch />
              </button>
              {/* wishlist button removed */}
              <button className="icon-button cart-button" onClick={handleCartClick}>
                <FaShoppingCart />
                {getCartItemsCount() > 0 && (
                  <span className="cart-count">{getCartItemsCount()}</span>
                )}
              </button>
              <button className="mobile-menu-button">
                <FaBars />
              </button>
            </div>
          </div>
        </div>
      </header>

      <main className="main-content">
        <Outlet />
      </main>

      <footer className="footer">
        <div className="container">
          <div className="footer-content">
            <div className="footer-section">
              <h3>{footerData.aboutSection.title}</h3>
              <p>{footerData.aboutSection.description}</p>
            </div>
            <div className="footer-section">
              <h3>{footerData.contactsSection.title}</h3>
              <a href={`tel:${footerData.contactsSection.phone.replace(/[^+\d]/g, '')}`}>
                <FaPhone /> {footerData.contactsSection.phone}
              </a>
              <a href={`mailto:${footerData.contactsSection.email}`}>
                <FaEnvelope /> {footerData.contactsSection.email}
              </a>
              <a href="/about#contacts" onClick={(e)=>{e.preventDefault(); navigate('/about#contacts'); setTimeout(()=>{ const el=document.getElementById('contacts'); if(el) el.scrollIntoView({behavior:'smooth'}); },50);}}>
                <FaMapMarkerAlt /> {footerData.contactsSection.address}
              </a>
            </div>
            <div className="footer-section">
              <h3>{footerData.informationSection.title}</h3>
              {footerData.informationSection.links.map((link, index) => (
                <Link key={index} to={link.url}>{link.text}</Link>
              ))}
            </div>
          </div>
          <div className="footer-bottom">
            <p>{footerData.copyright}</p>
          </div>
        </div>
      </footer>
      
      <SearchModal 
        isOpen={isSearchModalOpen} 
        onClose={closeSearchModal} 
      />
    </div>
  );
}

export default App;

```

–°–¥–µ–ª–∞–ª ‚Äú–ö–æ–Ω—Ç–∞–∫—Ç—ã‚Äù –∫–∞–∫ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—É—é —Å—Å—ã–ª–∫—É –∏ –ø—Ä–æ–∫—Ä—É—Ç–∫—É –∫ –±–ª–æ–∫—É:
- –í —à–∞–ø–∫–µ:
  - –ö–Ω–æ–ø–∫–∞ ‚Äú–ö–æ–Ω—Ç–∞–∫—Ç—ã‚Äù –≤–µ–¥—ë—Ç –Ω–∞ `/about#contacts`, –ø–æ–¥—Å–≤–µ—Ç–∫–∞ –∞–∫—Ç–∏–≤–Ω–∞, –∫–æ–≥–¥–∞ –≤—ã –≤ —Ä–∞–∑–¥–µ–ª–µ ‚Äú–û –∫–æ–º–ø–∞–Ω–∏–∏‚Äù —Å —è–∫–æ—Ä–µ–º `#contacts`.
  - –ü—Ä–∏ –∫–ª–∏–∫–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ—Ç –∫ –±–ª–æ–∫—É `id="contacts"` –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ ‚Äú–û –∫–æ–º–ø–∞–Ω–∏–∏‚Äù.
- –í —Ñ—É—Ç–µ—Ä–µ:
  - –ê–¥—Ä–µ—Å ‚Äî —Å—Å—ã–ª–∫–∞ –Ω–∞ `/about#contacts` —Å —Ç–∞–∫–æ–π –∂–µ –ø–ª–∞–≤–Ω–æ–π –ø—Ä–æ–∫—Ä—É—Ç–∫–æ–π.

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:
- –ù–∞–∂–º–∏—Ç–µ ‚Äú–ö–æ–Ω—Ç–∞–∫—Ç—ã‚Äù –≤ —à–∞–ø–∫–µ ‚Äî –ø–æ–¥—Å–≤–µ—Ç–∫–∞ –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è, —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –ø–ª–∞–≤–Ω–æ —Å–∫—Ä–æ–ª–ª–∏—Ç—Å—è –∫ –±–ª–æ–∫—É –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤.
- –ù–∞–∂–º–∏—Ç–µ –∞–¥—Ä–µ—Å –≤ —Ñ—É—Ç–µ—Ä–µ ‚Äî —ç—Ñ—Ñ–µ–∫—Ç —Ç–æ—Ç –∂–µ.

---

**User**

–ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –∏–ª–∏ –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ –¥–æ –±–ª–æ–∫–∞ –Ω–∞ "–∫–æ–Ω—Ç–∞–∫—Ç—ã" –≤ —à–∞–ø–∫–µ –¥–æ–ª–∂–Ω–æ –ø–æ–¥—Å–≤–µ—á–∏–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ —Ä–∞–∑–¥–µ–ª "–∫–æ–Ω—Ç–∞–∫—Ç—ã". –†–∞–∑–¥–µ–ª "–û –∫–æ–º–ø–∞–Ω–∏–∏" –≤ –∫–æ–Ω—Ç–∞–∫–∞—Ç–∞—Ö –Ω–µ –¥–æ–ª–∂–µ–Ω –ø–æ–¥—Å–≤–µ—á–∏–≤–∞—Ç—å—Å—è 

---

**Cursor**

```javascriptreact
import React, { useState, useEffect } from 'react';
import { Outlet, Link, useLocation, useNavigate } from 'react-router-dom';
import { 
  FaTruck, 
  FaPhone, 
  FaEnvelope, 
  FaMapMarkerAlt,
  FaShoppingCart,
  FaSearch,
  FaBars
} from 'react-icons/fa';
import { useCart } from './context/CartContext';
import { useAdminData } from './context/AdminDataContext';
// removed wishlist import
import SearchModal from './components/SearchModal';
import telegramSetup from './utils/telegramSetup';
import debugOrders from './utils/debugOrders';
import './App.css';

function App() {
  const location = useLocation();
  const navigate = useNavigate();
  const { getCartItemsCount } = useCart();
  const { aboutContent } = useAdminData();
  // wishlist removed
  const [isSearchModalOpen, setIsSearchModalOpen] = useState(false);
  const [contactsActive, setContactsActive] = useState(false);
  
  useEffect(() => {
    // –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º, –≤ –∑–æ–Ω–µ –≤–∏–¥–∏–º–æ—Å—Ç–∏ –ª–∏ –±–ª–æ–∫ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ 
    if (!location.pathname.startsWith('/about')) {
      setContactsActive(false);
      return;
    }
    const el = document.getElementById('contacts');
    if (!el) {
      setContactsActive(false);
      return;
    }
    const obs = new IntersectionObserver(
      (entries) => {
        entries.forEach((en) => {
          setContactsActive(en.isIntersecting);
        });
      },
      { threshold: 0.4 }
    );
    obs.observe(el);

    const onHashChange = () => setContactsActive(window.location.hash === '#contacts');
    window.addEventListener('hashchange', onHashChange);
    onHashChange();
    return () => {
      try { obs.disconnect(); } catch {}
      window.removeEventListener('hashchange', onHashChange);
    };
  }, [location.pathname]);
  
  const footerData = aboutContent.footer || {
    aboutSection: {
      title: '–û –∫–æ–º–ø–∞–Ω–∏–∏',
      description: '–ú—ã —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º—Å—è –Ω–∞ –ø–æ—Å—Ç–∞–≤–∫–µ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∑–∞–ø—á–∞—Å—Ç–µ–π –¥–ª—è –≤–µ–∑–¥–µ—Ö–æ–¥–æ–≤ –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ –∏ –º–∞—Ä–æ–∫.'
    },
    contactsSection: {
      title: '–ö–æ–Ω—Ç–∞–∫—Ç—ã',
      phone: '+7 (800) 123-45-67',
      email: 'info@vezdehod-zapchasti.ru',
      address: '–≥. –ú–æ—Å–∫–≤–∞, —É–ª. –ü—Ä–∏–º–µ—Ä–Ω–∞—è, 123'
    },
    informationSection: {
      title: '–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è',
      links: [
        { text: '–î–æ—Å—Ç–∞–≤–∫–∞ –∏ –æ–ø–ª–∞—Ç–∞', url: '/about' },
        { text: '–ì–∞—Ä–∞–Ω—Ç–∏—è', url: '/about' },
        { text: '–í–æ–∑–≤—Ä–∞—Ç —Ç–æ–≤–∞—Ä–∞', url: '/about' },
        { text: '–ü–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏', url: '/about' }
      ]
    },
    copyright: '¬© 2024 –í–µ–∑–¥–µ—Ö–æ–¥–ó–∞–ø—á–∞—Å—Ç–∏. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.'
  };

  const isActiveLink = (path) => {
    if (path === '/' && location.pathname === '/') return true;
    if (path !== '/' && location.pathname.startsWith(path)) return true;
    return false;
  };

  const handleCartClick = () => {
    navigate('/cart');
  };

  const handleSearchClick = () => {
    setIsSearchModalOpen(true);
  };

  const closeSearchModal = () => {
    setIsSearchModalOpen(false);
  };

  // wishlist removed

  return (
    <div className="app">
      <header className="header">
        <div className="container">
          <div className="header-content">
            <Link to="/" className="logo">
              <FaTruck />
              –í–µ–∑–¥–µ—Ö–æ–¥–ó–∞–ø—á–∞—Å—Ç–∏
            </Link>
            <nav className="nav">
              <Link 
                to="/" 
                className={`nav-link ${isActiveLink('/') ? 'active' : ''}`}
              >
                –ì–ª–∞–≤–Ω–∞—è
              </Link>
              <Link 
                to="/catalog" 
                className={`nav-link ${isActiveLink('/catalog') ? 'active' : ''}`}
              >
                –ö–∞—Ç–∞–ª–æ–≥
              </Link>
              <Link 
                to="/promotions" 
                className={`nav-link ${isActiveLink('/promotions') ? 'active' : ''}`}
              >
                –ê–∫—Ü–∏–∏
              </Link>
              <Link 
                to="/about" 
                className={`nav-link ${location.pathname.startsWith('/about') && !contactsActive && location.hash !== '#contacts' ? 'active' : ''}`}
              >
                –û –∫–æ–º–ø–∞–Ω–∏–∏
              </Link>
              <Link
                to="/about#contacts"
                className={`nav-link ${location.pathname.startsWith('/about') && (contactsActive || location.hash === '#contacts') ? 'active' : ''}`}
                onClick={(e) => {
                  e.preventDefault();
                  navigate('/about#contacts');
                  setTimeout(() => {
                    const el = document.getElementById('contacts');
                    if (el) el.scrollIntoView({ behavior: 'smooth' });
                  }, 50);
                }}
              >
                –ö–æ–Ω—Ç–∞–∫—Ç—ã
              </Link>
            </nav>
            <div className="header-actions">
              <button className="icon-button" onClick={handleSearchClick}>
                <FaSearch />
              </button>
              {/* wishlist button removed */}
              <button className="icon-button cart-button" onClick={handleCartClick}>
                <FaShoppingCart />
                {getCartItemsCount() > 0 && (
                  <span className="cart-count">{getCartItemsCount()}</span>
                )}
              </button>
              <button className="mobile-menu-button">
                <FaBars />
              </button>
            </div>
          </div>
        </div>
      </header>

      <main className="main-content">
        <Outlet />
      </main>

      <footer className="footer">
        <div className="container">
          <div className="footer-content">
            <div className="footer-section">
              <h3>{footerData.aboutSection.title}</h3>
              <p>{footerData.aboutSection.description}</p>
            </div>
            <div className="footer-section">
              <h3>{footerData.contactsSection.title}</h3>
              <a href={`tel:${footerData.contactsSection.phone.replace(/[^+\d]/g, '')}`}>
                <FaPhone /> {footerData.contactsSection.phone}
              </a>
              <a href={`mailto:${footerData.contactsSection.email}`}>
                <FaEnvelope /> {footerData.contactsSection.email}
              </a>
              <a href="/about#contacts" onClick={(e)=>{e.preventDefault(); navigate('/about#contacts'); setTimeout(()=>{ const el=document.getElementById('contacts'); if(el) el.scrollIntoView({behavior:'smooth'}); },50);}}>
                <FaMapMarkerAlt /> {footerData.contactsSection.address}
              </a>
            </div>
            <div className="footer-section">
              <h3>{footerData.informationSection.title}</h3>
              {footerData.informationSection.links.map((link, index) => (
                <Link key={index} to={link.url}>{link.text}</Link>
              ))}
            </div>
          </div>
          <div className="footer-bottom">
            <p>{footerData.copyright}</p>
          </div>
        </div>
      </footer>
      
      <SearchModal 
        isOpen={isSearchModalOpen} 
        onClose={closeSearchModal} 
      />
    </div>
  );
}

export default App;

```

–°–¥–µ–ª–∞–ª —Ä–∞–∑–¥–µ–ª—å–Ω—É—é –ø–æ–¥—Å–≤–µ—Ç–∫—É –≤ —à–∞–ø–∫–µ:
- ‚Äú–û –∫–æ–º–ø–∞–Ω–∏–∏‚Äù –∞–∫—Ç–∏–≤–µ–Ω, —Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ –≤—ã –≤ —Ä–∞–∑–¥–µ–ª–µ About –∏ –∫–æ–Ω—Ç–∞–∫—Ç–Ω—ã–π –±–ª–æ–∫ –Ω–µ –≤ –∑–æ–Ω–µ –≤–∏–¥–∏–º–æ—Å—Ç–∏/—Ö–µ—à–∞.
- ‚Äú–ö–æ–Ω—Ç–∞–∫—Ç—ã‚Äù –∞–∫—Ç–∏–≤–µ–Ω, –∫–æ–≥–¥–∞:
  - —Ö–µ—à `#contacts`, –∏–ª–∏
  - –±–ª–æ–∫ `id="contacts"` –≤–∏–¥–µ–Ω –Ω–∞ —ç–∫—Ä–∞–Ω–µ (IntersectionObserver, threshold 0.4).

–ü—Ä–æ–∫—Ä—É—Ç–∫–∞ –ø–æ –∫–ª–∏–∫—É –æ—Å—Ç–∞—ë—Ç—Å—è –ø–ª–∞–≤–Ω–æ–π, –≤ —Ñ—É—Ç–µ—Ä–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –Ω–µ –∏–∑–º–µ–Ω—è–ª–æ—Å—å. –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –Ω–∞ `/about` –∏ –ø—Ä–æ–∫—Ä—É—Ç–∏—Ç–µ ‚Äî –ø–æ–¥—Å–≤–µ—Ç–∫–∞ –±—É–¥–µ—Ç –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç—å—Å—è –º–µ–∂–¥—É –ø—É–Ω–∫—Ç–∞–º–∏.

---

**User**

–ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –Ω–∞ "–ö–æ–Ω—Ç–∞–∫—Ç—ã" –∫–æ–≥–¥–∞ –∫–ª–∏–µ–Ω—Ç –ø—Ä–æ–ª–∏—Å—Ç—ã–≤–∞–µ—Ç –±–ª–æ–∫ "–ö–æ–Ω—Ç–∞–∫—Ç—ã" –¥–æ–ª–∂–Ω–∞ –ø–æ–¥—Å–≤–µ—á–∏–≤–∞—Ç—å –∫–Ω–æ–ø–∫–∞ "–û –∫–æ–º–ø–∞–Ω–∏–∏", –∞ –∫–Ω–æ–ø–∫–∞ "–ö–æ–Ω—Ç–∞–∫—Ç—ã" –ø–µ—Ä–µ—Å—Ç–∞–µ—Ç –ø–æ–¥—Å–≤–µ—á–∏–≤–∞—Ç—å—Å—è. –¢–∞–∫ –∂–µ –µ—Å–ª–∏ –ø–æ—Å–ª–µ –∫–Ω–æ–ø–∫–∏ "–∫–æ–Ω—Ç–∞–∫—Ç—ã" –Ω–∞–∂–∞—Ç—å –Ω–∞ –∫–Ω–æ–ø–∫—É "–û –∫–æ–º–ø–∞–Ω–∏–∏" —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –¥–æ–ª–∂–Ω–∞ –ø—Ä–æ–ª–∏—Å—Ç—ã–≤–∞—Ç—å—Å—è –≤ —Å–∞–º—ã –≤–≤–µ—Ä—Ö —Ä–∞–∑–¥–µ–ª–∞ "–û –∫–æ–º–ø–∞–Ω–∏–∏"

---

**Cursor**

```javascriptreact
import React, { useState, useEffect } from 'react';
import { Outlet, Link, useLocation, useNavigate } from 'react-router-dom';
import { 
  FaTruck, 
  FaPhone, 
  FaEnvelope, 
  FaMapMarkerAlt,
  FaShoppingCart,
  FaSearch,
  FaBars
} from 'react-icons/fa';
import { useCart } from './context/CartContext';
import { useAdminData } from './context/AdminDataContext';
// removed wishlist import
import SearchModal from './components/SearchModal';
import telegramSetup from './utils/telegramSetup';
import debugOrders from './utils/debugOrders';
import './App.css';

function App() {
  const location = useLocation();
  const navigate = useNavigate();
  const { getCartItemsCount } = useCart();
  const { aboutContent } = useAdminData();
  // wishlist removed
  const [isSearchModalOpen, setIsSearchModalOpen] = useState(false);
  const [contactsActive, setContactsActive] = useState(false);
  
  useEffect(() => {
    // –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º, –≤ –∑–æ–Ω–µ –≤–∏–¥–∏–º–æ—Å—Ç–∏ –ª–∏ –±–ª–æ–∫ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ 
    if (!location.pathname.startsWith('/about')) {
      setContactsActive(false);
      return;
    }
    const el = document.getElementById('contacts');
    if (!el) {
      setContactsActive(false);
      return;
    }
    const obs = new IntersectionObserver(
      (entries) => {
        entries.forEach((en) => {
          setContactsActive(en.isIntersecting);
          if (!en.isIntersecting && window.location.hash === '#contacts') {
            // –∫–∞–∫ —Ç–æ–ª—å–∫–æ –≤—ã—à–ª–∏ –∏–∑ –±–ª–æ–∫–∞ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ ‚Äî —É–±–∏—Ä–∞–µ–º hash, —á—Ç–æ–±—ã –ø–æ–¥—Å–≤–µ—Ç–∫–∞ –≤–µ—Ä–Ω—É–ª–∞—Å—å –Ω–∞ "–û –∫–æ–º–ø–∞–Ω–∏–∏"
            history.replaceState(null, '', '/about');
          }
        });
      },
      { threshold: 0.4 }
    );
    obs.observe(el);

    const onHashChange = () => setContactsActive(window.location.hash === '#contacts');
    window.addEventListener('hashchange', onHashChange);
    onHashChange();
    return () => {
      try { obs.disconnect(); } catch {}
      window.removeEventListener('hashchange', onHashChange);
    };
  }, [location.pathname]);
  
  const footerData = aboutContent.footer || {
    aboutSection: {
      title: '–û –∫–æ–º–ø–∞–Ω–∏–∏',
      description: '–ú—ã —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º—Å—è –Ω–∞ –ø–æ—Å—Ç–∞–≤–∫–µ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∑–∞–ø—á–∞—Å—Ç–µ–π –¥–ª—è –≤–µ–∑–¥–µ—Ö–æ–¥–æ–≤ –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ –∏ –º–∞—Ä–æ–∫.'
    },
    contactsSection: {
      title: '–ö–æ–Ω—Ç–∞–∫—Ç—ã',
      phone: '+7 (800) 123-45-67',
      email: 'info@vezdehod-zapchasti.ru',
      address: '–≥. –ú–æ—Å–∫–≤–∞, —É–ª. –ü—Ä–∏–º–µ—Ä–Ω–∞—è, 123'
    },
    informationSection: {
      title: '–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è',
      links: [
        { text: '–î–æ—Å—Ç–∞–≤–∫–∞ –∏ –æ–ø–ª–∞—Ç–∞', url: '/about' },
        { text: '–ì–∞—Ä–∞–Ω—Ç–∏—è', url: '/about' },
        { text: '–í–æ–∑–≤—Ä–∞—Ç —Ç–æ–≤–∞—Ä–∞', url: '/about' },
        { text: '–ü–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏', url: '/about' }
      ]
    },
    copyright: '¬© 2024 –í–µ–∑–¥–µ—Ö–æ–¥–ó–∞–ø—á–∞—Å—Ç–∏. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.'
  };

  const isActiveLink = (path) => {
    if (path === '/' && location.pathname === '/') return true;
    if (path !== '/' && location.pathname.startsWith(path)) return true;
    return false;
  };

  const handleCartClick = () => {
    navigate('/cart');
  };

  const handleSearchClick = () => {
    setIsSearchModalOpen(true);
  };

  const closeSearchModal = () => {
    setIsSearchModalOpen(false);
  };

  // wishlist removed

  return (
    <div className="app">
      <header className="header">
        <div className="container">
          <div className="header-content">
            <Link to="/" className="logo">
              <FaTruck />
              –í–µ–∑–¥–µ—Ö–æ–¥–ó–∞–ø—á–∞—Å—Ç–∏
            </Link>
            <nav className="nav">
              <Link 
                to="/" 
                className={`nav-link ${isActiveLink('/') ? 'active' : ''}`}
              >
                –ì–ª–∞–≤–Ω–∞—è
              </Link>
              <Link 
                to="/catalog" 
                className={`nav-link ${isActiveLink('/catalog') ? 'active' : ''}`}
              >
                –ö–∞—Ç–∞–ª–æ–≥
              </Link>
              <Link 
                to="/promotions" 
                className={`nav-link ${isActiveLink('/promotions') ? 'active' : ''}`}
              >
                –ê–∫—Ü–∏–∏
              </Link>
              <Link 
                to="/about" 
                className={`nav-link ${location.pathname.startsWith('/about') && !contactsActive && location.hash !== '#contacts' ? 'active' : ''}`}
                onClick={(e)=>{
                  e.preventDefault();
                  // –æ—á–∏—â–∞–µ–º —Ö–µ—à –∏ –ø—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –∫ –Ω–∞—á–∞–ª—É —Å—Ç—Ä–∞–Ω–∏—Ü—ã "–û –∫–æ–º–ø–∞–Ω–∏–∏"
                  if (location.pathname.startsWith('/about')) {
                    history.replaceState(null, '', '/about');
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                  } else {
                    navigate('/about');
                    setTimeout(()=> window.scrollTo({ top: 0, behavior: 'smooth' }), 50);
                  }
                }}
              >
                –û –∫–æ–º–ø–∞–Ω–∏–∏
              </Link>
              <Link
                to="/about#contacts"
                className={`nav-link ${location.pathname.startsWith('/about') && (contactsActive || location.hash === '#contacts') ? 'active' : ''}`}
                onClick={(e) => {
                  e.preventDefault();
                  navigate('/about#contacts');
                  setTimeout(() => {
                    const el = document.getElementById('contacts');
                    if (el) el.scrollIntoView({ behavior: 'smooth' });
                  }, 50);
                }}
              >
                –ö–æ–Ω—Ç–∞–∫—Ç—ã
              </Link>
            </nav>
            <div className="header-actions">
              <button className="icon-button" onClick={handleSearchClick}>
                <FaSearch />
              </button>
              {/* wishlist button removed */}
              <button className="icon-button cart-button" onClick={handleCartClick}>
                <FaShoppingCart />
                {getCartItemsCount() > 0 && (
                  <span className="cart-count">{getCartItemsCount()}</span>
                )}
              </button>
              <button className="mobile-menu-button">
                <FaBars />
              </button>
            </div>
          </div>
        </div>
      </header>

      <main className="main-content">
        <Outlet />
      </main>

      <footer className="footer">
        <div className="container">
          <div className="footer-content">
            <div className="footer-section">
              <h3>{footerData.aboutSection.title}</h3>
              <p>{footerData.aboutSection.description}</p>
            </div>
            <div className="footer-section">
              <h3>{footerData.contactsSection.title}</h3>
              <a href={`tel:${footerData.contactsSection.phone.replace(/[^+\d]/g, '')}`}>
                <FaPhone /> {footerData.contactsSection.phone}
              </a>
              <a href={`mailto:${footerData.contactsSection.email}`}>
                <FaEnvelope /> {footerData.contactsSection.email}
              </a>
              <a href="/about#contacts" onClick={(e)=>{e.preventDefault(); navigate('/about#contacts'); setTimeout(()=>{ const el=document.getElementById('contacts'); if(el) el.scrollIntoView({behavior:'smooth'}); },50);}}>
                <FaMapMarkerAlt /> {footerData.contactsSection.address}
              </a>
            </div>
            <div className="footer-section">
              <h3>{footerData.informationSection.title}</h3>
              {footerData.informationSection.links.map((link, index) => (
                <Link key={index} to={link.url}>{link.text}</Link>
              ))}
            </div>
          </div>
          <div className="footer-bottom">
            <p>{footerData.copyright}</p>
          </div>
        </div>
      </footer>
      
      <SearchModal 
        isOpen={isSearchModalOpen} 
        onClose={closeSearchModal} 
      />
    </div>
  );
}

export default App;

```

–ì–æ—Ç–æ–≤–æ:
- –ö–æ–≥–¥–∞ –ø—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ—Ç–µ –Ω–∏–∂–µ –±–ª–æ–∫–∞ ‚Äú–ö–æ–Ω—Ç–∞–∫—Ç—ã‚Äù, –ø–æ–¥—Å–≤–µ—Ç–∫–∞ ‚Äú–ö–æ–Ω—Ç–∞–∫—Ç—ã‚Äù –≥–∞—Å–Ω–µ—Ç –∏ –≤–∫–ª—é—á–∞–µ—Ç—Å—è ‚Äú–û –∫–æ–º–ø–∞–Ω–∏–∏‚Äù.
- –ü—Ä–∏ –∫–ª–∏–∫–µ ‚Äú–û –∫–æ–º–ø–∞–Ω–∏–∏‚Äù –ø–æ—Å–ª–µ ‚Äú–ö–æ–Ω—Ç–∞–∫—Ç–æ–≤‚Äù –æ—á–∏—â–∞—é —Ö–µ—à –∏ –ø–ª–∞–≤–Ω–æ –ø—Ä–æ–∫—Ä—É—á–∏–≤–∞—é –≤ —Å–∞–º—ã–π –≤–µ—Ä—Ö —Å—Ç—Ä–∞–Ω–∏—Ü—ã ‚Äú–û –∫–æ–º–ø–∞–Ω–∏–∏‚Äù.
- –ü—Ä–∏ –∫–ª–∏–∫–µ ‚Äú–ö–æ–Ω—Ç–∞–∫—Ç—ã‚Äù –≤—Å–µ–≥–¥–∞ –ø–ª–∞–≤–Ω–æ –ø—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ—Ç –∫ –±–ª–æ–∫—É.

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ ‚Äî –¥–æ–±–∞–≤–ª—é —Ç–∞–∫—É—é –∂–µ –ª–æ–≥–∏–∫—É –¥–ª—è –º–æ–±–∏–ª—å–Ω–æ–≥–æ –º–µ–Ω—é.

---

**User**

–ü–æ—Å–ª–µ –Ω–∞–∂–∞—Ç–∏—è –Ω–∞ "–ö–æ–Ω—Ç–∞–∫—Ç—ã" —è –Ω–∞–∂–∏–º–∞—é –Ω–∞ "–û –∫–æ–º–ø–∞–Ω–∏–∏" –∏ —É –º–µ–Ω—è –≤—Å—ë –µ—â–µ –ø–æ–¥—Å–≤–µ—á–∏–≤–∞–µ—Ç—Å—è –∫–Ω–æ–ø–∫–∞ "–ö–æ–Ω—Ç–∞–∫—Ç—ã", –∞ –¥–æ–ª–∂–Ω–∞ –ø–æ–¥—Å–≤–µ—á–∏–≤–∞—Ç—å—Å—è —Ç–æ–ª—å–∫–æ "–û –∫–æ–º–ø–∞–Ω–∏–∏" 

---

**Cursor**

```javascriptreact
import React, { useState, useEffect } from 'react';
import { Outlet, Link, useLocation, useNavigate } from 'react-router-dom';
import { 
  FaTruck, 
  FaPhone, 
  FaEnvelope, 
  FaMapMarkerAlt,
  FaShoppingCart,
  FaSearch,
  FaBars
} from 'react-icons/fa';
import { useCart } from './context/CartContext';
import { useAdminData } from './context/AdminDataContext';
// removed wishlist import
import SearchModal from './components/SearchModal';
import telegramSetup from './utils/telegramSetup';
import debugOrders from './utils/debugOrders';
import './App.css';

function App() {
  const location = useLocation();
  const navigate = useNavigate();
  const { getCartItemsCount } = useCart();
  const { aboutContent } = useAdminData();
  // wishlist removed
  const [isSearchModalOpen, setIsSearchModalOpen] = useState(false);
  const [contactsActive, setContactsActive] = useState(false);
  
  useEffect(() => {
    // –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º, –≤ –∑–æ–Ω–µ –≤–∏–¥–∏–º–æ—Å—Ç–∏ –ª–∏ –±–ª–æ–∫ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ 
    if (!location.pathname.startsWith('/about')) {
      setContactsActive(false);
      return;
    }
    const el = document.getElementById('contacts');
    if (!el) {
      setContactsActive(false);
      return;
    }
    const obs = new IntersectionObserver(
      (entries) => {
        entries.forEach((en) => {
          setContactsActive(en.isIntersecting);
          if (!en.isIntersecting && window.location.hash === '#contacts') {
            // –∫–∞–∫ —Ç–æ–ª—å–∫–æ –≤—ã—à–ª–∏ –∏–∑ –±–ª–æ–∫–∞ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ ‚Äî —É–±–∏—Ä–∞–µ–º hash, —á—Ç–æ–±—ã –ø–æ–¥—Å–≤–µ—Ç–∫–∞ –≤–µ—Ä–Ω—É–ª–∞—Å—å –Ω–∞ "–û –∫–æ–º–ø–∞–Ω–∏–∏"
            history.replaceState(null, '', '/about');
          }
        });
      },
      { threshold: 0.4 }
    );
    obs.observe(el);

    const onHashChange = () => setContactsActive(window.location.hash === '#contacts');
    window.addEventListener('hashchange', onHashChange);
    onHashChange();
    return () => {
      try { obs.disconnect(); } catch {}
      window.removeEventListener('hashchange', onHashChange);
    };
  }, [location.pathname]);
  
  const footerData = aboutContent.footer || {
    aboutSection: {
      title: '–û –∫–æ–º–ø–∞–Ω–∏–∏',
      description: '–ú—ã —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º—Å—è –Ω–∞ –ø–æ—Å—Ç–∞–≤–∫–µ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∑–∞–ø—á–∞—Å—Ç–µ–π –¥–ª—è –≤–µ–∑–¥–µ—Ö–æ–¥–æ–≤ –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ –∏ –º–∞—Ä–æ–∫.'
    },
    contactsSection: {
      title: '–ö–æ–Ω—Ç–∞–∫—Ç—ã',
      phone: '+7 (800) 123-45-67',
      email: 'info@vezdehod-zapchasti.ru',
      address: '–≥. –ú–æ—Å–∫–≤–∞, —É–ª. –ü—Ä–∏–º–µ—Ä–Ω–∞—è, 123'
    },
    informationSection: {
      title: '–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è',
      links: [
        { text: '–î–æ—Å—Ç–∞–≤–∫–∞ –∏ –æ–ø–ª–∞—Ç–∞', url: '/about' },
        { text: '–ì–∞—Ä–∞–Ω—Ç–∏—è', url: '/about' },
        { text: '–í–æ–∑–≤—Ä–∞—Ç —Ç–æ–≤–∞—Ä–∞', url: '/about' },
        { text: '–ü–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏', url: '/about' }
      ]
    },
    copyright: '¬© 2024 –í–µ–∑–¥–µ—Ö–æ–¥–ó–∞–ø—á–∞—Å—Ç–∏. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.'
  };

  const isActiveLink = (path) => {
    if (path === '/' && location.pathname === '/') return true;
    if (path !== '/' && location.pathname.startsWith(path)) return true;
    return false;
  };

  const handleCartClick = () => {
    navigate('/cart');
  };

  const handleSearchClick = () => {
    setIsSearchModalOpen(true);
  };

  const closeSearchModal = () => {
    setIsSearchModalOpen(false);
  };

  // wishlist removed

  return (
    <div className="app">
      <header className="header">
        <div className="container">
          <div className="header-content">
            <Link to="/" className="logo">
              <FaTruck />
              –í–µ–∑–¥–µ—Ö–æ–¥–ó–∞–ø—á–∞—Å—Ç–∏
            </Link>
            <nav className="nav">
              <Link 
                to="/" 
                className={`nav-link ${isActiveLink('/') ? 'active' : ''}`}
              >
                –ì–ª–∞–≤–Ω–∞—è
              </Link>
              <Link 
                to="/catalog" 
                className={`nav-link ${isActiveLink('/catalog') ? 'active' : ''}`}
              >
                –ö–∞—Ç–∞–ª–æ–≥
              </Link>
              <Link 
                to="/promotions" 
                className={`nav-link ${isActiveLink('/promotions') ? 'active' : ''}`}
              >
                –ê–∫—Ü–∏–∏
              </Link>
              <Link 
                to="/about" 
                className={`nav-link ${location.pathname.startsWith('/about') && !contactsActive && location.hash !== '#contacts' ? 'active' : ''}`}
                onClick={(e)=>{
                  e.preventDefault();
                  // –æ—á–∏—â–∞–µ–º —Ö–µ—à –∏ –ø—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –∫ –Ω–∞—á–∞–ª—É —Å—Ç—Ä–∞–Ω–∏—Ü—ã "–û –∫–æ–º–ø–∞–Ω–∏–∏"
                  if (location.pathname.startsWith('/about')) {
                    history.replaceState(null, '', '/about');
                    setContactsActive(false);
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                  } else {
                    navigate('/about');
                    setContactsActive(false);
                    setTimeout(()=> window.scrollTo({ top: 0, behavior: 'smooth' }), 50);
                  }
                }}
              >
                –û –∫–æ–º–ø–∞–Ω–∏–∏
              </Link>
              <Link
                to="/about#contacts"
                className={`nav-link ${location.pathname.startsWith('/about') && (contactsActive || location.hash === '#contacts') ? 'active' : ''}`}
                onClick={(e) => {
                  e.preventDefault();
                  navigate('/about#contacts');
                  setTimeout(() => {
                    const el = document.getElementById('contacts');
                    if (el) el.scrollIntoView({ behavior: 'smooth' });
                  }, 50);
                }}
              >
                –ö–æ–Ω—Ç–∞–∫—Ç—ã
              </Link>
            </nav>
            <div className="header-actions">
              <button className="icon-button" onClick={handleSearchClick}>
                <FaSearch />
              </button>
              {/* wishlist button removed */}
              <button className="icon-button cart-button" onClick={handleCartClick}>
                <FaShoppingCart />
                {getCartItemsCount() > 0 && (
                  <span className="cart-count">{getCartItemsCount()}</span>
                )}
              </button>
              <button className="mobile-menu-button">
                <FaBars />
              </button>
            </div>
          </div>
        </div>
      </header>

      <main className="main-content">
        <Outlet />
      </main>

      <footer className="footer">
        <div className="container">
          <div className="footer-content">
            <div className="footer-section">
              <h3>{footerData.aboutSection.title}</h3>
              <p>{footerData.aboutSection.description}</p>
            </div>
            <div className="footer-section">
              <h3>{footerData.contactsSection.title}</h3>
              <a href={`tel:${footerData.contactsSection.phone.replace(/[^+\d]/g, '')}`}>
                <FaPhone /> {footerData.contactsSection.phone}
              </a>
              <a href={`mailto:${footerData.contactsSection.email}`}>
                <FaEnvelope /> {footerData.contactsSection.email}
              </a>
              <a href="/about#contacts" onClick={(e)=>{e.preventDefault(); navigate('/about#contacts'); setTimeout(()=>{ const el=document.getElementById('contacts'); if(el) el.scrollIntoView({behavior:'smooth'}); },50);}}>
                <FaMapMarkerAlt /> {footerData.contactsSection.address}
              </a>
            </div>
            <div className="footer-section">
              <h3>{footerData.informationSection.title}</h3>
              {footerData.informationSection.links.map((link, index) => (
                <Link key={index} to={link.url}>{link.text}</Link>
              ))}
            </div>
          </div>
          <div className="footer-bottom">
            <p>{footerData.copyright}</p>
          </div>
        </div>
      </footer>
      
      <SearchModal 
        isOpen={isSearchModalOpen} 
        onClose={closeSearchModal} 
      />
    </div>
  );
}

export default App;

```

–ò—Å–ø—Ä–∞–≤–∏–ª –ø–æ–¥—Å–≤–µ—Ç–∫—É:
- –ü—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ ‚Äú–û –∫–æ–º–ø–∞–Ω–∏–∏‚Äù —Ç–µ–ø–µ—Ä—å –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —Å–±—Ä–∞—Å—ã–≤–∞—é —Å–æ—Å—Ç–æ—è–Ω–∏–µ `contactsActive` –≤ false –∏ —É–±–∏—Ä–∞—é hash, –∑–∞—Ç–µ–º —Å–∫—Ä–æ–ª–ª—é –≤ –Ω–∞—á–∞–ª–æ. –ü–æ—ç—Ç–æ–º—É –∞–∫—Ç–∏–≤–Ω–æ–π –æ—Å—Ç–∞—ë—Ç—Å—è —Ç–æ–ª—å–∫–æ ‚Äú–û –∫–æ–º–ø–∞–Ω–∏–∏‚Äù.

–û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å: –ö–æ–Ω—Ç–∞–∫—Ç—ã ‚Üí –û –∫–æ–º–ø–∞–Ω–∏–∏ ‚Äî –ø–æ–¥—Å–≤–µ—Ç–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è.

---

**User**

–ù–∏—á–µ–≥–æ –Ω–µ –ø–æ–º–µ–Ω—è–ª–æ—Å—å, —Ç–∞–∫ –∂–µ –ø–æ–¥—Å–≤–µ—á–∏–≤–∞–µ—Ç—Å—è –ö–æ–Ω—Ç–∞–∫—Ç—ã –ø–æ—Å–ª–µ –Ω–∞–∂–∞—Ç–∏—è –Ω–∞ –û –∫–æ–º–ø–∞–Ω–∏–∏ 

---

**Cursor**

```javascriptreact
import React, { useState, useEffect } from 'react';
import { Outlet, Link, useLocation, useNavigate } from 'react-router-dom';
import { 
  FaTruck, 
  FaPhone, 
  FaEnvelope, 
  FaMapMarkerAlt,
  FaShoppingCart,
  FaSearch,
  FaBars
} from 'react-icons/fa';
import { useCart } from './context/CartContext';
import { useAdminData } from './context/AdminDataContext';
// removed wishlist import
import SearchModal from './components/SearchModal';
import telegramSetup from './utils/telegramSetup';
import debugOrders from './utils/debugOrders';
import './App.css';

function App() {
  const location = useLocation();
  const navigate = useNavigate();
  const { getCartItemsCount } = useCart();
  const { aboutContent } = useAdminData();
  // wishlist removed
  const [isSearchModalOpen, setIsSearchModalOpen] = useState(false);
  const [contactsActive, setContactsActive] = useState(false);
  
  useEffect(() => {
    // –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º, –≤ –∑–æ–Ω–µ –≤–∏–¥–∏–º–æ—Å—Ç–∏ –ª–∏ –±–ª–æ–∫ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ 
    if (!location.pathname.startsWith('/about')) {
      setContactsActive(false);
      return;
    }
    const el = document.getElementById('contacts');
    if (!el) {
      setContactsActive(false);
      return;
    }
    const obs = new IntersectionObserver(
      (entries) => {
        entries.forEach((en) => {
          setContactsActive(en.isIntersecting);
          if (!en.isIntersecting && window.location.hash === '#contacts') {
            // –≤—ã—à–ª–∏ –∏–∑ –±–ª–æ–∫–∞ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ ‚Äî —É–±–∏—Ä–∞–µ–º hash —á–µ—Ä–µ–∑ —Ä–æ—É—Ç–µ—Ä
            try { navigate('/about', { replace: true }); } catch {}
          }
        });
      },
      { threshold: 0.4 }
    );
    obs.observe(el);

    const onHashChange = () => setContactsActive(window.location.hash === '#contacts');
    window.addEventListener('hashchange', onHashChange);
    onHashChange();
    return () => {
      try { obs.disconnect(); } catch {}
      window.removeEventListener('hashchange', onHashChange);
    };
  }, [location.pathname, navigate]);
  
  const footerData = aboutContent.footer || {
    aboutSection: {
      title: '–û –∫–æ–º–ø–∞–Ω–∏–∏',
      description: '–ú—ã —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º—Å—è –Ω–∞ –ø–æ—Å—Ç–∞–≤–∫–µ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∑–∞–ø—á–∞—Å—Ç–µ–π –¥–ª—è –≤–µ–∑–¥–µ—Ö–æ–¥–æ–≤ –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ –∏ –º–∞—Ä–æ–∫.'
    },
    contactsSection: {
      title: '–ö–æ–Ω—Ç–∞–∫—Ç—ã',
      phone: '+7 (800) 123-45-67',
      email: 'info@vezdehod-zapchasti.ru',
      address: '–≥. –ú–æ—Å–∫–≤–∞, —É–ª. –ü—Ä–∏–º–µ—Ä–Ω–∞—è, 123'
    },
    informationSection: {
      title: '–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è',
      links: [
        { text: '–î–æ—Å—Ç–∞–≤–∫–∞ –∏ –æ–ø–ª–∞—Ç–∞', url: '/about' },
        { text: '–ì–∞—Ä–∞–Ω—Ç–∏—è', url: '/about' },
        { text: '–í–æ–∑–≤—Ä–∞—Ç —Ç–æ–≤–∞—Ä–∞', url: '/about' },
        { text: '–ü–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏', url: '/about' }
      ]
    },
    copyright: '¬© 2024 –í–µ–∑–¥–µ—Ö–æ–¥–ó–∞–ø—á–∞—Å—Ç–∏. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.'
  };

  const isActiveLink = (path) => {
    if (path === '/' && location.pathname === '/') return true;
    if (path !== '/' && location.pathname.startsWith(path)) return true;
    return false;
  };

  const handleCartClick = () => {
    navigate('/cart');
  };

  const handleSearchClick = () => {
    setIsSearchModalOpen(true);
  };

  const closeSearchModal = () => {
    setIsSearchModalOpen(false);
  };

  // wishlist removed

  return (
    <div className="app">
      <header className="header">
        <div className="container">
          <div className="header-content">
            <Link to="/" className="logo">
              <FaTruck />
              –í–µ–∑–¥–µ—Ö–æ–¥–ó–∞–ø—á–∞—Å—Ç–∏
            </Link>
            <nav className="nav">
              <Link 
                to="/" 
                className={`nav-link ${isActiveLink('/') ? 'active' : ''}`}
              >
                –ì–ª–∞–≤–Ω–∞—è
              </Link>
              <Link 
                to="/catalog" 
                className={`nav-link ${isActiveLink('/catalog') ? 'active' : ''}`}
              >
                –ö–∞—Ç–∞–ª–æ–≥
              </Link>
              <Link 
                to="/promotions" 
                className={`nav-link ${isActiveLink('/promotions') ? 'active' : ''}`}
              >
                –ê–∫—Ü–∏–∏
              </Link>
              <Link 
                to="/about" 
                className={`nav-link ${location.pathname.startsWith('/about') && !contactsActive && location.hash !== '#contacts' ? 'active' : ''}`}
                onClick={(e)=>{
                  e.preventDefault();
                  setContactsActive(false);
                  if (location.pathname.startsWith('/about')) {
                    navigate('/about', { replace: true });
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                  } else {
                    navigate('/about');
                    setTimeout(()=> window.scrollTo({ top: 0, behavior: 'smooth' }), 50);
                  }
                }}
              >
                –û –∫–æ–º–ø–∞–Ω–∏–∏
              </Link>
              <Link
                to="/about#contacts"
                className={`nav-link ${location.pathname.startsWith('/about') && (contactsActive || location.hash === '#contacts') ? 'active' : ''}`}
                onClick={(e) => {
                  e.preventDefault();
                  navigate('/about#contacts');
                  setTimeout(() => {
                    const el = document.getElementById('contacts');
                    if (el) el.scrollIntoView({ behavior: 'smooth' });
                  }, 50);
                }}
              >
                –ö–æ–Ω—Ç–∞–∫—Ç—ã
              </Link>
            </nav>
            <div className="header-actions">
              <button className="icon-button" onClick={handleSearchClick}>
                <FaSearch />
              </button>
              {/* wishlist button removed */}
              <button className="icon-button cart-button" onClick={handleCartClick}>
                <FaShoppingCart />
                {getCartItemsCount() > 0 && (
                  <span className="cart-count">{getCartItemsCount()}</span>
                )}
              </button>
              <button className="mobile-menu-button">
                <FaBars />
              </button>
            </div>
          </div>
        </div>
      </header>

      <main className="main-content">
        <Outlet />
      </main>

      <footer className="footer">
        <div className="container">
          <div className="footer-content">
            <div className="footer-section">
              <h3>{footerData.aboutSection.title}</h3>
              <p>{footerData.aboutSection.description}</p>
            </div>
            <div className="footer-section">
              <h3>{footerData.contactsSection.title}</h3>
              <a href={`tel:${footerData.contactsSection.phone.replace(/[^+\d]/g, '')}`}>
                <FaPhone /> {footerData.contactsSection.phone}
              </a>
              <a href={`mailto:${footerData.contactsSection.email}`}>
                <FaEnvelope /> {footerData.contactsSection.email}
              </a>
              <a href="/about#contacts" onClick={(e)=>{e.preventDefault(); navigate('/about#contacts'); setTimeout(()=>{ const el=document.getElementById('contacts'); if(el) el.scrollIntoView({behavior:'smooth'}); },50);}}>
                <FaMapMarkerAlt /> {footerData.contactsSection.address}
              </a>
            </div>
            <div className="footer-section">
              <h3>{footerData.informationSection.title}</h3>
              {footerData.informationSection.links.map((link, index) => (
                <Link key={index} to={link.url}>{link.text}</Link>
              ))}
            </div>
          </div>
          <div className="footer-bottom">
            <p>{footerData.copyright}</p>
          </div>
        </div>
      </footer>
      
      <SearchModal 
        isOpen={isSearchModalOpen} 
        onClose={closeSearchModal} 
      />
    </div>
  );
}

export default App;

```

–ò—Å–ø—Ä–∞–≤–∏–ª –ª–æ–≥–∏–∫—É:
- –ü—Ä–∏ –≤—ã—Ö–æ–¥–µ –∏–∑ –∑–æ–Ω—ã ‚Äú–ö–æ–Ω—Ç–∞–∫—Ç—ã‚Äù —É–¥–∞–ª—è—é —Ö–µ—à —á–µ—Ä–µ–∑ navigate('/about', { replace: true }), —á—Ç–æ–±—ã ‚Äú–û –∫–æ–º–ø–∞–Ω–∏–∏‚Äù —Å—Ç–∞–Ω–æ–≤–∏–ª—Å—è –∞–∫—Ç–∏–≤–Ω—ã–º.
- –ü—Ä–∏ –∫–ª–∏–∫–µ ‚Äú–û –∫–æ–º–ø–∞–Ω–∏–∏‚Äù —Ç–æ–∂–µ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –¥–µ–ª–∞—é navigate('/about', { replace: true }) –∏ —Å–±—Ä–∞—Å—ã–≤–∞—é contactsActive = false, –∑–∞—Ç–µ–º –ø—Ä–æ–∫—Ä—É—á–∏–≤–∞—é –Ω–∞–≤–µ—Ä—Ö.

–û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ: –ö–æ–Ω—Ç–∞–∫—Ç—ã ‚Üí –û –∫–æ–º–ø–∞–Ω–∏–∏ ‚Äî –ø–æ–¥—Å–≤–µ—Ç–∫–∞ —É—Ö–æ–¥–∏—Ç —Å ‚Äú–ö–æ–Ω—Ç–∞–∫—Ç—ã‚Äù –∏ –æ—Å—Ç–∞—ë—Ç—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞ ‚Äú–û –∫–æ–º–ø–∞–Ω–∏–∏‚Äù.

---

**User**

–û—Ç–ª–∏—á–Ω–æ. –í–µ–∑–¥–µ –≥–¥–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ —Ç–æ–≤–∞—Ä–∞, –ø—Ä–æ–≤–µ—Ä—å –∏ –∏—Å–ø—Ä–∞–≤—å —á—Ç–æ–±—ã –æ—Ç–æ–±—Ä–∞–∂–∞–ª–∞—Å—å —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏, –∞ –Ω–µ —Å—Å—ã–ª–∫–∞

---

**Cursor**

```javascriptreact
import React, { useState, useEffect } from 'react';
import { useNavigate, Link } from 'react-router-dom';
import { useAdminData } from '../../context/AdminDataContext';
import ProductManagement from './ProductManagement';
import PromotionManagement from './PromotionManagement';
import ContentManagement from './ContentManagement';
import PopularProductsManagement from './PopularProductsManagement';
import OrderManagement from './OrderManagement';
import { migrateProductImages, getMainImage } from '../../utils/imageHelpers';
import { FaHome, FaBox, FaTags, FaUsers, FaChartBar, FaSignOutAlt, FaEdit, FaStar, FaShoppingCart } from 'react-icons/fa';
import './AdvancedAdminDashboard.css';

function AdvancedAdminDashboard() {
  const navigate = useNavigate();
  const { products, promotions } = useAdminData();
  const [activeSection, setActiveSection] = useState('overview');

  useEffect(() => {
    const isAuth = localStorage.getItem('adminAuth');
    if (!isAuth) {
      navigate('/admin');
    }
  }, [navigate]);

  const handleLogout = () => {
    localStorage.removeItem('adminAuth');
    navigate('/admin');
  };

  const menuItems = [
    { id: 'overview', label: '–û–±–∑–æ—Ä', icon: <FaChartBar /> },
    { id: 'products', label: '–¢–æ–≤–∞—Ä—ã', icon: <FaBox /> },
    { id: 'popular', label: '–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã', icon: <FaStar /> },
    { id: 'promotions', label: '–ê–∫—Ü–∏–∏', icon: <FaTags /> },
    { id: 'orders', label: '–ó–∞–∫–∞–∑—ã', icon: <FaShoppingCart /> },
    { id: 'content', label: '–ö–æ–Ω—Ç–µ–Ω—Ç', icon: <FaEdit /> }
  ];

  const renderOverview = () => (
    <div className="overview-section">
      <h2>–û–±–∑–æ—Ä —Å–∏—Å—Ç–µ–º—ã</h2>
      
      <div className="stats-grid">
        <div className="stat-card">
          <div className="stat-icon">üì¶</div>
          <div className="stat-content">
            <div className="stat-number">{products.length}</div>
            <div className="stat-label">–¢–æ–≤–∞—Ä–æ–≤</div>
          </div>
        </div>
        
        <div className="stat-card">
          <div className="stat-icon">üéØ</div>
          <div className="stat-content">
            <div className="stat-number">{promotions.length}</div>
            <div className="stat-label">–ê–∫—Ü–∏–π</div>
          </div>
        </div>
        
        <div className="stat-card">
          <div className="stat-icon">‚úÖ</div>
          <div className="stat-content">
            <div className="stat-number">{products.filter(p => p.available).length}</div>
            <div className="stat-label">–í –Ω–∞–ª–∏—á–∏–∏</div>
          </div>
        </div>
        
        <div className="stat-card">
          <div className="stat-icon">üí∞</div>
          <div className="stat-content">
            <div className="stat-number">{Math.round(products.reduce((sum, p) => sum + (p.price * (p.quantity || 0)), 0) / 1000)}–ö</div>
            <div className="stat-label">–û–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å —Å–∫–ª–∞–¥–∞</div>
          </div>
        </div>
      </div>

      <div className="recent-section">
        <h3>–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã</h3>
        <div className="product-list">
          {products && products.length > 0 ? products.slice(0, 5).map(product => (
            <div key={product.id} className="product-item">
              {(() => {
                const migratedProduct = migrateProductImages(product);
                const mainImage = getMainImage(migratedProduct);
                
                if (mainImage?.data) {
                  if (
                    typeof mainImage.data === 'string' &&
                    (mainImage.data.startsWith('data:image') || mainImage.data.startsWith('/uploads/') || mainImage.data.startsWith('http'))
                  ) {
                    return <img src={mainImage.data} alt={product.title} className="product-image-small" />;
                  }
                  return <span className="product-icon">{mainImage.data}</span>;
                }
                return <span className="product-icon">üì¶</span>;
              })()}
              <div className="product-info">
                <div className="product-name">{product.title}</div>
                <div className="product-price">{product.price.toLocaleString()} ‚ÇΩ</div>
                <div className="product-quantity">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ: {product.quantity || 0} —à—Ç.</div>
              </div>
              <div className={`product-status ${product.available ? 'available' : 'unavailable'}`}>
                {product.available ? '–í –Ω–∞–ª–∏—á–∏–∏' : '–ù–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏'}
              </div>
            </div>
          )) : (
            <div className="no-products">
              <p>–¢–æ–≤–∞—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã. <Link to="#" onClick={() => setActiveSection('products')}>–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä—ã</Link></p>
            </div>
          )}
        </div>
      </div>
    </div>
  );

  const renderContent = () => {
    switch (activeSection) {
      case 'overview':
        return renderOverview();
      case 'products':
        return <ProductManagement />;
      case 'popular':
        return <PopularProductsManagement />;
      case 'promotions':
        return <PromotionManagement />;
      case 'orders':
        return <OrderManagement />;
      case 'content':
        return <ContentManagement />;
      default:
        return renderOverview();
    }
  };

  return (
    <div className="admin-dashboard">
      <aside className="admin-sidebar">
        <div className="sidebar-header">
          <h2>–í–µ–∑–¥–µ—Ö–æ–¥–ó–∞–ø—á–∞—Å—Ç–∏</h2>
          <p>–ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å</p>
        </div>
        
        <nav className="sidebar-nav">
          {menuItems.map(item => (
            <button
              key={item.id}
              className={`nav-item ${activeSection === item.id ? 'active' : ''}`}
              onClick={() => setActiveSection(item.id)}
            >
              {item.icon}
              <span>{item.label}</span>
            </button>
          ))}
        </nav>
        
        <div className="sidebar-footer">
          <Link to="/" className="nav-item">
            <FaHome />
            <span>–ù–∞ —Å–∞–π—Ç</span>
          </Link>
          <button onClick={handleLogout} className="nav-item logout">
            <FaSignOutAlt />
            <span>–í—ã–π—Ç–∏</span>
          </button>
        </div>
      </aside>

      <main className="admin-main">
        <header className="admin-header">
          <h1>
            {menuItems.find(item => item.id === activeSection)?.label || '–û–±–∑–æ—Ä'}
          </h1>
          <div className="header-actions">
            <span>–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</span>
          </div>
        </header>
        
        <div className="admin-content">
          {renderContent()}
        </div>
      </main>
    </div>
  );
}

export default AdvancedAdminDashboard;
```

```javascriptreact
import React, { useState } from 'react';
import { useAdminData } from '../../context/AdminDataContext';
import { FaSave, FaPlus, FaTimes, FaArrowUp, FaArrowDown } from 'react-icons/fa';
import { getMainImage } from '../../utils/imageHelpers';
import './PopularProductsManagement.css';

export default function PopularProductsManagement() {
  const { products, popularProductIds, updatePopularProducts } = useAdminData();
  const [selectedIds, setSelectedIds] = useState([...popularProductIds]);
  const [availableProducts] = useState(products.filter(p => !popularProductIds.includes(p.id)));

  const handleAddProduct = (productId) => {
    if (!selectedIds.includes(productId) && selectedIds.length < 6) {
      setSelectedIds([...selectedIds, productId]);
    }
  };

  const handleRemoveProduct = (productId) => {
    setSelectedIds(selectedIds.filter(id => id !== productId));
  };

  const handleMoveUp = (index) => {
    if (index > 0) {
      const newIds = [...selectedIds];
      [newIds[index - 1], newIds[index]] = [newIds[index], newIds[index - 1]];
      setSelectedIds(newIds);
    }
  };

  const handleMoveDown = (index) => {
    if (index < selectedIds.length - 1) {
      const newIds = [...selectedIds];
      [newIds[index], newIds[index + 1]] = [newIds[index + 1], newIds[index]];
      setSelectedIds(newIds);
    }
  };

  const handleSave = () => {
    updatePopularProducts(selectedIds);
    alert('–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã!');
  };

  const getProductById = (id) => products.find(p => p.id === id);

  return (
    <div className="popular-products-management">
      <div className="management-header">
        <h2>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ø—É–ª—è—Ä–Ω—ã–º–∏ —Ç–æ–≤–∞—Ä–∞–º–∏</h2>
        <button onClick={handleSave} className="btn-primary">
          <FaSave /> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
        </button>
      </div>

      <div className="management-content">
        <div className="selected-products">
          <h3>–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã (–º–∞–∫—Å–∏–º—É–º 6)</h3>
          <div className="products-list">
            {selectedIds.map((id, index) => {
              const product = getProductById(id);
              if (!product) return null;
              
              return (
                <div key={id} className="product-item selected">
                  <div className="product-image">
                    {(() => {
                      const d = getMainImage(product)?.data;
                      if (d && typeof d === 'string' && (d.startsWith('data:image') || d.startsWith('/uploads/') || d.startsWith('http'))) {
                        return <img src={d} alt={product.title} />;
                      }
                      return <span className="product-icon">{d || 'üì¶'}</span>;
                    })()}
                  </div>
                  <div className="product-info">
                    <h4>{product.title}</h4>
                    <p>{product.price.toLocaleString()} ‚ÇΩ</p>
                    <span className="product-category">{product.category}</span>
                  </div>
                  <div className="product-actions">
                    <button 
                      onClick={() => handleMoveUp(index)}
                      disabled={index === 0}
                      className="btn-move"
                      title="–ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å –≤–≤–µ—Ä—Ö"
                    >
                      <FaArrowUp />
                    </button>
                    <button 
                      onClick={() => handleMoveDown(index)}
                      disabled={index === selectedIds.length - 1}
                      className="btn-move"
                      title="–ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å –≤–Ω–∏–∑"
                    >
                      <FaArrowDown />
                    </button>
                    <button 
                      onClick={() => handleRemoveProduct(id)}
                      className="btn-remove"
                      title="–£–¥–∞–ª–∏—Ç—å –∏–∑ –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö"
                    >
                      <FaTimes />
                    </button>
                  </div>
                </div>
              );
            })}
          </div>
          {selectedIds.length === 0 && (
            <p className="empty-message">–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã –Ω–µ –≤—ã–±—Ä–∞–Ω—ã</p>
          )}
        </div>

        <div className="available-products">
          <h3>–î–æ—Å—Ç—É–ø–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã</h3>
          <div className="products-list">
            {products
              .filter(product => !selectedIds.includes(product.id))
              .map(product => (
                <div key={product.id} className="product-item available">
                  <div className="product-image">
                    {(() => {
                      const d = getMainImage(product)?.data;
                      if (d && typeof d === 'string' && (d.startsWith('data:image') || d.startsWith('/uploads/') || d.startsWith('http'))) {
                        return <img src={d} alt={product.title} />;
                      }
                      return <span className="product-icon">{d || 'üì¶'}</span>;
                    })()}
                  </div>
                  <div className="product-info">
                    <h4>{product.title}</h4>
                    <p>{product.price.toLocaleString()} ‚ÇΩ</p>
                    <span className="product-category">{product.category}</span>
                  </div>
                  <div className="product-actions">
                    <button 
                      onClick={() => handleAddProduct(product.id)}
                      disabled={selectedIds.length >= 6}
                      className="btn-add"
                      title="–î–æ–±–∞–≤–∏—Ç—å –≤ –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ"
                    >
                      <FaPlus />
                    </button>
                  </div>
                </div>
              ))
            }
          </div>
        </div>
      </div>

      <div className="info-panel">
        <h4>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:</h4>
        <ul>
          <li>–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ</li>
          <li>–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ: 6 —Ç–æ–≤–∞—Ä–æ–≤</li>
          <li>–ü–æ—Ä—è–¥–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤ –º–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å —Å—Ç—Ä–µ–ª–∫–∞–º–∏</li>
          <li>–ò–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –Ω–∞–∂–∞—Ç–∏—è "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å"</li>
        </ul>
      </div>
    </div>
  );
}

```

```javascriptreact
import React, { useState, useMemo } from 'react';
import { Link, useNavigate } from 'react-router-dom';
import { motion, AnimatePresence } from 'framer-motion';
import { FaTrash, FaMinus, FaPlus, FaShoppingCart, FaArrowLeft, FaPercent, FaTags } from 'react-icons/fa';
import { useCart } from '../context/CartContext';
import { useAdminData } from '../context/AdminDataContext';
import { useOrders } from '../context/OrdersContext';
import { getMainImage } from '../utils/imageHelpers';
import { sendTelegramMessage, formatOrderMessage, generateOrderNumber } from '../utils/telegramService';
import './Cart.css';

function Cart() {
  const { 
    cartItems, 
    removeFromCart, 
    updateQuantity, 
    clearCart, 
    getCartTotal 
  } = useCart();
  
  const { promotions, products } = useAdminData();
  const { createOrder } = useOrders();
  const navigate = useNavigate();
  
  // –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
  console.log('Cart component: useOrders hook result:', { createOrder });
  const [showCheckout, setShowCheckout] = useState(false);
  const [orderForm, setOrderForm] = useState({
    name: '',
    phone: '',
    email: '',
    address: '',
    deliveryMethod: 'pickup',
    paymentMethod: 'cash',
    comment: ''
  });

  // –†–∞—Å—á–µ—Ç –ø—Ä–∏–º–µ–Ω–∏–º—ã—Ö —Å–∫–∏–¥–æ–∫
  const applicableDiscounts = useMemo(() => {
    const cartTotal = getCartTotal();
    const cartCategories = [...new Set(cartItems.map(item => {
      const product = products.find(p => p.id === item.id);
      return product?.category;
    }).filter(Boolean))];

    const activePromotions = promotions.filter(promo => {
      if (!promo.active) return false;
      
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è
      if (promo.validUntil) {
        const validDate = new Date(promo.validUntil);
        if (validDate < new Date()) return false;
      }
      
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º –º–∏–Ω–∏–º–∞–ª—å–Ω—É—é —Å—É–º–º—É –ø–æ–∫—É–ø–∫–∏
      if (promo.minPurchase && cartTotal < promo.minPurchase) return false;
      
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏—é (–µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω–∞)
      if (promo.category && promo.category !== 'all' && !cartCategories.includes(promo.category)) {
        return false;
      }
      
      return true;
    });

    // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ —É–±—ã–≤–∞–Ω–∏—é —Å–∫–∏–¥–∫–∏ (–ª—É—á—à–∏–µ —Å–Ω–∞—á–∞–ª–∞)
    return activePromotions.sort((a, b) => (b.discount || 0) - (a.discount || 0));
  }, [cartItems, promotions, products, getCartTotal]);

  // –†–∞—Å—á–µ—Ç —Ñ–∏–Ω–∞–ª—å–Ω—ã—Ö —Ü–µ–Ω —Å —É—á–µ—Ç–æ–º —Å–∫–∏–¥–æ–∫
  const priceCalculation = useMemo(() => {
    const subtotal = getCartTotal();
    const bestDiscount = applicableDiscounts[0];
    const discountAmount = bestDiscount ? Math.round(subtotal * (bestDiscount.discount / 100)) : 0;
    const total = subtotal - discountAmount;

    return {
      subtotal,
      discountAmount,
      total,
      appliedPromotion: bestDiscount
    };
  }, [getCartTotal, applicableDiscounts]);

  const handleQuantityChange = (productId, newQuantity) => {
    updateQuantity(productId, newQuantity);
  };

  const handleRemoveItem = (productId) => {
    removeFromCart(productId);
  };

  const handleFormChange = (e) => {
    setOrderForm({
      ...orderForm,
      [e.target.name]: e.target.value
    });
  };

  const handleSubmitOrder = async (e) => {
    e.preventDefault();
    
    try {
      // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –Ω–æ–º–µ—Ä –∑–∞–∫–∞–∑–∞
      const orderNumber = generateOrderNumber();
      
      // –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏
      const orderData = {
        orderForm,
        cartItems,
        priceCalculation,
        orderNumber
      };
      
      // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∑–∞–∫–∞–∑ –≤ —Å–∏—Å—Ç–µ–º—É
      const savedOrder = await createOrder(orderData);
      console.log('–ó–∞–∫–∞–∑ —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤ —Å–∏—Å—Ç–µ–º–µ:', savedOrder);
      
      // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è Telegram
      const message = formatOrderMessage(orderData);
      
      // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ Telegram
      console.log('–û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–∫–∞–∑ –≤ Telegram...');
      const result = await sendTelegramMessage(message);
      
      if (result.success) {
        alert(`–ó–∞–∫–∞–∑ #${orderNumber} —É—Å–ø–µ—à–Ω–æ –æ—Ñ–æ—Ä–º–ª–µ–Ω! –ú—ã —Å–≤—è–∂–µ–º—Å—è —Å –≤–∞–º–∏ –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è.`);
        console.log('–ó–∞–∫–∞–∑ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –≤ Telegram');
      } else {
        console.error('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ Telegram:', result.error);
        alert(`–ó–∞–∫–∞–∑ #${orderNumber} –æ—Ñ–æ—Ä–º–ª–µ–Ω, –Ω–æ –≤–æ–∑–Ω–∏–∫–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è. –ú—ã –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —Å –≤–∞–º–∏ —Å–≤—è–∂–µ–º—Å—è!`);
      }
      
      // –û—á–∏—â–∞–µ–º –∫–æ—Ä–∑–∏–Ω—É –∏ –ø–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞ –≥–ª–∞–≤–Ω—É—é
      clearCart();
      setShowCheckout(false);
      navigate('/');
      
    } catch (error) {
      console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–∏ –∑–∞–∫–∞–∑–∞:', error);
      alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–∏ –∑–∞–∫–∞–∑–∞. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑ –∏–ª–∏ —Å–≤—è–∂–∏—Ç–µ—Å—å —Å –Ω–∞–º–∏ –ø–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É.');
    }
  };

  if (cartItems.length === 0) {
    return (
      <div className="cart-page">
        <div className="container">
          <div className="empty-cart">
            <FaShoppingCart className="empty-cart-icon" />
            <h2>–í–∞—à–∞ –∫–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</h2>
            <p>–î–æ–±–∞–≤—å—Ç–µ —Ç–æ–≤–∞—Ä—ã –∏–∑ –∫–∞—Ç–∞–ª–æ–≥–∞, —á—Ç–æ–±—ã –æ—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑</p>
            <Link to="/catalog" className="continue-shopping-btn">
              –ü–µ—Ä–µ–π—Ç–∏ –≤ –∫–∞—Ç–∞–ª–æ–≥
            </Link>
          </div>
        </div>
      </div>
    );
  }

  return (
    <div className="cart-page">
      <div className="container">
        <div className="cart-header">
          <button onClick={() => navigate(-1)} className="back-button">
            <FaArrowLeft /> –ù–∞–∑–∞–¥
          </button>
          <h1>–ö–æ—Ä–∑–∏–Ω–∞ —Ç–æ–≤–∞—Ä–æ–≤</h1>
          <button onClick={clearCart} className="clear-cart-btn">
            –û—á–∏—Å—Ç–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É
          </button>
        </div>

        <div className="cart-content">
          <div className="cart-items">
            <AnimatePresence>
              {cartItems.map((item) => (
                <motion.div
                  key={item.id}
                  className="cart-item"
                  initial={{ opacity: 0, y: 20 }}
                  animate={{ opacity: 1, y: 0 }}
                  exit={{ opacity: 0, x: -100 }}
                  transition={{ duration: 0.3 }}
                >
                  <div className="item-image">
                    {(() => {
                      const productData = products.find(p => p.id === item.id);
                      if (!productData) return <span className="item-icon">üì¶</span>;
                      
                      const mainImage = getMainImage(productData);
                      if (mainImage?.data) {
                        if (
                          typeof mainImage.data === 'string' &&
                          (mainImage.data.startsWith('data:image') || mainImage.data.startsWith('/uploads/') || mainImage.data.startsWith('http'))
                        ) {
                          return <img src={mainImage.data} alt={item.title} className="item-image-img" />;
                        }
                        return <span className="item-icon">{mainImage.data}</span>;
                      }
                      return <span className="item-icon">üì¶</span>;
                    })()}
                  </div>
                  
                  <div className="item-info">
                    <h3>{item.title}</h3>
                    <p className="item-brand">{item.brand}</p>
                    <p className="item-price">{item.price.toLocaleString()} ‚ÇΩ</p>
                  </div>
                  
                  <div className="item-controls">
                    <div className="quantity-controls">
                      <button
                        onClick={() => handleQuantityChange(item.id, item.quantity - 1)}
                        disabled={item.quantity <= 1}
                        className="quantity-btn"
                      >
                        <FaMinus />
                      </button>
                      <input 
                        type="text" 
                        value={item.quantity} 
                        onChange={(e) => {
                          const inputValue = e.target.value.replace(/[^0-9]/g, '');
                          // –†–∞–∑—Ä–µ—à–∞–µ–º –ø—É—Å—Ç–æ–µ –ø–æ–ª–µ
                          if (inputValue === '') {
                            // –í—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ
                            return;
                          }
                          const value = parseInt(inputValue);
                          if (!isNaN(value) && value >= 1) {
                            handleQuantityChange(item.id, value);
                          }
                        }}
                        onBlur={(e) => {
                          // –ü—Ä–∏ –ø–æ—Ç–µ—Ä–µ —Ñ–æ–∫—É—Å–∞, –µ—Å–ª–∏ –ø–æ–ª–µ –ø—É—Å—Ç–æ–µ, —Å—Ç–∞–≤–∏–º 1
                          const cleanValue = e.target.value.replace(/[^0-9]/g, '');
                          if (cleanValue === '' || parseInt(cleanValue) < 1) {
                            handleQuantityChange(item.id, 1);
                          }
                        }}
                        onFocus={(e) => e.target.select()}
                        placeholder="1"
                        className="quantity-input"
                      />
                      <button
                        onClick={() => handleQuantityChange(item.id, item.quantity + 1)}
                        className="quantity-btn"
                      >
                        <FaPlus />
                      </button>
                    </div>
                    
                    <div className="item-total">
                      {(item.price * item.quantity).toLocaleString()} ‚ÇΩ
                    </div>
                    
                    <button
                      onClick={() => handleRemoveItem(item.id)}
                      className="remove-btn"
                    >
                      <FaTrash />
                    </button>
                  </div>
                </motion.div>
              ))}
            </AnimatePresence>
          </div>

          <div className="cart-summary">
            <div className="summary-card">
              <h3>–ò—Ç–æ–≥–æ</h3>
              <div className="summary-line">
                <span>–¢–æ–≤–∞—Ä—ã ({cartItems.reduce((sum, item) => sum + item.quantity, 0)} —à—Ç):</span>
                <span>{priceCalculation.subtotal.toLocaleString()} ‚ÇΩ</span>
              </div>
              
              {priceCalculation.appliedPromotion && (
                <div className="summary-line discount-line">
                  <span>
                    <FaPercent className="discount-icon" />
                    –°–∫–∏–¥–∫–∞ "{priceCalculation.appliedPromotion.title}" ({priceCalculation.appliedPromotion.discount}%):
                  </span>
                  <span className="discount-amount">
                    -{priceCalculation.discountAmount.toLocaleString()} ‚ÇΩ
                  </span>
                </div>
              )}
              
              <div className="summary-line">
                <span>–î–æ—Å—Ç–∞–≤–∫–∞:</span>
                <span>–ë–µ—Å–ø–ª–∞—Ç–Ω–æ</span>
              </div>
              
              <div className="summary-total">
                <span>–ö –æ–ø–ª–∞—Ç–µ:</span>
                <span>{priceCalculation.total.toLocaleString()} ‚ÇΩ</span>
              </div>
              
              {applicableDiscounts.length > 0 && (
                <div className="promotions-info">
                  <FaTags className="promo-icon" />
                  <span>–ü—Ä–∏–º–µ–Ω–µ–Ω—ã –∞–∫—Ç–∏–≤–Ω—ã–µ –∞–∫—Ü–∏–∏!</span>
                </div>
              )}
              
              <motion.button
                className="checkout-btn"
                onClick={() => setShowCheckout(true)}
                whileHover={{ scale: 1.02 }}
                whileTap={{ scale: 0.98 }}
              >
                –û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑
              </motion.button>
            </div>
          </div>
        </div>

        <AnimatePresence>
          {showCheckout && (
            <motion.div
              className="checkout-modal"
              initial={{ opacity: 0 }}
              animate={{ opacity: 1 }}
              exit={{ opacity: 0 }}
            >
              <motion.div
                className="checkout-content"
                initial={{ y: 50, opacity: 0 }}
                animate={{ y: 0, opacity: 1 }}
                exit={{ y: 50, opacity: 0 }}
              >
                <h2>–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞</h2>
                
                <form onSubmit={handleSubmitOrder} className="order-form">
                  <div className="form-group">
                    <label htmlFor="name">–ò–º—è *</label>
                    <input
                      type="text"
                      id="name"
                      name="name"
                      value={orderForm.name}
                      onChange={handleFormChange}
                      required
                    />
                  </div>
                  
                  <div className="form-group">
                    <label htmlFor="phone">–¢–µ–ª–µ—Ñ–æ–Ω *</label>
                    <input
                      type="tel"
                      id="phone"
                      name="phone"
                      value={orderForm.phone}
                      onChange={handleFormChange}
                      required
                    />
                  </div>
                  
                  <div className="form-group">
                    <label htmlFor="email">Email</label>
                    <input
                      type="email"
                      id="email"
                      name="email"
                      value={orderForm.email}
                      onChange={handleFormChange}
                    />
                  </div>
                  
                  <div className="form-group">
                    <label htmlFor="deliveryMethod">–°–ø–æ—Å–æ–± –ø–æ–ª—É—á–µ–Ω–∏—è *</label>
                    <select
                      id="deliveryMethod"
                      name="deliveryMethod"
                      value={orderForm.deliveryMethod}
                      onChange={handleFormChange}
                      required
                    >
                      <option value="pickup">–°–∞–º–æ–≤—ã–≤–æ–∑</option>
                      <option value="delivery">–î–æ—Å—Ç–∞–≤–∫–∞</option>
                    </select>
                  </div>
                  
                  {orderForm.deliveryMethod === 'delivery' && (
                    <div className="form-group">
                      <label htmlFor="address">–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏ *</label>
                      <textarea
                        id="address"
                        name="address"
                        value={orderForm.address}
                        onChange={handleFormChange}
                        required={orderForm.deliveryMethod === 'delivery'}
                        rows="3"
                      />
                    </div>
                  )}
                  
                  <div className="form-group">
                    <label htmlFor="paymentMethod">–°–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã *</label>
                    <select
                      id="paymentMethod"
                      name="paymentMethod"
                      value={orderForm.paymentMethod}
                      onChange={handleFormChange}
                      required
                    >
                      <option value="cash">–ù–∞–ª–∏—á–Ω—ã–º–∏</option>
                      <option value="card">–ë–∞–Ω–∫–æ–≤—Å–∫–æ–π –∫–∞—Ä—Ç–æ–π</option>
                      <option value="transfer">–ë–∞–Ω–∫–æ–≤—Å–∫–∏–π –ø–µ—Ä–µ–≤–æ–¥</option>
                    </select>
                  </div>
                  
                  <div className="form-group">
                    <label htmlFor="comment">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ –∑–∞–∫–∞–∑—É</label>
                    <textarea
                      id="comment"
                      name="comment"
                      value={orderForm.comment}
                      onChange={handleFormChange}
                      rows="3"
                    />
                  </div>
                  
                  <div className="order-summary">
                    <h4>–í–∞—à –∑–∞–∫–∞–∑:</h4>
                    <div className="order-items">
                      {cartItems.map((item) => (
                        <div key={item.id} className="order-item">
                          <span>{item.title} √ó {item.quantity}</span>
                          <span>{(item.price * item.quantity).toLocaleString()} ‚ÇΩ</span>
                        </div>
                      ))}
                    </div>
                    {priceCalculation.appliedPromotion && (
                      <div className="discount-info">
                        <div className="discount-line">
                          <span>–ü–æ–¥—ã—Ç–æ–≥: {priceCalculation.subtotal.toLocaleString()} ‚ÇΩ</span>
                        </div>
                        <div className="discount-line">
                          <span className="discount-text">
                            <FaPercent /> –°–∫–∏–¥–∫–∞ "{priceCalculation.appliedPromotion.title}" ({priceCalculation.appliedPromotion.discount}%):
                          </span>
                          <span className="discount-amount">
                            -{priceCalculation.discountAmount.toLocaleString()} ‚ÇΩ
                          </span>
                        </div>
                      </div>
                    )}
                    <div className="order-total">
                      <strong>–ò—Ç–æ–≥–æ: {priceCalculation.total.toLocaleString()} ‚ÇΩ</strong>
                    </div>
                  </div>
                  
                  <div className="form-actions">
                    <button type="button" onClick={() => setShowCheckout(false)} className="cancel-btn">
                      –û—Ç–º–µ–Ω–∞
                    </button>
                    <button type="submit" className="submit-btn">
                      –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –∑–∞–∫–∞–∑
                    </button>
                  </div>
                </form>
              </motion.div>
            </motion.div>
          )}
        </AnimatePresence>
      </div>
    </div>
  );
}

export default Cart;

```

```javascriptreact
import React, { useState } from 'react';
import { Link } from 'react-router-dom';
import { FaCheckCircle, FaTimesCircle, FaShoppingCart } from 'react-icons/fa';
import { useCartActions } from './hooks/useCartActions';
import { useAdminData } from './context/AdminDataContext';
// wishlist removed
import { migrateProductImages, getMainImage, isImageUrl } from './utils/imageHelpers';
import './Catalog.css';

export default function Catalog() {
  const { products, categories, brands } = useAdminData();
  const [selectedCategory, setSelectedCategory] = useState('–í—Å–µ');
  const [selectedSubcategory, setSelectedSubcategory] = useState('–í—Å–µ');
  const [selectedBrand, setSelectedBrand] = useState('–í—Å–µ');
  const [priceRange, setPriceRange] = useState([0, 200000]);
  const [inStock, setInStock] = useState(false);
  const { addToCartWithNotification } = useCartActions();

  // –°–æ–∑–¥–∞–µ–º —Å–ø–∏—Å–æ–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –∏ –±—Ä–µ–Ω–¥–æ–≤
  const categoryList = ['–í—Å–µ', ...Object.keys(categories)];
  const brandList = ['–í—Å–µ', ...brands];

  const minPrice = 0;
  const maxPrice = 200000;

  // –ü–æ–ª—É—á–∞–µ–º –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
  const availableSubcategories = selectedCategory === '–í—Å–µ' 
    ? [] 
    : ['–í—Å–µ', ...(categories[selectedCategory] || [])];

  // –°–±—Ä–æ—Å –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø—Ä–∏ —Å–º–µ–Ω–µ –æ—Å–Ω–æ–≤–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
  const handleCategoryChange = (category) => {
    setSelectedCategory(category);
    setSelectedSubcategory('–í—Å–µ');
  };

  const filteredProducts = products.filter((product) => {
    const byCategory = selectedCategory === '–í—Å–µ' || product.category === selectedCategory;
    const bySubcategory = selectedSubcategory === '–í—Å–µ' || product.subcategory === selectedSubcategory;
    const byBrand = selectedBrand === '–í—Å–µ' || product.brand === selectedBrand;
    const byPrice = product.price >= priceRange[0] && product.price <= priceRange[1];
    const byStock = !inStock || product.available;
    return byCategory && bySubcategory && byBrand && byPrice && byStock;
  });

  const handleAddToCart = (product, e) => {
    e.preventDefault();
    e.stopPropagation();
    addToCartWithNotification(product, 1);
  };

  // wishlist removed

  return (
    <div className="catalog-wrapper">
      <aside className="catalog-filters">
        <h3>–§–∏–ª—å—Ç—Ä—ã</h3>
        <div className="filter-group">
          <label>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
          <select value={selectedCategory} onChange={e => handleCategoryChange(e.target.value)}>
            {categoryList.map(cat => (
              <option key={cat} value={cat}>{cat}</option>
            ))}
          </select>
        </div>
        {availableSubcategories.length > 0 && (
          <div className="filter-group">
            <label>–ü–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è</label>
            <select value={selectedSubcategory} onChange={e => setSelectedSubcategory(e.target.value)}>
              {availableSubcategories.map(subcat => (
                <option key={subcat} value={subcat}>{subcat}</option>
              ))}
            </select>
          </div>
        )}
        <div className="filter-group">
          <label>–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å</label>
          <select value={selectedBrand} onChange={e => setSelectedBrand(e.target.value)}>
            {brandList.map(brand => (
              <option key={brand} value={brand}>{brand}</option>
            ))}
          </select>
        </div>
        <div className="filter-group">
          <label>–¶–µ–Ω–∞, ‚ÇΩ</label>
          <div className="price-range">
            <input
              type="number"
              min={minPrice}
              max={priceRange[1]}
              value={priceRange[0]}
              onChange={e => setPriceRange([+e.target.value, priceRange[1]])}
            />
            <span>-</span>
            <input
              type="number"
              min={priceRange[0]}
              max={maxPrice}
              value={priceRange[1]}
              onChange={e => setPriceRange([priceRange[0], +e.target.value])}
            />
          </div>
        </div>
        <div className="filter-group">
          <label>
            <input
              type="checkbox"
              checked={inStock}
              onChange={e => setInStock(e.target.checked)}
            />
            –¢–æ–ª—å–∫–æ –≤ –Ω–∞–ª–∏—á–∏–∏
          </label>
        </div>
      </aside>
      <main className="catalog-main">
        <h2>–ö–∞—Ç–∞–ª–æ–≥ —Ç–æ–≤–∞—Ä–æ–≤</h2>
        <div className="catalog-grid">
          {filteredProducts.length === 0 && <div className="no-products">–ù–µ—Ç —Ç–æ–≤–∞—Ä–æ–≤ –ø–æ –≤—ã–±—Ä–∞–Ω–Ω—ã–º —Ñ–∏–ª—å—Ç—Ä–∞–º</div>}
          {filteredProducts.map(product => (
            <Link to={`/product/${product.id}`} className="catalog-card" key={product.id}>
              <div className="catalog-card-image">
                {(() => {
                  const migratedProduct = migrateProductImages(product);
                  const mainImage = getMainImage(migratedProduct);
                  
                  if (mainImage?.data) {
                    if (
                      typeof mainImage.data === 'string' &&
                      (mainImage.data.startsWith('data:image') || isImageUrl(mainImage.data))
                    ) {
                      return <img src={mainImage.data} alt={product.title} className="catalog-product-image" />;
                    }
                    return <span className="catalog-card-icon">{mainImage.data}</span>;
                  }
                  return <span className="catalog-card-icon">üì¶</span>;
                })()}
                {/* wishlist button removed */}
              </div>
              <div className="catalog-card-info">
                <h3>{product.title}</h3>
                <div className="catalog-card-price">{product.price.toLocaleString()} ‚ÇΩ</div>
                <div className="catalog-card-category">
                  <span className="category">{product.category}</span>
                  {product.subcategory && <span className="subcategory"> ‚Üí {product.subcategory}</span>}
                </div>
                <div className="catalog-card-meta">
                  <span className="catalog-card-brand">{product.brand}</span>
                  <span className={product.available ? 'in-stock' : 'out-of-stock'}>
                    {product.available ? <FaCheckCircle /> : <FaTimesCircle />} {product.available ? '–í –Ω–∞–ª–∏—á–∏–∏' : '–ù–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏'}
                  </span>
                </div>
                <button 
                  className="catalog-card-btn"
                  onClick={(e) => handleAddToCart(product, e)}
                  disabled={!product.available}
                >
                  <FaShoppingCart /> –í –∫–æ—Ä–∑–∏–Ω—É
                </button>
              </div>
            </Link>
          ))}
        </div>
      </main>
    </div>
  );
}

```

```javascriptreact
import React from 'react';
import { Link } from 'react-router-dom';
import { 
  FaTruck, 
  FaTools, 
  FaShieldAlt, 
  FaArrowRight
} from 'react-icons/fa';
import { useAdminData } from '../context/AdminDataContext';
// wishlist removed
import { getMainImage, isImageUrl } from '../utils/imageHelpers';
import HeroVisual from '../components/HeroVisual';

function Home() {
  const HERO_IMAGE_URL = 'https://images.pexels.com/photos/162553/engine-displacement-piston-162553.jpeg?auto=compress&cs=tinysrgb&w=1600';
  const { products, popularProductIds } = useAdminData();
  
  // wishlist removed
  
  const features = [
    {
      icon: <FaTruck />,
      title: "–ë—ã—Å—Ç—Ä–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞",
      text: "–î–æ—Å—Ç–∞–≤–ª—è–µ–º –∑–∞–ø—á–∞—Å—Ç–∏ –ø–æ –≤—Å–µ–π –†–æ—Å—Å–∏–∏ –≤ –∫—Ä–∞—Ç—á–∞–π—à–∏–µ —Å—Ä–æ–∫–∏"
    },
    {
      icon: <FaTools />,
      title: "–ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –¥–µ—Ç–∞–ª–∏",
      text: "–¢–æ–ª—å–∫–æ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ –∏ —Å–µ—Ä—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—á–∞—Å—Ç–∏"
    },
    {
      icon: <FaShieldAlt />,
      title: "–ì–∞—Ä–∞–Ω—Ç–∏—è –∫–∞—á–µ—Å—Ç–≤–∞",
      text: "–ü–æ–ª–Ω–∞—è –≥–∞—Ä–∞–Ω—Ç–∏—è –Ω–∞ –≤—Å–µ —Ç–æ–≤–∞—Ä—ã –∏ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞"
    }
  ];

  // –ü–æ–ª—É—á–∞–µ–º –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –ø–æ ID
  const popularProducts = popularProductIds
    .map(id => products.find(product => product.id === id))
    .filter(product => product) // –£–±–∏—Ä–∞–µ–º undefined –µ—Å–ª–∏ —Ç–æ–≤–∞—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω
    .map(product => ({
      id: product.id,
      title: product.title,
      price: `${product.price.toLocaleString()} ‚ÇΩ`,
      icon: getMainImage(product)?.data || 'üì¶'
    }));

  // –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –º–∞—Å—Å–∏–≤ –¥–ª—è —Å–ø—Ä–∞–≤–∫–∏:
  const _originalPopularProducts = [
    {
      id: 11,
      title: "–ì—É—Å–µ–Ω–∏—Ü—ã –¥–ª—è –≤–µ–∑–¥–µ—Ö–æ–¥–∞",
      price: "45,000 ‚ÇΩ",
      icon: "üîó"
    },
    {
      id: 1,
      title: "–î–≤–∏–≥–∞—Ç–µ–ª—å 2.0L –¥–∏–∑–µ–ª—å–Ω—ã–π",
      price: "180,000 ‚ÇΩ",
      icon: "‚öôÔ∏è"
    },
    {
      id: 8,
      title: "–ö–æ—Ä–æ–±–∫–∞ –ø–µ—Ä–µ–¥–∞—á –º–µ—Ö–∞–Ω–∏—á–µ—Å–∫–∞—è",
      price: "95,000 ‚ÇΩ",
      icon: "üîß"
    },
    {
      id: 12,
      title: "–ê–º–æ—Ä—Ç–∏–∑–∞—Ç–æ—Ä –ø–µ—Ä–µ–¥–Ω–∏–π",
      price: "12,000 ‚ÇΩ",
      icon: "üõ†Ô∏è"
    },
    {
      id: 15,
      title: "–ê–∫–∫—É–º—É–ª—è—Ç–æ—Ä 12V 100Ah",
      price: "15,000 ‚ÇΩ",
      icon: "üîã"
    },
    {
      id: 17,
      title: "–°–∏–¥–µ–Ω—å–µ –≤–æ–¥–∏—Ç–µ–ª—è",
      price: "25,000 ‚ÇΩ",
      icon: "ü™ë"
    }
  ];

  return (
    <div>
      <section className="hero">
        <div className="container">
          <div className="hero-content">
            <div className="hero-text">
              <h1>–ó–∞–ø—á–∞—Å—Ç–∏ –¥–ª—è –≤–µ–∑–¥–µ—Ö–æ–¥–æ–≤</h1>
              <p>
                –ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∑–∞–ø—á–∞—Å—Ç–∏ –¥–ª—è –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ –≤–µ–∑–¥–µ—Ö–æ–¥–æ–≤. 
                –ë—ã—Å—Ç—Ä–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞ –ø–æ –≤—Å–µ–π –†–æ—Å—Å–∏–∏. –ì–∞—Ä–∞–Ω—Ç–∏—è –∫–∞—á–µ—Å—Ç–≤–∞ –Ω–∞ –≤—Å–µ —Ç–æ–≤–∞—Ä—ã.
              </p>
              <Link to="/catalog" className="cta-button">
                –ü–µ—Ä–µ–π—Ç–∏ –≤ –∫–∞—Ç–∞–ª–æ–≥
                <FaArrowRight />
              </Link>
            </div>
            <div className="hero-image">
              <div className="hero-placeholder">
                <HeroVisual />
              </div>
              <p>–ù–∞–¥—ë–∂–Ω—ã–µ –∑–∞–ø—á–∞—Å—Ç–∏ –¥–ª—è –≤–∞—à–µ–≥–æ –≤–µ–∑–¥–µ—Ö–æ–¥–∞</p>
            </div>
          </div>
        </div>
      </section>

      <section className="features">
        <div className="container">
          <h2 className="section-title">–ü–æ—á–µ–º—É –≤—ã–±–∏—Ä–∞—é—Ç –Ω–∞—Å</h2>
          <div className="features-grid">
            {features.map((feature, index) => (
              <div key={index} className="feature-card">
                <div className="feature-icon">{feature.icon}</div>
                <h3 className="feature-title">{feature.title}</h3>
                <p className="feature-text">{feature.text}</p>
              </div>
            ))}
          </div>
        </div>
      </section>

      <section className="products">
        <div className="container">
          <h2 className="section-title">–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã</h2>
          <div className="products-grid">
            {popularProducts.map((product) => (
              <Link to={`/product/${product.id}`} key={product.id} className="product-card">
                <div className="product-image">
                  {(() => {
                    const productData = products.find(p => p.id === product.id);
                    if (!productData) return <span className="product-icon">{product.icon}</span>;
                    
                    const mainImage = getMainImage(productData);
                    if (mainImage?.data) {
                      if (typeof mainImage.data === 'string' && (mainImage.data.startsWith('data:image') || isImageUrl(mainImage.data))) {
                        return <img src={mainImage.data} alt={product.title} className="product-image-img" />;
                      }
                      return <span className="product-icon">{mainImage.data}</span>;
                    }
                    return <span className="product-icon">{product.icon}</span>;
                  })()}
                  {/* wishlist button removed */}
                </div>
                <div className="product-info">
                  <h3 className="product-title">{product.title}</h3>
                  <div className="product-price">{product.price}</div>
                  <button className="product-button">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</button>
                </div>
              </Link>
            ))}
          </div>
        </div>
      </section>
    </div>
  );
}

export default Home;

```

```javascriptreact
import React, { useState, useEffect, useMemo } from 'react';
import { Link } from 'react-router-dom';
import { motion, AnimatePresence } from 'framer-motion';
import { FaSearch, FaTimes, FaShoppingCart } from 'react-icons/fa';
import { useAdminData } from '../context/AdminDataContext';
import { getMainImage } from '../utils/imageHelpers';
import { useCartActions } from '../hooks/useCartActions';
import './SearchModal.css';

export default function SearchModal({ isOpen, onClose }) {
  const [searchTerm, setSearchTerm] = useState('');
  const [selectedCategory, setSelectedCategory] = useState('all');
  const { products, categories } = useAdminData();
  const { addToCartWithNotification } = useCartActions();

  // –û—á–∏—â–∞–µ–º –ø–æ–∏—Å–∫ –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
  useEffect(() => {
    if (!isOpen) {
      setSearchTerm('');
      setSelectedCategory('all');
    }
  }, [isOpen]);

  // –§–æ–∫—É—Å –Ω–∞ –ø–æ–ª–µ –ø–æ–∏—Å–∫–∞ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏
  useEffect(() => {
    if (isOpen) {
      const searchInput = document.getElementById('search-input');
      if (searchInput) {
        setTimeout(() => searchInput.focus(), 100);
      }
    }
  }, [isOpen]);

  // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∞–≤–∏—à–∏ Escape
  useEffect(() => {
    const handleEscape = (e) => {
      if (e.key === 'Escape' && isOpen) {
        onClose();
      }
    };

    if (isOpen) {
      document.addEventListener('keydown', handleEscape);
      return () => document.removeEventListener('keydown', handleEscape);
    }
  }, [isOpen, onClose]);

  // –õ–æ–≥–∏–∫–∞ –ø–æ–∏—Å–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤
  const searchResults = useMemo(() => {
    if (!searchTerm.trim()) return [];

    const query = searchTerm.toLowerCase().trim();
    
    return products.filter(product => {
      // –§–∏–ª—å—Ç—Ä –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
      if (selectedCategory !== 'all' && product.category !== selectedCategory) {
        return false;
      }

      // –ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é
      if (product.title.toLowerCase().includes(query)) return true;
      
      // –ü–æ–∏—Å–∫ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
      if (product.category?.toLowerCase().includes(query)) return true;
      
      // –ü–æ–∏—Å–∫ –ø–æ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏
      if (product.subcategory?.toLowerCase().includes(query)) return true;
      
      // –ü–æ–∏—Å–∫ –ø–æ –±—Ä–µ–Ω–¥—É
      if (product.brand?.toLowerCase().includes(query)) return true;
      
      // –ü–æ–∏—Å–∫ –ø–æ –æ–ø–∏—Å–∞–Ω–∏—é
      if (product.description?.toLowerCase().includes(query)) return true;

      return false;
    }).slice(0, 10); // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –¥–æ 10 —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
  }, [searchTerm, selectedCategory, products]);

  const handleBackdropClick = (e) => {
    if (e.target === e.currentTarget) {
      onClose();
    }
  };

  const handleAddToCart = (product) => {
    addToCartWithNotification(product, 1);
  };

  const categoryList = Object.keys(categories);

  return (
    <AnimatePresence>
      {isOpen && (
        <motion.div
          className="search-modal-overlay"
          initial={{ opacity: 0 }}
          animate={{ opacity: 1 }}
          exit={{ opacity: 0 }}
          onClick={handleBackdropClick}
        >
          <motion.div
            className="search-modal"
            initial={{ y: -100, opacity: 0, scale: 0.9 }}
            animate={{ y: 0, opacity: 1, scale: 1 }}
            exit={{ y: -100, opacity: 0, scale: 0.9 }}
            transition={{ type: "spring", damping: 20, stiffness: 300 }}
            onClick={(e) => e.stopPropagation()}
          >
            <div className="search-header">
              <h2>
                <FaSearch /> –ü–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–æ–≤
              </h2>
              <button onClick={onClose} className="close-btn">
                <FaTimes />
              </button>
            </div>

            <div className="search-form">
              <div className="search-input-container">
                <FaSearch className="search-icon" />
                <input
                  id="search-input"
                  type="text"
                  placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞, –∫–∞—Ç–µ–≥–æ—Ä–∏—é –∏–ª–∏ –±—Ä–µ–Ω–¥..."
                  value={searchTerm}
                  onChange={(e) => setSearchTerm(e.target.value)}
                  className="search-input"
                />
              </div>

              <div className="category-filter">
                <label>–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</label>
                <select
                  value={selectedCategory}
                  onChange={(e) => setSelectedCategory(e.target.value)}
                  className="category-select"
                >
                  <option value="all">–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>
                  {categoryList.map(category => (
                    <option key={category} value={category}>
                      {category}
                    </option>
                  ))}
                </select>
              </div>
            </div>

            <div className="search-results">
              {searchTerm.trim() === '' ? (
                <div className="search-placeholder">
                  <FaSearch className="placeholder-icon" />
                  <p>–ù–∞—á–Ω–∏—Ç–µ –≤–≤–æ–¥–∏—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ –¥–ª—è –ø–æ–∏—Å–∫–∞</p>
                  <small>–ü–æ–∏—Å–∫ –æ—Å—É—â–µ—Å—Ç–≤–ª—è–µ—Ç—Å—è –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é, –∫–∞—Ç–µ–≥–æ—Ä–∏–∏, –±—Ä–µ–Ω–¥—É –∏ –æ–ø–∏—Å–∞–Ω–∏—é</small>
                </div>
              ) : searchResults.length === 0 ? (
                <div className="no-results">
                  <h3>–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</h3>
                  <p>–ü–æ –∑–∞–ø—Ä–æ—Å—É "{searchTerm}" –Ω–µ –Ω–∞–π–¥–µ–Ω–æ —Ç–æ–≤–∞—Ä–æ–≤</p>
                  <small>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –∑–∞–ø—Ä–æ—Å –∏–ª–∏ –≤—ã–±—Ä–∞—Ç—å –¥—Ä—É–≥—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é</small>
                </div>
              ) : (
                <div className="results-container">
                  <div className="results-header">
                    <span>–ù–∞–π–¥–µ–Ω–æ —Ç–æ–≤–∞—Ä–æ–≤: {searchResults.length}</span>
                  </div>
                  
                  <div className="results-list">
                    {searchResults.map((product) => {
                      const mainImage = getMainImage(product);
                      
                      return (
                        <motion.div
                          key={product.id}
                          className="result-item"
                          initial={{ opacity: 0, x: -20 }}
                          animate={{ opacity: 1, x: 0 }}
                          transition={{ duration: 0.3 }}
                        >
                          <div className="result-image">
                      {(() => {
                        const d = mainImage?.data;
                        if (d && typeof d === 'string' && (d.startsWith('data:image') || d.startsWith('/uploads/') || d.startsWith('http'))){
                          return <img src={d} alt={product.title} />;
                        }
                        return <span className="result-icon">{d || 'üì¶'}</span>;
                      })()}
                          </div>

                          <div className="result-info">
                            <h4>{product.title}</h4>
                            <div className="result-meta">
                              <span className="result-category">{product.category}</span>
                              {product.subcategory && (
                                <span className="result-subcategory"> ‚Ä¢ {product.subcategory}</span>
                              )}
                              {product.brand && (
                                <span className="result-brand"> ‚Ä¢ {product.brand}</span>
                              )}
                            </div>
                            <div className="result-price">{product.price?.toLocaleString()} ‚ÇΩ</div>
                            <div className="result-availability">
                              {product.quantity > 0 ? (
                                <span className="in-stock">–í –Ω–∞–ª–∏—á–∏–∏: {product.quantity} —à—Ç</span>
                              ) : (
                                <span className="out-of-stock">–ù–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏</span>
                              )}
                            </div>
                          </div>

                          <div className="result-actions">
                            <Link 
                              to={`/product/${product.id}`} 
                              onClick={onClose}
                              className="view-btn"
                            >
                              –ü–æ–¥—Ä–æ–±–Ω–µ–µ
                            </Link>
                            {product.quantity > 0 && (
                              <button
                                onClick={() => handleAddToCart(product)}
                                className="add-to-cart-btn"
                              >
                                <FaShoppingCart /> –í –∫–æ—Ä–∑–∏–Ω—É
                              </button>
                            )}
                          </div>
                        </motion.div>
                      );
                    })}
                  </div>
                </div>
              )}
            </div>
          </motion.div>
        </motion.div>
      )}
    </AnimatePresence>
  );
}

```

–ü—Ä–æ–≤–µ—Ä–∏–ª –≤—Å–µ –º–µ—Å—Ç–∞ –≤—ã–≤–æ–¥–∞ —Ñ–æ—Ç–æ —Ç–æ–≤–∞—Ä–∞ –∏ –≤–µ–∑–¥–µ —Å–¥–µ–ª–∞–ª –µ–¥–∏–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ: –µ—Å–ª–∏ –ø–æ–ª–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è ‚Äî –≤–∞–ª–∏–¥–Ω—ã–π URL (`/uploads/...`, http/https) –∏–ª–∏ Base64, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º `<img>`, –∏–Ω–∞—á–µ ‚Äî –∏–∫–æ–Ω–∫—É/—ç–º–æ–¥–∑–∏.

–û–±–Ω–æ–≤–∏–ª:
- –ö–∞—Ç–∞–ª–æ–≥: `src/Catalog.jsx`
- –ì–ª–∞–≤–Ω–∞—è (–±–ª–æ–∫ ‚Äú–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ‚Äù): `src/pages/Home.jsx`
- –ö–æ—Ä–∑–∏–Ω–∞: `src/pages/Cart.jsx`
- –ü–æ–∏—Å–∫: `src/components/SearchModal.jsx`
- –ê–¥–º–∏–Ω–∫–∞:
  - –û–±–∑–æ—Ä: `src/pages/admin/AdvancedAdminDashboard.jsx`
  - –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã: `src/pages/admin/PopularProductsManagement.jsx`
  - –°–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤ —É–∂–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–ª URL (`ProductManagement.jsx`).

–¢–µ–ø–µ—Ä—å –≤–º–µ—Å—Ç–æ —Å—Å—ã–ª–æ–∫ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è —Å–∞–º–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤–æ –≤—Å–µ—Ö —ç—Ç–∏—Ö –º–µ—Å—Ç–∞—Ö. –ï—Å–ª–∏ –∑–∞–º–µ—Ç–∏—Ç–µ –µ—â—ë –≥–¥–µ-—Ç–æ —Å—Å—ã–ª–∫—É ‚Äî —Å–∫–∞–∂–∏—Ç–µ, –¥–æ–±—å—é —Ç–æ—á–µ—á–Ω–æ.

---

**User**

–ö–æ–≥–¥–∞ —è —É–¥–∞–ª—è—é –æ—Ç–º–µ–Ω–µ–Ω–Ω—ã–µ –∑–∞–∫–∞–∑—ã –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –æ–Ω–∏ —Å–Ω–æ–≤–∞ –ø–æ—è–≤–ª—è—é—Ç—Å—è, –∏—Å–ø—Ä–∞–≤—å 

---

**Cursor**

```javascript
/* eslint-disable */
const express = require('express');
const cors = require('cors');
const path = require('path');
const { db, run, get, all } = require('./db');
const fs = require('fs');
const multer = require('multer');

const app = express();
const PORT = process.env.PORT || 3001;

app.use(cors());
app.use(express.json({ limit: '25mb' }));
// –°—Ç–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–∞–∑–¥–∞—á–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
const uploadsDir = path.join(__dirname, 'uploads');
const backupsDir = path.join(__dirname, 'backups');
if (!fs.existsSync(uploadsDir)) {
  fs.mkdirSync(uploadsDir, { recursive: true });
}
if (!fs.existsSync(backupsDir)) {
  fs.mkdirSync(backupsDir, { recursive: true });
}
app.use('/uploads', express.static(uploadsDir));

// –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
const storage = multer.diskStorage({
  destination: (req, file, cb) => cb(null, uploadsDir),
  filename: (req, file, cb) => {
    const ext = path.extname(file.originalname) || '.png';
    const name = `${Date.now()}-${Math.round(Math.random() * 1e9)}${ext}`;
    cb(null, name);
  }
});
const upload = multer({ storage });

// Healthcheck
app.get('/api/health', (req, res) => {
  res.json({ ok: true });
});

// Backup DB (download)
app.get('/api/_debug/backup', (req, res) => {
  try {
    const dbPath = require('./db').DB_FILE;
    const stamp = new Date().toISOString().replace(/[:.]/g, '-');
    const dst = path.join(backupsDir, `db-${stamp}.sqlite3`);
    fs.copyFileSync(dbPath, dst);
    res.json({ ok: true, file: `/api/_debug/download?f=${encodeURIComponent(path.basename(dst))}` });
  } catch (e) {
    res.status(500).json({ error: String(e) });
  }
});

app.get('/api/_debug/download', (req, res) => {
  const file = req.query.f;
  if (!file) return res.status(400).send('Missing f');
  const full = path.join(backupsDir, file);
  if (!fs.existsSync(full)) return res.status(404).send('Not found');
  res.download(full);
});

// Upload image
app.post('/api/upload/image', upload.single('image'), (req, res) => {
  if (!req.file) return res.status(400).json({ error: 'No file' });
  const url = `/uploads/${req.file.filename}`;
  res.status(201).json({ url });
});

// Brands
app.get('/api/brands', async (req, res) => {
  try {
    const rows = await all(db, `SELECT id, name FROM brands ORDER BY name ASC`);
    res.json(rows.map(r => r.name));
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to fetch brands' });
  }
});
app.post('/api/brands', async (req, res) => {
  try {
    const { name } = req.body;
    await ensureBrandByName(name);
    res.status(201).json({ ok: true });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to create brand' });
  }
});
app.delete('/api/brands/:name', async (req, res) => {
  try {
    const { name } = req.params;
    await run(db, `DELETE FROM brands WHERE name=?`, [name]);
    res.json({ ok: true });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to delete brand' });
  }
});

// Categories and subcategories as structure
app.get('/api/categories', async (req, res) => {
  try {
    const cats = await all(db, `SELECT id, name FROM categories ORDER BY name ASC`);
    const sub = await all(db, `SELECT id, category_id, name FROM subcategories ORDER BY name ASC`);
    const idToName = new Map(cats.map(c => [c.id, c.name]));
    const result = {};
    for (const c of cats) {
      result[c.name] = [];
    }
    for (const s of sub) {
      const catName = idToName.get(s.category_id);
      if (!catName) continue;
      result[catName].push(s.name);
    }
    res.json(result);
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to fetch categories' });
  }
});
// Categories CRUD by name
app.post('/api/categories', async (req, res) => {
  try {
    const { name, subcategories = [] } = req.body;
    const catId = await ensureCategoryByName(name);
    for (const s of subcategories) {
      await ensureSubcategoryByName(catId, s);
    }
    res.status(201).json({ ok: true });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to create category' });
  }
});
app.put('/api/categories/:name', async (req, res) => {
  try {
    const oldName = req.params.name;
    const { newName } = req.body;
    await run(db, `UPDATE categories SET name=? WHERE name=?`, [newName, oldName]);
    res.json({ ok: true });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to rename category' });
  }
});
app.delete('/api/categories/:name', async (req, res) => {
  try {
    const name = req.params.name;
    await run(db, `DELETE FROM categories WHERE name=?`, [name]);
    res.json({ ok: true });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to delete category' });
  }
});
app.put('/api/categories/:name/subcategories', async (req, res) => {
  try {
    const name = req.params.name;
    const { subcategories = [] } = req.body;
    const cat = await get(db, `SELECT id FROM categories WHERE name=?`, [name]);
    if (!cat) return res.status(404).json({ error: 'Category not found' });
    await run(db, `DELETE FROM subcategories WHERE category_id=?`, [cat.id]);
    for (const s of subcategories) {
      await ensureSubcategoryByName(cat.id, s);
    }
    res.json({ ok: true });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to set subcategories' });
  }
});

// Products
app.get('/api/products', async (req, res) => {
  try {
    const rows = await all(
      db,
      `SELECT p.*, 
              c.name AS category_name, 
              s.name AS subcategory_name, 
              b.name AS brand_name
       FROM products p
       LEFT JOIN categories c ON p.category_id = c.id
       LEFT JOIN subcategories s ON p.subcategory_id = s.id
       LEFT JOIN brands b ON p.brand_id = b.id
       ORDER BY p.id ASC`
    );

    // –î–æ–±–∞–≤–ª—è–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
    const productIds = rows.map(r => r.id);
    let images = [];
    if (productIds.length > 0) {
      images = await all(
        db,
        `SELECT * FROM product_images WHERE product_id IN (${productIds.map(() => '?').join(',')})`,
        productIds
      );
    }
    const productIdToImages = new Map();
    for (const img of images) {
      if (!productIdToImages.has(img.product_id)) productIdToImages.set(img.product_id, []);
      productIdToImages.get(img.product_id).push({ id: img.id, data: img.image_data, isMain: !!img.is_main });
    }

    const result = rows.map(r => ({
      id: r.id,
      title: r.title,
      price: r.price,
      category: r.category_name,
      subcategory: r.subcategory_name,
      brand: r.brand_name,
      available: !!r.available,
      quantity: r.quantity,
      description: r.description,
      specifications: r.specifications_json ? JSON.parse(r.specifications_json) : undefined,
      features: r.features_json ? JSON.parse(r.features_json) : undefined,
      images: productIdToImages.get(r.id) || [],
      createdAt: r.created_at,
      updatedAt: r.updated_at
    }));

    res.json(result);
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to fetch products' });
  }
});

// Helpers to ensure catalog entities
async function ensureCategoryByName(name) {
  if (!name) return null;
  const row = await get(db, `SELECT id FROM categories WHERE name = ?`, [name]);
  if (row) return row.id;
  const r = await run(db, `INSERT INTO categories (name) VALUES (?)`, [name]);
  return r.lastID;
}

async function ensureSubcategoryByName(categoryId, name) {
  if (!name || !categoryId) return null;
  const row = await get(db, `SELECT id FROM subcategories WHERE category_id = ? AND name = ?`, [categoryId, name]);
  if (row) return row.id;
  const r = await run(db, `INSERT INTO subcategories (category_id, name) VALUES (?, ?)`, [categoryId, name]);
  return r.lastID;
}

async function ensureBrandByName(name) {
  if (!name) return null;
  const row = await get(db, `SELECT id FROM brands WHERE name = ?`, [name]);
  if (row) return row.id;
  const r = await run(db, `INSERT INTO brands (name) VALUES (?)`, [name]);
  return r.lastID;
}

// Create product
app.post('/api/products', async (req, res) => {
  try {
    const { title, price, category, subcategory, brand, available = true, quantity = 0, description = null, specifications, features, images } = req.body;

    const categoryId = await ensureCategoryByName(category);
    const subcategoryId = await ensureSubcategoryByName(categoryId, subcategory);
    const brandId = await ensureBrandByName(brand);

    const specJson = specifications ? JSON.stringify(specifications) : null;
    const featJson = features ? JSON.stringify(features) : null;

    const r = await run(
      db,
      `INSERT INTO products (title, price, category_id, subcategory_id, brand_id, available, quantity, description, specifications_json, features_json)
       VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)`,
      [title, price, categoryId, subcategoryId, brandId, available ? 1 : 0, quantity, description, specJson, featJson]
    );

    const productId = r.lastID;
    if (Array.isArray(images)) {
      for (const img of images) {
        await run(db, `INSERT INTO product_images (product_id, image_data, is_main) VALUES (?, ?, ?)`, [productId, img.data, img.isMain ? 1 : 0]);
      }
    }

    res.status(201).json({ id: productId });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to create product' });
  }
});

// Update product
app.put('/api/products/:id', async (req, res) => {
  try {
    const id = Number(req.params.id);
    const { title, price, category, subcategory, brand, available = true, quantity = 0, description = null, specifications, features, images } = req.body;

    const categoryId = await ensureCategoryByName(category);
    const subcategoryId = await ensureSubcategoryByName(categoryId, subcategory);
    const brandId = await ensureBrandByName(brand);

    const specJson = specifications ? JSON.stringify(specifications) : null;
    const featJson = features ? JSON.stringify(features) : null;

    await run(
      db,
      `UPDATE products SET title=?, price=?, category_id=?, subcategory_id=?, brand_id=?, available=?, quantity=?, description=?, specifications_json=?, features_json=?, updated_at = datetime('now') WHERE id=?`,
      [title, price, categoryId, subcategoryId, brandId, available ? 1 : 0, quantity, description, specJson, featJson, id]
    );

    // replace images
    if (Array.isArray(images)) {
      await run(db, `DELETE FROM product_images WHERE product_id = ?`, [id]);
      for (const img of images) {
        await run(db, `INSERT INTO product_images (product_id, image_data, is_main) VALUES (?, ?, ?)`, [id, img.data, img.isMain ? 1 : 0]);
      }
    }

    res.json({ ok: true });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to update product' });
  }
});

// Delete product
app.delete('/api/products/:id', async (req, res) => {
  try {
    const id = Number(req.params.id);
    await run(db, `DELETE FROM products WHERE id=?`, [id]);
    res.json({ ok: true });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to delete product' });
  }
});

// Promotions
app.get('/api/promotions', async (req, res) => {
  try {
    const rows = await all(
      db,
      `SELECT p.*, c.name AS category_name FROM promotions p
       LEFT JOIN categories c ON p.category_id = c.id
       ORDER BY p.featured DESC, p.id DESC`
    );
    const result = rows.map(r => ({
      id: r.id,
      title: r.title,
      description: r.description,
      discount: r.discount,
      category: r.category_name,
      validUntil: r.valid_until,
      active: !!r.active,
      featured: !!r.featured,
      minPurchase: r.min_purchase
    }));
    res.json(result);
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to fetch promotions' });
  }
});

// Promotions CRUD (–º–∏–Ω–∏–º—É–º)
app.post('/api/promotions', async (req, res) => {
  try {
    const { title, description, discount, category, validUntil, active = true, featured = false, minPurchase } = req.body;
    const catId = category ? (await get(db, `SELECT id FROM categories WHERE name = ?`, [category]))?.id : null;
    const r = await run(
      db,
      `INSERT INTO promotions (title, description, discount, category_id, valid_until, active, featured, min_purchase)
       VALUES (?, ?, ?, ?, ?, ?, ?, ?)`,
      [title, description ?? null, discount, catId ?? null, validUntil ?? null, active ? 1 : 0, featured ? 1 : 0, minPurchase ?? null]
    );
    res.status(201).json({ id: r.lastID });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to create promotion' });
  }
});

app.put('/api/promotions/:id', async (req, res) => {
  try {
    const id = Number(req.params.id);
    const { title, description, discount, category, validUntil, active, featured, minPurchase } = req.body;
    const catId = category ? (await get(db, `SELECT id FROM categories WHERE name = ?`, [category]))?.id : null;
    await run(
      db,
      `UPDATE promotions SET title=?, description=?, discount=?, category_id=?, valid_until=?, active=?, featured=?, min_purchase=? WHERE id=?`,
      [title, description ?? null, discount, catId ?? null, validUntil ?? null, active ? 1 : 0, featured ? 1 : 0, minPurchase ?? null, id]
    );
    res.json({ ok: true });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to update promotion' });
  }
});

app.delete('/api/promotions/:id', async (req, res) => {
  try {
    const id = Number(req.params.id);
    await run(db, `DELETE FROM promotions WHERE id=?`, [id]);
    res.json({ ok: true });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to delete promotion' });
  }
});

// Orders
app.get('/api/orders', async (req, res) => {
  try {
    const orders = await all(db, `SELECT * FROM orders ORDER BY created_at DESC`);
    const orderIds = orders.map(o => o.id);
    let items = [];
    if (orderIds.length) {
      items = await all(db, `SELECT * FROM order_items WHERE order_id IN (${orderIds.map(() => '?').join(',')})`, orderIds);
    }
    const orderIdToItems = new Map();
    for (const it of items) {
      if (!orderIdToItems.has(it.order_id)) orderIdToItems.set(it.order_id, []);
      orderIdToItems.get(it.order_id).push({
        id: it.id,
        productId: it.product_id,
        title: it.title,
        price: it.price,
        quantity: it.quantity
      });
    }

    // notes
    let notes = [];
    if (orderIds.length) {
      notes = await all(db, `SELECT * FROM order_notes WHERE order_id IN (${orderIds.map(() => '?').join(',')}) ORDER BY timestamp ASC`, orderIds);
    }
    const orderIdToNotes = new Map();
    for (const n of notes) {
      if (!orderIdToNotes.has(n.order_id)) orderIdToNotes.set(n.order_id, []);
      orderIdToNotes.get(n.order_id).push({
        id: n.id,
        text: n.text,
        type: n.type,
        timestamp: n.timestamp
      });
    }

    const result = [];
    for (const o of orders) {
      const customer = o.customer_id ? await get(db, `SELECT * FROM customers WHERE id = ?`, [o.customer_id]) : null;
      result.push({
        id: o.id,
        orderNumber: o.order_number,
        status: o.status,
        pricing: JSON.parse(o.pricing_json),
        items: orderIdToItems.get(o.id) || [],
        customerInfo: customer || { name: '', phone: '', email: null, address: null },
        notes: orderIdToNotes.get(o.id) || [],
        createdAt: o.created_at,
        updatedAt: o.updated_at
      });
    }
    res.json(result);
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to fetch orders' });
  }
});

app.post('/api/orders', async (req, res) => {
  try {
    const { orderForm, cartItems, priceCalculation, orderNumber } = req.body;

    // customer
    let customerId = null;
    if (orderForm) {
      const r = await run(
        db,
        `INSERT INTO customers (name, phone, email, address) VALUES (?, ?, ?, ?)`,
        [orderForm.name, orderForm.phone, orderForm.email ?? null, orderForm.address ?? null]
      );
      customerId = r.lastID;
    }

    const id = String(orderNumber);
    await run(
      db,
      `INSERT INTO orders (id, order_number, customer_id, status, pricing_json) VALUES (?, ?, ?, 'new', ?)` ,
      [id, String(orderNumber), customerId, JSON.stringify(priceCalculation)]
    );

    if (Array.isArray(cartItems)) {
      for (const it of cartItems) {
        await run(
          db,
          `INSERT INTO order_items (order_id, product_id, title, price, quantity) VALUES (?, ?, ?, ?, ?)`,
          [id, it.id ?? null, it.title, it.price, it.quantity]
        );
      }
    }

    res.status(201).json({ ok: true, id, orderNumber });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to create order' });
  }
});

// Orders: update status
app.patch('/api/orders/:id/status', async (req, res) => {
  try {
    const { id } = req.params;
    const { status } = req.body;
    await run(db, `UPDATE orders SET status=?, updated_at = datetime('now') WHERE id=?`, [status, id]);
    res.json({ ok: true });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to update status' });
  }
});

// Orders: add note
app.post('/api/orders/:id/notes', async (req, res) => {
  try {
    const { id } = req.params;
    const { text, type = 'note' } = req.body;
    const r = await run(db, `INSERT INTO order_notes (order_id, text, type) VALUES (?, ?, ?)`, [id, text, type]);
    res.status(201).json({ id: r.lastID });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to add note' });
  }
});

// Orders: hard delete (used for cancelled orders cleanup)
app.delete('/api/orders/:id', async (req, res) => {
  try {
    const { id } = req.params;
    // –£–¥–∞–ª—è–µ–º —Å–≤—è–∑–∞–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏ —è–≤–Ω–æ, —á—Ç–æ–±—ã –Ω–µ –∑–∞–≤–∏—Å–µ—Ç—å –æ—Ç PRAGMA foreign_keys
    await run(db, `DELETE FROM order_items WHERE order_id = ?`, [id]);
    await run(db, `DELETE FROM order_notes WHERE order_id = ?`, [id]);
    await run(db, `DELETE FROM orders WHERE id = ?`, [id]);
    res.json({ ok: true });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: 'Failed to delete order' });
  }
});

// Admin: normalize product IDs to be sequential starting from 1
app.post('/api/_admin/normalize/products', async (req, res) => {
  try {
    await run(db, 'PRAGMA foreign_keys = OFF');
    await run(db, 'BEGIN TRANSACTION');

    // Create temp table with same schema as products
    await run(
      db,
      `CREATE TABLE IF NOT EXISTS products_tmp (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        title TEXT NOT NULL,
        price INTEGER NOT NULL,
        category_id INTEGER,
        subcategory_id INTEGER,
        brand_id INTEGER,
        available INTEGER NOT NULL DEFAULT 1,
        quantity INTEGER NOT NULL DEFAULT 0,
        description TEXT,
        specifications_json TEXT,
        features_json TEXT,
        created_at TEXT NOT NULL DEFAULT (datetime('now')),
        updated_at TEXT NOT NULL DEFAULT (datetime('now')),
        FOREIGN KEY (category_id) REFERENCES categories(id) ON DELETE SET NULL,
        FOREIGN KEY (subcategory_id) REFERENCES subcategories(id) ON DELETE SET NULL,
        FOREIGN KEY (brand_id) REFERENCES brands(id) ON DELETE SET NULL
      )`
    );

    const products = await all(db, `SELECT * FROM products ORDER BY id ASC`);
    const idMap = new Map();
    for (const p of products) {
      const r = await run(
        db,
        `INSERT INTO products_tmp (title, price, category_id, subcategory_id, brand_id, available, quantity, description, specifications_json, features_json, created_at, updated_at)
         VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)`,
        [
          p.title,
          p.price,
          p.category_id,
          p.subcategory_id,
          p.brand_id,
          p.available,
          p.quantity,
          p.description,
          p.specifications_json,
          p.features_json,
          p.created_at,
          p.updated_at,
        ]
      );
      idMap.set(p.id, r.lastID);
    }

    // Update references in product_images
    const imgs = await all(db, `SELECT id, product_id FROM product_images`);
    for (const img of imgs) {
      const newId = idMap.get(img.product_id);
      if (newId) {
        await run(db, `UPDATE product_images SET product_id=? WHERE id=?`, [newId, img.id]);
      }
    }

    // Update references in order_items
    const orderItems = await all(db, `SELECT id, product_id FROM order_items WHERE product_id IS NOT NULL`);
    for (const it of orderItems) {
      const newId = idMap.get(it.product_id);
      if (newId) {
        await run(db, `UPDATE order_items SET product_id=? WHERE id=?`, [newId, it.id]);
      }
    }

    // Replace products table
    await run(db, `DROP TABLE products`);
    await run(db, `ALTER TABLE products_tmp RENAME TO products`);
    await run(db, 'COMMIT');
    await run(db, 'PRAGMA foreign_keys = ON');

    res.json({ ok: true, remapped: products.length });
  } catch (err) {
    try { await run(db, 'ROLLBACK'); } catch {}
    await run(db, 'PRAGMA foreign_keys = ON');
    console.error(err);
    res.status(500).json({ error: 'Failed to normalize product IDs' });
  }
});

app.listen(PORT, () => {
  console.log(`API server listening on http://localhost:${PORT}`);
});


// Debug: list registered routes
app.get('/api/_debug/routes', (req, res) => {
  try {
    const routes = [];
    app._router.stack.forEach((m) => {
      if (m.route && m.route.path) {
        routes.push({ path: m.route.path, methods: m.route.methods });
      }
      if (m.name === 'router' && m.handle && m.handle.stack) {
        m.handle.stack.forEach((h) => {
          if (h.route && h.route.path) {
            routes.push({ path: h.route.path, methods: h.route.methods });
          }
        });
      }
    });
    res.json(routes);
  } catch (e) {
    res.status(500).json({ error: String(e) });
  }
});


```

```javascriptreact
*** Begin Patch
*** Update File: src/context/OrdersContext.jsx
@@
-  // –£–¥–∞–ª–∏—Ç—å –∑–∞–∫–∞–∑ (—Ç–æ–ª—å–∫–æ –¥–ª—è –æ—Ç–º–µ–Ω–µ–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤)
-  const deleteOrder = (orderId) => {
-    setOrders(prev => prev.filter(order => order.id !== orderId));
-  };
+  // –£–¥–∞–ª–∏—Ç—å –∑–∞–∫–∞–∑ (—Ç–æ–ª—å–∫–æ –¥–ª—è –æ—Ç–º–µ–Ω–µ–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤) + API
+  const deleteOrder = async (orderId) => {
+    try {
+      await fetch(`/api/orders/${orderId}`, { method: 'DELETE' });
+      const list = await fetch('/api/orders').then(r => r.json());
+      setOrders(Array.isArray(list) ? list : []);
+    } catch (e) {
+      // fallback –ª–æ–∫–∞–ª—å–Ω–æ
+      setOrders(prev => prev.filter(order => order.id !== orderId));
+    }
+  };
*** End Patch
```

```javascriptreact
import React, { createContext, useContext, useState, useEffect } from 'react';

const OrdersContext = createContext();

export const useOrders = () => {
  const context = useContext(OrdersContext);
  if (!context) {
    throw new Error('useOrders must be used within an OrdersProvider');
  }
  return context;
};

// –°—Ç–∞—Ç—É—Å—ã –∑–∞–∫–∞–∑–æ–≤
export const ORDER_STATUSES = {
  NEW: 'new',
  CONFIRMED: 'confirmed',
  PROCESSING: 'processing',
  SHIPPED: 'shipped',
  DELIVERED: 'delivered',
  CANCELLED: 'cancelled'
};

// –ù–∞–∑–≤–∞–Ω–∏—è —Å—Ç–∞—Ç—É—Å–æ–≤ –Ω–∞ —Ä—É—Å—Å–∫–æ–º
export const STATUS_LABELS = {
  [ORDER_STATUSES.NEW]: '–ù–æ–≤—ã–π',
  [ORDER_STATUSES.CONFIRMED]: '–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω',
  [ORDER_STATUSES.PROCESSING]: '–í –æ–±—Ä–∞–±–æ—Ç–∫–µ',
  [ORDER_STATUSES.SHIPPED]: '–û—Ç–ø—Ä–∞–≤–ª–µ–Ω',
  [ORDER_STATUSES.DELIVERED]: '–î–æ—Å—Ç–∞–≤–ª–µ–Ω',
  [ORDER_STATUSES.CANCELLED]: '–û—Ç–º–µ–Ω–µ–Ω'
};

// –¶–≤–µ—Ç–∞ –¥–ª—è —Å—Ç–∞—Ç—É—Å–æ–≤
export const STATUS_COLORS = {
  [ORDER_STATUSES.NEW]: '#3b82f6',
  [ORDER_STATUSES.CONFIRMED]: '#f59e0b',
  [ORDER_STATUSES.PROCESSING]: '#8b5cf6',
  [ORDER_STATUSES.SHIPPED]: '#06b6d4',
  [ORDER_STATUSES.DELIVERED]: '#e6a34a',
  [ORDER_STATUSES.CANCELLED]: '#ef4444'
};

export const OrdersProvider = ({ children }) => {
  const [orders, setOrders] = useState([]);

  // –ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–∫–∞–∑–æ–≤ —Å —Å–µ—Ä–≤–µ—Ä–∞ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
  useEffect(() => {
    const loadOrders = async () => {
      try {
        const response = await fetch('/api/orders');
        if (!response.ok) throw new Error('Failed to load orders');
        const data = await response.json();
        setOrders(Array.isArray(data) ? data : []);
      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∑–∞–∫–∞–∑–æ–≤ —Å —Å–µ—Ä–≤–µ—Ä–∞:', error);
        setOrders([]);
      }
    };
    loadOrders();
  }, []);

  // –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –∑–∞–∫–∞–∑
  const createOrder = async (orderData) => {
    try {
      const response = await fetch('/api/orders', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(orderData)
      });
      if (!response.ok) throw new Error('Failed to create order');
      const saved = await response.json();

      // –û–±–Ω–æ–≤–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–≤–µ–∂–µ–π –∫–æ–ø–∏–µ–π —Å —Å–µ—Ä–≤–µ—Ä–∞
      const list = await fetch('/api/orders').then(r => r.json());
      setOrders(Array.isArray(list) ? list : []);

      return saved;
    } catch (error) {
      console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–∫–∞–∑–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:', error);
      throw error;
    }
  };

  // –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞
  const updateOrderStatus = async (orderId, newStatus, note = '') => {
    await fetch(`/api/orders/${orderId}/status`, {
      method: 'PATCH',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ status: newStatus })
    });
    if (note) {
      await fetch(`/api/orders/${orderId}/notes`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ text: note, type: 'status_change' })
      });
    }
    const list = await fetch('/api/orders').then(r => r.json());
    setOrders(Array.isArray(list) ? list : []);
  };

  // –î–æ–±–∞–≤–∏—Ç—å –∑–∞–º–µ—Ç–∫—É –∫ –∑–∞–∫–∞–∑—É
  const addOrderNote = async (orderId, noteText) => {
    await fetch(`/api/orders/${orderId}/notes`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ text: noteText, type: 'note' })
    });
    const list = await fetch('/api/orders').then(r => r.json());
    setOrders(Array.isArray(list) ? list : []);
  };

  // –ü–æ–ª—É—á–∏—Ç—å –∑–∞–∫–∞–∑ –ø–æ ID
  const getOrderById = (orderId) => {
    return orders.find(order => order.id === orderId);
  };

  // –ü–æ–ª—É—á–∏—Ç—å –∑–∞–∫–∞–∑—ã –ø–æ —Å—Ç–∞—Ç—É—Å—É
  const getOrdersByStatus = (status) => {
    return orders.filter(order => order.status === status);
  };

  // –ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∑–∞–∫–∞–∑–æ–≤
  const getOrdersStats = () => {
    const stats = {
      total: orders.length,
      byStatus: {},
      totalRevenue: 0,
      recentOrders: orders.slice(0, 5)
    };

    // –ü–æ–¥—Å—á–µ—Ç –ø–æ —Å—Ç–∞—Ç—É—Å–∞–º
    Object.values(ORDER_STATUSES).forEach(status => {
      stats.byStatus[status] = orders.filter(order => order.status === status).length;
    });

    // –ü–æ–¥—Å—á–µ—Ç –æ–±—â–µ–π –≤—ã—Ä—É—á–∫–∏ (—Ç–æ–ª—å–∫–æ –¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–µ –∑–∞–∫–∞–∑—ã)
    stats.totalRevenue = orders
      .filter(order => order.status === ORDER_STATUSES.DELIVERED)
      .reduce((sum, order) => sum + (order.pricing?.total || 0), 0);

    return stats;
  };

  // –£–¥–∞–ª–∏—Ç—å –∑–∞–∫–∞–∑ (—Ç–æ–ª—å–∫–æ –¥–ª—è –æ—Ç–º–µ–Ω–µ–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤) ‚Äî —Å–µ—Ä–≤–µ—Ä–Ω—ã–π hard delete
  const deleteOrder = async (orderId) => {
    try {
      await fetch(`/api/orders/${orderId}`, { method: 'DELETE' });
      const list = await fetch('/api/orders').then(r => r.json());
      setOrders(Array.isArray(list) ? list : []);
    } catch (e) {
      setOrders(prev => prev.filter(order => order.id !== orderId));
    }
  };

  // –ü–æ–∏—Å–∫ –∑–∞–∫–∞–∑–æ–≤
  const searchOrders = (query) => {
    const lowercaseQuery = query.toLowerCase();
    return orders.filter(order => 
      order.orderNumber.toLowerCase().includes(lowercaseQuery) ||
      order.customerInfo.name.toLowerCase().includes(lowercaseQuery) ||
      order.customerInfo.phone.includes(lowercaseQuery) ||
      (order.customerInfo.email && order.customerInfo.email.toLowerCase().includes(lowercaseQuery))
    );
  };

  const value = {
    orders,
    createOrder,
    updateOrderStatus,
    addOrderNote,
    getOrderById,
    getOrdersByStatus,
    getOrdersStats,
    deleteOrder,
    searchOrders,
    ORDER_STATUSES,
    STATUS_LABELS,
    STATUS_COLORS
  };

  return (
    <OrdersContext.Provider value={value}>
      {children}
    </OrdersContext.Provider>
  );
};

```

–°–¥–µ–ª–∞–ª —É–¥–∞–ª–µ–Ω–∏–µ –æ—Ç–º–µ–Ω—ë–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤ ‚Äú–Ω–∞—Å—Ç–æ—è—â–∏–º‚Äù:
- –ë—ç–∫–µ–Ω–¥: –¥–æ–±–∞–≤–∏–ª —ç–Ω–¥–ø–æ–∏–Ω—Ç `DELETE /api/orders/:id`, –∫–æ—Ç–æ—Ä—ã–π —É–¥–∞–ª—è–µ—Ç –∑–∞–∫–∞–∑ –∏ —Å–≤—è–∑–∞–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏ (`order_items`, `order_notes`) –∏–∑ –ë–î.
- –§—Ä–æ–Ω—Ç–µ–Ω–¥ (–∞–¥–º–∏–Ω–∫–∞): –∫–Ω–æ–ø–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –≤ —Ä–∞–∑–¥–µ–ª–µ –∑–∞–∫–∞–∑–æ–≤ —Ç–µ–ø–µ—Ä—å –≤—ã–∑—ã–≤–∞–µ—Ç —Å–µ—Ä–≤–µ—Ä–Ω—ã–π `DELETE` –∏ –∑–∞—Ç–µ–º –ø–µ—Ä–µ—á–∏—Ç—ã–≤–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –∑–∞–∫–∞–∑–æ–≤.

–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã —É–¥–∞–ª—ë–Ω–Ω—ã–µ –æ—Ç–º–µ–Ω—ë–Ω–Ω—ã–µ –∑–∞–∫–∞–∑—ã –±–æ–ª—å—à–µ –Ω–µ –≤–µ—Ä–Ω—É—Ç—Å—è.

---

**User**

–ö–Ω–æ–ø–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞ —Ç–µ–ø–µ—Ä—å –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –ø—Ä–∏–Ω—Ü–∏–ø–µ 

---

**Cursor**

–Ø –ø—Ä–æ–≤–µ—Ä—é —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é —É–¥–∞–ª–µ–Ω–∏—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –∏ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ –∑–∞–∫–∞–∑–æ–≤, –∑–∞–ø—É—â—É –ª–æ–∫–∞–ª—å–Ω—ã–π –≤—ã–∑–æ–≤ DELETE –¥–ª—è —Ç–µ—Å—Ç–∞ –∏ –ø–æ—Å–º–æ—Ç—Ä—é –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞, —á—Ç–æ–±—ã –∏—Å–ø—Ä–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É —É–¥–∞–ª–µ–Ω–∏—è.

–ü—Ä–æ–≤–µ—Ä—é —Å—Ö–µ–º—É –ë–î –∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ç–∏–ø–æ–≤ `id` –∑–∞–∫–∞–∑–∞ (—Å—Ç—Ä–æ–∫–∞ vs —á–∏—Å–ª–æ), –∞ —Ç–∞–∫–∂–µ –≤—ã–∑–æ–≤—É DELETE –ª–æ–∫–∞–ª—å–Ω–æ, —á—Ç–æ–±—ã –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏ –ø—Ä–æ–±–ª–µ–º—É. –ó–∞—Ç–µ–º –ø–æ–ø—Ä–∞–≤–ª—é —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥/–±—ç–∫–µ–Ω–¥, —á—Ç–æ–±—ã —É–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞–±–∏–ª—å–Ω–æ —Ä–∞–±–æ—Ç–∞–ª–æ.

–°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—é –Ω–∞–ª–∏—á–∏–µ –º–∞—Ä—à—Ä—É—Ç–∞ DELETE –∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∑–∞–∫–∞–∑–æ–≤ —á–µ—Ä–µ–∑ HTTP-–∑–∞–ø—Ä–æ—Å—ã, –∑–∞—Ç–µ–º –ø–æ–ø—Ä–æ–±—É—é —É–¥–∞–ª–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –∑–∞–∫–∞–∑, —á—Ç–æ–±—ã –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏ –ø—Ä–æ–±–ª–µ–º—É. –í—ã–ø–æ–ª–Ω—è—é –∑–∞–ø—Ä–æ—Å—ã –∫ —Å–µ—Ä–≤–µ—Ä—É.

---

**User**

–°–¥–µ–ª–∞–ª?

---

**Cursor**

–°–µ–π—á–∞—Å –ø—Ä–æ–≤–µ—Ä—é —É–¥–∞–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ API –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º –∑–∞–∫–∞–∑–µ –∏ –∑–∞—Ç–µ–º –ø–µ—Ä–µ—á–∏—Ç–∞—é —Å–ø–∏—Å–æ–∫, —á—Ç–æ–±—ã —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —É–¥–∞–ª—è–µ—Ç –∑–∞–ø–∏—Å—å. –í—ã–ø–æ–ª–Ω—è—é –∫–æ–º–∞–Ω–¥—ã.

–°–Ω–∞—á–∞–ª–∞ –ø–µ—Ä–µ–∑–∞–ø—É—â—É —Å–µ—Ä–≤–µ—Ä API, —á—Ç–æ–±—ã –ø–æ–¥—Ç—è–Ω—É—Ç—å –Ω–æ–≤—ã–π –º–∞—Ä—à—Ä—É—Ç DELETE. –ó–∞—Ç–µ–º –ø—Ä–æ–≤–µ—Ä—é —É–¥–∞–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞ —á–µ—Ä–µ–∑ –∑–∞–ø—Ä–æ—Å –∏ —É–±–µ–¥—é—Å—å, —á—Ç–æ –æ–Ω –∏—Å—á–µ–∑–∞–µ—Ç –∏–∑ —Å–ø–∏—Å–∫–∞.

–ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞—é backend, —á—Ç–æ–±—ã –ø–æ–¥—Ç—è–Ω—É—Ç—å –Ω–æ–≤—ã–π –º–∞—Ä—à—Ä—É—Ç DELETE, –∑–∞—Ç–µ–º –ø—Ä–æ–≤–µ—Ä—é —É–¥–∞–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞ —á–µ—Ä–µ–∑ API –∏ —É–±–µ–¥—é—Å—å, —á—Ç–æ —Å–ø–∏—Å–æ–∫ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è.

---

**User**

–ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–π 

---

**Cursor**

–ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞—é backend –∏ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥, –∑–∞—Ç–µ–º –ø—Ä–æ–≤–µ—Ä—é —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å —É–¥–∞–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ API.

---

**User**

–ø—Ä–æ–¥–æ–ª–∂–∞–π

---

**Cursor**

–°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—é —Ç–µ–∫—É—â–∏–π —Å–ø–∏—Å–æ–∫ –∑–∞–∫–∞–∑–æ–≤ (—á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å id), –∑–∞—Ç–µ–º –æ—Ç–ø—Ä–∞–≤–ª—é DELETE –¥–ª—è –æ–¥–Ω–æ–≥–æ –æ—Ç–º–µ–Ω—ë–Ω–Ω–æ–≥–æ –∑–∞–∫–∞–∑–∞ –∏ —Å–Ω–æ–≤–∞ –ø–µ—Ä–µ—á–∏—Ç–∞—é —Å–ø–∏—Å–æ–∫ –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è.

–°–¥–µ–ª–∞–ª –∏ –ø—Ä–æ–≤–µ—Ä–∏–ª:
- –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏–ª backend –∏ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥.
- –î–æ–±–∞–≤–∏–ª —Å–µ—Ä–≤–µ—Ä–Ω—ã–π DELETE `/api/orders/:id` –∏ –ø—Ä–æ–≤–µ—Ä–∏–ª —á–µ—Ä–µ–∑ API ‚Äî –æ—Ç–º–µ–Ω—ë–Ω–Ω—ã–π –∑–∞–∫–∞–∑ —É–¥–∞–ª—è–µ—Ç—Å—è –∏ –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è.
- –û–±–Ω–æ–≤–∏–ª `deleteOrder` –≤ `OrdersContext` ‚Äî —Ç–µ–ø–µ—Ä—å –≤—ã–∑—ã–≤–∞–µ—Ç DELETE –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –∏ –ø–µ—Ä–µ—á–∏—Ç—ã–≤–∞–µ—Ç —Å–ø–∏—Å–æ–∫.

–í–∞–∂–Ω–æ: –∫–Ω–æ–ø–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–Ω–∞ –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –¥–ª—è –∑–∞–∫–∞–∑–æ–≤ —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º ‚Äú–û—Ç–º–µ–Ω–µ–Ω‚Äù. –û–±–Ω–æ–≤–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—É –∞–¥–º–∏–Ω–∫–∏ –∏ –ø–æ–ø—Ä–æ–±—É–π —É–¥–∞–ª–∏—Ç—å –æ—Ç–º–µ–Ω—ë–Ω–Ω—ã–π –∑–∞–∫–∞–∑ ‚Äî –æ–Ω –∏—Å—á–µ–∑–Ω–µ—Ç –∏ –Ω–µ –ø–æ—è–≤–∏—Ç—Å—è —Å–Ω–æ–≤–∞.

- –ò–∑–º–µ–Ω–µ–Ω–∏—è: –¥–æ–±–∞–≤–ª–µ–Ω –º–∞—Ä—à—Ä—É—Ç `DELETE /api/orders/:id` –≤ `server/index.js`; –æ–±–Ω–æ–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `deleteOrder` –≤ `src/context/OrdersContext.jsx`.
- –≠—Ñ—Ñ–µ–∫—Ç: —É–¥–∞–ª–µ–Ω–∏–µ –æ—Ç–º–µ–Ω—ë–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤ –ë–î, –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –æ–Ω–∏ –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è.

---

**User**

–ï—Å–ª–∏ –≤ –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö —Ç–æ–≤–∞—Ä–∞—Ö –Ω–∏—á–µ–≥–æ –Ω–µ—Ç, —Ç–æ –Ω–∞ —Å–∞–π—Ç–µ –∫—Ä–∞—Å–∏–≤–æ –¥–æ–ª–∂–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ –æ —Ç–æ–º —á—Ç–æ –ø–æ–∫–∞ –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤ –Ω–µ—Ç 

---

**Cursor**

–°–Ω–∞—á–∞–ª–∞ –Ω–∞–π–¥—É –∏ –æ—Ç–∫—Ä–æ—é `src/pages/Home.jsx`, —á—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø—É—Å—Ç–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è –¥–ª—è –±–ª–æ–∫–∞ –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤. –ó–∞—Ç–µ–º –≤–Ω–µ—Å—É –ø—Ä–∞–≤–∫—É –∏ —Å–æ—Ö—Ä–∞–Ω—é.

–°–¥–µ–ª–∞—é –ø—Ä–∞–≤–∫—É –≤ `src/pages/Home.jsx`: –¥–æ–±–∞–≤–ª—é —É—Å–ª–æ–≤–Ω—ã–π —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ –ø—É—Å—Ç–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è –¥–ª—è –±–ª–æ–∫–∞ –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤ —Å –∞–∫–∫—É—Ä–∞—Ç–Ω—ã–º –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ–º –∏ —Å—Å—ã–ª–∫–æ–π –≤ –∫–∞—Ç–∞–ª–æ–≥. –ó–∞—Ç–µ–º —Å–æ—Ö—Ä–∞–Ω—è—é.

```javascriptreact
import React from 'react';
import { Link } from 'react-router-dom';
import { 
  FaTruck, 
  FaTools, 
  FaShieldAlt, 
  FaArrowRight,
  FaStar
} from 'react-icons/fa';
import { useAdminData } from '../context/AdminDataContext';
// wishlist removed
import { getMainImage, isImageUrl } from '../utils/imageHelpers';
import HeroVisual from '../components/HeroVisual';

function Home() {
  const HERO_IMAGE_URL = 'https://images.pexels.com/photos/162553/engine-displacement-piston-162553.jpeg?auto=compress&cs=tinysrgb&w=1600';
  const { products, popularProductIds } = useAdminData();
  
  // wishlist removed
  
  const features = [
    {
      icon: <FaTruck />,
      title: "–ë—ã—Å—Ç—Ä–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞",
      text: "–î–æ—Å—Ç–∞–≤–ª—è–µ–º –∑–∞–ø—á–∞—Å—Ç–∏ –ø–æ –≤—Å–µ–π –†–æ—Å—Å–∏–∏ –≤ –∫—Ä–∞—Ç—á–∞–π—à–∏–µ —Å—Ä–æ–∫–∏"
    },
    {
      icon: <FaTools />,
      title: "–ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –¥–µ—Ç–∞–ª–∏",
      text: "–¢–æ–ª—å–∫–æ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ –∏ —Å–µ—Ä—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—á–∞—Å—Ç–∏"
    },
    {
      icon: <FaShieldAlt />,
      title: "–ì–∞—Ä–∞–Ω—Ç–∏—è –∫–∞—á–µ—Å—Ç–≤–∞",
      text: "–ü–æ–ª–Ω–∞—è –≥–∞—Ä–∞–Ω—Ç–∏—è –Ω–∞ –≤—Å–µ —Ç–æ–≤–∞—Ä—ã –∏ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞"
    }
  ];

  // –ü–æ–ª—É—á–∞–µ–º –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –ø–æ ID
  const popularProducts = popularProductIds
    .map(id => products.find(product => product.id === id))
    .filter(product => product) // –£–±–∏—Ä–∞–µ–º undefined –µ—Å–ª–∏ —Ç–æ–≤–∞—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω
    .map(product => ({
      id: product.id,
      title: product.title,
      price: `${product.price.toLocaleString()} ‚ÇΩ`,
      icon: getMainImage(product)?.data || 'üì¶'
    }));

  // –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –º–∞—Å—Å–∏–≤ –¥–ª—è —Å–ø—Ä–∞–≤–∫–∏:
  const _originalPopularProducts = [
    {
      id: 11,
      title: "–ì—É—Å–µ–Ω–∏—Ü—ã –¥–ª—è –≤–µ–∑–¥–µ—Ö–æ–¥–∞",
      price: "45,000 ‚ÇΩ",
      icon: "üîó"
    },
    {
      id: 1,
      title: "–î–≤–∏–≥–∞—Ç–µ–ª—å 2.0L –¥–∏–∑–µ–ª—å–Ω—ã–π",
      price: "180,000 ‚ÇΩ",
      icon: "‚öôÔ∏è"
    },
    {
      id: 8,
      title: "–ö–æ—Ä–æ–±–∫–∞ –ø–µ—Ä–µ–¥–∞—á –º–µ—Ö–∞–Ω–∏—á–µ—Å–∫–∞—è",
      price: "95,000 ‚ÇΩ",
      icon: "üîß"
    },
    {
      id: 12,
      title: "–ê–º–æ—Ä—Ç–∏–∑–∞—Ç–æ—Ä –ø–µ—Ä–µ–¥–Ω–∏–π",
      price: "12,000 ‚ÇΩ",
      icon: "üõ†Ô∏è"
    },
    {
      id: 15,
      title: "–ê–∫–∫—É–º—É–ª—è—Ç–æ—Ä 12V 100Ah",
      price: "15,000 ‚ÇΩ",
      icon: "üîã"
    },
    {
      id: 17,
      title: "–°–∏–¥–µ–Ω—å–µ –≤–æ–¥–∏—Ç–µ–ª—è",
      price: "25,000 ‚ÇΩ",
      icon: "ü™ë"
    }
  ];

  return (
    <div>
      <section className="hero">
        <div className="container">
          <div className="hero-content">
            <div className="hero-text">
              <h1>–ó–∞–ø—á–∞—Å—Ç–∏ –¥–ª—è –≤–µ–∑–¥–µ—Ö–æ–¥–æ–≤</h1>
              <p>
                –ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∑–∞–ø—á–∞—Å—Ç–∏ –¥–ª—è –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ –≤–µ–∑–¥–µ—Ö–æ–¥–æ–≤. 
                –ë—ã—Å—Ç—Ä–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞ –ø–æ –≤—Å–µ–π –†–æ—Å—Å–∏–∏. –ì–∞—Ä–∞–Ω—Ç–∏—è –∫–∞—á–µ—Å—Ç–≤–∞ –Ω–∞ –≤—Å–µ —Ç–æ–≤–∞—Ä—ã.
              </p>
              <Link to="/catalog" className="cta-button">
                –ü–µ—Ä–µ–π—Ç–∏ –≤ –∫–∞—Ç–∞–ª–æ–≥
                <FaArrowRight />
              </Link>
            </div>
            <div className="hero-image">
              <div className="hero-placeholder">
                <HeroVisual />
              </div>
              <p>–ù–∞–¥—ë–∂–Ω—ã–µ –∑–∞–ø—á–∞—Å—Ç–∏ –¥–ª—è –≤–∞—à–µ–≥–æ –≤–µ–∑–¥–µ—Ö–æ–¥–∞</p>
            </div>
          </div>
        </div>
      </section>

      <section className="features">
        <div className="container">
          <h2 className="section-title">–ü–æ—á–µ–º—É –≤—ã–±–∏—Ä–∞—é—Ç –Ω–∞—Å</h2>
          <div className="features-grid">
            {features.map((feature, index) => (
              <div key={index} className="feature-card">
                <div className="feature-icon">{feature.icon}</div>
                <h3 className="feature-title">{feature.title}</h3>
                <p className="feature-text">{feature.text}</p>
              </div>
            ))}
          </div>
        </div>
      </section>

      <section className="products">
        <div className="container">
          <h2 className="section-title">–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã</h2>

          {popularProducts.length === 0 ? (
            <div
              style={{
                display: 'flex',
                alignItems: 'center',
                justifyContent: 'center',
                padding: '2rem',
                borderRadius: '16px',
                border: '1px solid rgba(255,255,255,0.1)',
                background: 'linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.02))',
                boxShadow: '0 10px 30px rgba(0,0,0,0.2)',
                textAlign: 'center'
              }}
            >
              <div>
                <div style={{ fontSize: '2.2rem', color: '#ffd166', marginBottom: '0.5rem' }}>
                  <FaStar style={{ verticalAlign: 'middle' }} />
                </div>
                <h3 style={{ margin: '0 0 0.5rem' }}>–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã —Å–∫–æ—Ä–æ –ø–æ—è–≤—è—Ç—Å—è</h3>
                <p style={{ opacity: 0.85, margin: '0 0 1rem' }}>
                  –°–µ–π—á–∞—Å –º—ã —Å–æ–±–∏—Ä–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ –ø–æ–∫—É–ø–∫–∞–º. –í –∫–∞—Ç–∞–ª–æ–≥–µ —É–∂–µ –º–Ω–æ–≥–æ –æ—Ç–ª–∏—á–Ω—ã—Ö –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π.
                </p>
                <Link to="/catalog" className="cta-button">
                  –ü–µ—Ä–µ–π—Ç–∏ –≤ –∫–∞—Ç–∞–ª–æ–≥ <FaArrowRight />
                </Link>
              </div>
            </div>
          ) : (
            <div className="products-grid">
              {popularProducts.map((product) => (
                <Link to={`/product/${product.id}`} key={product.id} className="product-card">
                  <div className="product-image">
                    {(() => {
                      const productData = products.find(p => p.id === product.id);
                      if (!productData) return <span className="product-icon">{product.icon}</span>;

                      const mainImage = getMainImage(productData);
                      if (mainImage?.data) {
                        if (
                          typeof mainImage.data === 'string' &&
                          (mainImage.data.startsWith('data:image') || isImageUrl(mainImage.data))
                        ) {
                          return (
                            <img
                              src={mainImage.data}
                              alt={product.title}
                              className="product-image-img"
                            />
                          );
                        }
                        return <span className="product-icon">{mainImage.data}</span>;
                      }
                      return <span className="product-icon">{product.icon}</span>;
                    })()}
                  </div>
                  <div className="product-info">
                    <h3 className="product-title">{product.title}</h3>
                    <div className="product-price">{product.price}</div>
                    <button className="product-button">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</button>
                  </div>
                </Link>
              ))}
            </div>
          )}
        </div>
      </section>
    </div>
  );
}

export default Home;

```

–°–¥–µ–ª–∞–ª –∫—Ä–∞—Å–∏–≤–æ–µ –ø—É—Å—Ç–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è –±–ª–æ–∫–∞ ‚Äú–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã‚Äù:
- –ï—Å–ª–∏ —Å–ø–∏—Å–æ–∫ –ø—É—Å—Ç, –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –∫–∞—Ä—Ç–æ—á–∫–∞ —Å –∏–∫–æ–Ω–∫–æ–π –∏ —Ç–µ–∫—Å—Ç–æ–º ‚Äú–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã —Å–∫–æ—Ä–æ –ø–æ—è–≤—è—Ç—Å—è‚Äù –∏ –∫–Ω–æ–ø–∫–æ–π –ø–µ—Ä–µ—Ö–æ–¥–∞ –≤ –∫–∞—Ç–∞–ª–æ–≥.
- –ü—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ —Ç–æ–≤–∞—Ä–æ–≤ –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ —Ä–∞–Ω—å—à–µ.

–ò–∑–º–µ–Ω–µ–Ω–∏—è: `src/pages/Home.jsx`.

---

**User**

–í –∞–¥–º–∏–Ω–∫—É –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫ –∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏ –¥–ª—è –¥–æ–ø —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏

---

**Cursor**

–ß–∏—Ç–∞—é —Ñ–∞–π–ª—ã –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞–º–∏, —á—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫ –∏ –∫–Ω–æ–ø–∫—É –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Å—Ç—Ä–æ–∫–∏. –ó–∞—Ç–µ–º –≤–Ω–µ—Å—É –ø—Ä–∞–≤–∫–∏ –≤ UI –∏ —Å–æ—Ö—Ä–∞–Ω—é.

```javascriptreact
import React, { useState } from 'react';
import { useAdminData } from '../../context/AdminDataContext';
import { FaPlus, FaEdit, FaTrash, FaSave, FaTimes } from 'react-icons/fa';
import MultiImageUpload from '../../components/MultiImageUpload';
import { migrateProductImages, getMainImage } from '../../utils/imageHelpers';
import './ProductManagement.css';

export default function ProductManagement() {
  const { products, categories, brands, addProduct, updateProduct, deleteProduct } = useAdminData();
  const [editingProduct, setEditingProduct] = useState(null);
  const [isCreating, setIsCreating] = useState(false);
  const [formData, setFormData] = useState({
    title: '',
    price: '',
    category: '',
    subcategory: '',
    brand: '',
    available: true,
    quantity: 0,
    images: [],
    description: '',
    specifications: [{ name: '', value: '' }],
    features: []
  });

  const categoryList = Object.keys(categories);

  const handleInputChange = (e) => {
    const { name, value, type, checked } = e.target;
    setFormData(prev => ({
      ...prev,
      [name]: type === 'checkbox' ? checked : value
    }));
  };

  const handleCategoryChange = (e) => {
    const selectedCategory = e.target.value;
    setFormData(prev => ({
      ...prev,
      category: selectedCategory,
      subcategory: '' // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—é –ø—Ä–∏ —Å–º–µ–Ω–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
    }));
  };

  const startCreating = () => {
    setIsCreating(true);
    setEditingProduct(null);
    setFormData({
      title: '',
      price: '',
      category: '',
      subcategory: '',
      brand: '',
      available: true,
      quantity: 0,
      images: [],
      description: '',
      specifications: [{ name: '', value: '' }],
      features: []
    });
  };

  const startEditing = (product) => {
    setEditingProduct(product.id);
    setIsCreating(false);
    const migratedProduct = migrateProductImages(product);
    setFormData({ ...migratedProduct });
  };

  const cancelEditing = () => {
    setEditingProduct(null);
    setIsCreating(false);
    setFormData({
      title: '',
      price: '',
      category: '',
      subcategory: '',
      brand: '',
      available: true,
      quantity: 0,
      images: [],
      description: '',
      specifications: [{ name: '', value: '' }],
      features: []
    });
  };

  const saveProduct = () => {
    console.log('Saving product:', { formData, isCreating, editingProduct });
    
    if (!formData.title || !formData.category) {
      alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è: –Ω–∞–∑–≤–∞–Ω–∏–µ –∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—è!');
      return;
    }

    const price = parseFloat(formData.price);
    if (isNaN(price) || price < 0) {
      alert('–£–∫–∞–∂–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Ü–µ–Ω—É —Ç–æ–≤–∞—Ä–∞!');
      return;
    }

    try {
      const productData = {
        ...formData,
        price: parseFloat(formData.price),
        quantity: parseInt(formData.quantity) || 0
      };

      if (isCreating) {
        console.log('Creating new product:', productData);
        addProduct(productData);
        alert('–¢–æ–≤–∞—Ä —Å–æ–∑–¥–∞–Ω!');
      } else {
        console.log('Updating existing product:', editingProduct, productData);
        updateProduct(editingProduct, productData);
        alert('–¢–æ–≤–∞—Ä –æ–±–Ω–æ–≤–ª–µ–Ω!');
      }
      
      cancelEditing();
    } catch (error) {
      console.error('Error saving product:', error);
      alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ —Ç–æ–≤–∞—Ä–∞!');
    }
  };

  const handleDelete = (id) => {
    if (window.confirm('–£–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä?')) {
      deleteProduct(id);
      alert('–¢–æ–≤–∞—Ä —É–¥–∞–ª–µ–Ω!');
    }
  };

  const availableSubcategories = formData.category ? categories[formData.category] || [] : [];

  return (
    <div className="product-management">
      <div className="management-header">
        <h2>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞–º–∏</h2>
        <button onClick={startCreating} className="btn-primary">
          <FaPlus /> –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä
        </button>
      </div>

      {(isCreating || editingProduct) && (
        <div className="product-form">
          <h3>{isCreating ? '–°–æ–∑–¥–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞' : '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞'}</h3>
          <div className="form-grid">
            <div className="form-group">
              <label>–ù–∞–∑–≤–∞–Ω–∏–µ *</label>
              <input
                type="text"
                name="title"
                value={formData.title}
                onChange={handleInputChange}
                placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞"
              />
            </div>

            <div className="form-group">
              <label>–¶–µ–Ω–∞ *</label>
              <input
                type="number"
                name="price"
                value={formData.price}
                onChange={handleInputChange}
                min="0"
              />
            </div>

            <div className="form-group">
              <label>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤ –Ω–∞–ª–∏—á–∏–∏</label>
              <input
                type="number"
                name="quantity"
                value={formData.quantity}
                onChange={handleInputChange}
                min="0"
                placeholder="0"
              />
            </div>

            <div className="form-group">
              <label>–ö–∞—Ç–µ–≥–æ—Ä–∏—è *</label>
              <select
                name="category"
                value={formData.category}
                onChange={handleCategoryChange}
              >
                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</option>
                {categoryList.map(cat => (
                  <option key={cat} value={cat}>{cat}</option>
                ))}
              </select>
            </div>

            <div className="form-group">
              <label>–ü–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è</label>
              <select
                name="subcategory"
                value={formData.subcategory}
                onChange={handleInputChange}
                disabled={!formData.category}
              >
                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—é</option>
                {availableSubcategories.map(subcat => (
                  <option key={subcat} value={subcat}>{subcat}</option>
                ))}
              </select>
            </div>

            <div className="form-group">
              <label>–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å</label>
              <select
                name="brand"
                value={formData.brand}
                onChange={handleInputChange}
              >
                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—è</option>
                {brands.map(brand => (
                  <option key={brand} value={brand}>{brand}</option>
                ))}
              </select>
            </div>

            <div className="form-group form-group-full">
              <label>–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞</label>
              <MultiImageUpload
                value={formData.images}
                onChange={(images) => setFormData(prev => ({ ...prev, images }))}
                maxImages={5}
                placeholder="–î–æ–±–∞–≤–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞"
              />
            </div>

            <div className="form-group form-group-full">
              <label>–û–ø–∏—Å–∞–Ω–∏–µ</label>
              <textarea
                name="description"
                value={formData.description}
                onChange={handleInputChange}
                placeholder="–û–ø–∏—Å–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞"
                rows="3"
              />
            </div>

            <div className="form-group form-group-full">
              <label>
                <input
                  type="checkbox"
                  name="available"
                  checked={formData.available}
                  onChange={handleInputChange}
                />
                –í –Ω–∞–ª–∏—á–∏–∏
              </label>
            </div>
          </div>

          <div className="form-actions">
            <button onClick={saveProduct} className="btn-success">
              <FaSave /> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
            </button>
            <button onClick={cancelEditing} className="btn-secondary">
              <FaTimes /> –û—Ç–º–µ–Ω–∞
            </button>
          </div>
        </div>
      )}

      <div className="products-table">
        <table>
          <thead>
            <tr>
              <th>ID</th>
              <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
              <th>–¶–µ–Ω–∞</th>
              <th>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</th>
              <th>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>
              <th>–ü–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è</th>
              <th>–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å</th>
              <th>–ù–∞–ª–∏—á–∏–µ</th>
              <th>–î–µ–π—Å—Ç–≤–∏—è</th>
            </tr>
          </thead>
          <tbody>
            {products.map(product => (
              <tr key={product.id}>
                <td>{product.id}</td>
                <td>
                  <div className="product-title">
                    {(() => {
                      const migratedProduct = migrateProductImages(product);
                      const mainImage = getMainImage(migratedProduct);
                      
                      if (mainImage?.data) {
                        if (typeof mainImage.data === 'string' && (mainImage.data.startsWith('data:image') || mainImage.data.startsWith('/uploads/') || mainImage.data.startsWith('http'))){
                          return <img src={mainImage.data} alt={product.title} className="product-image" />;
                        }
                        return <span className="product-icon">{mainImage.data}</span>;
                      }
                      return <span className="product-icon">üì¶</span>;
                    })()}
                    {product.title}
                  </div>
                </td>
                <td>{product.price.toLocaleString()} ‚ÇΩ</td>
                <td>
                  <span className={`quantity-badge ${(product.quantity || 0) === 0 ? 'out-of-stock' : (product.quantity || 0) < 5 ? 'low-stock' : 'in-stock'}`}>
                    {product.quantity || 0} —à—Ç.
                  </span>
                </td>
                <td>{product.category}</td>
                <td>{product.subcategory || '-'}</td>
                <td>{product.brand}</td>
                <td>
                  <span className={product.available ? 'status-available' : 'status-unavailable'}>
                    {product.available ? '–í –Ω–∞–ª–∏—á–∏–∏' : '–ù–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏'}
                  </span>
                </td>
                <td>
                  <div className="action-buttons">
                    <button 
                      onClick={() => startEditing(product)}
                      className="btn-edit"
                      title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å"
                    >
                      <FaEdit />
                    </button>
                    <button 
                      onClick={() => handleDelete(product.id)}
                      className="btn-delete"
                      title="–£–¥–∞–ª–∏—Ç—å"
                    >
                      <FaTrash />
                    </button>
                  </div>
                </td>
              </tr>
            ))}
          </tbody>
        </table>
      </div>
    </div>
  );
}

```

```javascriptreact
import React, { useState } from 'react';
import { useAdminData } from '../../context/AdminDataContext';
import { FaPlus, FaEdit, FaTrash, FaSave, FaTimes } from 'react-icons/fa';
import MultiImageUpload from '../../components/MultiImageUpload';
import { migrateProductImages, getMainImage } from '../../utils/imageHelpers';
import './ProductManagement.css';

export default function ProductManagement() {
  const { products, categories, brands, addProduct, updateProduct, deleteProduct } = useAdminData();
  const [editingProduct, setEditingProduct] = useState(null);
  const [isCreating, setIsCreating] = useState(false);
  const [formData, setFormData] = useState({
    title: '',
    price: '',
    category: '',
    subcategory: '',
    brand: '',
    available: true,
    quantity: 0,
    images: [],
    description: '',
    specifications: [{ name: '', value: '' }],
    features: []
  });

  const categoryList = Object.keys(categories);

  const handleInputChange = (e) => {
    const { name, value, type, checked } = e.target;
    setFormData(prev => ({
      ...prev,
      [name]: type === 'checkbox' ? checked : value
    }));
  };

  const handleCategoryChange = (e) => {
    const selectedCategory = e.target.value;
    setFormData(prev => ({
      ...prev,
      category: selectedCategory,
      subcategory: '' // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—é –ø—Ä–∏ —Å–º–µ–Ω–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
    }));
  };

  const startCreating = () => {
    setIsCreating(true);
    setEditingProduct(null);
    setFormData({
      title: '',
      price: '',
      category: '',
      subcategory: '',
      brand: '',
      available: true,
      quantity: 0,
      images: [],
      description: '',
      specifications: [{ name: '', value: '' }],
      features: []
    });
  };

  const startEditing = (product) => {
    setEditingProduct(product.id);
    setIsCreating(false);
    const migratedProduct = migrateProductImages(product);
    setFormData({ ...migratedProduct });
  };

  const cancelEditing = () => {
    setEditingProduct(null);
    setIsCreating(false);
    setFormData({
      title: '',
      price: '',
      category: '',
      subcategory: '',
      brand: '',
      available: true,
      quantity: 0,
      images: [],
      description: '',
      specifications: [{ name: '', value: '' }],
      features: []
    });
  };

  const saveProduct = () => {
    console.log('Saving product:', { formData, isCreating, editingProduct });
    
    if (!formData.title || !formData.category) {
      alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è: –Ω–∞–∑–≤–∞–Ω–∏–µ –∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—è!');
      return;
    }

    const price = parseFloat(formData.price);
    if (isNaN(price) || price < 0) {
      alert('–£–∫–∞–∂–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Ü–µ–Ω—É —Ç–æ–≤–∞—Ä–∞!');
      return;
    }

    try {
      const productData = {
        ...formData,
        price: parseFloat(formData.price),
        quantity: parseInt(formData.quantity) || 0
      };

      if (isCreating) {
        console.log('Creating new product:', productData);
        addProduct(productData);
        alert('–¢–æ–≤–∞—Ä —Å–æ–∑–¥–∞–Ω!');
      } else {
        console.log('Updating existing product:', editingProduct, productData);
        updateProduct(editingProduct, productData);
        alert('–¢–æ–≤–∞—Ä –æ–±–Ω–æ–≤–ª–µ–Ω!');
      }
      
      cancelEditing();
    } catch (error) {
      console.error('Error saving product:', error);
      alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ —Ç–æ–≤–∞—Ä–∞!');
    }
  };

  const handleDelete = (id) => {
    if (window.confirm('–£–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä?')) {
      deleteProduct(id);
      alert('–¢–æ–≤–∞—Ä —É–¥–∞–ª–µ–Ω!');
    }
  };

  const availableSubcategories = formData.category ? categories[formData.category] || [] : [];

  return (
    <div className="product-management">
      <div className="management-header">
        <h2>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞–º–∏</h2>
        <button onClick={startCreating} className="btn-primary">
          <FaPlus /> –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä
        </button>
      </div>

      {(isCreating || editingProduct) && (
        <div className="product-form">
          <h3>{isCreating ? '–°–æ–∑–¥–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞' : '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞'}</h3>
          <div className="form-grid">
            <div className="form-group">
              <label>–ù–∞–∑–≤–∞–Ω–∏–µ *</label>
              <input
                type="text"
                name="title"
                value={formData.title}
                onChange={handleInputChange}
                placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞"
              />
            </div>

            <div className="form-group">
              <label>–¶–µ–Ω–∞ *</label>
              <input
                type="number"
                name="price"
                value={formData.price}
                onChange={handleInputChange}
                min="0"
              />
            </div>

            <div className="form-group">
              <label>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤ –Ω–∞–ª–∏—á–∏–∏</label>
              <input
                type="number"
                name="quantity"
                value={formData.quantity}
                onChange={handleInputChange}
                min="0"
                placeholder="0"
              />
            </div>

            <div className="form-group">
              <label>–ö–∞—Ç–µ–≥–æ—Ä–∏—è *</label>
              <select
                name="category"
                value={formData.category}
                onChange={handleCategoryChange}
              >
                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</option>
                {categoryList.map(cat => (
                  <option key={cat} value={cat}>{cat}</option>
                ))}
              </select>
            </div>

            <div className="form-group">
              <label>–ü–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è</label>
              <select
                name="subcategory"
                value={formData.subcategory}
                onChange={handleInputChange}
                disabled={!formData.category}
              >
                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—é</option>
                {availableSubcategories.map(subcat => (
                  <option key={subcat} value={subcat}>{subcat}</option>
                ))}
              </select>
            </div>

            <div className="form-group">
              <label>–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å</label>
              <select
                name="brand"
                value={formData.brand}
                onChange={handleInputChange}
              >
                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—è</option>
                {brands.map(brand => (
                  <option key={brand} value={brand}>{brand}</option>
                ))}
              </select>
            </div>

            <div className="form-group form-group-full">
              <label>–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞</label>
              <MultiImageUpload
                value={formData.images}
                onChange={(images) => setFormData(prev => ({ ...prev, images }))}
                maxImages={5}
                placeholder="–î–æ–±–∞–≤–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞"
              />
            </div>

            <div className="form-group form-group-full">
              <label>–û–ø–∏—Å–∞–Ω–∏–µ</label>
              <textarea
                name="description"
                value={formData.description}
                onChange={handleInputChange}
                placeholder="–û–ø–∏—Å–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞"
                rows="3"
              />
            </div>

            <div className="form-group form-group-full">
              <label>–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏</label>
              <div style={{ display: 'grid', gap: '8px' }}>
                {(formData.specifications || []).map((spec, idx) => (
                  <div key={idx} style={{ display: 'grid', gridTemplateColumns: '1fr 1fr auto', gap: '8px' }}>
                    <input
                      type="text"
                      placeholder="–ü–∞—Ä–∞–º–µ—Ç—Ä (–Ω–∞–ø—Ä. –ú–æ—â–Ω–æ—Å—Ç—å)"
                      value={spec.name}
                      onChange={(e) => {
                        const next = [...(formData.specifications || [])];
                        next[idx] = { ...next[idx], name: e.target.value };
                        setFormData(prev => ({ ...prev, specifications: next }));
                      }}
                    />
                    <input
                      type="text"
                      placeholder="–ó–Ω–∞—á–µ–Ω–∏–µ (–Ω–∞–ø—Ä. 120 –ª.—Å.)"
                      value={spec.value}
                      onChange={(e) => {
                        const next = [...(formData.specifications || [])];
                        next[idx] = { ...next[idx], value: e.target.value };
                        setFormData(prev => ({ ...prev, specifications: next }));
                      }}
                    />
                    <button
                      type="button"
                      className="btn-secondary"
                      onClick={() => {
                        const next = (formData.specifications || []).filter((_, i) => i !== idx);
                        setFormData(prev => ({ ...prev, specifications: next.length ? next : [{ name: '', value: '' }] }));
                      }}
                    >
                      –£–¥–∞–ª–∏—Ç—å
                    </button>
                  </div>
                ))}
                <button
                  type="button"
                  className="btn-primary"
                  onClick={() => setFormData(prev => ({ ...prev, specifications: [...(prev.specifications || []), { name: '', value: '' }] }))}
                >
                  <FaPlus /> –î–æ–±–∞–≤–∏—Ç—å —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫—É
                </button>
              </div>
            </div>

            <div className="form-group form-group-full">
              <label>
                <input
                  type="checkbox"
                  name="available"
                  checked={formData.available}
                  onChange={handleInputChange}
                />
                –í –Ω–∞–ª–∏—á–∏–∏
              </label>
            </div>
          </div>

          <div className="form-actions">
            <button onClick={saveProduct} className="btn-success">
              <FaSave /> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
            </button>
            <button onClick={cancelEditing} className="btn-secondary">
              <FaTimes /> –û—Ç–º–µ–Ω–∞
            </button>
          </div>
        </div>
      )}

      <div className="products-table">
        <table>
          <thead>
            <tr>
              <th>ID</th>
              <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
              <th>–¶–µ–Ω–∞</th>
              <th>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</th>
              <th>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>
              <th>–ü–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è</th>
              <th>–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å</th>
              <th>–ù–∞–ª–∏—á–∏–µ</th>
              <th>–î–µ–π—Å—Ç–≤–∏—è</th>
            </tr>
          </thead>
          <tbody>
            {products.map(product => (
              <tr key={product.id}>
                <td>{product.id}</td>
                <td>
                  <div className="product-title">
                    {(() => {
                      const migratedProduct = migrateProductImages(product);
                      const mainImage = getMainImage(migratedProduct);
                      
                      if (mainImage?.data) {
                        if (typeof mainImage.data === 'string' && (mainImage.data.startsWith('data:image') || mainImage.data.startsWith('/uploads/') || mainImage.data.startsWith('http'))){
                          return <img src={mainImage.data} alt={product.title} className="product-image" />;
                        }
                        return <span className="product-icon">{mainImage.data}</span>;
                      }
                      return <span className="product-icon">üì¶</span>;
                    })()}
                    {product.title}
                  </div>
                </td>
                <td>{product.price.toLocaleString()} ‚ÇΩ</td>
                <td>
                  <span className={`quantity-badge ${(product.quantity || 0) === 0 ? 'out-of-stock' : (product.quantity || 0) < 5 ? 'low-stock' : 'in-stock'}`}>
                    {product.quantity || 0} —à—Ç.
                  </span>
                </td>
                <td>{product.category}</td>
                <td>{product.subcategory || '-'}</td>
                <td>{product.brand}</td>
                <td>
                  <span className={product.available ? 'status-available' : 'status-unavailable'}>
                    {product.available ? '–í –Ω–∞–ª–∏—á–∏–∏' : '–ù–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏'}
                  </span>
                </td>
                <td>
                  <div className="action-buttons">
                    <button 
                      onClick={() => startEditing(product)}
                      className="btn-edit"
                      title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å"
                    >
                      <FaEdit />
                    </button>
                    <button 
                      onClick={() => handleDelete(product.id)}
                      className="btn-delete"
                      title="–£–¥–∞–ª–∏—Ç—å"
                    >
                      <FaTrash />
                    </button>
                  </div>
                </td>
              </tr>
            ))}
          </tbody>
        </table>
      </div>
    </div>
  );
}

```

```javascriptreact
import React, { useState } from 'react';
import { useAdminData } from '../../context/AdminDataContext';
import { FaPlus, FaEdit, FaTrash, FaSave, FaTimes } from 'react-icons/fa';
import MultiImageUpload from '../../components/MultiImageUpload';
import { migrateProductImages, getMainImage } from '../../utils/imageHelpers';
import './ProductManagement.css';

export default function ProductManagement() {
  const { products, categories, brands, addProduct, updateProduct, deleteProduct } = useAdminData();
  const [editingProduct, setEditingProduct] = useState(null);
  const [isCreating, setIsCreating] = useState(false);
  const [formData, setFormData] = useState({
    title: '',
    price: '',
    category: '',
    subcategory: '',
    brand: '',
    available: true,
    quantity: 0,
    images: [],
    description: '',
    specifications: [{ name: '', value: '' }],
    features: []
  });

  const categoryList = Object.keys(categories);

  const handleInputChange = (e) => {
    const { name, value, type, checked } = e.target;
    setFormData(prev => ({
      ...prev,
      [name]: type === 'checkbox' ? checked : value
    }));
  };

  const handleCategoryChange = (e) => {
    const selectedCategory = e.target.value;
    setFormData(prev => ({
      ...prev,
      category: selectedCategory,
      subcategory: '' // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—é –ø—Ä–∏ —Å–º–µ–Ω–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
    }));
  };

  const startCreating = () => {
    setIsCreating(true);
    setEditingProduct(null);
    setFormData({
      title: '',
      price: '',
      category: '',
      subcategory: '',
      brand: '',
      available: true,
      quantity: 0,
      images: [],
      description: '',
      specifications: [{ name: '', value: '' }],
      features: []
    });
  };

  const startEditing = (product) => {
    setEditingProduct(product.id);
    setIsCreating(false);
    const migratedProduct = migrateProductImages(product);
    setFormData({ ...migratedProduct });
  };

  const cancelEditing = () => {
    setEditingProduct(null);
    setIsCreating(false);
    setFormData({
      title: '',
      price: '',
      category: '',
      subcategory: '',
      brand: '',
      available: true,
      quantity: 0,
      images: [],
      description: '',
      specifications: [{ name: '', value: '' }],
      features: []
    });
  };

  const saveProduct = () => {
    console.log('Saving product:', { formData, isCreating, editingProduct });
    
    if (!formData.title || !formData.category) {
      alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è: –Ω–∞–∑–≤–∞–Ω–∏–µ –∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—è!');
      return;
    }

    const price = parseFloat(formData.price);
    if (isNaN(price) || price < 0) {
      alert('–£–∫–∞–∂–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Ü–µ–Ω—É —Ç–æ–≤–∞—Ä–∞!');
      return;
    }

    try {
      const productData = {
        ...formData,
        price: parseFloat(formData.price),
        quantity: parseInt(formData.quantity) || 0,
        specifications: (formData.specifications || []).filter(s => (s.name || s.value))
      };

      if (isCreating) {
        console.log('Creating new product:', productData);
        addProduct(productData);
        alert('–¢–æ–≤–∞—Ä —Å–æ–∑–¥–∞–Ω!');
      } else {
        console.log('Updating existing product:', editingProduct, productData);
        updateProduct(editingProduct, productData);
        alert('–¢–æ–≤–∞—Ä –æ–±–Ω–æ–≤–ª–µ–Ω!');
      }
      
      cancelEditing();
    } catch (error) {
      console.error('Error saving product:', error);
      alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ —Ç–æ–≤–∞—Ä–∞!');
    }
  };

  const handleDelete = (id) => {
    if (window.confirm('–£–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä?')) {
      deleteProduct(id);
      alert('–¢–æ–≤–∞—Ä —É–¥–∞–ª–µ–Ω!');
    }
  };

  const availableSubcategories = formData.category ? categories[formData.category] || [] : [];

  return (
    <div className="product-management">
      <div className="management-header">
        <h2>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞–º–∏</h2>
        <button onClick={startCreating} className="btn-primary">
          <FaPlus /> –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä
        </button>
      </div>

      {(isCreating || editingProduct) && (
        <div className="product-form">
          <h3>{isCreating ? '–°–æ–∑–¥–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞' : '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞'}</h3>
          <div className="form-grid">
            <div className="form-group">
              <label>–ù–∞–∑–≤–∞–Ω–∏–µ *</label>
              <input
                type="text"
                name="title"
                value={formData.title}
                onChange={handleInputChange}
                placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞"
              />
            </div>

            <div className="form-group">
              <label>–¶–µ–Ω–∞ *</label>
              <input
                type="number"
                name="price"
                value={formData.price}
                onChange={handleInputChange}
                min="0"
              />
            </div>

            <div className="form-group">
              <label>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤ –Ω–∞–ª–∏—á–∏–∏</label>
              <input
                type="number"
                name="quantity"
                value={formData.quantity}
                onChange={handleInputChange}
                min="0"
                placeholder="0"
              />
            </div>

            <div className="form-group">
              <label>–ö–∞—Ç–µ–≥–æ—Ä–∏—è *</label>
              <select
                name="category"
                value={formData.category}
                onChange={handleCategoryChange}
              >
                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</option>
                {categoryList.map(cat => (
                  <option key={cat} value={cat}>{cat}</option>
                ))}
              </select>
            </div>

            <div className="form-group">
              <label>–ü–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è</label>
              <select
                name="subcategory"
                value={formData.subcategory}
                onChange={handleInputChange}
                disabled={!formData.category}
              >
                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—é</option>
                {availableSubcategories.map(subcat => (
                  <option key={subcat} value={subcat}>{subcat}</option>
                ))}
              </select>
            </div>

            <div className="form-group">
              <label>–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å</label>
              <select
                name="brand"
                value={formData.brand}
                onChange={handleInputChange}
              >
                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—è</option>
                {brands.map(brand => (
                  <option key={brand} value={brand}>{brand}</option>
                ))}
              </select>
            </div>

            <div className="form-group form-group-full">
              <label>–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞</label>
              <MultiImageUpload
                value={formData.images}
                onChange={(images) => setFormData(prev => ({ ...prev, images }))}
                maxImages={5}
                placeholder="–î–æ–±–∞–≤–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞"
              />
            </div>

            <div className="form-group form-group-full">
              <label>–û–ø–∏—Å–∞–Ω–∏–µ</label>
              <textarea
                name="description"
                value={formData.description}
                onChange={handleInputChange}
                placeholder="–û–ø–∏—Å–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞"
                rows="3"
              />
            </div>

            <div className="form-group form-group-full">
              <label>–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏</label>
              <div style={{ display: 'grid', gap: '8px' }}>
                {(formData.specifications || []).map((spec, idx) => (
                  <div key={idx} style={{ display: 'grid', gridTemplateColumns: '1fr 1fr auto', gap: '8px' }}>
                    <input
                      type="text"
                      placeholder="–ü–∞—Ä–∞–º–µ—Ç—Ä (–Ω–∞–ø—Ä. –ú–æ—â–Ω–æ—Å—Ç—å)"
                      value={spec.name}
                      onChange={(e) => {
                        const next = [...(formData.specifications || [])];
                        next[idx] = { ...next[idx], name: e.target.value };
                        setFormData(prev => ({ ...prev, specifications: next }));
                      }}
                    />
                    <input
                      type="text"
                      placeholder="–ó–Ω–∞—á–µ–Ω–∏–µ (–Ω–∞–ø—Ä. 120 –ª.—Å.)"
                      value={spec.value}
                      onChange={(e) => {
                        const next = [...(formData.specifications || [])];
                        next[idx] = { ...next[idx], value: e.target.value };
                        setFormData(prev => ({ ...prev, specifications: next }));
                      }}
                    />
                    <button
                      type="button"
                      className="btn-secondary"
                      onClick={() => {
                        const next = (formData.specifications || []).filter((_, i) => i !== idx);
                        setFormData(prev => ({ ...prev, specifications: next.length ? next : [{ name: '', value: '' }] }));
                      }}
                    >
                      –£–¥–∞–ª–∏—Ç—å
                    </button>
                  </div>
                ))}
                <button
                  type="button"
                  className="btn-primary"
                  onClick={() => setFormData(prev => ({ ...prev, specifications: [...(prev.specifications || []), { name: '', value: '' }] }))}
                >
                  <FaPlus /> –î–æ–±–∞–≤–∏—Ç—å —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫—É
                </button>
              </div>
            </div>

            <div className="form-group form-group-full">
              <label>
                <input
                  type="checkbox"
                  name="available"
                  checked={formData.available}
                  onChange={handleInputChange}
                />
                –í –Ω–∞–ª–∏—á–∏–∏
              </label>
            </div>
          </div>

          <div className="form-actions">
            <button onClick={saveProduct} className="btn-success">
              <FaSave /> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
            </button>
            <button onClick={cancelEditing} className="btn-secondary">
              <FaTimes /> –û—Ç–º–µ–Ω–∞
            </button>
          </div>
        </div>
      )}

      <div className="products-table">
        <table>
          <thead>
            <tr>
              <th>ID</th>
              <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
              <th>–¶–µ–Ω–∞</th>
              <th>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</th>
              <th>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>
              <th>–ü–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è</th>
              <th>–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å</th>
              <th>–ù–∞–ª–∏—á–∏–µ</th>
              <th>–î–µ–π—Å—Ç–≤–∏—è</th>
            </tr>
          </thead>
          <tbody>
            {products.map(product => (
              <tr key={product.id}>
                <td>{product.id}</td>
                <td>
                  <div className="product-title">
                    {(() => {
                      const migratedProduct = migrateProductImages(product);
                      const mainImage = getMainImage(migratedProduct);
                      
                      if (mainImage?.data) {
                        if (typeof mainImage.data === 'string' && (mainImage.data.startsWith('data:image') || mainImage.data.startsWith('/uploads/') || mainImage.data.startsWith('http'))){
                          return <img src={mainImage.data} alt={product.title} className="product-image" />;
                        }
                        return <span className="product-icon">{mainImage.data}</span>;
                      }
                      return <span className="product-icon">üì¶</span>;
                    })()}
                    {product.title}
                  </div>
                </td>
                <td>{product.price.toLocaleString()} ‚ÇΩ</td>
                <td>
                  <span className={`quantity-badge ${(product.quantity || 0) === 0 ? 'out-of-stock' : (product.quantity || 0) < 5 ? 'low-stock' : 'in-stock'}`}>
                    {product.quantity || 0} —à—Ç.
                  </span>
                </td>
                <td>{product.category}</td>
                <td>{product.subcategory || '-'}</td>
                <td>{product.brand}</td>
                <td>
                  <span className={product.available ? 'status-available' : 'status-unavailable'}>
                    {product.available ? '–í –Ω–∞–ª–∏—á–∏–∏' : '–ù–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏'}
                  </span>
                </td>
                <td>
                  <div className="action-buttons">
                    <button 
                      onClick={() => startEditing(product)}
                      className="btn-edit"
                      title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å"
                    >
                      <FaEdit />
                    </button>
                    <button 
                      onClick={() => handleDelete(product.id)}
                      className="btn-delete"
                      title="–£–¥–∞–ª–∏—Ç—å"
                    >
                      <FaTrash />
                    </button>
                  </div>
                </td>
              </tr>
            ))}
          </tbody>
        </table>
      </div>
    </div>
  );
}

```

–°–¥–µ–ª–∞–ª —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫ –≤ –∞–¥–º–∏–Ω–∫–µ:
- –í —Ñ–æ—Ä–º–µ —Ç–æ–≤–∞—Ä–∞ –¥–æ–±–∞–≤–ª–µ–Ω –±–ª–æ–∫ ‚Äú–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏‚Äù.
- –ü–æ–¥–¥–µ—Ä–∂–∞–Ω—ã –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏, –∏–∑–º–µ–Ω–µ–Ω–∏–µ –∏ —É–¥–∞–ª–µ–Ω–∏–µ —Å—Ç—Ä–æ–∫ (–ø–∞—Ä–∞ ‚Äú–ü–∞—Ä–∞–º–µ—Ç—Ä / –ó–Ω–∞—á–µ–Ω–∏–µ‚Äù).
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–µ—Ä–µ–¥–∞—ë—Ç `specifications` –Ω–∞ –±—ç–∫–µ–Ω–¥; –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –ë–î –∏ –ø–æ–¥—Ç—è–≥–∏–≤–∞—é—Ç—Å—è –ø—Ä–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏.

–ì–¥–µ –ø—Ä–∞–≤–∫–∏:
- `src/pages/admin/ProductManagement.jsx`: –¥–æ–±–∞–≤–ª–µ–Ω—ã –ø–æ–ª—è `specifications` –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ñ–æ—Ä–º—ã –∏ UI-–±–ª–æ–∫ —Å–æ —Å–ø–∏—Å–∫–æ–º —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫ –∏ –∫–Ω–æ–ø–∫–∞–º–∏ ‚Äú–î–æ–±–∞–≤–∏—Ç—å —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫—É‚Äù/—É–¥–∞–ª–µ–Ω–∏–µ —Å—Ç—Ä–æ–∫–∏.

–ü—Ä–æ–≤–µ—Ä—å –≤ –∞–¥–º–∏–Ω–∫–µ: –æ—Ç–∫—Ä–æ–π —Ç–æ–≤–∞—Ä ‚Üí ‚Äú–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞‚Äù ‚Üí ‚Äú–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏‚Äù ‚Üí –¥–æ–±–∞–≤—å/–∏–∑–º–µ–Ω–∏ —Å—Ç—Ä–æ–∫–∏ ‚Üí ‚Äú–°–æ—Ö—Ä–∞–Ω–∏—Ç—å‚Äù.

---

**User**

Unexpected Application Error!
Objects are not valid as a React child (found: object with keys {name, value}). If you meant to render a collection of children, use an array instead.
Error: Objects are not valid as a React child (found: object with keys {name, value}). If you meant to render a collection of children, use an array instead.
    at throwOnInvalidObjectType (http://localhost:5174/node_modules/.vite/deps/react-dom_client.js?v=b24aa6eb:5438:15)
    at reconcileChildFibersImpl (http://localhost:5174/node_modules/.vite/deps/react-dom_client.js?v=b24aa6eb:6039:13)
    at http://localhost:5174/node_modules/.vite/deps/react-dom_client.js?v=b24aa6eb:6059:35
    at reconcileChildren (http://localhost:5174/node_modules/.vite/deps/react-dom_client.js?v=b24aa6eb:6442:53)
    at beginWork (http://localhost:5174/node_modules/.vite/deps/react-dom_client.js?v=b24aa6eb:7828:104)
    at runWithFiberInDEV (http://localhost:5174/node_modules/.vite/deps/react-dom_client.js?v=b24aa6eb:1483:72)
    at performUnitOfWork (http://localhost:5174/node_modules/.vite/deps/react-dom_client.js?v=b24aa6eb:10866:98)
    at workLoopSync (http://localhost:5174/node_modules/.vite/deps/react-dom_client.js?v=b24aa6eb:10726:43)
    at renderRootSync (http://localhost:5174/node_modules/.vite/deps/react-dom_client.js?v=b24aa6eb:10709:13)
    at performWorkOnRoot (http://localhost:5174/node_modules/.vite/deps/react-dom_client.js?v=b24aa6eb:10357:46)
üíø Hey developer üëã

You can provide a way better UX than this when your app throws errors by providing your own ErrorBoundary or errorElement prop on your route.

---

**Cursor**

```javascriptreact
import React, { useState } from 'react';
import { useParams, useNavigate } from 'react-router-dom';
import { FaArrowLeft, FaShoppingCart, FaCheckCircle, FaTimesCircle, FaChevronLeft, FaChevronRight } from 'react-icons/fa';
import { motion } from 'framer-motion';
import { useCartActions } from '../hooks/useCartActions';
import { useAdminData } from '../context/AdminDataContext';
import { migrateProductImages, getAllImages, isImageUrl } from '../utils/imageHelpers';
import './ProductPage.css';

// –î–∞–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä–æ–≤ (–≤ —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è —Å —Å–µ—Ä–≤–µ—Ä–∞)
const productsData = {
  1: {
    id: 1,
    title: '–ì—É—Å–µ–Ω–∏—Ü—ã –¥–ª—è –≤–µ–∑–¥–µ—Ö–æ–¥–∞',
    price: 45000,
    originalPrice: 50000,
    category: '–•–æ–¥–æ–≤–∞—è',
    brand: '–í–µ–∑–¥–µ—Ö–æ–¥-–ú–∞—Å—Ç–µ—Ä',
    available: true,
    inStock: 12,
    icon: 'üîó',
    images: ['/api/placeholder/600/400', '/api/placeholder/600/400', '/api/placeholder/600/400'],
    description: '–í—ã—Å–æ–∫–æ–∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –≥—É—Å–µ–Ω–∏—Ü—ã –¥–ª—è –≤–µ–∑–¥–µ—Ö–æ–¥–æ–≤ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –º–∞—Ä–æ–∫. –ò–∑–≥–æ—Ç–æ–≤–ª–µ–Ω—ã –∏–∑ –ø—Ä–æ—á–Ω–æ–π —Ä–µ–∑–∏–Ω—ã —Å –º–µ—Ç–∞–ª–ª–∏—á–µ—Å–∫–∏–º–∏ –≤—Å—Ç–∞–≤–∫–∞–º–∏. –û–±–µ—Å–ø–µ—á–∏–≤–∞—é—Ç –æ—Ç–ª–∏—á–Ω–æ–µ —Å—Ü–µ–ø–ª–µ–Ω–∏–µ –Ω–∞ –ª—é–±–æ–π –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–∏.',
    specifications: {
      '–®–∏—Ä–∏–Ω–∞': '400 –º–º',
      '–î–ª–∏–Ω–∞': '2500 –º–º',
      '–ú–∞—Ç–µ—Ä–∏–∞–ª': '–†–µ–∑–∏–Ω–∞ —Å –º–µ—Ç–∞–ª–ª–æ–∫–æ—Ä–¥–æ–º',
      '–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å': '–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è',
      '–ì–∞—Ä–∞–Ω—Ç–∏—è': '12 –º–µ—Å—è—Ü–µ–≤'
    },
    features: [
      '–í—ã—Å–æ–∫–∞—è –∏–∑–Ω–æ—Å–æ—Å—Ç–æ–π–∫–æ—Å—Ç—å',
      '–û—Ç–ª–∏—á–Ω–æ–µ —Å—Ü–µ–ø–ª–µ–Ω–∏–µ –Ω–∞ —Å–Ω–µ–≥—É –∏ –≥—Ä—è–∑–∏',
      '–ü—Ä–æ—Å—Ç–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞',
      '–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ–º –≤–µ–∑–¥–µ—Ö–æ–¥–æ–≤'
    ]
  },
  2: {
    id: 2,
    title: '–î–≤–∏–≥–∞—Ç–µ–ª—å 2.0L',
    price: 180000,
    category: '–î–≤–∏–≥–∞—Ç–µ–ª—å',
    brand: '–¢–µ—Ö–Ω–æ–ú–æ—Ç–æ—Ä',
    available: true,
    inStock: 3,
    icon: '‚öôÔ∏è',
    images: ['/api/placeholder/600/400', '/api/placeholder/600/400'],
    description: '–ú–æ—â–Ω—ã–π –∏ –Ω–∞–¥–µ–∂–Ω—ã–π –¥–≤–∏–≥–∞—Ç–µ–ª—å –æ–±—ä–µ–º–æ–º 2.0 –ª–∏—Ç—Ä–∞ –¥–ª—è –≤–µ–∑–¥–µ—Ö–æ–¥–æ–≤. –û—Ç–ª–∏—á–∞–µ—Ç—Å—è –≤—ã—Å–æ–∫–æ–π —Ç–æ–ø–ª–∏–≤–Ω–æ–π —ç–∫–æ–Ω–æ–º–∏—á–Ω–æ—Å—Ç—å—é –∏ –¥–æ–ª–≥–æ–≤–µ—á–Ω–æ—Å—Ç—å—é.',
    specifications: {
      '–û–±—ä–µ–º': '2.0 –ª',
      '–ú–æ—â–Ω–æ—Å—Ç—å': '150 –ª.—Å.',
      '–¢–∏–ø —Ç–æ–ø–ª–∏–≤–∞': '–ë–µ–Ω–∑–∏–Ω',
      '–û—Ö–ª–∞–∂–¥–µ–Ω–∏–µ': '–ñ–∏–¥–∫–æ—Å—Ç–Ω–æ–µ',
      '–ì–∞—Ä–∞–Ω—Ç–∏—è': '24 –º–µ—Å—è—Ü–∞'
    },
    features: [
      '–í—ã—Å–æ–∫–∞—è –º–æ—â–Ω–æ—Å—Ç—å –∏ –∫—Ä—É—Ç—è—â–∏–π –º–æ–º–µ–Ω—Ç',
      '–≠–∫–æ–Ω–æ–º–∏—á–Ω—ã–π —Ä–∞—Å—Ö–æ–¥ —Ç–æ–ø–ª–∏–≤–∞',
      '–ü—Ä–æ—Å—Ç–æ–µ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ',
      '–ù–∞–¥–µ–∂–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –æ—Ö–ª–∞–∂–¥–µ–Ω–∏—è'
    ]
  },
  3: {
    id: 3,
    title: '–¢—Ä–∞–Ω—Å–º–∏—Å—Å–∏—è',
    price: 95000,
    category: '–¢—Ä–∞–Ω—Å–º–∏—Å—Å–∏—è',
    brand: '–í–µ–∑–¥–µ—Ö–æ–¥-–ú–∞—Å—Ç–µ—Ä',
    available: false,
    inStock: 0,
    icon: 'üîß',
    images: ['/api/placeholder/600/400'],
    description: '–ù–∞–¥–µ–∂–Ω–∞—è —Ç—Ä–∞–Ω—Å–º–∏—Å—Å–∏—è –¥–ª—è –≤–µ–∑–¥–µ—Ö–æ–¥–æ–≤ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –º–∞—Ä–æ–∫. –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –ø–ª–∞–≤–Ω–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –ø–µ—Ä–µ–¥–∞—á –∏ –¥–æ–ª–≥–∏–π —Å—Ä–æ–∫ —Å–ª—É–∂–±—ã.',
    specifications: {
      '–¢–∏–ø': '–ú–µ—Ö–∞–Ω–∏—á–µ—Å–∫–∞—è',
      '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–µ—Ä–µ–¥–∞—á': '6',
      '–ú–∞—Ç–µ—Ä–∏–∞–ª': '–°—Ç–∞–ª—å –≤—ã—Å–æ–∫–æ–π –ø—Ä–æ—á–Ω–æ—Å—Ç–∏',
      '–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å': '–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è',
      '–ì–∞—Ä–∞–Ω—Ç–∏—è': '18 –º–µ—Å—è—Ü–µ–≤'
    },
    features: [
      '–ü–ª–∞–≤–Ω–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –ø–µ—Ä–µ–¥–∞—á',
      '–í—ã—Å–æ–∫–∞—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å',
      '–ü—Ä–æ—Å—Ç–æ–µ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ',
      '–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ–º –¥–≤–∏–≥–∞—Ç–µ–ª–µ–π'
    ]
  },
  4: {
    id: 4,
    title: '–ü–æ–¥–≤–µ—Å–∫–∞',
    price: 65000,
    category: '–•–æ–¥–æ–≤–∞—è',
    brand: '–°—É–ø–µ—Ä–¢—Ä–µ–∫',
    available: true,
    inStock: 8,
    icon: 'üõ†Ô∏è',
    images: ['/api/placeholder/600/400', '/api/placeholder/600/400'],
    description: '–£—Å–∏–ª–µ–Ω–Ω–∞—è –ø–æ–¥–≤–µ—Å–∫–∞ –¥–ª—è —ç–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω—ã—Ö —É—Å–ª–æ–≤–∏–π —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏–∏. –ü–æ–≤—ã—à–∞–µ—Ç –ø—Ä–æ—Ö–æ–¥–∏–º–æ—Å—Ç—å –∏ –∫–æ–º—Ñ–æ—Ä—Ç –µ–∑–¥—ã.',
    specifications: {
      '–¢–∏–ø': '–ù–µ–∑–∞–≤–∏—Å–∏–º–∞—è',
      '–ê–º–æ—Ä—Ç–∏–∑–∞—Ç–æ—Ä—ã': '–ì–∞–∑–æ-–º–∞—Å–ª—è–Ω—ã–µ',
      '–ú–∞—Ç–µ—Ä–∏–∞–ª': '–°—Ç–∞–ª—å + –∞–ª—é–º–∏–Ω–∏–π',
      '–•–æ–¥ –ø–æ–¥–≤–µ—Å–∫–∏': '250 –º–º',
      '–ì–∞—Ä–∞–Ω—Ç–∏—è': '12 –º–µ—Å—è—Ü–µ–≤'
    },
    features: [
      '–£–≤–µ–ª–∏—á–µ–Ω–Ω—ã–π —Ö–æ–¥ –ø–æ–¥–≤–µ—Å–∫–∏',
      '–£—Å–∏–ª–µ–Ω–Ω–∞—è –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏—è',
      '–û—Ç–ª–∏—á–Ω–∞—è –∞–º–æ—Ä—Ç–∏–∑–∞—Ü–∏—è',
      '–ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è —ç–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω—ã—Ö —É—Å–ª–æ–≤–∏–π'
    ]
  },
  5: {
    id: 5,
    title: '–§–∏–ª—å—Ç—Ä –≤–æ–∑–¥—É—à–Ω—ã–π',
    price: 3500,
    category: '–î–≤–∏–≥–∞—Ç–µ–ª—å',
    brand: '–¢–µ—Ö–Ω–æ–ú–æ—Ç–æ—Ä',
    available: true,
    inStock: 25,
    icon: 'üåÄ',
    images: ['/api/placeholder/600/400'],
    description: '–í—ã—Å–æ–∫–æ–∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –≤–æ–∑–¥—É—à–Ω—ã–π —Ñ–∏–ª—å—Ç—Ä –¥–ª—è –∑–∞—â–∏—Ç—ã –¥–≤–∏–≥–∞—Ç–µ–ª—è –æ—Ç –ø—ã–ª–∏ –∏ –≥—Ä—è–∑–∏.',
    specifications: {
      '–¢–∏–ø': '–ü–∞–Ω–µ–ª—å–Ω—ã–π',
      '–ú–∞—Ç–µ—Ä–∏–∞–ª': '–°–∏–Ω—Ç–µ—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ–ª–æ–∫–Ω–æ',
      '–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å': '99.5%',
      '–†–µ—Å—É—Ä—Å': '15 000 –∫–º',
      '–ì–∞—Ä–∞–Ω—Ç–∏—è': '6 –º–µ—Å—è—Ü–µ–≤'
    },
    features: [
      '–í—ã—Å–æ–∫–∞—è —Å—Ç–µ–ø–µ–Ω—å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏',
      '–î–æ–ª–≥–∏–π —Å—Ä–æ–∫ —Å–ª—É–∂–±—ã',
      '–ü—Ä–æ—Å—Ç–∞—è –∑–∞–º–µ–Ω–∞',
      '–ó–∞—â–∏—Ç–∞ –¥–≤–∏–≥–∞—Ç–µ–ª—è –æ—Ç –∏–∑–Ω–æ—Å–∞'
    ]
  },
  6: {
    id: 6,
    title: '–†–µ–º–µ–Ω—å –ø—Ä–∏–≤–æ–¥–Ω–æ–π',
    price: 2200,
    category: '–¢—Ä–∞–Ω—Å–º–∏—Å—Å–∏—è',
    brand: 'DrivePro',
    available: true,
    inStock: 15,
    icon: '‚õìÔ∏è',
    images: ['/api/placeholder/600/400'],
    description: '–ü—Ä–æ—á–Ω—ã–π –ø—Ä–∏–≤–æ–¥–Ω–æ–π —Ä–µ–º–µ–Ω—å –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ–π –ø–µ—Ä–µ–¥–∞—á–∏ –º–æ—â–Ω–æ—Å—Ç–∏ –æ—Ç –¥–≤–∏–≥–∞—Ç–µ–ª—è –∫ —Ç—Ä–∞–Ω—Å–º–∏—Å—Å–∏–∏.',
    specifications: {
      '–î–ª–∏–Ω–∞': '1200 –º–º',
      '–®–∏—Ä–∏–Ω–∞': '30 –º–º',
      '–ú–∞—Ç–µ—Ä–∏–∞–ª': '–†–µ–∑–∏–Ω–∞ —Å –∫–µ–≤–ª–∞—Ä–æ–≤—ã–º –∫–æ—Ä–¥–æ–º',
      '–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞': '150 –ù–º',
      '–ì–∞—Ä–∞–Ω—Ç–∏—è': '12 –º–µ—Å—è—Ü–µ–≤'
    },
    features: [
      '–í—ã—Å–æ–∫–∞—è –ø—Ä–æ—á–Ω–æ—Å—Ç—å –Ω–∞ —Ä–∞–∑—Ä—ã–≤',
      '–£—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å –∫ –∏–∑–Ω–æ—Å—É',
      '–†–∞–±–æ—Ç–∞ –≤ —à–∏—Ä–æ–∫–æ–º –¥–∏–∞–ø–∞–∑–æ–Ω–µ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä',
      '–ü—Ä–æ—Å—Ç–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞'
    ]
  }
};

function ProductPage() {
  const { id } = useParams();
  const navigate = useNavigate();
  const { addToCartWithNotification } = useCartActions();
  const { products } = useAdminData();
  const [selectedImageIndex, setSelectedImageIndex] = useState(0);
  const [quantity, setQuantity] = useState(1);
  // wishlist removed

  const product = products.find(p => p.id === parseInt(id));

  if (!product) {
    return (
      <div className="product-not-found">
        <h2>–¢–æ–≤–∞—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω</h2>
        <button onClick={() => navigate('/catalog')} className="back-button">
          –í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –∫–∞—Ç–∞–ª–æ–≥
        </button>
      </div>
    );
  }

  // –ú–∏–≥—Ä–∏—Ä—É–µ–º –∏ –ø–æ–ª—É—á–∞–µ–º –≤—Å–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞
  const migratedProduct = migrateProductImages(product);
  const allImages = getAllImages(migratedProduct) || [];
  
  // –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å: —É–±–µ–∂–¥–∞–µ–º—Å—è —á—Ç–æ selectedImageIndex –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –º–∞—Å—Å–∏–≤–∞
  const safeSelectedIndex = Math.max(0, Math.min(selectedImageIndex, allImages.length - 1));

  const handleAddToCart = () => {
    addToCartWithNotification(product, quantity);
  };

  const handleBuyNow = () => {
    try {
      addToCartWithNotification(product, quantity);
      setTimeout(() => {
        navigate('/cart');
      }, 100);
    } catch (error) {
      console.error('Error in handleBuyNow:', error);
      alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∫—É–ø–∫–µ —Ç–æ–≤–∞—Ä–∞');
    }
  };

  // –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫: –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –∫–∞–∫ –æ–±—ä–µ–∫—Ç–∞, —Ç–∞–∫ –∏ –º–∞—Å—Å–∏–≤–∞ [{name, value}]
  const specsArray = Array.isArray(product?.specifications)
    ? (product.specifications || []).filter(s => s && (s.name || s.value))
    : (product?.specifications && typeof product.specifications === 'object')
      ? Object.entries(product.specifications).map(([name, value]) => ({ name, value }))
      : [];

  return (
    <motion.div 
      className="product-page"
      initial={{ opacity: 0 }}
      animate={{ opacity: 1 }}
      transition={{ duration: 0.5 }}
    >
      <div className="container">
        <button 
          onClick={() => navigate(-1)} 
          className="back-button"
        >
          <FaArrowLeft /> –ù–∞–∑–∞–¥
        </button>

        <div className="product-content">
          <div className="product-images">
            <div className="main-image">
              <motion.div 
                className="image-container"
                whileHover={{ scale: 1.05 }}
                transition={{ duration: 0.3 }}
              >
                {allImages && allImages.length > 0 && allImages[safeSelectedIndex] ? (
                  allImages[safeSelectedIndex].data && (
                    allImages[safeSelectedIndex].data.startsWith('data:image') ||
                    isImageUrl(allImages[safeSelectedIndex].data)
                  ) ? (
                    <img
                      src={allImages[safeSelectedIndex].data}
                      alt={product.title}
                      className="product-main-image"
                    />
                  ) : (
                    <span className="product-icon">{allImages[safeSelectedIndex]?.data || 'üì¶'}</span>
                  )
                ) : (
                  <span className="product-icon">üì¶</span>
                )}
              </motion.div>
              
              {allImages && allImages.length > 1 && (
                <div className="image-navigation">
                  <button 
                    className="nav-button prev"
                    onClick={() => setSelectedImageIndex(selectedImageIndex === 0 ? allImages.length - 1 : selectedImageIndex - 1)}
                    disabled={!allImages || allImages.length <= 1}
                  >
                    <FaChevronLeft />
                  </button>
                  <button 
                    className="nav-button next"
                    onClick={() => setSelectedImageIndex(selectedImageIndex === allImages.length - 1 ? 0 : selectedImageIndex + 1)}
                    disabled={!allImages || allImages.length <= 1}
                  >
                    <FaChevronRight />
                  </button>
                </div>
              )}
            </div>
            
            {allImages && allImages.length > 1 && (
              <div className="image-thumbnails">
                {allImages.map((image, index) => (
                  <button
                    key={index}
                    className={`thumbnail ${selectedImageIndex === index ? 'active' : ''}`}
                    onClick={() => setSelectedImageIndex(index)}
                  >
                    {image && image.data && (
                      image.data.startsWith('data:image') || isImageUrl(image.data)
                    ) ? (
                      <img src={image.data} alt={`${product.title} ${index + 1}`} />
                    ) : (
                      <span className="product-icon">{image?.data || 'üì¶'}</span>
                    )}
                  </button>
                ))}
              </div>
            )}
          </div>

          <div className="product-info">
            <div className="product-header">
              <h1>{product.title}</h1>
              {/* wishlist button removed */}
            </div>

            <div className="product-meta">
              <span className="brand">{product.brand}</span>
              <span className="category">{product.category}</span>
              <span className={`availability ${product.available ? 'in-stock' : 'out-of-stock'}`}>
                {product.available ? <FaCheckCircle /> : <FaTimesCircle />}
                {product.available ? `–í –Ω–∞–ª–∏—á–∏–∏: ${product.quantity || 0} —à—Ç` : '–ù–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏'}
              </span>
            </div>

            <div className="product-price">
              <span className="current-price">{product.price.toLocaleString()} ‚ÇΩ</span>
              {product.originalPrice && (
                <span className="original-price">{product.originalPrice.toLocaleString()} ‚ÇΩ</span>
              )}
            </div>

            <div className="product-description">
              <p>{product.description}</p>
            </div>

            {product.features && product.features.length > 0 && (
              <div className="product-features">
                <h3>–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:</h3>
                <ul>
                  {product.features.map((feature, index) => (
                    <li key={index}>{feature}</li>
                  ))}
                </ul>
              </div>
            )}

            <div className="product-actions">
              <div className="quantity-selector">
                <label>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ:</label>
                <div className="quantity-controls">
                  <button 
                    onClick={() => setQuantity(Math.max(1, quantity - 1))}
                    disabled={quantity <= 1}
                  >
                    -
                  </button>
                  <input 
                    type="text" 
                    value={quantity} 
                    onChange={(e) => {
                      const inputValue = e.target.value.replace(/[^0-9]/g, '');
                      // –†–∞–∑—Ä–µ—à–∞–µ–º –ø—É—Å—Ç–æ–µ –ø–æ–ª–µ
                      if (inputValue === '') {
                        return;
                      }
                      const value = parseInt(inputValue);
                      if (!isNaN(value) && value >= 1) {
                        setQuantity(Math.min(value, product.quantity || 999));
                      }
                    }}
                    onBlur={(e) => {
                      // –ü—Ä–∏ –ø–æ—Ç–µ—Ä–µ —Ñ–æ–∫—É—Å–∞, –µ—Å–ª–∏ –ø–æ–ª–µ –ø—É—Å—Ç–æ–µ, —Å—Ç–∞–≤–∏–º 1
                      const cleanValue = e.target.value.replace(/[^0-9]/g, '');
                      if (cleanValue === '' || parseInt(cleanValue) < 1) {
                        setQuantity(1);
                      }
                    }}
                    onFocus={(e) => e.target.select()}
                    placeholder="1"
                    className="quantity-input"
                  />
                  <button 
                    onClick={() => setQuantity(Math.min(quantity + 1, product.quantity || 999))}
                    disabled={quantity >= (product.quantity || 999)}
                  >
                    +
                  </button>
                </div>
              </div>

              <div className="action-buttons">
                <motion.button 
                  className="add-to-cart-btn"
                  onClick={handleAddToCart}
                  disabled={!product.available}
                  whileHover={{ scale: 1.02 }}
                  whileTap={{ scale: 0.98 }}
                >
                  <FaShoppingCart /> –í –∫–æ—Ä–∑–∏–Ω—É
                </motion.button>

                <motion.button 
                  className="buy-now-btn"
                  onClick={handleBuyNow}
                  disabled={!product.available}
                  whileHover={{ scale: 1.02 }}
                  whileTap={{ scale: 0.98 }}
                >
                  –ö—É–ø–∏—Ç—å —Å–µ–π—á–∞—Å
                </motion.button>
              </div>
            </div>
          </div>
        </div>

        {specsArray.length > 0 && (
          <div className="product-specifications">
            <h3>–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏</h3>
            <div className="specs-grid">
              {specsArray.map((spec, idx) => (
                <div key={idx} className="spec-item">
                  <span className="spec-label">{spec.name}:</span>
                  <span className="spec-value">{String(spec.value)}</span>
                </div>
              ))}
            </div>
          </div>
        )}
      </div>
    </motion.div>
  );
}

export default ProductPage;

```

```javascriptreact
import React, { useState } from 'react';
import { useAdminData } from '../../context/AdminDataContext';
import { FaPlus, FaEdit, FaTrash, FaSave, FaTimes } from 'react-icons/fa';
import MultiImageUpload from '../../components/MultiImageUpload';
import { migrateProductImages, getMainImage } from '../../utils/imageHelpers';
import './ProductManagement.css';

export default function ProductManagement() {
  const { products, categories, brands, addProduct, updateProduct, deleteProduct } = useAdminData();
  const [editingProduct, setEditingProduct] = useState(null);
  const [isCreating, setIsCreating] = useState(false);
  const [formData, setFormData] = useState({
    title: '',
    price: '',
    category: '',
    subcategory: '',
    brand: '',
    available: true,
    quantity: 0,
    images: [],
    description: '',
    specifications: [{ name: '', value: '' }],
    features: []
  });

  const categoryList = Object.keys(categories);

  const handleInputChange = (e) => {
    const { name, value, type, checked } = e.target;
    setFormData(prev => ({
      ...prev,
      [name]: type === 'checkbox' ? checked : value
    }));
  };

  const handleCategoryChange = (e) => {
    const selectedCategory = e.target.value;
    setFormData(prev => ({
      ...prev,
      category: selectedCategory,
      subcategory: '' // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—é –ø—Ä–∏ —Å–º–µ–Ω–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
    }));
  };

  const startCreating = () => {
    setIsCreating(true);
    setEditingProduct(null);
    setFormData({
      title: '',
      price: '',
      category: '',
      subcategory: '',
      brand: '',
      available: true,
      quantity: 0,
      images: [],
      description: '',
      specifications: [{ name: '', value: '' }],
      features: []
    });
  };

  const startEditing = (product) => {
    setEditingProduct(product.id);
    setIsCreating(false);
    const migratedProduct = migrateProductImages(product);
    // –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –∫ –º–∞—Å—Å–∏–≤—É {name, value}
    const normalizedSpecs = Array.isArray(migratedProduct.specifications)
      ? migratedProduct.specifications
      : migratedProduct.specifications && typeof migratedProduct.specifications === 'object'
        ? Object.entries(migratedProduct.specifications).map(([name, value]) => ({ name, value }))
        : [{ name: '', value: '' }];
    setFormData({ ...migratedProduct, specifications: normalizedSpecs });
  };

  const cancelEditing = () => {
    setEditingProduct(null);
    setIsCreating(false);
    setFormData({
      title: '',
      price: '',
      category: '',
      subcategory: '',
      brand: '',
      available: true,
      quantity: 0,
      images: [],
      description: '',
      specifications: [{ name: '', value: '' }],
      features: []
    });
  };

  const saveProduct = () => {
    console.log('Saving product:', { formData, isCreating, editingProduct });
    
    if (!formData.title || !formData.category) {
      alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è: –Ω–∞–∑–≤–∞–Ω–∏–µ –∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—è!');
      return;
    }

    const price = parseFloat(formData.price);
    if (isNaN(price) || price < 0) {
      alert('–£–∫–∞–∂–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Ü–µ–Ω—É —Ç–æ–≤–∞—Ä–∞!');
      return;
    }

    try {
      const productData = {
        ...formData,
        price: parseFloat(formData.price),
        quantity: parseInt(formData.quantity) || 0,
        specifications: (formData.specifications || []).filter(s => (s.name || s.value))
      };

      if (isCreating) {
        console.log('Creating new product:', productData);
        addProduct(productData);
        alert('–¢–æ–≤–∞—Ä —Å–æ–∑–¥–∞–Ω!');
      } else {
        console.log('Updating existing product:', editingProduct, productData);
        updateProduct(editingProduct, productData);
        alert('–¢–æ–≤–∞—Ä –æ–±–Ω–æ–≤–ª–µ–Ω!');
      }
      
      cancelEditing();
    } catch (error) {
      console.error('Error saving product:', error);
      alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ —Ç–æ–≤–∞—Ä–∞!');
    }
  };

  const handleDelete = (id) => {
    if (window.confirm('–£–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä?')) {
      deleteProduct(id);
      alert('–¢–æ–≤–∞—Ä —É–¥–∞–ª–µ–Ω!');
    }
  };

  const availableSubcategories = formData.category ? categories[formData.category] || [] : [];

  return (
    <div className="product-management">
      <div className="management-header">
        <h2>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞–º–∏</h2>
        <button onClick={startCreating} className="btn-primary">
          <FaPlus /> –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä
        </button>
      </div>

      {(isCreating || editingProduct) && (
        <div className="product-form">
          <h3>{isCreating ? '–°–æ–∑–¥–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞' : '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞'}</h3>
          <div className="form-grid">
            <div className="form-group">
              <label>–ù–∞–∑–≤–∞–Ω–∏–µ *</label>
              <input
                type="text"
                name="title"
                value={formData.title}
                onChange={handleInputChange}
                placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞"
              />
            </div>

            <div className="form-group">
              <label>–¶–µ–Ω–∞ *</label>
              <input
                type="number"
                name="price"
                value={formData.price}
                onChange={handleInputChange}
                min="0"
              />
            </div>

            <div className="form-group">
              <label>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤ –Ω–∞–ª–∏—á–∏–∏</label>
              <input
                type="number"
                name="quantity"
                value={formData.quantity}
                onChange={handleInputChange}
                min="0"
                placeholder="0"
              />
            </div>

            <div className="form-group">
              <label>–ö–∞—Ç–µ–≥–æ—Ä–∏—è *</label>
              <select
                name="category"
                value={formData.category}
                onChange={handleCategoryChange}
              >
                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</option>
                {categoryList.map(cat => (
                  <option key={cat} value={cat}>{cat}</option>
                ))}
              </select>
            </div>

            <div className="form-group">
              <label>–ü–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è</label>
              <select
                name="subcategory"
                value={formData.subcategory}
                onChange={handleInputChange}
                disabled={!formData.category}
              >
                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—é</option>
                {availableSubcategories.map(subcat => (
                  <option key={subcat} value={subcat}>{subcat}</option>
                ))}
              </select>
            </div>

            <div className="form-group">
              <label>–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å</label>
              <select
                name="brand"
                value={formData.brand}
                onChange={handleInputChange}
              >
                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—è</option>
                {brands.map(brand => (
                  <option key={brand} value={brand}>{brand}</option>
                ))}
              </select>
            </div>

            <div className="form-group form-group-full">
              <label>–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞</label>
              <MultiImageUpload
                value={formData.images}
                onChange={(images) => setFormData(prev => ({ ...prev, images }))}
                maxImages={5}
                placeholder="–î–æ–±–∞–≤–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞"
              />
            </div>

            <div className="form-group form-group-full">
              <label>–û–ø–∏—Å–∞–Ω–∏–µ</label>
              <textarea
                name="description"
                value={formData.description}
                onChange={handleInputChange}
                placeholder="–û–ø–∏—Å–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞"
                rows="3"
              />
            </div>

            <div className="form-group form-group-full">
              <label>–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏</label>
              <div style={{ display: 'grid', gap: '8px' }}>
                {(formData.specifications || []).map((spec, idx) => (
                  <div key={idx} style={{ display: 'grid', gridTemplateColumns: '1fr 1fr auto', gap: '8px' }}>
                    <input
                      type="text"
                      placeholder="–ü–∞—Ä–∞–º–µ—Ç—Ä (–Ω–∞–ø—Ä. –ú–æ—â–Ω–æ—Å—Ç—å)"
                      value={spec.name}
                      onChange={(e) => {
                        const next = [...(formData.specifications || [])];
                        next[idx] = { ...next[idx], name: e.target.value };
                        setFormData(prev => ({ ...prev, specifications: next }));
                      }}
                    />
                    <input
                      type="text"
                      placeholder="–ó–Ω–∞—á–µ–Ω–∏–µ (–Ω–∞–ø—Ä. 120 –ª.—Å.)"
                      value={spec.value}
                      onChange={(e) => {
                        const next = [...(formData.specifications || [])];
                        next[idx] = { ...next[idx], value: e.target.value };
                        setFormData(prev => ({ ...prev, specifications: next }));
                      }}
                    />
                    <button
                      type="button"
                      className="btn-secondary"
                      onClick={() => {
                        const next = (formData.specifications || []).filter((_, i) => i !== idx);
                        setFormData(prev => ({ ...prev, specifications: next.length ? next : [{ name: '', value: '' }] }));
                      }}
                    >
                      –£–¥–∞–ª–∏—Ç—å
                    </button>
                  </div>
                ))}
                <button
                  type="button"
                  className="btn-primary"
                  onClick={() => setFormData(prev => ({ ...prev, specifications: [...(prev.specifications || []), { name: '', value: '' }] }))}
                >
                  <FaPlus /> –î–æ–±–∞–≤–∏—Ç—å —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫—É
                </button>
              </div>
            </div>

            <div className="form-group form-group-full">
              <label>
                <input
                  type="checkbox"
                  name="available"
                  checked={formData.available}
                  onChange={handleInputChange}
                />
                –í –Ω–∞–ª–∏—á–∏–∏
              </label>
            </div>
          </div>

          <div className="form-actions">
            <button onClick={saveProduct} className="btn-success">
              <FaSave /> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
            </button>
            <button onClick={cancelEditing} className="btn-secondary">
              <FaTimes /> –û—Ç–º–µ–Ω–∞
            </button>
          </div>
        </div>
      )}

      <div className="products-table">
        <table>
          <thead>
            <tr>
              <th>ID</th>
              <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
              <th>–¶–µ–Ω–∞</th>
              <th>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</th>
              <th>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>
              <th>–ü–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è</th>
              <th>–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å</th>
              <th>–ù–∞–ª–∏—á–∏–µ</th>
              <th>–î–µ–π—Å—Ç–≤–∏—è</th>
            </tr>
          </thead>
          <tbody>
            {products.map(product => (
              <tr key={product.id}>
                <td>{product.id}</td>
                <td>
                  <div className="product-title">
                    {(() => {
                      const migratedProduct = migrateProductImages(product);
                      const mainImage = getMainImage(migratedProduct);
                      
                      if (mainImage?.data) {
                        if (typeof mainImage.data === 'string' && (mainImage.data.startsWith('data:image') || mainImage.data.startsWith('/uploads/') || mainImage.data.startsWith('http'))){
                          return <img src={mainImage.data} alt={product.title} className="product-image" />;
                        }
                        return <span className="product-icon">{mainImage.data}</span>;
                      }
                      return <span className="product-icon">üì¶</span>;
                    })()}
                    {product.title}
                  </div>
                </td>
                <td>{product.price.toLocaleString()} ‚ÇΩ</td>
                <td>
                  <span className={`quantity-badge ${(product.quantity || 0) === 0 ? 'out-of-stock' : (product.quantity || 0) < 5 ? 'low-stock' : 'in-stock'}`}>
                    {product.quantity || 0} —à—Ç.
                  </span>
                </td>
                <td>{product.category}</td>
                <td>{product.subcategory || '-'}</td>
                <td>{product.brand}</td>
                <td>
                  <span className={product.available ? 'status-available' : 'status-unavailable'}>
                    {product.available ? '–í –Ω–∞–ª–∏—á–∏–∏' : '–ù–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏'}
                  </span>
                </td>
                <td>
                  <div className="action-buttons">
                    <button 
                      onClick={() => startEditing(product)}
                      className="btn-edit"
                      title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å"
                    >
                      <FaEdit />
                    </button>
                    <button 
                      onClick={() => handleDelete(product.id)}
                      className="btn-delete"
                      title="–£–¥–∞–ª–∏—Ç—å"
                    >
                      <FaTrash />
                    </button>
                  </div>
                </td>
              </tr>
            ))}
          </tbody>
        </table>
      </div>
    </div>
  );
}

```

–ò—Å–ø—Ä–∞–≤–∏–ª –æ—à–∏–±–∫—É —Ä–µ–Ω–¥–µ—Ä–∞ –æ–±—ä–µ–∫—Ç–æ–≤:
- –ü—Ä–∏–≤—ë–ª —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –∫ –µ–¥–∏–Ω–æ–º—É —Ñ–æ—Ä–º–∞—Ç—É –º–∞—Å—Å–∏–≤–∞ `{ name, value }` –ø—Ä–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ —Ç–æ–≤–∞—Ä–∞.
- –ù–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ —Ç–æ–≤–∞—Ä–∞ –¥–æ–±–∞–≤–∏–ª –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—é: –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è –∏ –æ–±—ä–µ–∫—Ç, –∏ –º–∞—Å—Å–∏–≤ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫; –≤—ã–≤–æ–¥–∏—Ç—Å—è –∫–∞–∫ —Å–ø–∏—Å–æ–∫ –ø–∞—Ä.
- –í —Ñ–æ—Ä–º–µ –∞–¥–º–∏–Ω–∫–∏ –¥–æ–±–∞–≤–ª–µ–Ω UI –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫, —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –∫–∞–∫ –º–∞—Å—Å–∏–≤.

–§–∞–π–ª—ã:
- `src/pages/admin/ProductManagement.jsx`: –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è `specifications` –≤ `startEditing`, –ø–æ–ª—è —Ñ–æ—Ä–º—ã.
- `src/pages/ProductPage.jsx`: –±–µ–∑–æ–ø–∞—Å–Ω—ã–π —Ä–µ–Ω–¥–µ—Ä `specsArray`.

–¢–µ–ø–µ—Ä—å –æ—à–∏–±–∫–∞ ‚ÄúObjects are not valid as a React child ‚Ä¶ {name, value}‚Äù –Ω–µ –≤–æ–∑–Ω–∏–∫–∞–µ—Ç.

---

**User**

–í –∫–∞—Ç–∞–ª–æ–≥–µ –≤ –±–ª–æ–∫–µ —Ñ–∏–ª—å—Ç—Ä –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É –°–±—Ä–æ—Å–∏—Ç—å 

---

**Cursor**

–°–¥–µ–ª–∞—é –∫–Ω–æ–ø–∫—É —Å–±—Ä–æ—Å–∞ —Ñ–∏–ª—å—Ç—Ä–æ–≤ –≤ `src/Catalog.jsx`: –¥–æ–±–∞–≤–ª—é –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ `resetFilters` –∏ –∫–Ω–æ–ø–∫—É –≤ –ø–∞–Ω–µ–ª–∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤, —á—Ç–æ–±—ã –æ–±–Ω—É–ª–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é, –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—é, –±—Ä–µ–Ω–¥, —Ü–µ–Ω—ã –∏ —Ñ–ª–∞–≥ –Ω–∞–ª–∏—á–∏—è. –ó–∞—Ç–µ–º —Å–æ—Ö—Ä–∞–Ω—é.

```javascriptreact
import React, { useState } from 'react';
import { Link } from 'react-router-dom';
import { FaCheckCircle, FaTimesCircle, FaShoppingCart } from 'react-icons/fa';
import { useCartActions } from './hooks/useCartActions';
import { useAdminData } from './context/AdminDataContext';
// wishlist removed
import { migrateProductImages, getMainImage, isImageUrl } from './utils/imageHelpers';
import './Catalog.css';

export default function Catalog() {
  const { products, categories, brands } = useAdminData();
  const [selectedCategory, setSelectedCategory] = useState('–í—Å–µ');
  const [selectedSubcategory, setSelectedSubcategory] = useState('–í—Å–µ');
  const [selectedBrand, setSelectedBrand] = useState('–í—Å–µ');
  const [priceRange, setPriceRange] = useState([0, 200000]);
  const [inStock, setInStock] = useState(false);
  const { addToCartWithNotification } = useCartActions();

  // –°–æ–∑–¥–∞–µ–º —Å–ø–∏—Å–æ–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –∏ –±—Ä–µ–Ω–¥–æ–≤
  const categoryList = ['–í—Å–µ', ...Object.keys(categories)];
  const brandList = ['–í—Å–µ', ...brands];

  const minPrice = 0;
  const maxPrice = 200000;

  const resetFilters = () => {
    setSelectedCategory('–í—Å–µ');
    setSelectedSubcategory('–í—Å–µ');
    setSelectedBrand('–í—Å–µ');
    setPriceRange([minPrice, maxPrice]);
    setInStock(false);
  };

  // –ü–æ–ª—É—á–∞–µ–º –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
  const availableSubcategories = selectedCategory === '–í—Å–µ' 
    ? [] 
    : ['–í—Å–µ', ...(categories[selectedCategory] || [])];

  // –°–±—Ä–æ—Å –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø—Ä–∏ —Å–º–µ–Ω–µ –æ—Å–Ω–æ–≤–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
  const handleCategoryChange = (category) => {
    setSelectedCategory(category);
    setSelectedSubcategory('–í—Å–µ');
  };

  const filteredProducts = products.filter((product) => {
    const byCategory = selectedCategory === '–í—Å–µ' || product.category === selectedCategory;
    const bySubcategory = selectedSubcategory === '–í—Å–µ' || product.subcategory === selectedSubcategory;
    const byBrand = selectedBrand === '–í—Å–µ' || product.brand === selectedBrand;
    const byPrice = product.price >= priceRange[0] && product.price <= priceRange[1];
    const byStock = !inStock || product.available;
    return byCategory && bySubcategory && byBrand && byPrice && byStock;
  });

  const handleAddToCart = (product, e) => {
    e.preventDefault();
    e.stopPropagation();
    addToCartWithNotification(product, 1);
  };

  // wishlist removed

  return (
    <div className="catalog-wrapper">
      <aside className="catalog-filters">
        <h3>–§–∏–ª—å—Ç—Ä—ã</h3>
        <div className="filter-actions" style={{ marginBottom: '12px' }}>
          <button onClick={resetFilters} className="catalog-reset-btn">
            –°–±—Ä–æ—Å–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã
          </button>
        </div>
        <div className="filter-group">
          <label>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
          <select value={selectedCategory} onChange={e => handleCategoryChange(e.target.value)}>
            {categoryList.map(cat => (
              <option key={cat} value={cat}>{cat}</option>
            ))}
          </select>
        </div>
        {availableSubcategories.length > 0 && (
          <div className="filter-group">
            <label>–ü–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è</label>
            <select value={selectedSubcategory} onChange={e => setSelectedSubcategory(e.target.value)}>
              {availableSubcategories.map(subcat => (
                <option key={subcat} value={subcat}>{subcat}</option>
              ))}
            </select>
          </div>
        )}
        <div className="filter-group">
          <label>–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å</label>
          <select value={selectedBrand} onChange={e => setSelectedBrand(e.target.value)}>
            {brandList.map(brand => (
              <option key={brand} value={brand}>{brand}</option>
            ))}
          </select>
        </div>
        <div className="filter-group">
          <label>–¶–µ–Ω–∞, ‚ÇΩ</label>
          <div className="price-range">
            <input
              type="number"
              min={minPrice}
              max={priceRange[1]}
              value={priceRange[0]}
              onChange={e => setPriceRange([+e.target.value, priceRange[1]])}
            />
            <span>-</span>
            <input
              type="number"
              min={priceRange[0]}
              max={maxPrice}
              value={priceRange[1]}
              onChange={e => setPriceRange([priceRange[0], +e.target.value])}
            />
          </div>
        </div>
        <div className="filter-group">
          <label>
            <input
              type="checkbox"
              checked={inStock}
              onChange={e => setInStock(e.target.checked)}
            />
            –¢–æ–ª—å–∫–æ –≤ –Ω–∞–ª–∏—á–∏–∏
          </label>
        </div>
      </aside>
      <main className="catalog-main">
        <h2>–ö–∞—Ç–∞–ª–æ–≥ —Ç–æ–≤–∞—Ä–æ–≤</h2>
        <div className="catalog-grid">
          {filteredProducts.length === 0 && <div className="no-products">–ù–µ—Ç —Ç–æ–≤–∞—Ä–æ–≤ –ø–æ –≤—ã–±—Ä–∞–Ω–Ω—ã–º —Ñ–∏–ª—å—Ç—Ä–∞–º</div>}
          {filteredProducts.map(product => (
            <Link to={`/product/${product.id}`} className="catalog-card" key={product.id}>
              <div className="catalog-card-image">
                {(() => {
                  const migratedProduct = migrateProductImages(product);
                  const mainImage = getMainImage(migratedProduct);
                  
                  if (mainImage?.data) {
                    if (
                      typeof mainImage.data === 'string' &&
                      (mainImage.data.startsWith('data:image') || isImageUrl(mainImage.data))
                    ) {
                      return <img src={mainImage.data} alt={product.title} className="catalog-product-image" />;
                    }
                    return <span className="catalog-card-icon">{mainImage.data}</span>;
                  }
                  return <span className="catalog-card-icon">üì¶</span>;
                })()}
                {/* wishlist button removed */}
              </div>
              <div className="catalog-card-info">
                <h3>{product.title}</h3>
                <div className="catalog-card-price">{product.price.toLocaleString()} ‚ÇΩ</div>
                <div className="catalog-card-category">
                  <span className="category">{product.category}</span>
                  {product.subcategory && <span className="subcategory"> ‚Üí {product.subcategory}</span>}
                </div>
                <div className="catalog-card-meta">
                  <span className="catalog-card-brand">{product.brand}</span>
                  <span className={product.available ? 'in-stock' : 'out-of-stock'}>
                    {product.available ? <FaCheckCircle /> : <FaTimesCircle />} {product.available ? '–í –Ω–∞–ª–∏—á–∏–∏' : '–ù–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏'}
                  </span>
                </div>
                <button 
                  className="catalog-card-btn"
                  onClick={(e) => handleAddToCart(product, e)}
                  disabled={!product.available}
                >
                  <FaShoppingCart /> –í –∫–æ—Ä–∑–∏–Ω—É
                </button>
              </div>
            </Link>
          ))}
        </div>
      </main>
    </div>
  );
}

```

–î–æ–±–∞–≤–∏–ª –∫–Ω–æ–ø–∫—É —Å–±—Ä–æ—Å–∞ —Ñ–∏–ª—å—Ç—Ä–æ–≤ –≤ –∫–∞—Ç–∞–ª–æ–≥–µ:
- –ö–Ω–æ–ø–∫–∞ ‚Äú–°–±—Ä–æ—Å–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã‚Äù —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏—é, –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—é, –±—Ä–µ–Ω–¥, –¥–∏–∞–ø–∞–∑–æ–Ω —Ü–µ–Ω –∏ —Ñ–ª–∞–≥ ‚Äú–¢–æ–ª—å–∫–æ –≤ –Ω–∞–ª–∏—á–∏–∏‚Äù.
- –û–±—Ä–∞–±–æ—Ç—á–∏–∫ `resetFilters` –∏ –∫–Ω–æ–ø–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ –ø–∞–Ω–µ–ª—å —Ñ–∏–ª—å—Ç—Ä–æ–≤.

–§–∞–π–ª: `src/Catalog.jsx`.

---

**User**

–ü–µ—Ä–µ–º–µ—Å—Ç–∏ –∫–Ω–æ–ø–∫—É –≤–Ω–∏–∑ –±–ª–æ–∫–∞, –ø–æ–¥ –≥–∞–ª–æ—á–∫–æ–π "–¢–æ–ª—å–∫–æ –≤ –Ω–∞–ª–∏—á–∏–∏" 

---

**Cursor**

```javascriptreact
import React, { useState } from 'react';
import { Link } from 'react-router-dom';
import { FaCheckCircle, FaTimesCircle, FaShoppingCart } from 'react-icons/fa';
import { useCartActions } from './hooks/useCartActions';
import { useAdminData } from './context/AdminDataContext';
// wishlist removed
import { migrateProductImages, getMainImage, isImageUrl } from './utils/imageHelpers';
import './Catalog.css';

export default function Catalog() {
  const { products, categories, brands } = useAdminData();
  const [selectedCategory, setSelectedCategory] = useState('–í—Å–µ');
  const [selectedSubcategory, setSelectedSubcategory] = useState('–í—Å–µ');
  const [selectedBrand, setSelectedBrand] = useState('–í—Å–µ');
  const [priceRange, setPriceRange] = useState([0, 200000]);
  const [inStock, setInStock] = useState(false);
  const { addToCartWithNotification } = useCartActions();

  // –°–æ–∑–¥–∞–µ–º —Å–ø–∏—Å–æ–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –∏ –±—Ä–µ–Ω–¥–æ–≤
  const categoryList = ['–í—Å–µ', ...Object.keys(categories)];
  const brandList = ['–í—Å–µ', ...brands];

  const minPrice = 0;
  const maxPrice = 200000;

  const resetFilters = () => {
    setSelectedCategory('–í—Å–µ');
    setSelectedSubcategory('–í—Å–µ');
    setSelectedBrand('–í—Å–µ');
    setPriceRange([minPrice, maxPrice]);
    setInStock(false);
  };

  // –ü–æ–ª—É—á–∞–µ–º –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
  const availableSubcategories = selectedCategory === '–í—Å–µ' 
    ? [] 
    : ['–í—Å–µ', ...(categories[selectedCategory] || [])];

  // –°–±—Ä–æ—Å –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø—Ä–∏ —Å–º–µ–Ω–µ –æ—Å–Ω–æ–≤–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
  const handleCategoryChange = (category) => {
    setSelectedCategory(category);
    setSelectedSubcategory('–í—Å–µ');
  };

  const filteredProducts = products.filter((product) => {
    const byCategory = selectedCategory === '–í—Å–µ' || product.category === selectedCategory;
    const bySubcategory = selectedSubcategory === '–í—Å–µ' || product.subcategory === selectedSubcategory;
    const byBrand = selectedBrand === '–í—Å–µ' || product.brand === selectedBrand;
    const byPrice = product.price >= priceRange[0] && product.price <= priceRange[1];
    const byStock = !inStock || product.available;
    return byCategory && bySubcategory && byBrand && byPrice && byStock;
  });

  const handleAddToCart = (product, e) => {
    e.preventDefault();
    e.stopPropagation();
    addToCartWithNotification(product, 1);
  };

  // wishlist removed

  return (
    <div className="catalog-wrapper">
      <aside className="catalog-filters">
        <h3>–§–∏–ª—å—Ç—Ä—ã</h3>
        <div className="filter-group">
          <label>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
          <select value={selectedCategory} onChange={e => handleCategoryChange(e.target.value)}>
            {categoryList.map(cat => (
              <option key={cat} value={cat}>{cat}</option>
            ))}
          </select>
        </div>
        {availableSubcategories.length > 0 && (
          <div className="filter-group">
            <label>–ü–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è</label>
            <select value={selectedSubcategory} onChange={e => setSelectedSubcategory(e.target.value)}>
              {availableSubcategories.map(subcat => (
                <option key={subcat} value={subcat}>{subcat}</option>
              ))}
            </select>
          </div>
        )}
        <div className="filter-group">
          <label>–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å</label>
          <select value={selectedBrand} onChange={e => setSelectedBrand(e.target.value)}>
            {brandList.map(brand => (
              <option key={brand} value={brand}>{brand}</option>
            ))}
          </select>
        </div>
        <div className="filter-group">
          <label>–¶–µ–Ω–∞, ‚ÇΩ</label>
          <div className="price-range">
            <input
              type="number"
              min={minPrice}
              max={priceRange[1]}
              value={priceRange[0]}
              onChange={e => setPriceRange([+e.target.value, priceRange[1]])}
            />
            <span>-</span>
            <input
              type="number"
              min={priceRange[0]}
              max={maxPrice}
              value={priceRange[1]}
              onChange={e => setPriceRange([priceRange[0], +e.target.value])}
            />
          </div>
        </div>
        <div className="filter-group">
          <label>
            <input
              type="checkbox"
              checked={inStock}
              onChange={e => setInStock(e.target.checked)}
            />
            –¢–æ–ª—å–∫–æ –≤ –Ω–∞–ª–∏—á–∏–∏
          </label>
        </div>
        <div className="filter-actions" style={{ marginTop: '8px' }}>
          <button onClick={resetFilters} className="catalog-reset-btn">
            –°–±—Ä–æ—Å–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã
          </button>
        </div>
      </aside>
      <main className="catalog-main">
        <h2>–ö–∞—Ç–∞–ª–æ–≥ —Ç–æ–≤–∞—Ä–æ–≤</h2>
        <div className="catalog-grid">
          {filteredProducts.length === 0 && <div className="no-products">–ù–µ—Ç —Ç–æ–≤–∞—Ä–æ–≤ –ø–æ –≤—ã–±—Ä–∞–Ω–Ω—ã–º —Ñ–∏–ª—å—Ç—Ä–∞–º</div>}
          {filteredProducts.map(product => (
            <Link to={`/product/${product.id}`} className="catalog-card" key={product.id}>
              <div className="catalog-card-image">
                {(() => {
                  const migratedProduct = migrateProductImages(product);
                  const mainImage = getMainImage(migratedProduct);
                  
                  if (mainImage?.data) {
                    if (
                      typeof mainImage.data === 'string' &&
                      (mainImage.data.startsWith('data:image') || isImageUrl(mainImage.data))
                    ) {
                      return <img src={mainImage.data} alt={product.title} className="catalog-product-image" />;
                    }
                    return <span className="catalog-card-icon">{mainImage.data}</span>;
                  }
                  return <span className="catalog-card-icon">üì¶</span>;
                })()}
                {/* wishlist button removed */}
              </div>
              <div className="catalog-card-info">
                <h3>{product.title}</h3>
                <div className="catalog-card-price">{product.price.toLocaleString()} ‚ÇΩ</div>
                <div className="catalog-card-category">
                  <span className="category">{product.category}</span>
                  {product.subcategory && <span className="subcategory"> ‚Üí {product.subcategory}</span>}
                </div>
                <div className="catalog-card-meta">
                  <span className="catalog-card-brand">{product.brand}</span>
                  <span className={product.available ? 'in-stock' : 'out-of-stock'}>
                    {product.available ? <FaCheckCircle /> : <FaTimesCircle />} {product.available ? '–í –Ω–∞–ª–∏—á–∏–∏' : '–ù–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏'}
                  </span>
                </div>
                <button 
                  className="catalog-card-btn"
                  onClick={(e) => handleAddToCart(product, e)}
                  disabled={!product.available}
                >
                  <FaShoppingCart /> –í –∫–æ—Ä–∑–∏–Ω—É
                </button>
              </div>
            </Link>
          ))}
        </div>
      </main>
    </div>
  );
}

```

–ì–æ—Ç–æ–≤–æ. –ö–Ω–æ–ø–∫–∞ ‚Äú–°–±—Ä–æ—Å–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã‚Äù –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–∞ –≤–Ω–∏–∑ –ø–∞–Ω–µ–ª–∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤ ‚Äî —Å—Ä–∞–∑—É –ø–æ–¥ –≥–∞–ª–æ—á–∫–æ–π ‚Äú–¢–æ–ª—å–∫–æ –≤ –Ω–∞–ª–∏—á–∏–∏‚Äù.

- –ò–∑–º–µ–Ω—ë–Ω —Ñ–∞–π–ª: `src/Catalog.jsx`.

---

**User**

–í —Ñ–∏–ª—å—Ç—Ä–∞—Ö, —É–±–µ–≥–∞–µ—Ç —Å—Ç—Ä–æ–∫–∞ –ø—Ä–∏ –≤–≤–æ–¥–µ —Å—É–º–º—ã. –¢–∞–∫ –∂–µ —É–±–µ—Ä–∏ –æ—Ç —Ç—É–¥–∞ —Å—Ç—Ä–µ–ª–æ—á–∫–∏ 

---

**Cursor**

```javascriptreact
import React, { useState } from 'react';
import { Link } from 'react-router-dom';
import { FaCheckCircle, FaTimesCircle, FaShoppingCart } from 'react-icons/fa';
import { useCartActions } from './hooks/useCartActions';
import { useAdminData } from './context/AdminDataContext';
// wishlist removed
import { migrateProductImages, getMainImage, isImageUrl } from './utils/imageHelpers';
import './Catalog.css';

export default function Catalog() {
  const { products, categories, brands } = useAdminData();
  const [selectedCategory, setSelectedCategory] = useState('–í—Å–µ');
  const [selectedSubcategory, setSelectedSubcategory] = useState('–í—Å–µ');
  const [selectedBrand, setSelectedBrand] = useState('–í—Å–µ');
  const [priceRange, setPriceRange] = useState([0, 200000]);
  const [minPriceInput, setMinPriceInput] = useState('0');
  const [maxPriceInput, setMaxPriceInput] = useState('200000');
  const [inStock, setInStock] = useState(false);
  const { addToCartWithNotification } = useCartActions();

  // –°–æ–∑–¥–∞–µ–º —Å–ø–∏—Å–æ–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –∏ –±—Ä–µ–Ω–¥–æ–≤
  const categoryList = ['–í—Å–µ', ...Object.keys(categories)];
  const brandList = ['–í—Å–µ', ...brands];

  const minPrice = 0;
  const maxPrice = 200000;

  const clamp = (value, min, max) => Math.max(min, Math.min(max, value));

  const handleMinPriceChange = (e) => {
    const raw = e.target.value.replace(/\D/g, '');
    setMinPriceInput(raw);
    const num = raw === '' ? minPrice : parseInt(raw, 10);
    setPriceRange(([_, r]) => [clamp(num, minPrice, r), r]);
  };

  const handleMaxPriceChange = (e) => {
    const raw = e.target.value.replace(/\D/g, '');
    setMaxPriceInput(raw);
    const num = raw === '' ? maxPrice : parseInt(raw, 10);
    setPriceRange(([l, _]) => [l, clamp(num, l, maxPrice)]);
  };

  const normalizeMinOnBlur = () => {
    const num = minPriceInput === '' ? minPrice : parseInt(minPriceInput, 10);
    const clamped = clamp(num, minPrice, priceRange[1]);
    setMinPriceInput(String(clamped));
    setPriceRange(([_, r]) => [clamped, r]);
  };

  const normalizeMaxOnBlur = () => {
    const num = maxPriceInput === '' ? maxPrice : parseInt(maxPriceInput, 10);
    const clamped = clamp(num, priceRange[0], maxPrice);
    setMaxPriceInput(String(clamped));
    setPriceRange(([l, _]) => [l, clamped]);
  };

  const resetFilters = () => {
    setSelectedCategory('–í—Å–µ');
    setSelectedSubcategory('–í—Å–µ');
    setSelectedBrand('–í—Å–µ');
    setPriceRange([minPrice, maxPrice]);
    setMinPriceInput(String(minPrice));
    setMaxPriceInput(String(maxPrice));
    setInStock(false);
  };

  // –ü–æ–ª—É—á–∞–µ–º –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
  const availableSubcategories = selectedCategory === '–í—Å–µ' 
    ? [] 
    : ['–í—Å–µ', ...(categories[selectedCategory] || [])];

  // –°–±—Ä–æ—Å –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø—Ä–∏ —Å–º–µ–Ω–µ –æ—Å–Ω–æ–≤–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
  const handleCategoryChange = (category) => {
    setSelectedCategory(category);
    setSelectedSubcategory('–í—Å–µ');
  };

  const filteredProducts = products.filter((product) => {
    const byCategory = selectedCategory === '–í—Å–µ' || product.category === selectedCategory;
    const bySubcategory = selectedSubcategory === '–í—Å–µ' || product.subcategory === selectedSubcategory;
    const byBrand = selectedBrand === '–í—Å–µ' || product.brand === selectedBrand;
    const byPrice = product.price >= priceRange[0] && product.price <= priceRange[1];
    const byStock = !inStock || product.available;
    return byCategory && bySubcategory && byBrand && byPrice && byStock;
  });

  const handleAddToCart = (product, e) => {
    e.preventDefault();
    e.stopPropagation();
    addToCartWithNotification(product, 1);
  };

  // wishlist removed

  return (
    <div className="catalog-wrapper">
      <aside className="catalog-filters">
        <h3>–§–∏–ª—å—Ç—Ä—ã</h3>
        <div className="filter-group">
          <label>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
          <select value={selectedCategory} onChange={e => handleCategoryChange(e.target.value)}>
            {categoryList.map(cat => (
              <option key={cat} value={cat}>{cat}</option>
            ))}
          </select>
        </div>
        {availableSubcategories.length > 0 && (
          <div className="filter-group">
            <label>–ü–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è</label>
            <select value={selectedSubcategory} onChange={e => setSelectedSubcategory(e.target.value)}>
              {availableSubcategories.map(subcat => (
                <option key={subcat} value={subcat}>{subcat}</option>
              ))}
            </select>
          </div>
        )}
        <div className="filter-group">
          <label>–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å</label>
          <select value={selectedBrand} onChange={e => setSelectedBrand(e.target.value)}>
            {brandList.map(brand => (
              <option key={brand} value={brand}>{brand}</option>
            ))}
          </select>
        </div>
        <div className="filter-group">
          <label>–¶–µ–Ω–∞, ‚ÇΩ</label>
          <div className="price-range">
            <input
              type="text"
              inputMode="numeric"
              pattern="[0-9]*"
              value={minPriceInput}
              onChange={handleMinPriceChange}
              onBlur={normalizeMinOnBlur}
            />
            <span>-</span>
            <input
              type="text"
              inputMode="numeric"
              pattern="[0-9]*"
              value={maxPriceInput}
              onChange={handleMaxPriceChange}
              onBlur={normalizeMaxOnBlur}
            />
          </div>
        </div>
        <div className="filter-group">
          <label>
            <input
              type="checkbox"
              checked={inStock}
              onChange={e => setInStock(e.target.checked)}
            />
            –¢–æ–ª—å–∫–æ –≤ –Ω–∞–ª–∏—á–∏–∏
          </label>
        </div>
        <div className="filter-actions" style={{ marginTop: '8px' }}>
          <button onClick={resetFilters} className="catalog-reset-btn">
            –°–±—Ä–æ—Å–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã
          </button>
        </div>
      </aside>
      <main className="catalog-main">
        <h2>–ö–∞—Ç–∞–ª–æ–≥ —Ç–æ–≤–∞—Ä–æ–≤</h2>
        <div className="catalog-grid">
          {filteredProducts.length === 0 && <div className="no-products">–ù–µ—Ç —Ç–æ–≤–∞—Ä–æ–≤ –ø–æ –≤—ã–±—Ä–∞–Ω–Ω—ã–º —Ñ–∏–ª—å—Ç—Ä–∞–º</div>}
          {filteredProducts.map(product => (
            <Link to={`/product/${product.id}`} className="catalog-card" key={product.id}>
              <div className="catalog-card-image">
                {(() => {
                  const migratedProduct = migrateProductImages(product);
                  const mainImage = getMainImage(migratedProduct);
                  
                  if (mainImage?.data) {
                    if (
                      typeof mainImage.data === 'string' &&
                      (mainImage.data.startsWith('data:image') || isImageUrl(mainImage.data))
                    ) {
                      return <img src={mainImage.data} alt={product.title} className="catalog-product-image" />;
                    }
                    return <span className="catalog-card-icon">{mainImage.data}</span>;
                  }
                  return <span className="catalog-card-icon">üì¶</span>;
                })()}
                {/* wishlist button removed */}
              </div>
              <div className="catalog-card-info">
                <h3>{product.title}</h3>
                <div className="catalog-card-price">{product.price.toLocaleString()} ‚ÇΩ</div>
                <div className="catalog-card-category">
                  <span className="category">{product.category}</span>
                  {product.subcategory && <span className="subcategory"> ‚Üí {product.subcategory}</span>}
                </div>
                <div className="catalog-card-meta">
                  <span className="catalog-card-brand">{product.brand}</span>
                  <span className={product.available ? 'in-stock' : 'out-of-stock'}>
                    {product.available ? <FaCheckCircle /> : <FaTimesCircle />} {product.available ? '–í –Ω–∞–ª–∏—á–∏–∏' : '–ù–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏'}
                  </span>
                </div>
                <button 
                  className="catalog-card-btn"
                  onClick={(e) => handleAddToCart(product, e)}
                  disabled={!product.available}
                >
                  <FaShoppingCart /> –í –∫–æ—Ä–∑–∏–Ω—É
                </button>
              </div>
            </Link>
          ))}
        </div>
      </main>
    </div>
  );
}

```

```javascriptreact
import React, { useState } from 'react';
import { Link } from 'react-router-dom';
import { FaCheckCircle, FaTimesCircle, FaShoppingCart } from 'react-icons/fa';
import { useCartActions } from './hooks/useCartActions';
import { useAdminData } from './context/AdminDataContext';
// wishlist removed
import { migrateProductImages, getMainImage, isImageUrl } from './utils/imageHelpers';
import './Catalog.css';

export default function Catalog() {
  const { products, categories, brands } = useAdminData();
  const [selectedCategory, setSelectedCategory] = useState('–í—Å–µ');
  const [selectedSubcategory, setSelectedSubcategory] = useState('–í—Å–µ');
  const [selectedBrand, setSelectedBrand] = useState('–í—Å–µ');
  const [priceRange, setPriceRange] = useState([0, 200000]);
  const [minPriceInput, setMinPriceInput] = useState('0');
  const [maxPriceInput, setMaxPriceInput] = useState('200000');
  const [inStock, setInStock] = useState(false);
  const { addToCartWithNotification } = useCartActions();

  // –°–æ–∑–¥–∞–µ–º —Å–ø–∏—Å–æ–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –∏ –±—Ä–µ–Ω–¥–æ–≤
  const categoryList = ['–í—Å–µ', ...Object.keys(categories)];
  const brandList = ['–í—Å–µ', ...brands];

  const minPrice = 0;
  const maxPrice = 200000;

  const clamp = (value, min, max) => Math.max(min, Math.min(max, value));

  const handleMinPriceChange = (e) => {
    const raw = e.target.value.replace(/\D/g, '');
    setMinPriceInput(raw);
    const num = raw === '' ? minPrice : parseInt(raw, 10);
    setPriceRange(([_, r]) => [clamp(num, minPrice, r), r]);
  };

  const handleMaxPriceChange = (e) => {
    const raw = e.target.value.replace(/\D/g, '');
    setMaxPriceInput(raw);
    const num = raw === '' ? maxPrice : parseInt(raw, 10);
    setPriceRange(([l, _]) => [l, clamp(num, l, maxPrice)]);
  };

  const normalizeMinOnBlur = () => {
    const num = minPriceInput === '' ? minPrice : parseInt(minPriceInput, 10);
    const clamped = clamp(num, minPrice, priceRange[1]);
    setMinPriceInput(String(clamped));
    setPriceRange(([_, r]) => [clamped, r]);
  };

  const normalizeMaxOnBlur = () => {
    const num = maxPriceInput === '' ? maxPrice : parseInt(maxPriceInput, 10);
    const clamped = clamp(num, priceRange[0], maxPrice);
    setMaxPriceInput(String(clamped));
    setPriceRange(([l, _]) => [l, clamped]);
  };

  const resetFilters = () => {
    setSelectedCategory('–í—Å–µ');
    setSelectedSubcategory('–í—Å–µ');
    setSelectedBrand('–í—Å–µ');
    setPriceRange([minPrice, maxPrice]);
    setMinPriceInput(String(minPrice));
    setMaxPriceInput(String(maxPrice));
    setInStock(false);
  };

  // –ü–æ–ª—É—á–∞–µ–º –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
  const availableSubcategories = selectedCategory === '–í—Å–µ' 
    ? [] 
    : ['–í—Å–µ', ...(categories[selectedCategory] || [])];

  // –°–±—Ä–æ—Å –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø—Ä–∏ —Å–º–µ–Ω–µ –æ—Å–Ω–æ–≤–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
  const handleCategoryChange = (category) => {
    setSelectedCategory(category);
    setSelectedSubcategory('–í—Å–µ');
  };

  const filteredProducts = products.filter((product) => {
    const byCategory = selectedCategory === '–í—Å–µ' || product.category === selectedCategory;
    const bySubcategory = selectedSubcategory === '–í—Å–µ' || product.subcategory === selectedSubcategory;
    const byBrand = selectedBrand === '–í—Å–µ' || product.brand === selectedBrand;
    const byPrice = product.price >= priceRange[0] && product.price <= priceRange[1];
    const byStock = !inStock || product.available;
    return byCategory && bySubcategory && byBrand && byPrice && byStock;
  });

  const handleAddToCart = (product, e) => {
    e.preventDefault();
    e.stopPropagation();
    addToCartWithNotification(product, 1);
  };

  // wishlist removed

  return (
    <div className="catalog-wrapper">
      <aside className="catalog-filters">
        <h3>–§–∏–ª—å—Ç—Ä—ã</h3>
        <div className="filter-group">
          <label>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
          <select value={selectedCategory} onChange={e => handleCategoryChange(e.target.value)}>
            {categoryList.map(cat => (
              <option key={cat} value={cat}>{cat}</option>
            ))}
          </select>
        </div>
        {availableSubcategories.length > 0 && (
          <div className="filter-group">
            <label>–ü–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è</label>
            <select value={selectedSubcategory} onChange={e => setSelectedSubcategory(e.target.value)}>
              {availableSubcategories.map(subcat => (
                <option key={subcat} value={subcat}>{subcat}</option>
              ))}
            </select>
          </div>
        )}
        <div className="filter-group">
          <label>–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å</label>
          <select value={selectedBrand} onChange={e => setSelectedBrand(e.target.value)}>
            {brandList.map(brand => (
              <option key={brand} value={brand}>{brand}</option>
            ))}
          </select>
        </div>
        <div className="filter-group">
          <label>–¶–µ–Ω–∞, ‚ÇΩ</label>
          <div className="price-range">
            <input
              type="text"
              inputMode="numeric"
              pattern="[0-9]*"
              value={minPriceInput}
              maxLength={6}
              placeholder={String(minPrice)}
              onChange={handleMinPriceChange}
              onBlur={normalizeMinOnBlur}
            />
            <span>-</span>
            <input
              type="text"
              inputMode="numeric"
              pattern="[0-9]*"
              value={maxPriceInput}
              maxLength={6}
              placeholder={String(maxPrice)}
              onChange={handleMaxPriceChange}
              onBlur={normalizeMaxOnBlur}
            />
          </div>
        </div>
        <div className="filter-group">
          <label>
            <input
              type="checkbox"
              checked={inStock}
              onChange={e => setInStock(e.target.checked)}
            />
            –¢–æ–ª—å–∫–æ –≤ –Ω–∞–ª–∏—á–∏–∏
          </label>
        </div>
        <div className="filter-actions" style={{ marginTop: '8px' }}>
          <button onClick={resetFilters} className="catalog-reset-btn">
            –°–±—Ä–æ—Å–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã
          </button>
        </div>
      </aside>
      <main className="catalog-main">
        <h2>–ö–∞—Ç–∞–ª–æ–≥ —Ç–æ–≤–∞—Ä–æ–≤</h2>
        <div className="catalog-grid">
          {filteredProducts.length === 0 && <div className="no-products">–ù–µ—Ç —Ç–æ–≤–∞—Ä–æ–≤ –ø–æ –≤—ã–±—Ä–∞–Ω–Ω—ã–º —Ñ–∏–ª—å—Ç—Ä–∞–º</div>}
          {filteredProducts.map(product => (
            <Link to={`/product/${product.id}`} className="catalog-card" key={product.id}>
              <div className="catalog-card-image">
                {(() => {
                  const migratedProduct = migrateProductImages(product);
                  const mainImage = getMainImage(migratedProduct);
                  
                  if (mainImage?.data) {
                    if (
                      typeof mainImage.data === 'string' &&
                      (mainImage.data.startsWith('data:image') || isImageUrl(mainImage.data))
                    ) {
                      return <img src={mainImage.data} alt={product.title} className="catalog-product-image" />;
                    }
                    return <span className="catalog-card-icon">{mainImage.data}</span>;
                  }
                  return <span className="catalog-card-icon">üì¶</span>;
                })()}
                {/* wishlist button removed */}
              </div>
              <div className="catalog-card-info">
                <h3>{product.title}</h3>
                <div className="catalog-card-price">{product.price.toLocaleString()} ‚ÇΩ</div>
                <div className="catalog-card-category">
                  <span className="category">{product.category}</span>
                  {product.subcategory && <span className="subcategory"> ‚Üí {product.subcategory}</span>}
                </div>
                <div className="catalog-card-meta">
                  <span className="catalog-card-brand">{product.brand}</span>
                  <span className={product.available ? 'in-stock' : 'out-of-stock'}>
                    {product.available ? <FaCheckCircle /> : <FaTimesCircle />} {product.available ? '–í –Ω–∞–ª–∏—á–∏–∏' : '–ù–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏'}
                  </span>
                </div>
                <button 
                  className="catalog-card-btn"
                  onClick={(e) => handleAddToCart(product, e)}
                  disabled={!product.available}
                >
                  <FaShoppingCart /> –í –∫–æ—Ä–∑–∏–Ω—É
                </button>
              </div>
            </Link>
          ))}
        </div>
      </main>
    </div>
  );
}

```

```css
/* –ö–∞—Ç–∞–ª–æ–≥ —Ç–æ–≤–∞—Ä–æ–≤ */
.catalog-wrapper {
  display: flex;
  gap: 2rem;
  margin: 3rem 0 5rem 0;
  width: 100%;
}

.catalog-filters {
  background: #181818;
  border-radius: 16px;
  padding: 2rem 1.5rem;
  min-width: 260px;
  max-width: 300px;
  box-shadow: 0 4px 24px rgba(0,0,0,0.12);
  color: #fff;
  height: fit-content;
}

.catalog-filters h3 {
  margin-bottom: 1.5rem;
  color: #e6a34a;
  font-size: 1.3rem;
  font-weight: 700;
}

.filter-group {
  margin-bottom: 1.5rem;
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
}

.filter-group label {
  font-size: 1rem;
  color: #cccccc;
}

.filter-group select, .filter-group input[type='number'], .filter-group input[type='text'] {
  padding: 0.5rem 0.7rem;
  border-radius: 8px;
  border: 1px solid #222;
  background: #222;
  color: #fff;
  font-size: 1rem;
  outline: none;
  margin-top: 0.2rem;
}

/* –£–±–∏—Ä–∞–µ–º —Å—Ç—Ä–µ–ª–æ—á–∫–∏ —É number (–Ω–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π) */
input[type='number']::-webkit-outer-spin-button,
input[type='number']::-webkit-inner-spin-button {
  -webkit-appearance: none;
  margin: 0;
}
input[type='number'] {
  -moz-appearance: textfield;
}

.price-range {
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.filter-group input[type='checkbox'] {
  accent-color: #e6a34a;
  margin-right: 0.5rem;
}

.catalog-main {
  flex: 1;
  width: 100%;
}

.catalog-main h2 {
  font-size: 2rem;
  font-weight: 700;
  margin-bottom: 2rem;
  color: #e6a34a;
}

.catalog-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
  gap: 2rem;
}

.catalog-card {
  background: #181818;
  border-radius: 16px;
  box-shadow: 0 4px 24px rgba(0,0,0,0.12);
  padding: 1.5rem;
  display: flex;
  flex-direction: column;
  align-items: center;
  transition: box-shadow 0.3s, transform 0.3s;
  border: 1px solid transparent;
}

.catalog-card:hover {
  box-shadow: 0 8px 32px rgba(230, 163, 74, 0.10);
  border: 1px solid #e6a34a;
  transform: translateY(-5px) scale(1.03);
}

.catalog-card-image {
  width: 100%;
  height: 140px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 3rem;
  color: #e6a34a;
  margin-bottom: 1rem;
  position: relative;
  overflow: hidden;
  border-radius: 8px;
}

/* wishlist toggle removed */

.catalog-product-image {
  width: 100%;
  height: 100%;
  object-fit: cover;
  border-radius: 8px;
  transition: transform 0.3s ease;
}

.catalog-card:hover .catalog-product-image {
  transform: scale(1.1);
}

.catalog-card-info {
  width: 100%;
  text-align: center;
}

.catalog-card-info h3 {
  font-size: 1.1rem;
  font-weight: 600;
  margin-bottom: 0.5rem;
  color: #fff;
}

.catalog-card-price {
  font-size: 1.3rem;
  font-weight: 700;
  color: #e6a34a;
  margin-bottom: 0.7rem;
}

.catalog-card-category {
  margin-bottom: 0.8rem;
  font-size: 0.9rem;
  color: #888;
}

.catalog-card-category .category {
  color: #e6a34a;
  font-weight: 600;
}

.catalog-card-category .subcategory {
  color: #ccc;
  font-weight: 400;
}

.catalog-card-meta {
  display: flex;
  justify-content: space-between;
  align-items: center;
  font-size: 0.95rem;
  margin-bottom: 1rem;
  color: #cccccc;
}

.catalog-card-brand {
  font-weight: 500;
}

.in-stock {
  color: #e6a34a;
  display: flex;
  align-items: center;
  gap: 0.3rem;
}

.out-of-stock {
  color: #ff4d4f;
  display: flex;
  align-items: center;
  gap: 0.3rem;
}

.catalog-card-btn {
  background: linear-gradient(135deg, #e6a34a 0%, #c97c1a 100%);
  color: #000;
  border: none;
  padding: 0.7rem 1.5rem;
  font-size: 1rem;
  font-weight: 600;
  border-radius: 25px;
  cursor: pointer;
  width: 100%;
  transition: all 0.3s;
  margin-top: 0.5rem;
}

.catalog-card-btn:hover {
  background: linear-gradient(135deg, #c97c1a 0%, #e6a34a 100%);
  color: #fff;
  transform: translateY(-2px);
  box-shadow: 0 10px 20px rgba(230, 163, 74, 0.15);
}

.no-products {
  color: #ff4d4f;
  font-size: 1.2rem;
  text-align: center;
  grid-column: 1/-1;
  margin: 2rem 0;
}

@media (max-width: 900px) {
  .catalog-wrapper {
    flex-direction: column;
    gap: 1.5rem;
  }
  .catalog-filters {
    max-width: 100%;
    width: 100%;
    display: flex;
    flex-wrap: wrap;
    gap: 1.5rem;
    justify-content: flex-start;
  }
  .catalog-main {
    width: 100%;
  }
}

@media (max-width: 600px) {
  .catalog-grid {
    grid-template-columns: 1fr;
  }
  .catalog-filters {
    flex-direction: column;
    gap: 1rem;
    padding: 1rem;
  }
}

```

–°–¥–µ–ª–∞–ª —Ñ–∏–∫—Å –≤–≤–æ–¥–∞ —Ü–µ–Ω—ã –≤ —Ñ–∏–ª—å—Ç—Ä–∞—Ö –∏ —É–±—Ä–∞–ª —Å—Ç—Ä–µ–ª–æ—á–∫–∏:
- –ó–∞–º–µ–Ω–∏–ª –ø–æ–ª—è —Ü–µ–Ω—ã –Ω–∞ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ —Å `inputMode='numeric'` –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π —Ç–æ–ª—å–∫–æ —Ü–∏—Ñ—Ä. –°—Ç—Ä–æ–∫–∞ –±–æ–ª—å—à–µ –Ω–µ ‚Äú–ø—Ä—ã–≥–∞–µ—Ç‚Äù –ø—Ä–∏ –Ω–∞–±–æ—Ä–µ.
- –ó–Ω–∞—á–µ–Ω–∏—è –∫–ª–∞–º–ø—è—Ç—Å—è –≤ –¥–æ–ø—É—Å—Ç–∏–º—ã–π –¥–∏–∞–ø–∞–∑–æ–Ω –∏ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É—é—Ç—Å—è –Ω–∞ blur.
- –£–±—Ä–∞–ª —Å–ø–∏–Ω–Ω–µ—Ä—ã —É –∏–Ω–ø—É—Ç–æ–≤ (—Å—Ç—Ä–µ–ª–æ—á–∫–∏) —á–µ—Ä–µ–∑ CSS.
- –°–±—Ä–æ—Å —Ñ–∏–ª—å—Ç—Ä–æ–≤ —Ç–∞–∫–∂–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ü–µ–Ω—ã –∫ 0‚Äì200000.

–ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª:
- `src/Catalog.jsx`: –ª–æ–≥–∏–∫–∞ –ø–æ–ª–µ–π —Ü–µ–Ω—ã (`minPriceInput`, `maxPriceInput`, clamp, onBlur), `maxLength`, `placeholder`.
- `src/Catalog.css`: —Å—Ç–∏–ª–∏ –¥–ª—è `input[type='text']` –∏ —Å–∫—Ä—ã—Ç–∏–µ —Å—Ç—Ä–µ–ª–æ–∫ —É number.

–ö–æ—Ä–æ—Ç–∫–æ:
- –í–≤–æ–¥ —Å—É–º–º—ã —Å—Ç–∞–±–∏–ª–µ–Ω, –±–µ–∑ —Å–º–µ—â–µ–Ω–∏—è –≤–µ—Ä—Å—Ç–∫–∏.
- –°—Ç—Ä–µ–ª–æ—á–µ–∫ –Ω–µ—Ç.
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Ü–µ–Ω–µ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.

---

**User**

–°—Ç—Ä–æ–∫–∞ —É–µ—Ö–∞–ª–∞

---

**Cursor**

```css
/* –ö–∞—Ç–∞–ª–æ–≥ —Ç–æ–≤–∞—Ä–æ–≤ */
.catalog-wrapper {
  display: flex;
  gap: 2rem;
  margin: 3rem 0 5rem 0;
  width: 100%;
}

.catalog-filters {
  background: #181818;
  border-radius: 16px;
  padding: 2rem 1.5rem;
  min-width: 260px;
  max-width: 300px;
  box-shadow: 0 4px 24px rgba(0,0,0,0.12);
  color: #fff;
  height: fit-content;
}

.catalog-filters h3 {
  margin-bottom: 1.5rem;
  color: #e6a34a;
  font-size: 1.3rem;
  font-weight: 700;
}

.filter-group {
  margin-bottom: 1.5rem;
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
}

.filter-group label {
  font-size: 1rem;
  color: #cccccc;
}

.filter-group select, .filter-group input[type='number'], .filter-group input[type='text'] {
  padding: 0.5rem 0.7rem;
  border-radius: 8px;
  border: 1px solid #222;
  background: #222;
  color: #fff;
  font-size: 1rem;
  outline: none;
  margin-top: 0.2rem;
}

/* –£–±–∏—Ä–∞–µ–º —Å—Ç—Ä–µ–ª–æ—á–∫–∏ —É number (–Ω–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π) */
input[type='number']::-webkit-outer-spin-button,
input[type='number']::-webkit-inner-spin-button {
  -webkit-appearance: none;
  margin: 0;
}
input[type='number'] {
  -moz-appearance: textfield;
}

.price-range {
  display: grid;
  grid-template-columns: 1fr auto 1fr;
  align-items: center;
  gap: 0.5rem;
}

.price-range input {
  width: 100%;
  min-width: 0; /* –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç ¬´—Ä–∞—Å–ø–æ–ª–∑–∞–Ω–∏–µ¬ª */
}

.price-range span {
  color: #cccccc;
}

.filter-group input[type='checkbox'] {
  accent-color: #e6a34a;
  margin-right: 0.5rem;
}

.catalog-main {
  flex: 1;
  width: 100%;
}

.catalog-main h2 {
  font-size: 2rem;
  font-weight: 700;
  margin-bottom: 2rem;
  color: #e6a34a;
}

.catalog-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
  gap: 2rem;
}

.catalog-card {
  background: #181818;
  border-radius: 16px;
  box-shadow: 0 4px 24px rgba(0,0,0,0.12);
  padding: 1.5rem;
  display: flex;
  flex-direction: column;
  align-items: center;
  transition: box-shadow 0.3s, transform 0.3s;
  border: 1px solid transparent;
}

.catalog-card:hover {
  box-shadow: 0 8px 32px rgba(230, 163, 74, 0.10);
  border: 1px solid #e6a34a;
  transform: translateY(-5px) scale(1.03);
}

.catalog-card-image {
  width: 100%;
  height: 140px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 3rem;
  color: #e6a34a;
  margin-bottom: 1rem;
  position: relative;
  overflow: hidden;
  border-radius: 8px;
}

/* wishlist toggle removed */

.catalog-product-image {
  width: 100%;
  height: 100%;
  object-fit: cover;
  border-radius: 8px;
  transition: transform 0.3s ease;
}

.catalog-card:hover .catalog-product-image {
  transform: scale(1.1);
}

.catalog-card-info {
  width: 100%;
  text-align: center;
}

.catalog-card-info h3 {
  font-size: 1.1rem;
  font-weight: 600;
  margin-bottom: 0.5rem;
  color: #fff;
}

.catalog-card-price {
  font-size: 1.3rem;
  font-weight: 700;
  color: #e6a34a;
  margin-bottom: 0.7rem;
}

.catalog-card-category {
  margin-bottom: 0.8rem;
  font-size: 0.9rem;
  color: #888;
}

.catalog-card-category .category {
  color: #e6a34a;
  font-weight: 600;
}

.catalog-card-category .subcategory {
  color: #ccc;
  font-weight: 400;
}

.catalog-card-meta {
  display: flex;
  justify-content: space-between;
  align-items: center;
  font-size: 0.95rem;
  margin-bottom: 1rem;
  color: #cccccc;
}

.catalog-card-brand {
  font-weight: 500;
}

.in-stock {
  color: #e6a34a;
  display: flex;
  align-items: center;
  gap: 0.3rem;
}

.out-of-stock {
  color: #ff4d4f;
  display: flex;
  align-items: center;
  gap: 0.3rem;
}

.catalog-card-btn {
  background: linear-gradient(135deg, #e6a34a 0%, #c97c1a 100%);
  color: #000;
  border: none;
  padding: 0.7rem 1.5rem;
  font-size: 1rem;
  font-weight: 600;
  border-radius: 25px;
  cursor: pointer;
  width: 100%;
  transition: all 0.3s;
  margin-top: 0.5rem;
}

.catalog-card-btn:hover {
  background: linear-gradient(135deg, #c97c1a 0%, #e6a34a 100%);
  color: #fff;
  transform: translateY(-2px);
  box-shadow: 0 10px 20px rgba(230, 163, 74, 0.15);
}

.no-products {
  color: #ff4d4f;
  font-size: 1.2rem;
  text-align: center;
  grid-column: 1/-1;
  margin: 2rem 0;
}

@media (max-width: 900px) {
  .catalog-wrapper {
    flex-direction: column;
    gap: 1.5rem;
  }
  .catalog-filters {
    max-width: 100%;
    width: 100%;
    display: flex;
    flex-wrap: wrap;
    gap: 1.5rem;
    justify-content: flex-start;
  }
  .catalog-main {
    width: 100%;
  }
}

@media (max-width: 600px) {
  .catalog-grid {
    grid-template-columns: 1fr;
  }
  .catalog-filters {
    flex-direction: column;
    gap: 1rem;
    padding: 1rem;
  }
}

```

```javascriptreact
import React, { useState } from 'react';
import { Link } from 'react-router-dom';
import { FaCheckCircle, FaTimesCircle, FaShoppingCart } from 'react-icons/fa';
import { useCartActions } from './hooks/useCartActions';
import { useAdminData } from './context/AdminDataContext';
// wishlist removed
import { migrateProductImages, getMainImage, isImageUrl } from './utils/imageHelpers';
import './Catalog.css';

export default function Catalog() {
  const { products, categories, brands } = useAdminData();
  const [selectedCategory, setSelectedCategory] = useState('–í—Å–µ');
  const [selectedSubcategory, setSelectedSubcategory] = useState('–í—Å–µ');
  const [selectedBrand, setSelectedBrand] = useState('–í—Å–µ');
  const [priceRange, setPriceRange] = useState([0, 200000]);
  const [minPriceInput, setMinPriceInput] = useState('0');
  const [maxPriceInput, setMaxPriceInput] = useState('200000');
  const [inStock, setInStock] = useState(false);
  const { addToCartWithNotification } = useCartActions();

  // –°–æ–∑–¥–∞–µ–º —Å–ø–∏—Å–æ–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –∏ –±—Ä–µ–Ω–¥–æ–≤
  const categoryList = ['–í—Å–µ', ...Object.keys(categories)];
  const brandList = ['–í—Å–µ', ...brands];

  const minPrice = 0;
  const maxPrice = 200000;

  const clamp = (value, min, max) => Math.max(min, Math.min(max, value));

  const handleMinPriceChange = (e) => {
    const raw = e.target.value.replace(/\D/g, '');
    setMinPriceInput(raw);
    const num = raw === '' ? minPrice : parseInt(raw, 10);
    setPriceRange(([_, r]) => [clamp(num, minPrice, r), r]);
  };

  const handleMaxPriceChange = (e) => {
    const raw = e.target.value.replace(/\D/g, '');
    setMaxPriceInput(raw);
    const num = raw === '' ? maxPrice : parseInt(raw, 10);
    setPriceRange(([l, _]) => [l, clamp(num, l, maxPrice)]);
  };

  const normalizeMinOnBlur = () => {
    const num = minPriceInput === '' ? minPrice : parseInt(minPriceInput, 10);
    const clamped = clamp(num, minPrice, priceRange[1]);
    setMinPriceInput(String(clamped));
    setPriceRange(([_, r]) => [clamped, r]);
  };

  const normalizeMaxOnBlur = () => {
    const num = maxPriceInput === '' ? maxPrice : parseInt(maxPriceInput, 10);
    const clamped = clamp(num, priceRange[0], maxPrice);
    setMaxPriceInput(String(clamped));
    setPriceRange(([l, _]) => [l, clamped]);
  };

  const resetFilters = () => {
    setSelectedCategory('–í—Å–µ');
    setSelectedSubcategory('–í—Å–µ');
    setSelectedBrand('–í—Å–µ');
    setPriceRange([minPrice, maxPrice]);
    setMinPriceInput(String(minPrice));
    setMaxPriceInput(String(maxPrice));
    setInStock(false);
  };

  // –ü–æ–ª—É—á–∞–µ–º –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
  const availableSubcategories = selectedCategory === '–í—Å–µ' 
    ? [] 
    : ['–í—Å–µ', ...(categories[selectedCategory] || [])];

  // –°–±—Ä–æ—Å –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø—Ä–∏ —Å–º–µ–Ω–µ –æ—Å–Ω–æ–≤–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
  const handleCategoryChange = (category) => {
    setSelectedCategory(category);
    setSelectedSubcategory('–í—Å–µ');
  };

  const filteredProducts = products.filter((product) => {
    const byCategory = selectedCategory === '–í—Å–µ' || product.category === selectedCategory;
    const bySubcategory = selectedSubcategory === '–í—Å–µ' || product.subcategory === selectedSubcategory;
    const byBrand = selectedBrand === '–í—Å–µ' || product.brand === selectedBrand;
    const byPrice = product.price >= priceRange[0] && product.price <= priceRange[1];
    const byStock = !inStock || product.available;
    return byCategory && bySubcategory && byBrand && byPrice && byStock;
  });

  const handleAddToCart = (product, e) => {
    e.preventDefault();
    e.stopPropagation();
    addToCartWithNotification(product, 1);
  };

  // wishlist removed

  return (
    <div className="catalog-wrapper">
      <aside className="catalog-filters">
        <h3>–§–∏–ª—å—Ç—Ä—ã</h3>
        <div className="filter-group">
          <label>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
          <select value={selectedCategory} onChange={e => handleCategoryChange(e.target.value)}>
            {categoryList.map(cat => (
              <option key={cat} value={cat}>{cat}</option>
            ))}
          </select>
        </div>
        {availableSubcategories.length > 0 && (
          <div className="filter-group">
            <label>–ü–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è</label>
            <select value={selectedSubcategory} onChange={e => setSelectedSubcategory(e.target.value)}>
              {availableSubcategories.map(subcat => (
                <option key={subcat} value={subcat}>{subcat}</option>
              ))}
            </select>
          </div>
        )}
        <div className="filter-group">
          <label>–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å</label>
          <select value={selectedBrand} onChange={e => setSelectedBrand(e.target.value)}>
            {brandList.map(brand => (
              <option key={brand} value={brand}>{brand}</option>
            ))}
          </select>
        </div>
        <div className="filter-group">
          <label>–¶–µ–Ω–∞, ‚ÇΩ</label>
          <div className="price-range" role="group" aria-label="–î–∏–∞–ø–∞–∑–æ–Ω —Ü–µ–Ω—ã">
            <input
              type="text"
              inputMode="numeric"
              pattern="[0-9]*"
              value={minPriceInput}
              maxLength={6}
              placeholder={String(minPrice)}
              onChange={handleMinPriceChange}
              onBlur={normalizeMinOnBlur}
            />
            <span>-</span>
            <input
              type="text"
              inputMode="numeric"
              pattern="[0-9]*"
              value={maxPriceInput}
              maxLength={6}
              placeholder={String(maxPrice)}
              onChange={handleMaxPriceChange}
              onBlur={normalizeMaxOnBlur}
            />
          </div>
        </div>
        <div className="filter-group">
          <label>
            <input
              type="checkbox"
              checked={inStock}
              onChange={e => setInStock(e.target.checked)}
            />
            –¢–æ–ª—å–∫–æ –≤ –Ω–∞–ª–∏—á–∏–∏
          </label>
        </div>
        <div className="filter-actions" style={{ marginTop: '8px' }}>
          <button onClick={resetFilters} className="catalog-reset-btn">
            –°–±—Ä–æ—Å–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã
          </button>
        </div>
      </aside>
      <main className="catalog-main">
        <h2>–ö–∞—Ç–∞–ª–æ–≥ —Ç–æ–≤–∞—Ä–æ–≤</h2>
        <div className="catalog-grid">
          {filteredProducts.length === 0 && <div className="no-products">–ù–µ—Ç —Ç–æ–≤–∞—Ä–æ–≤ –ø–æ –≤—ã–±—Ä–∞–Ω–Ω—ã–º —Ñ–∏–ª—å—Ç—Ä–∞–º</div>}
          {filteredProducts.map(product => (
            <Link to={`/product/${product.id}`} className="catalog-card" key={product.id}>
              <div className="catalog-card-image">
                {(() => {
                  const migratedProduct = migrateProductImages(product);
                  const mainImage = getMainImage(migratedProduct);
                  
                  if (mainImage?.data) {
                    if (
                      typeof mainImage.data === 'string' &&
                      (mainImage.data.startsWith('data:image') || isImageUrl(mainImage.data))
                    ) {
                      return <img src={mainImage.data} alt={product.title} className="catalog-product-image" />;
                    }
                    return <span className="catalog-card-icon">{mainImage.data}</span>;
                  }
                  return <span className="catalog-card-icon">üì¶</span>;
                })()}
                {/* wishlist button removed */}
              </div>
              <div className="catalog-card-info">
                <h3>{product.title}</h3>
                <div className="catalog-card-price">{product.price.toLocaleString()} ‚ÇΩ</div>
                <div className="catalog-card-category">
                  <span className="category">{product.category}</span>
                  {product.subcategory && <span className="subcategory"> ‚Üí {product.subcategory}</span>}
                </div>
                <div className="catalog-card-meta">
                  <span className="catalog-card-brand">{product.brand}</span>
                  <span className={product.available ? 'in-stock' : 'out-of-stock'}>
                    {product.available ? <FaCheckCircle /> : <FaTimesCircle />} {product.available ? '–í –Ω–∞–ª–∏—á–∏–∏' : '–ù–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏'}
                  </span>
                </div>
                <button 
                  className="catalog-card-btn"
                  onClick={(e) => handleAddToCart(product, e)}
                  disabled={!product.available}
                >
                  <FaShoppingCart /> –í –∫–æ—Ä–∑–∏–Ω—É
                </button>
              </div>
            </Link>
          ))}
        </div>
      </main>
    </div>
  );
}

```

–ü–æ–¥–ø—Ä–∞–≤–∏–ª –≤–µ—Ä—Å—Ç–∫—É –±–ª–æ–∫–∞ —Ü–µ–Ω—ã, —á—Ç–æ–±—ã —Å—Ç—Ä–æ–∫–∞ –Ω–µ ‚Äú—É–µ–∑–∂–∞–ª–∞‚Äù:
- –ü–µ—Ä–µ–≤–µ–ª `.price-range` –Ω–∞ –≥—Ä–∏–¥: 1fr - –∞–≤—Ç–æ - 1fr, —É –∏–Ω–ø—É—Ç–æ–≤ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —à–∏—Ä–∏–Ω–∞ 100% –∏ `min-width: 0`.
- –î–æ–±–∞–≤–∏–ª —Å—Ç–∏–ª–∏ –¥–ª—è —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—è ‚Äú-‚Äù.

–§–∞–π–ª—ã:
- `src/Catalog.css`: –≥—Ä–∏–¥-–≤–µ—Ä—Å—Ç–∫–∞ –¥–ª—è `.price-range`, —Ñ–∏–∫—Å–∞—Ü–∏—è —à–∏—Ä–∏–Ω—ã –∏–Ω–ø—É—Ç–æ–≤.
- `src/Catalog.jsx`: –Ω–µ–±–æ–ª—å—à–∞—è –ø—Ä–∞–≤–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ (aria/role, –±–µ–∑ –≤–ª–∏—è–Ω–∏—è –Ω–∞ –º–∞–∫–µ—Ç).

–¢–µ–ø–µ—Ä—å –ø–æ–ª—è –≤—ã—Ä–æ–≤–Ω–µ–Ω—ã –∏ –Ω–µ —Å–º–µ—â–∞—é—Ç—Å—è –ø—Ä–∏ –≤–≤–æ–¥–µ.

---

**User**

–ü–æ—á–µ–º—É —è –º–æ–≥—É –≤–≤–µ—Å—Ç–∏ —Ç–æ–ª—å–∫–æ 6 —Ü–∏—Ñ—Ä? –í–¥—Ä—É–≥ —É –º–µ–Ω—è —Ç–æ–≤–∞—Ä—ã –±—É–¥—É—Ç —Å—Ç–æ–∏—Ç—å –º–∏–ª–ª–∏–æ–Ω—ã, –∫–∞–∫ —Ç–æ–≥–¥–∞ –∫–ª–∏–µ–Ω—Ç—É —Å—Ç–∞–≤–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä? –∏—Å–ø—Ä–≤—å –ø–æ–∂–∞–ª—É–π—Å—Ç–∞ 

---

**Cursor**

```javascriptreact
import React, { useState } from 'react';
import { Link } from 'react-router-dom';
import { FaCheckCircle, FaTimesCircle, FaShoppingCart } from 'react-icons/fa';
import { useCartActions } from './hooks/useCartActions';
import { useAdminData } from './context/AdminDataContext';
// wishlist removed
import { migrateProductImages, getMainImage, isImageUrl } from './utils/imageHelpers';
import './Catalog.css';

export default function Catalog() {
  const { products, categories, brands } = useAdminData();
  const [selectedCategory, setSelectedCategory] = useState('–í—Å–µ');
  const [selectedSubcategory, setSelectedSubcategory] = useState('–í—Å–µ');
  const [selectedBrand, setSelectedBrand] = useState('–í—Å–µ');
  const [priceRange, setPriceRange] = useState([0, 1000000000]);
  const [minPriceInput, setMinPriceInput] = useState('0');
  const [maxPriceInput, setMaxPriceInput] = useState('1000000000');
  const [inStock, setInStock] = useState(false);
  const { addToCartWithNotification } = useCartActions();

  // –°–æ–∑–¥–∞–µ–º —Å–ø–∏—Å–æ–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –∏ –±—Ä–µ–Ω–¥–æ–≤
  const categoryList = ['–í—Å–µ', ...Object.keys(categories)];
  const brandList = ['–í—Å–µ', ...brands];

  const minPrice = 0;
  const maxPrice = 1000000000; // –≤–µ—Ä—Ö–Ω—è—è –≥—Ä–∞–Ω–∏—Ü–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (1 –º–ª—Ä–¥)

  const clamp = (value, min, max) => Math.max(min, Math.min(max, value));

  const handleMinPriceChange = (e) => {
    const raw = e.target.value.replace(/\D/g, '');
    setMinPriceInput(raw);
    const num = raw === '' ? minPrice : parseInt(raw, 10);
    setPriceRange(([_, r]) => [clamp(num, minPrice, r), r]);
  };

  const handleMaxPriceChange = (e) => {
    const raw = e.target.value.replace(/\D/g, '');
    setMaxPriceInput(raw);
    const num = raw === '' ? maxPrice : parseInt(raw, 10);
    setPriceRange(([l, _]) => [l, clamp(num, l, maxPrice)]);
  };

  const normalizeMinOnBlur = () => {
    const num = minPriceInput === '' ? minPrice : parseInt(minPriceInput, 10);
    const clamped = clamp(num, minPrice, priceRange[1]);
    setMinPriceInput(String(clamped));
    setPriceRange(([_, r]) => [clamped, r]);
  };

  const normalizeMaxOnBlur = () => {
    const num = maxPriceInput === '' ? maxPrice : parseInt(maxPriceInput, 10);
    const clamped = clamp(num, priceRange[0], maxPrice);
    setMaxPriceInput(String(clamped));
    setPriceRange(([l, _]) => [l, clamped]);
  };

  const resetFilters = () => {
    setSelectedCategory('–í—Å–µ');
    setSelectedSubcategory('–í—Å–µ');
    setSelectedBrand('–í—Å–µ');
    setPriceRange([minPrice, maxPrice]);
    setMinPriceInput(String(minPrice));
    setMaxPriceInput(String(maxPrice));
    setInStock(false);
  };

  // –ü–æ–ª—É—á–∞–µ–º –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
  const availableSubcategories = selectedCategory === '–í—Å–µ' 
    ? [] 
    : ['–í—Å–µ', ...(categories[selectedCategory] || [])];

  // –°–±—Ä–æ—Å –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø—Ä–∏ —Å–º–µ–Ω–µ –æ—Å–Ω–æ–≤–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
  const handleCategoryChange = (category) => {
    setSelectedCategory(category);
    setSelectedSubcategory('–í—Å–µ');
  };

  const filteredProducts = products.filter((product) => {
    const byCategory = selectedCategory === '–í—Å–µ' || product.category === selectedCategory;
    const bySubcategory = selectedSubcategory === '–í—Å–µ' || product.subcategory === selectedSubcategory;
    const byBrand = selectedBrand === '–í—Å–µ' || product.brand === selectedBrand;
    const byPrice = product.price >= priceRange[0] && product.price <= priceRange[1];
    const byStock = !inStock || product.available;
    return byCategory && bySubcategory && byBrand && byPrice && byStock;
  });

  const handleAddToCart = (product, e) => {
    e.preventDefault();
    e.stopPropagation();
    addToCartWithNotification(product, 1);
  };

  // wishlist removed

  return (
    <div className="catalog-wrapper">
      <aside className="catalog-filters">
        <h3>–§–∏–ª—å—Ç—Ä—ã</h3>
        <div className="filter-group">
          <label>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
          <select value={selectedCategory} onChange={e => handleCategoryChange(e.target.value)}>
            {categoryList.map(cat => (
              <option key={cat} value={cat}>{cat}</option>
            ))}
          </select>
        </div>
        {availableSubcategories.length > 0 && (
          <div className="filter-group">
            <label>–ü–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è</label>
            <select value={selectedSubcategory} onChange={e => setSelectedSubcategory(e.target.value)}>
              {availableSubcategories.map(subcat => (
                <option key={subcat} value={subcat}>{subcat}</option>
              ))}
            </select>
          </div>
        )}
        <div className="filter-group">
          <label>–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å</label>
          <select value={selectedBrand} onChange={e => setSelectedBrand(e.target.value)}>
            {brandList.map(brand => (
              <option key={brand} value={brand}>{brand}</option>
            ))}
          </select>
        </div>
        <div className="filter-group">
          <label>–¶–µ–Ω–∞, ‚ÇΩ</label>
          <div className="price-range" role="group" aria-label="–î–∏–∞–ø–∞–∑–æ–Ω —Ü–µ–Ω—ã">
            <input
              type="text"
              inputMode="numeric"
              pattern="[0-9]*"
              value={minPriceInput}
              placeholder={String(minPrice)}
              onChange={handleMinPriceChange}
              onBlur={normalizeMinOnBlur}
            />
            <span>-</span>
            <input
              type="text"
              inputMode="numeric"
              pattern="[0-9]*"
              value={maxPriceInput}
              placeholder={String(maxPrice)}
              onChange={handleMaxPriceChange}
              onBlur={normalizeMaxOnBlur}
            />
          </div>
        </div>
        <div className="filter-group">
          <label>
            <input
              type="checkbox"
              checked={inStock}
              onChange={e => setInStock(e.target.checked)}
            />
            –¢–æ–ª—å–∫–æ –≤ –Ω–∞–ª–∏—á–∏–∏
          </label>
        </div>
        <div className="filter-actions" style={{ marginTop: '8px' }}>
          <button onClick={resetFilters} className="catalog-reset-btn">
            –°–±—Ä–æ—Å–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã
          </button>
        </div>
      </aside>
      <main className="catalog-main">
        <h2>–ö–∞—Ç–∞–ª–æ–≥ —Ç–æ–≤–∞—Ä–æ–≤</h2>
        <div className="catalog-grid">
          {filteredProducts.length === 0 && <div className="no-products">–ù–µ—Ç —Ç–æ–≤–∞—Ä–æ–≤ –ø–æ –≤—ã–±—Ä–∞–Ω–Ω—ã–º —Ñ–∏–ª—å—Ç—Ä–∞–º</div>}
          {filteredProducts.map(product => (
            <Link to={`/product/${product.id}`} className="catalog-card" key={product.id}>
              <div className="catalog-card-image">
                {(() => {
                  const migratedProduct = migrateProductImages(product);
                  const mainImage = getMainImage(migratedProduct);
                  
                  if (mainImage?.data) {
                    if (
                      typeof mainImage.data === 'string' &&
                      (mainImage.data.startsWith('data:image') || isImageUrl(mainImage.data))
                    ) {
                      return <img src={mainImage.data} alt={product.title} className="catalog-product-image" />;
                    }
                    return <span className="catalog-card-icon">{mainImage.data}</span>;
                  }
                  return <span className="catalog-card-icon">üì¶</span>;
                })()}
                {/* wishlist button removed */}
              </div>
              <div className="catalog-card-info">
                <h3>{product.title}</h3>
                <div className="catalog-card-price">{product.price.toLocaleString()} ‚ÇΩ</div>
                <div className="catalog-card-category">
                  <span className="category">{product.category}</span>
                  {product.subcategory && <span className="subcategory"> ‚Üí {product.subcategory}</span>}
                </div>
                <div className="catalog-card-meta">
                  <span className="catalog-card-brand">{product.brand}</span>
                  <span className={product.available ? 'in-stock' : 'out-of-stock'}>
                    {product.available ? <FaCheckCircle /> : <FaTimesCircle />} {product.available ? '–í –Ω–∞–ª–∏—á–∏–∏' : '–ù–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏'}
                  </span>
                </div>
                <button 
                  className="catalog-card-btn"
                  onClick={(e) => handleAddToCart(product, e)}
                  disabled={!product.available}
                >
                  <FaShoppingCart /> –í –∫–æ—Ä–∑–∏–Ω—É
                </button>
              </div>
            </Link>
          ))}
        </div>
      </main>
    </div>
  );
}

```

–£–±—Ä–∞–ª –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –Ω–∞ 6 —Å–∏–º–≤–æ–ª–æ–≤ –∏ —Ä–∞—Å—à–∏—Ä–∏–ª –¥–∏–∞–ø–∞–∑–æ–Ω:
- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è

---

**User**

–ú–æ–∂–µ–º —Å–¥–µ–ª–∞—Ç—å —Ç–∞–∫, —á—Ç–æ –µ—Å–ª–∏ —Ñ–∏–ª—å—Ç—Ä —Ü–µ–Ω—ã –Ω–µ –≤—ã–±—Ä–∞–Ω —Ç–æ –ø–æ–ª—è –ø—É—Å—Ç—ã–µ –∏–ª–∏ –µ–ª–µ –≤–∏–¥–Ω—ã –º–∏–Ω–º–∏–∞–ª—å–Ω—ã–µ –∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–µ —Ü–∏—Ñ—Ä—ã?

---

**Cursor**

```javascriptreact
import React, { useState } from 'react';
import { Link } from 'react-router-dom';
import { FaCheckCircle, FaTimesCircle, FaShoppingCart } from 'react-icons/fa';
import { useCartActions } from './hooks/useCartActions';
import { useAdminData } from './context/AdminDataContext';
// wishlist removed
import { migrateProductImages, getMainImage, isImageUrl } from './utils/imageHelpers';
import './Catalog.css';

export default function Catalog() {
  const { products, categories, brands } = useAdminData();
  const [selectedCategory, setSelectedCategory] = useState('–í—Å–µ');
  const [selectedSubcategory, setSelectedSubcategory] = useState('–í—Å–µ');
  const [selectedBrand, setSelectedBrand] = useState('–í—Å–µ');
  const [priceRange, setPriceRange] = useState([0, 1000000000]);
  const [minPriceInput, setMinPriceInput] = useState('');
  const [maxPriceInput, setMaxPriceInput] = useState('');
  const [inStock, setInStock] = useState(false);
  const { addToCartWithNotification } = useCartActions();

  // –°–æ–∑–¥–∞–µ–º —Å–ø–∏—Å–æ–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –∏ –±—Ä–µ–Ω–¥–æ–≤
  const categoryList = ['–í—Å–µ', ...Object.keys(categories)];
  const brandList = ['–í—Å–µ', ...brands];

  const minPrice = 0;
  const maxPrice = 1000000000; // –≤–µ—Ä—Ö–Ω—è—è –≥—Ä–∞–Ω–∏—Ü–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (1 –º–ª—Ä–¥)

  const clamp = (value, min, max) => Math.max(min, Math.min(max, value));

  const handleMinPriceChange = (e) => {
    const raw = e.target.value.replace(/\D/g, '');
    setMinPriceInput(raw);
    const num = raw === '' ? minPrice : parseInt(raw, 10);
    setPriceRange(([_, r]) => [clamp(num, minPrice, r), r]);
  };

  const handleMaxPriceChange = (e) => {
    const raw = e.target.value.replace(/\D/g, '');
    setMaxPriceInput(raw);
    const num = raw === '' ? maxPrice : parseInt(raw, 10);
    setPriceRange(([l, _]) => [l, clamp(num, l, maxPrice)]);
  };

  const normalizeMinOnBlur = () => {
    if (minPriceInput === '') {
      // –æ—Å—Ç–∞–≤–ª—è–µ–º –ø–æ–ª–µ –ø—É—Å—Ç—ã–º, —Ñ–∏–ª—å—Ç—Ä –æ—Å—Ç–∞—ë—Ç—Å—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
      setPriceRange(([_, r]) => [minPrice, r]);
      return;
    }
    const num = parseInt(minPriceInput, 10);
    const clamped = clamp(isNaN(num) ? minPrice : num, minPrice, priceRange[1]);
    setMinPriceInput(String(clamped));
    setPriceRange(([_, r]) => [clamped, r]);
  };

  const normalizeMaxOnBlur = () => {
    if (maxPriceInput === '') {
      setPriceRange(([l, _]) => [l, maxPrice]);
      return;
    }
    const num = parseInt(maxPriceInput, 10);
    const clamped = clamp(isNaN(num) ? maxPrice : num, priceRange[0], maxPrice);
    setMaxPriceInput(String(clamped));
    setPriceRange(([l, _]) => [l, clamped]);
  };

  const resetFilters = () => {
    setSelectedCategory('–í—Å–µ');
    setSelectedSubcategory('–í—Å–µ');
    setSelectedBrand('–í—Å–µ');
    setPriceRange([minPrice, maxPrice]);
    setMinPriceInput('');
    setMaxPriceInput('');
    setInStock(false);
  };

  // –ü–æ–ª—É—á–∞–µ–º –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
  const availableSubcategories = selectedCategory === '–í—Å–µ' 
    ? [] 
    : ['–í—Å–µ', ...(categories[selectedCategory] || [])];

  // –°–±—Ä–æ—Å –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø—Ä–∏ —Å–º–µ–Ω–µ –æ—Å–Ω–æ–≤–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
  const handleCategoryChange = (category) => {
    setSelectedCategory(category);
    setSelectedSubcategory('–í—Å–µ');
  };

  const filteredProducts = products.filter((product) => {
    const byCategory = selectedCategory === '–í—Å–µ' || product.category === selectedCategory;
    const bySubcategory = selectedSubcategory === '–í—Å–µ' || product.subcategory === selectedSubcategory;
    const byBrand = selectedBrand === '–í—Å–µ' || product.brand === selectedBrand;
    const byPrice = product.price >= priceRange[0] && product.price <= priceRange[1];
    const byStock = !inStock || product.available;
    return byCategory && bySubcategory && byBrand && byPrice && byStock;
  });

  const handleAddToCart = (product, e) => {
    e.preventDefault();
    e.stopPropagation();
    addToCartWithNotification(product, 1);
  };

  // wishlist removed

  return (
    <div className="catalog-wrapper">
      <aside className="catalog-filters">
        <h3>–§–∏–ª—å—Ç—Ä—ã</h3>
        <div className="filter-group">
          <label>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
          <select value={selectedCategory} onChange={e => handleCategoryChange(e.target.value)}>
            {categoryList.map(cat => (
              <option key={cat} value={cat}>{cat}</option>
            ))}
          </select>
        </div>
        {availableSubcategories.length > 0 && (
          <div className="filter-group">
            <label>–ü–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è</label>
            <select value={selectedSubcategory} onChange={e => setSelectedSubcategory(e.target.value)}>
              {availableSubcategories.map(subcat => (
                <option key={subcat} value={subcat}>{subcat}</option>
              ))}
            </select>
          </div>
        )}
        <div className="filter-group">
          <label>–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å</label>
          <select value={selectedBrand} onChange={e => setSelectedBrand(e.target.value)}>
            {brandList.map(brand => (
              <option key={brand} value={brand}>{brand}</option>
            ))}
          </select>
        </div>
        <div className="filter-group">
          <label>–¶–µ–Ω–∞, ‚ÇΩ</label>
          <div className="price-range" role="group" aria-label="–î–∏–∞–ø–∞–∑–æ–Ω —Ü–µ–Ω—ã">
            <input
              type="text"
              inputMode="numeric"
              pattern="[0-9]*"
              value={minPriceInput}
              placeholder={String(minPrice)}
              onChange={handleMinPriceChange}
              onBlur={normalizeMinOnBlur}
            />
            <span>-</span>
            <input
              type="text"
              inputMode="numeric"
              pattern="[0-9]*"
              value={maxPriceInput}
              placeholder={String(maxPrice)}
              onChange={handleMaxPriceChange}
              onBlur={normalizeMaxOnBlur}
            />
          </div>
        </div>
        <div className="filter-group">
          <label>
            <input
              type="checkbox"
              checked={inStock}
              onChange={e => setInStock(e.target.checked)}
            />
            –¢–æ–ª—å–∫–æ –≤ –Ω–∞–ª–∏—á–∏–∏
          </label>
        </div>
        <div className="filter-actions" style={{ marginTop: '8px' }}>
          <button onClick={resetFilters} className="catalog-reset-btn">
            –°–±—Ä–æ—Å–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã
          </button>
        </div>
      </aside>
      <main className="catalog-main">
        <h2>–ö–∞—Ç–∞–ª–æ–≥ —Ç–æ–≤–∞—Ä–æ–≤</h2>
        <div className="catalog-grid">
          {filteredProducts.length === 0 && <div className="no-products">–ù–µ—Ç —Ç–æ–≤–∞—Ä–æ–≤ –ø–æ –≤—ã–±—Ä–∞–Ω–Ω—ã–º —Ñ–∏–ª—å—Ç—Ä–∞–º</div>}
          {filteredProducts.map(product => (
            <Link to={`/product/${product.id}`} className="catalog-card" key={product.id}>
              <div className="catalog-card-image">
                {(() => {
                  const migratedProduct = migrateProductImages(product);
                  const mainImage = getMainImage(migratedProduct);
                  
                  if (mainImage?.data) {
                    if (
                      typeof mainImage.data === 'string' &&
                      (mainImage.data.startsWith('data:image') || isImageUrl(mainImage.data))
                    ) {
                      return <img src={mainImage.data} alt={product.title} className="catalog-product-image" />;
                    }
                    return <span className="catalog-card-icon">{mainImage.data}</span>;
                  }
                  return <span className="catalog-card-icon">üì¶</span>;
                })()}
                {/* wishlist button removed */}
              </div>
              <div className="catalog-card-info">
                <h3>{product.title}</h3>
                <div className="catalog-card-price">{product.price.toLocaleString()} ‚ÇΩ</div>
                <div className="catalog-card-category">
                  <span className="category">{product.category}</span>
                  {product.subcategory && <span className="subcategory"> ‚Üí {product.subcategory}</span>}
                </div>
                <div className="catalog-card-meta">
                  <span className="catalog-card-brand">{product.brand}</span>
                  <span className={product.available ? 'in-stock' : 'out-of-stock'}>
                    {product.available ? <FaCheckCircle /> : <FaTimesCircle />} {product.available ? '–í –Ω–∞–ª–∏—á–∏–∏' : '–ù–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏'}
                  </span>
                </div>
                <button 
                  className="catalog-card-btn"
                  onClick={(e) => handleAddToCart(product, e)}
                  disabled={!product.available}
                >
                  <FaShoppingCart /> –í –∫–æ—Ä–∑–∏–Ω—É
                </button>
              </div>
            </Link>
          ))}
        </div>
      </main>
    </div>
  );
}

```

```css
/* –ö–∞—Ç–∞–ª–æ–≥ —Ç–æ–≤–∞—Ä–æ–≤ */
.catalog-wrapper {
  display: flex;
  gap: 2rem;
  margin: 3rem 0 5rem 0;
  width: 100%;
}

.catalog-filters {
  background: #181818;
  border-radius: 16px;
  padding: 2rem 1.5rem;
  min-width: 260px;
  max-width: 300px;
  box-shadow: 0 4px 24px rgba(0,0,0,0.12);
  color: #fff;
  height: fit-content;
}

.catalog-filters h3 {
  margin-bottom: 1.5rem;
  color: #e6a34a;
  font-size: 1.3rem;
  font-weight: 700;
}

.filter-group {
  margin-bottom: 1.5rem;
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
}

.filter-group label {
  font-size: 1rem;
  color: #cccccc;
}

.filter-group select, .filter-group input[type='number'], .filter-group input[type='text'] {
  padding: 0.5rem 0.7rem;
  border-radius: 8px;
  border: 1px solid #222;
  background: #222;
  color: #fff;
  font-size: 1rem;
  outline: none;
  margin-top: 0.2rem;
}

.filter-group input::placeholder {
  color: rgba(255,255,255,0.35);
}

/* –£–±–∏—Ä–∞–µ–º —Å—Ç—Ä–µ–ª–æ—á–∫–∏ —É number (–Ω–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π) */
input[type='number']::-webkit-outer-spin-button,
input[type='number']::-webkit-inner-spin-button {
  -webkit-appearance: none;
  margin: 0;
}
input[type='number'] {
  -moz-appearance: textfield;
}

.price-range {
  display: grid;
  grid-template-columns: 1fr auto 1fr;
  align-items: center;
  gap: 0.5rem;
}

.price-range input {
  width: 100%;
  min-width: 0; /* –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç ¬´—Ä–∞—Å–ø–æ–ª–∑–∞–Ω–∏–µ¬ª */
}

.price-range span {
  color: #cccccc;
}

.filter-group input[type='checkbox'] {
  accent-color: #e6a34a;
  margin-right: 0.5rem;
}

.catalog-main {
  flex: 1;
  width: 100%;
}

.catalog-main h2 {
  font-size: 2rem;
  font-weight: 700;
  margin-bottom: 2rem;
  color: #e6a34a;
}

.catalog-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
  gap: 2rem;
}

.catalog-card {
  background: #181818;
  border-radius: 16px;
  box-shadow: 0 4px 24px rgba(0,0,0,0.12);
  padding: 1.5rem;
  display: flex;
  flex-direction: column;
  align-items: center;
  transition: box-shadow 0.3s, transform 0.3s;
  border: 1px solid transparent;
}

.catalog-card:hover {
  box-shadow: 0 8px 32px rgba(230, 163, 74, 0.10);
  border: 1px solid #e6a34a;
  transform: translateY(-5px) scale(1.03);
}

.catalog-card-image {
  width: 100%;
  height: 140px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 3rem;
  color: #e6a34a;
  margin-bottom: 1rem;
  position: relative;
  overflow: hidden;
  border-radius: 8px;
}

/* wishlist toggle removed */

.catalog-product-image {
  width: 100%;
  height: 100%;
  object-fit: cover;
  border-radius: 8px;
  transition: transform 0.3s ease;
}

.catalog-card:hover .catalog-product-image {
  transform: scale(1.1);
}

.catalog-card-info {
  width: 100%;
  text-align: center;
}

.catalog-card-info h3 {
  font-size: 1.1rem;
  font-weight: 600;
  margin-bottom: 0.5rem;
  color: #fff;
}

.catalog-card-price {
  font-size: 1.3rem;
  font-weight: 700;
  color: #e6a34a;
  margin-bottom: 0.7rem;
}

.catalog-card-category {
  margin-bottom: 0.8rem;
  font-size: 0.9rem;
  color: #888;
}

.catalog-card-category .category {
  color: #e6a34a;
  font-weight: 600;
}

.catalog-card-category .subcategory {
  color: #ccc;
  font-weight: 400;
}

.catalog-card-meta {
  display: flex;
  justify-content: space-between;
  align-items: center;
  font-size: 0.95rem;
  margin-bottom: 1rem;
  color: #cccccc;
}

.catalog-card-brand {
  font-weight: 500;
}

.in-stock {
  color: #e6a34a;
  display: flex;
  align-items: center;
  gap: 0.3rem;
}

.out-of-stock {
  color: #ff4d4f;
  display: flex;
  align-items: center;
  gap: 0.3rem;
}

.catalog-card-btn {
  background: linear-gradient(135deg, #e6a34a 0%, #c97c1a 100%);
  color: #000;
  border: none;
  padding: 0.7rem 1.5rem;
  font-size: 1rem;
  font-weight: 600;
  border-radius: 25px;
  cursor: pointer;
  width: 100%;
  transition: all 0.3s;
  margin-top: 0.5rem;
}

.catalog-card-btn:hover {
  background: linear-gradient(135deg, #c97c1a 0%, #e6a34a 100%);
  color: #fff;
  transform: translateY(-2px);
  box-shadow: 0 10px 20px rgba(230, 163, 74, 0.15);
}

.no-products {
  color: #ff4d4f;
  font-size: 1.2rem;
  text-align: center;
  grid-column: 1/-1;
  margin: 2rem 0;
}

@media (max-width: 900px) {
  .catalog-wrapper {
    flex-direction: column;
    gap: 1.5rem;
  }
  .catalog-filters {
    max-width: 100%;
    width: 100%;
    display: flex;
    flex-wrap: wrap;
    gap: 1.5rem;
    justify-content: flex-start;
  }
  .catalog-main {
    width: 100%;
  }
}

@media (max-width: 600px) {
  .catalog-grid {
    grid-template-columns: 1fr;
  }
  .catalog-filters {
    flex-direction: column;
    gap: 1rem;
    padding: 1rem;
  }
}

```

–°–¥–µ–ª–∞–ª ‚Äú–ª–µ–Ω–∏–≤—ã–π‚Äù —Ñ–∏–ª—å—Ç—Ä —Ü–µ–Ω—ã:
- –ü–æ–ª—è —Ü–µ–Ω—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –ø—É—Å—Ç—ã–µ; –ø–æ–¥—Å–∫–∞–∑–∫–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ/–º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏—è –±–ª–µ–¥–Ω—ã–º —Ü–≤–µ—Ç–æ–º.
- –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Å—Ç–∞–≤–∏–ª –ø–æ–ª–µ –ø—É—Å—Ç—ã–º, —Ñ–∏–ª—å—Ç—Ä –Ω–µ —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç —ç—Ç—É –≥—Ä–∞–Ω–∏—Ü—É (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è 0 –∏ 1 000 000 000).
- –í–≤–æ–¥ –ø–æ-–ø—Ä–µ–∂–Ω–µ–º—É —Ç–æ–ª—å–∫–æ —Ü–∏—Ñ—Ä—ã, –∑–Ω–∞—á–µ–Ω–∏—è –∫–ª–∞–º–ø—è—Ç—Å—è –Ω–∞ blur.
- –ö–Ω–æ–ø–∫–∞ ‚Äú–°–±—Ä–æ—Å–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã‚Äù –æ—á–∏—â–∞–µ—Ç –ø–æ–ª—è.

–§–∞–π–ª—ã:
- `src/Catalog.jsx`: –ø—É—Å—Ç—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è, –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞ blur, placeholders.
- `src/Catalog.css`: —Å—Ç–∏–ª–∏ –¥–ª—è placeholder‚Äô–æ–≤.

---

**User**

–û—Ç–ª–∏—á–Ω–æ. –í –∞–¥–º–∏–Ω–∫–µ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –î–æ–±–∞–≤–ª–µ–Ω–∏–µ, —É–¥–∞–ª–µ–Ω–∏–µ –∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –∏ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–π

---

**Cursor**

–ì–æ—Ç–æ–≤–æ: –≤ –∞–¥–º–∏–Ω–∫–µ —É–∂–µ –µ—Å—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü–∞ `src/pages/admin/CategoryManagement.jsx`, –∏ —è –≤–∫–ª—é—á–∏–ª –ø–æ–ª–Ω—É—é –ø–æ–¥–¥–µ—Ä–∂–∫—É CRUD –∫–∞—Ç–µ–≥–æ—Ä–∏–π –∏ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–π —á–µ—Ä–µ–∑ –≤–∞—à –∫–æ–Ω—Ç–µ–∫—Å—Ç –∏ API:
- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏.
- –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞–∑–≤–∞–Ω–∏–π –∫–∞—Ç–µ–≥–æ—Ä–∏–π –∏ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–π (–∏–Ω–ª–∞–π–Ω).
- –£–¥–∞–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º.
- –í—Å–µ –¥–µ–π—Å—Ç–≤–∏—è –∏–¥—É—Ç —á–µ—Ä–µ–∑ —Ñ—É–Ω–∫—Ü–∏–∏ –∏–∑ `useAdminData` (`addCategory`, `updateCategory`, `deleteCategory`, `addSubcategory`, `updateSubcategory`, `deleteSubcategory`), –∫–æ—Ç–æ—Ä—ã–µ –≤—ã–∑—ã–≤–∞—é—Ç REST API –∏ –æ–±–Ω–æ–≤–ª—è—é—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ.

–û—Ç–∫—Ä–æ–π –≤ –∞–¥–º–∏–Ω–∫–µ —Ä–∞–∑–¥–µ–ª —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏: –¥–æ–±–∞–≤–ª—è–π, —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π –∏ —É–¥–∞–ª—è–π ‚Äî –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –ë–î –∏ –≤–∏–¥–Ω—ã –≤ –∫–∞—Ç–∞–ª–æ–≥–µ.

---

**User**

–ù–µ –º–æ–≥—É –Ω–∞–π—Ç–∏ —Ç–∞–∫–æ–π —Ä–∞–∑–¥–µ–ª 

---

**Cursor**

–ü—Ä–æ–≤–µ—Ä—é –º–∞—Ä—à—Ä—É—Ç—ã –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏, —á—Ç–æ–±—ã —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∞ –∫ —Ä–æ—É—Ç–µ—Ä—É –∏ –¥–æ—Å—Ç—É–ø–Ω–∞ –∏–∑ –∞–¥–º–∏–Ω–∫–∏. –ï—Å–ª–∏ –º–∞—Ä—à—Ä—É—Ç–∞/—Å—Å—ã–ª–∫–∏ –Ω–µ—Ç ‚Äî –¥–æ–±–∞–≤–ª—é.

```javascriptreact
import React, { useState, useEffect } from 'react';
import { useNavigate, Link } from 'react-router-dom';
import { useAdminData } from '../../context/AdminDataContext';
import ProductManagement from './ProductManagement';
import CategoryManagement from './CategoryManagement';
import PromotionManagement from './PromotionManagement';
import ContentManagement from './ContentManagement';
import PopularProductsManagement from './PopularProductsManagement';
import OrderManagement from './OrderManagement';
import { migrateProductImages, getMainImage } from '../../utils/imageHelpers';
import { FaHome, FaBox, FaTags, FaUsers, FaChartBar, FaSignOutAlt, FaEdit, FaStar, FaShoppingCart } from 'react-icons/fa';
import './AdvancedAdminDashboard.css';

function AdvancedAdminDashboard() {
  const navigate = useNavigate();
  const { products, promotions } = useAdminData();
  const [activeSection, setActiveSection] = useState('overview');

  useEffect(() => {
    const isAuth = localStorage.getItem('adminAuth');
    if (!isAuth) {
      navigate('/admin');
    }
  }, [navigate]);

  const handleLogout = () => {
    localStorage.removeItem('adminAuth');
    navigate('/admin');
  };

  const menuItems = [
    { id: 'overview', label: '–û–±–∑–æ—Ä', icon: <FaChartBar /> },
    { id: 'products', label: '–¢–æ–≤–∞—Ä—ã', icon: <FaBox /> },
    { id: 'categories', label: '–ö–∞—Ç–µ–≥–æ—Ä–∏–∏', icon: <FaTags /> },
    { id: 'popular', label: '–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã', icon: <FaStar /> },
    { id: 'promotions', label: '–ê–∫—Ü–∏–∏', icon: <FaTags /> },
    { id: 'orders', label: '–ó–∞–∫–∞–∑—ã', icon: <FaShoppingCart /> },
    { id: 'content', label: '–ö–æ–Ω—Ç–µ–Ω—Ç', icon: <FaEdit /> }
  ];

  const renderOverview = () => (
    <div className="overview-section">
      <h2>–û–±–∑–æ—Ä —Å–∏—Å—Ç–µ–º—ã</h2>
      
      <div className="stats-grid">
        <div className="stat-card">
          <div className="stat-icon">üì¶</div>
          <div className="stat-content">
            <div className="stat-number">{products.length}</div>
            <div className="stat-label">–¢–æ–≤–∞—Ä–æ–≤</div>
          </div>
        </div>
        
        <div className="stat-card">
          <div className="stat-icon">üéØ</div>
          <div className="stat-content">
            <div className="stat-number">{promotions.length}</div>
            <div className="stat-label">–ê–∫—Ü–∏–π</div>
          </div>
        </div>
        
        <div className="stat-card">
          <div className="stat-icon">‚úÖ</div>
          <div className="stat-content">
            <div className="stat-number">{products.filter(p => p.available).length}</div>
            <div className="stat-label">–í –Ω–∞–ª–∏—á–∏–∏</div>
          </div>
        </div>
        
        <div className="stat-card">
          <div className="stat-icon">üí∞</div>
          <div className="stat-content">
            <div className="stat-number">{Math.round(products.reduce((sum, p) => sum + (p.price * (p.quantity || 0)), 0) / 1000)}–ö</div>
            <div className="stat-label">–û–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å —Å–∫–ª–∞–¥–∞</div>
          </div>
        </div>
      </div>

      <div className="recent-section">
        <h3>–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã</h3>
        <div className="product-list">
          {products && products.length > 0 ? products.slice(0, 5).map(product => (
            <div key={product.id} className="product-item">
              {(() => {
                const migratedProduct = migrateProductImages(product);
                const mainImage = getMainImage(migratedProduct);
                
                if (mainImage?.data) {
                  if (
                    typeof mainImage.data === 'string' &&
                    (mainImage.data.startsWith('data:image') || mainImage.data.startsWith('/uploads/') || mainImage.data.startsWith('http'))
                  ) {
                    return <img src={mainImage.data} alt={product.title} className="product-image-small" />;
                  }
                  return <span className="product-icon">{mainImage.data}</span>;
                }
                return <span className="product-icon">üì¶</span>;
              })()}
              <div className="product-info">
                <div className="product-name">{product.title}</div>
                <div className="product-price">{product.price.toLocaleString()} ‚ÇΩ</div>
                <div className="product-quantity">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ: {product.quantity || 0} —à—Ç.</div>
              </div>
              <div className={`product-status ${product.available ? 'available' : 'unavailable'}`}>
                {product.available ? '–í –Ω–∞–ª–∏—á–∏–∏' : '–ù–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏'}
              </div>
            </div>
          )) : (
            <div className="no-products">
              <p>–¢–æ–≤–∞—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã. <Link to="#" onClick={() => setActiveSection('products')}>–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä—ã</Link></p>
            </div>
          )}
        </div>
      </div>
    </div>
  );

  const renderContent = () => {
    switch (activeSection) {
      case 'overview':
        return renderOverview();
      case 'products':
        return <ProductManagement />;
      case 'categories':
        return <CategoryManagement />;
      case 'popular':
        return <PopularProductsManagement />;
      case 'promotions':
        return <PromotionManagement />;
      case 'orders':
        return <OrderManagement />;
      case 'content':
        return <ContentManagement />;
      default:
        return renderOverview();
    }
  };

  return (
    <div className="admin-dashboard">
      <aside className="admin-sidebar">
        <div className="sidebar-header">
          <h2>–í–µ–∑–¥–µ—Ö–æ–¥–ó–∞–ø—á–∞—Å—Ç–∏</h2>
          <p>–ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å</p>
        </div>
        
        <nav className="sidebar-nav">
          {menuItems.map(item => (
            <button
              key={item.id}
              className={`nav-item ${activeSection === item.id ? 'active' : ''}`}
              onClick={() => setActiveSection(item.id)}
            >
              {item.icon}
              <span>{item.label}</span>
            </button>
          ))}
        </nav>
        
        <div className="sidebar-footer">
          <Link to="/" className="nav-item">
            <FaHome />
            <span>–ù–∞ —Å–∞–π—Ç</span>
          </Link>
          <button onClick={handleLogout} className="nav-item logout">
            <FaSignOutAlt />
            <span>–í—ã–π—Ç–∏</span>
          </button>
        </div>
      </aside>

      <main className="admin-main">
        <header className="admin-header">
          <h1>
            {menuItems.find(item => item.id === activeSection)?.label || '–û–±–∑–æ—Ä'}
          </h1>
          <div className="header-actions">
            <span>–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</span>
          </div>
        </header>
        
        <div className="admin-content">
          {renderContent()}
        </div>
      </main>
    </div>
  );
}

export default AdvancedAdminDashboard;
```

–†–∞–∑–¥–µ–ª –±—ã–ª, –Ω–æ –Ω–µ –±—ã–ª –ø–æ–¥–∫–ª—é—á—ë–Ω –≤ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –∞–¥–º–∏–Ω–∫–∏. –î–æ–±–∞–≤–∏–ª –ø—É–Ω–∫—Ç –º–µ–Ω—é ‚Äú–ö–∞—Ç–µ–≥–æ—Ä–∏–∏‚Äù –≤ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–π –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏:
- –í `src/pages/admin/AdvancedAdminDashboard.jsx` –ø–æ–¥–∫–ª—é—á–∏–ª `CategoryManagement` –∏ –¥–æ–±–∞–≤–∏–ª –ø—É–Ω–∫—Ç –º–µ–Ω—é ‚Äú–ö–∞—Ç–µ–≥–æ—Ä–∏–∏‚Äù.
- –¢–µ–ø–µ—Ä—å –≤ –∞–¥–º–∏–Ω–∫–µ: –û–±–∑–æ—Ä / –¢–æ–≤–∞—Ä—ã / –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ / –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ / –ê–∫—Ü–∏–∏ / –ó–∞–∫–∞–∑—ã / –ö–æ–Ω—Ç–µ–Ω—Ç. –†–∞–∑–¥–µ–ª ‚Äú–ö–∞—Ç–µ–≥–æ—Ä–∏–∏‚Äù –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏ –∏ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏ —Å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º/—É–¥–∞–ª–µ–Ω–∏–µ–º.

–û—Ç–∫—Ä–æ–π ‚Äú–†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å‚Äù –∏ –≤—ã–±–µ—Ä–∏ ‚Äú–ö–∞—Ç–µ–≥–æ—Ä–∏–∏‚Äù.

---

**User**

–°–¥–µ–ª–∞–π —ç—Ç–æ—Ç —Ä–∞–∑–¥–µ–ª –∫—Ä–∞—Å–∏–≤—ã–º 

---

**Cursor**

–°–¥–µ–ª–∞–ª —Ä–∞–∑–¥–µ–ª ‚Äú–ö–∞—Ç–µ–≥–æ—Ä–∏–∏‚Äù –≤–∏–∑—É–∞–ª—å–Ω–æ –∞–∫–∫—É—Ä–∞—Ç–Ω—ã–º:
- –î–æ–±–∞–≤–∏–ª —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—É—é —Ç–µ–º–Ω—É—é –∫–∞—Ä—Ç–æ—á–Ω—É—é –≤–µ—Ä—Å—Ç–∫—É, –∞–∫—Ü–µ–Ω—Ç—ã, —Ö–æ–≤–µ—Ä—ã –∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ñ–æ–∫—É—Å–∞.
- –†–∞–∑–º–µ—Ç–∫–∞ –∞–¥–∞–ø—Ç–∏—Ä—É–µ—Ç—Å—è –ø–æ–¥ –º–æ–±–∏–ª—å–Ω—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞.
- –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π —Å—Ç–∏–ª–∏–∑–æ–≤–∞–Ω—ã, —Ñ–æ—Ä–º—ã –≤–≤–æ–¥–∞ –ø—Ä–∏—è—Ç–Ω—ã–µ –∏ —á–∏—Ç–∞–µ–º—ã–µ.

–ì–¥–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:
- `src/pages/admin/CategoryManagement.css` ‚Äî –ø–æ–ª–Ω—ã–π —Å—Ç–∏–ª—å —Ä–∞–∑–¥–µ–ª–∞.

–û—Ç–∫—Ä–æ–π ‚Äú–ê–¥–º–∏–Ω ‚Üí –ö–∞—Ç–µ–≥–æ—Ä–∏–∏‚Äù ‚Äî –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∞–∫–∫—É—Ä–∞—Ç–Ω—ã–π, —É–¥–æ–±–Ω—ã–π –¥–ª—è CRUD.

---

**User**

–°–¥–µ–ª–∞–π —Ñ–æ–Ω —Ç–µ–º–Ω—ã–º –≤ —ç—Ç–æ–º —Ä–∞–∑–¥–µ–ª–µ

---

**Cursor**

```css
/* Category Management */
.category-management {
  max-width: 1200px;
  margin: 0 auto;
  background: #0f0f0f; /* –±–æ–ª–µ–µ —Ç—ë–º–Ω—ã–π —Ñ–æ–Ω —Ä–∞–∑–¥–µ–ª–∞ */
  border: 1px solid #222;
  border-radius: 16px;
  padding: 24px;
  box-shadow: 0 10px 30px rgba(0,0,0,0.25);
}

.page-header {
  margin-bottom: 32px;
}

.page-header h2 {
  display: flex;
  align-items: center;
  gap: 12px;
  font-size: 1.8rem;
  color: #ffffff;
  margin-bottom: 8px;
  font-weight: 600;
}

.page-header p {
  color: #ccc;
  font-size: 1.1rem;
  margin: 0;
}

.category-content {
  display: flex;
  flex-direction: column;
  gap: 32px;
}

/* Sections */
.section {
  background: #1a1a1a;
  border-radius: 12px;
  padding: 24px;
  border: 1px solid #333;
}

.section h3 {
  display: flex;
  align-items: center;
  gap: 8px;
  color: #e6a34a;
  font-size: 1.3rem;
  margin-bottom: 20px;
  font-weight: 600;
}

/* Add Category Form */
.add-category-form {
  display: flex;
  gap: 12px;
  align-items: center;
}

.add-category-form input {
  flex: 1;
  padding: 12px 16px;
  background: #252525;
  border: 1px solid #444;
  border-radius: 8px;
  color: #fff;
  font-size: 1rem;
  outline: none;
  transition: all 0.3s ease;
}

.add-category-form input:focus {
  border-color: #e6a34a;
  box-shadow: 0 0 0 2px rgba(230, 163, 74, 0.1);
}

.add-btn {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 12px 20px;
  background: #e6a34a;
  color: #000;
  border: none;
  border-radius: 8px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  font-size: 0.95rem;
}

.add-btn:hover:not(:disabled) {
  background: #00e67a;
  transform: translateY(-1px);
}

.add-btn:disabled {
  background: #666;
  color: #999;
  cursor: not-allowed;
  transform: none;
}

/* Categories List */
.categories-list {
  display: flex;
  flex-direction: column;
  gap: 20px;
}

.category-item {
  background: #252525;
  border-radius: 10px;
  border: 1px solid #333;
  overflow: hidden;
}

.category-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 20px 24px;
  background: #2a2a2a;
  border-bottom: 1px solid #333;
}

.category-info h4 {
  color: #fff;
  font-size: 1.2rem;
  margin: 0 0 4px 0;
  font-weight: 600;
}

.subcategory-count {
  color: #e6a34a;
  font-size: 0.9rem;
  font-weight: 500;
}

.category-actions,
.subcategory-actions {
  display: flex;
  gap: 8px;
}

.edit-btn,
.delete-btn,
.save-btn,
.cancel-btn {
  padding: 8px 12px;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  font-size: 0.9rem;
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  justify-content: center;
}

.edit-btn {
  background: #2196f3;
  color: white;
}

.edit-btn:hover {
  background: #1976d2;
}

.delete-btn {
  background: #ff4444;
  color: white;
}

.delete-btn:hover {
  background: #ff3333;
}

.save-btn {
  background: #e6a34a;
  color: #000;
}

.save-btn:hover {
  background: #00e67a;
}

.cancel-btn {
  background: #666;
  color: white;
}

.cancel-btn:hover {
  background: #555;
}

/* Subcategories */
.subcategories {
  padding: 20px 24px;
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.subcategory-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 12px 16px;
  background: #1a1a1a;
  border-radius: 8px;
  border: 1px solid #333;
}

.subcategory-name {
  color: #ccc;
  font-weight: 500;
}

/* Edit Forms */
.edit-form {
  display: flex;
  align-items: center;
  gap: 8px;
  flex: 1;
}

.edit-form input {
  flex: 1;
  padding: 8px 12px;
  background: #333;
  border: 1px solid #555;
  border-radius: 6px;
  color: #fff;
  font-size: 0.95rem;
  outline: none;
}

.edit-form input:focus {
  border-color: #e6a34a;
}

/* Add Subcategory Form */
.add-subcategory-form {
  display: flex;
  gap: 12px;
  align-items: center;
}

.add-subcategory-form select {
  padding: 12px 16px;
  background: #252525;
  border: 1px solid #444;
  border-radius: 8px;
  color: #fff;
  font-size: 1rem;
  outline: none;
  transition: all 0.3s ease;
  min-width: 200px;
}

.add-subcategory-form select:focus {
  border-color: #e6a34a;
  box-shadow: 0 0 0 2px rgba(230, 163, 74, 0.1);
}

.add-subcategory-form input {
  flex: 1;
  padding: 12px 16px;
  background: #252525;
  border: 1px solid #444;
  border-radius: 8px;
  color: #fff;
  font-size: 1rem;
  outline: none;
  transition: all 0.3s ease;
}

.add-subcategory-form input:focus {
  border-color: #e6a34a;
  box-shadow: 0 0 0 2px rgba(230, 163, 74, 0.1);
}

/* Responsive */
@media (max-width: 768px) {
  .add-category-form,
  .add-subcategory-form {
    flex-direction: column;
    align-items: stretch;
  }
  
  .category-header {
    flex-direction: column;
    align-items: flex-start;
    gap: 12px;
  }
  
  .category-actions {
    align-self: flex-end;
  }
  
  .subcategory-item {
    flex-direction: column;
    align-items: stretch;
    gap: 8px;
  }
  
  .subcategory-actions {
    align-self: flex-end;
  }
  
  .edit-form {
    flex-direction: column;
    align-items: stretch;
    gap: 8px;
  }
}

@media (max-width: 480px) {
  .section {
    padding: 16px;
  }
  
  .page-header h2 {
    font-size: 1.5rem;
  }
  
  .category-header {
    padding: 16px;
  }
  
  .subcategories {
    padding: 16px;
  }
}

```

–°–¥–µ–ª–∞–ª —Ç—ë–º–Ω—ã–π —Ñ–æ–Ω –¥–ª—è —Ä–∞–∑–¥–µ–ª–∞ ‚Äú–ö–∞—Ç–µ–≥–æ—Ä–∏–∏‚Äù:
- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —Ä–∞–∑–¥–µ–ª–∞ —Ç–µ–ø–µ—Ä—å —Å –≥–ª—É–±–æ–∫–∏–º —Ç—ë–º–Ω—ã–º —Ñ–æ–Ω–æ–º, —Ä–∞–º–∫–æ–π, —Å–∫—Ä—É–≥–ª–µ–Ω–∏–µ–º –∏ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–º–∏ –æ—Ç—Å—Ç—É–ø–∞–º–∏ ‚Äî –∫–æ–Ω—Ç–µ–Ω—Ç —á–∏—Ç–∞–µ—Ç—Å—è –ª—É—á—à–µ.
- –§–∞–π–ª: `src/pages/admin/CategoryManagement.css` (—Å—Ç–∏–ª–∏ –¥–ª—è `.category-management`).

---

**User**

–£–±–µ—Ä–∏ –±–ª–æ–∫ –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—é. –≠—Ç–æ —Ñ—É–Ω–∫—Ü–∏—è –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –≤ –º–æ–¥—É–ª–µ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ 

---

**Cursor**

```javascriptreact
import React, { useState } from 'react';
import { 
  FaPlus, 
  FaEdit, 
  FaTrash, 
  FaSave, 
  FaTimes,
  FaTags,
  FaList
} from 'react-icons/fa';
import { useAdminData } from '../../context/AdminDataContext';
import './CategoryManagement.css';

function CategoryManagement() {
  const { 
    data, 
    addCategory, 
    updateCategory, 
    deleteCategory,
    addSubcategory,
    updateSubcategory,
    deleteSubcategory
  } = useAdminData();

  const [newCategoryName, setNewCategoryName] = useState('');
  const [newCategorySubs, setNewCategorySubs] = useState([]);
  const [newSubInput, setNewSubInput] = useState('');
  const [editingCategory, setEditingCategory] = useState(null);
  const [editCategoryName, setEditCategoryName] = useState('');
  
  const [newSubcategoryName, setNewSubcategoryName] = useState('');
  const [editingSubcategory, setEditingSubcategory] = useState(null);
  const [editSubcategoryName, setEditSubcategoryName] = useState('');
  const [selectedCategoryForSub, setSelectedCategoryForSub] = useState('');

  // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
  const handleAddCategory = () => {
    if (newCategoryName.trim()) {
      const subs = (newCategorySubs || []).map(s => s.trim()).filter(Boolean);
      addCategory(newCategoryName.trim(), subs);
      setNewCategoryName('');
      setNewCategorySubs([]);
      setNewSubInput('');
    }
  };

  const handleAddNewSubToNewCategory = () => {
    const name = (newSubInput || '').trim();
    if (!name) return;
    if (newCategorySubs.includes(name)) return;
    setNewCategorySubs(prev => [...prev, name]);
    setNewSubInput('');
  };

  const handleRemoveNewSub = (idx) => {
    setNewCategorySubs(prev => prev.filter((_, i) => i !== idx));
  };

  // –ù–∞—á–∞—Ç—å —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
  const startEditCategory = (categoryName) => {
    setEditingCategory(categoryName);
    setEditCategoryName(categoryName);
  };

  // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
  const saveEditCategory = () => {
    if (editCategoryName.trim() && editCategoryName !== editingCategory) {
      updateCategory(editingCategory, editCategoryName.trim());
    }
    setEditingCategory(null);
    setEditCategoryName('');
  };

  // –û—Ç–º–µ–Ω–∏—Ç—å —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
  const cancelEditCategory = () => {
    setEditingCategory(null);
    setEditCategoryName('');
  };

  // –£–¥–∞–ª–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é
  const handleDeleteCategory = (categoryName) => {
    if (confirm(`–£–¥–∞–ª–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é "${categoryName}" –∏ –≤—Å–µ –µ—ë —Ç–æ–≤–∞—Ä—ã?`)) {
      deleteCategory(categoryName);
    }
  };

  // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–π –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏
  const handleAddSubcategory = () => {
    if (newSubcategoryName.trim() && selectedCategoryForSub) {
      addSubcategory(selectedCategoryForSub, newSubcategoryName.trim());
      setNewSubcategoryName('');
    }
  };

  // –ù–∞—á–∞—Ç—å —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏
  const startEditSubcategory = (categoryName, subcategoryName) => {
    setEditingSubcategory(`${categoryName}::${subcategoryName}`);
    setEditSubcategoryName(subcategoryName);
  };

  // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏
  const saveEditSubcategory = () => {
    const [categoryName, oldSubName] = editingSubcategory.split('::');
    if (editSubcategoryName.trim() && editSubcategoryName !== oldSubName) {
      updateSubcategory(categoryName, oldSubName, editSubcategoryName.trim());
    }
    setEditingSubcategory(null);
    setEditSubcategoryName('');
  };

  // –û—Ç–º–µ–Ω–∏—Ç—å —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏
  const cancelEditSubcategory = () => {
    setEditingSubcategory(null);
    setEditSubcategoryName('');
  };

  // –£–¥–∞–ª–∏—Ç—å –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—é
  const handleDeleteSubcategory = (categoryName, subcategoryName) => {
    if (confirm(`–£–¥–∞–ª–∏—Ç—å –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—é "${subcategoryName}" –∏ –≤—Å–µ –µ—ë —Ç–æ–≤–∞—Ä—ã?`)) {
      deleteSubcategory(categoryName, subcategoryName);
    }
  };

  return (
    <div className="category-management">
      <div className="page-header">
        <h2>
          <FaTags /> –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏
        </h2>
        <p>–î–æ–±–∞–≤–ª—è–π—Ç–µ, —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ –∏ —É–¥–∞–ª—è–π—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ç–æ–≤–∞—Ä–æ–≤</p>
      </div>

      <div className="category-content">
        {/* –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ (+ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏) */}
        <div className="section">
          <h3>
            <FaPlus /> –î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é
          </h3>
          <div className="add-category-form">
            <input
              type="text"
              placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –Ω–æ–≤–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏"
              value={newCategoryName}
              onChange={(e) => setNewCategoryName(e.target.value)}
              onKeyPress={(e) => e.key === 'Enter' && handleAddCategory()}
            />
            <button 
              onClick={handleAddCategory}
              disabled={!newCategoryName.trim()}
              className="add-btn"
            >
              <FaPlus /> –î–æ–±–∞–≤–∏—Ç—å
            </button>
          </div>

          {/* –ü–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ */}
          <div className="add-subcategory-form" style={{ marginTop: '12px' }}>
            <input
              type="text"
              placeholder="–ü–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è (–ø–æ –∂–µ–ª–∞–Ω–∏—é)"
              value={newSubInput}
              onChange={(e) => setNewSubInput(e.target.value)}
              onKeyPress={(e) => e.key === 'Enter' && handleAddNewSubToNewCategory()}
            />
            <button
              onClick={handleAddNewSubToNewCategory}
              className="add-btn"
              disabled={!newSubInput.trim()}
            >
              <FaPlus /> –î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—é
            </button>
          </div>

          {newCategorySubs.length > 0 && (
            <div className="subchips">
              {newCategorySubs.map((s, idx) => (
                <span key={idx} className="subchip">
                  {s}
                  <button type="button" onClick={() => handleRemoveNewSub(idx)} aria-label="–£–¥–∞–ª–∏—Ç—å">
                    √ó
                  </button>
                </span>
              ))}
            </div>
          )}
        </div>

        {/* –°–ø–∏—Å–æ–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–π */}
        <div className="section">
          <h3>
            <FaList /> –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ ({Object.keys(data.categoryStructure).length})
          </h3>
          <div className="categories-list">
            {Object.entries(data.categoryStructure).map(([categoryName, subcategories]) => (
              <div key={categoryName} className="category-item">
                <div className="category-header">
                  <div className="category-info">
                    {editingCategory === categoryName ? (
                      <div className="edit-form">
                        <input
                          type="text"
                          value={editCategoryName}
                          onChange={(e) => setEditCategoryName(e.target.value)}
                          onKeyPress={(e) => e.key === 'Enter' && saveEditCategory()}
                          autoFocus
                        />
                        <button onClick={saveEditCategory} className="save-btn">
                          <FaSave />
                        </button>
                        <button onClick={cancelEditCategory} className="cancel-btn">
                          <FaTimes />
                        </button>
                      </div>
                    ) : (
                      <>
                        <h4>{categoryName}</h4>
                        <span className="subcategory-count">
                          {subcategories.length} –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–π
                        </span>
                      </>
                    )}
                  </div>
                  
                  {editingCategory !== categoryName && (
                    <div className="category-actions">
                      <button 
                        onClick={() => startEditCategory(categoryName)}
                        className="edit-btn"
                        title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å"
                      >
                        <FaEdit />
                      </button>
                      <button 
                        onClick={() => handleDeleteCategory(categoryName)}
                        className="delete-btn"
                        title="–£–¥–∞–ª–∏—Ç—å"
                      >
                        <FaTrash />
                      </button>
                    </div>
                  )}
                </div>

                {/* –ü–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ */}
                <div className="subcategories">
                  {subcategories.map((subcategoryName) => (
                    <div key={subcategoryName} className="subcategory-item">
                      {editingSubcategory === `${categoryName}::${subcategoryName}` ? (
                        <div className="edit-form">
                          <input
                            type="text"
                            value={editSubcategoryName}
                            onChange={(e) => setEditSubcategoryName(e.target.value)}
                            onKeyPress={(e) => e.key === 'Enter' && saveEditSubcategory()}
                            autoFocus
                          />
                          <button onClick={saveEditSubcategory} className="save-btn">
                            <FaSave />
                          </button>
                          <button onClick={cancelEditSubcategory} className="cancel-btn">
                            <FaTimes />
                          </button>
                        </div>
                      ) : (
                        <>
                          <span className="subcategory-name">{subcategoryName}</span>
                          <div className="subcategory-actions">
                            <button 
                              onClick={() => startEditSubcategory(categoryName, subcategoryName)}
                              className="edit-btn"
                              title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å"
                            >
                              <FaEdit />
                            </button>
                            <button 
                              onClick={() => handleDeleteSubcategory(categoryName, subcategoryName)}
                              className="delete-btn"
                              title="–£–¥–∞–ª–∏—Ç—å"
                            >
                              <FaTrash />
                            </button>
                          </div>
                        </>
                      )}
                    </div>
                  ))}
                </div>
              </div>
            ))}
          </div>
        </div>

        {/* –ë–ª–æ–∫ –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —É–±—Ä–∞–Ω –ø–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—é */}
      </div>
    </div>
  );
}

export default CategoryManagement;

```

```css
/* Category Management */
.category-management {
  max-width: 1200px;
  margin: 0 auto;
  background: #0f0f0f; /* –±–æ–ª–µ–µ —Ç—ë–º–Ω—ã–π —Ñ–æ–Ω —Ä–∞–∑–¥–µ–ª–∞ */
  border: 1px solid #222;
  border-radius: 16px;
  padding: 24px;
  box-shadow: 0 10px 30px rgba(0,0,0,0.25);
}

.page-header {
  margin-bottom: 32px;
}

.page-header h2 {
  display: flex;
  align-items: center;
  gap: 12px;
  font-size: 1.8rem;
  color: #ffffff;
  margin-bottom: 8px;
  font-weight: 600;
}

.page-header p {
  color: #ccc;
  font-size: 1.1rem;
  margin: 0;
}

.category-content {
  display: flex;
  flex-direction: column;
  gap: 32px;
}

/* Sections */
.section {
  background: #1a1a1a;
  border-radius: 12px;
  padding: 24px;
  border: 1px solid #333;
}

.section h3 {
  display: flex;
  align-items: center;
  gap: 8px;
  color: #e6a34a;
  font-size: 1.3rem;
  margin-bottom: 20px;
  font-weight: 600;
}

/* Add Category Form */
.add-category-form {
  display: flex;
  gap: 12px;
  align-items: center;
}

.subchips {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  margin-top: 10px;
}

.subchip {
  background: #1f1f1f;
  border: 1px solid #333;
  color: #ddd;
  padding: 6px 10px;
  border-radius: 999px;
  display: inline-flex;
  align-items: center;
  gap: 6px;
}

.subchip button {
  background: transparent;
  border: none;
  color: #aaa;
  cursor: pointer;
  line-height: 1;
  font-size: 14px;
}
.subchip button:hover { color: #fff; }

.add-category-form input {
  flex: 1;
  padding: 12px 16px;
  background: #252525;
  border: 1px solid #444;
  border-radius: 8px;
  color: #fff;
  font-size: 1rem;
  outline: none;
  transition: all 0.3s ease;
}

.add-category-form input:focus {
  border-color: #e6a34a;
  box-shadow: 0 0 0 2px rgba(230, 163, 74, 0.1);
}

.add-btn {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 12px 20px;
  background: #e6a34a;
  color: #000;
  border: none;
  border-radius: 8px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  font-size: 0.95rem;
}

.add-btn:hover:not(:disabled) {
  background: #00e67a;
  transform: translateY(-1px);
}

.add-btn:disabled {
  background: #666;
  color: #999;
  cursor: not-allowed;
  transform: none;
}

/* Categories List */
.categories-list {
  display: flex;
  flex-direction: column;
  gap: 20px;
}

.category-item {
  background: #252525;
  border-radius: 10px;
  border: 1px solid #333;
  overflow: hidden;
}

.category-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 20px 24px;
  background: #2a2a2a;
  border-bottom: 1px solid #333;
}

.category-info h4 {
  color: #fff;
  font-size: 1.2rem;
  margin: 0 0 4px 0;
  font-weight: 600;
}

.subcategory-count {
  color: #e6a34a;
  font-size: 0.9rem;
  font-weight: 500;
}

.category-actions,
.subcategory-actions {
  display: flex;
  gap: 8px;
}

.edit-btn,
.delete-btn,
.save-btn,
.cancel-btn {
  padding: 8px 12px;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  font-size: 0.9rem;
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  justify-content: center;
}

.edit-btn {
  background: #2196f3;
  color: white;
}

.edit-btn:hover {
  background: #1976d2;
}

.delete-btn {
  background: #ff4444;
  color: white;
}

.delete-btn:hover {
  background: #ff3333;
}

.save-btn {
  background: #e6a34a;
  color: #000;
}

.save-btn:hover {
  background: #00e67a;
}

.cancel-btn {
  background: #666;
  color: white;
}

.cancel-btn:hover {
  background: #555;
}

/* Subcategories */
.subcategories {
  padding: 20px 24px;
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.subcategory-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 12px 16px;
  background: #1a1a1a;
  border-radius: 8px;
  border: 1px solid #333;
}

.subcategory-name {
  color: #ccc;
  font-weight: 500;
}

/* Edit Forms */
.edit-form {
  display: flex;
  align-items: center;
  gap: 8px;
  flex: 1;
}

.edit-form input {
  flex: 1;
  padding: 8px 12px;
  background: #333;
  border: 1px solid #555;
  border-radius: 6px;
  color: #fff;
  font-size: 0.95rem;
  outline: none;
}

.edit-form input:focus {
  border-color: #e6a34a;
}

/* Add Subcategory Form */
.add-subcategory-form {
  display: flex;
  gap: 12px;
  align-items: center;
}

.add-subcategory-form select {
  padding: 12px 16px;
  background: #252525;
  border: 1px solid #444;
  border-radius: 8px;
  color: #fff;
  font-size: 1rem;
  outline: none;
  transition: all 0.3s ease;
  min-width: 200px;
}

.add-subcategory-form select:focus {
  border-color: #e6a34a;
  box-shadow: 0 0 0 2px rgba(230, 163, 74, 0.1);
}

.add-subcategory-form input {
  flex: 1;
  padding: 12px 16px;
  background: #252525;
  border: 1px solid #444;
  border-radius: 8px;
  color: #fff;
  font-size: 1rem;
  outline: none;
  transition: all 0.3s ease;
}

.add-subcategory-form input:focus {
  border-color: #e6a34a;
  box-shadow: 0 0 0 2px rgba(230, 163, 74, 0.1);
}

/* Responsive */
@media (max-width: 768px) {
  .add-category-form,
  .add-subcategory-form {
    flex-direction: column;
    align-items: stretch;
  }
  
  .category-header {
    flex-direction: column;
    align-items: flex-start;
    gap: 12px;
  }
  
  .category-actions {
    align-self: flex-end;
  }
  
  .subcategory-item {
    flex-direction: column;
    align-items: stretch;
    gap: 8px;
  }
  
  .subcategory-actions {
    align-self: flex-end;
  }
  
  .edit-form {
    flex-direction: column;
    align-items: stretch;
    gap: 8px;
  }
}

@media (max-width: 480px) {
  .section {
    padding: 16px;
  }
  
  .page-header h2 {
    font-size: 1.5rem;
  }
  
  .category-header {
    padding: 16px;
  }
  
  .subcategories {
    padding: 16px;
  }
}

```

–°–¥–µ–ª–∞–ª –ø–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—é:
- –£–±—Ä–∞–ª –æ—Ç–¥–µ–ª—å–Ω—ã–π –±–ª–æ–∫ ‚Äú–î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—é‚Äù.
- –¢–µ–ø–µ—Ä—å –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –ø—Ä—è–º–æ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏: –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–π —Å–ø–∏—Å–∫–æ–º, —É–¥–∞–ª—è—Ç—å –ø–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º.
- –ü–æ ‚Äú–î–æ–±–∞–≤–∏—Ç—å‚Äù –∫–∞—Ç–µ–≥–æ—Ä–∏—è —Å–æ–∑–¥–∞—ë—Ç—Å—è —Å –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã–º –º–∞—Å—Å–∏–≤–æ–º –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–π (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `addCategory(name, subcategories)`).

–ò–∑–º–µ–Ω–µ–Ω–∏—è:
- `src/pages/admin/CategoryManagement.jsx`: —É–±—Ä–∞–Ω –Ω–∏–∂–Ω–∏–π –±–ª–æ–∫ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏, –¥–æ–±–∞–≤–ª–µ–Ω –≤–≤–æ–¥ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–π –≤ —Ñ–æ—Ä–º–µ —Å–æ–∑–¥–∞–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏.
- `src/pages/admin/CategoryManagement.css`: –¥–æ–±–∞–≤–ª–µ–Ω—ã —Å—Ç–∏–ª–∏ ‚Äú—á–∏–ø–æ–≤‚Äù –¥–ª—è –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–π.

---

**User**

–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã –Ω–∞ —Å–∞–π—Ç–µ –¥–æ–ª–∂–Ω—ã –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è —Ç–∞–∫ –∂–µ –∫–∞–∫ —Ç–æ–≤–∞—Ä—ã –∞–∫—Ü–∏–∏ 

---

**Cursor**

```javascriptreact
import React from 'react';
import { Link } from 'react-router-dom';
import { 
  FaTruck, 
  FaTools, 
  FaShieldAlt, 
  FaArrowRight,
  FaStar
} from 'react-icons/fa';
import { useAdminData } from '../context/AdminDataContext';
// wishlist removed
import { getMainImage, isImageUrl } from '../utils/imageHelpers';
import HeroVisual from '../components/HeroVisual';
import './Home.css';

function Home() {
  const HERO_IMAGE_URL = 'https://images.pexels.com/photos/162553/engine-displacement-piston-162553.jpeg?auto=compress&cs=tinysrgb&w=1600';
  const { products, popularProductIds } = useAdminData();
  
  // wishlist removed
  
  const features = [
    {
      icon: <FaTruck />,
      title: "–ë—ã—Å—Ç—Ä–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞",
      text: "–î–æ—Å—Ç–∞–≤–ª—è–µ–º –∑–∞–ø—á–∞—Å—Ç–∏ –ø–æ –≤—Å–µ–π –†–æ—Å—Å–∏–∏ –≤ –∫—Ä–∞—Ç—á–∞–π—à–∏–µ —Å—Ä–æ–∫–∏"
    },
    {
      icon: <FaTools />,
      title: "–ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –¥–µ—Ç–∞–ª–∏",
      text: "–¢–æ–ª—å–∫–æ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ –∏ —Å–µ—Ä—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—á–∞—Å—Ç–∏"
    },
    {
      icon: <FaShieldAlt />,
      title: "–ì–∞—Ä–∞–Ω—Ç–∏—è –∫–∞—á–µ—Å—Ç–≤–∞",
      text: "–ü–æ–ª–Ω–∞—è –≥–∞—Ä–∞–Ω—Ç–∏—è –Ω–∞ –≤—Å–µ —Ç–æ–≤–∞—Ä—ã –∏ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞"
    }
  ];

  // –ü–æ–ª—É—á–∞–µ–º –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –ø–æ ID
  const popularProducts = popularProductIds
    .map(id => products.find(product => product.id === id))
    .filter(product => product) // –£–±–∏—Ä–∞–µ–º undefined –µ—Å–ª–∏ —Ç–æ–≤–∞—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω
    .map(product => ({
      id: product.id,
      title: product.title,
      price: `${product.price.toLocaleString()} ‚ÇΩ`,
      icon: getMainImage(product)?.data || 'üì¶'
    }));

  // –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –º–∞—Å—Å–∏–≤ –¥–ª—è —Å–ø—Ä–∞–≤–∫–∏:
  const _originalPopularProducts = [
    {
      id: 11,
      title: "–ì—É—Å–µ–Ω–∏—Ü—ã –¥–ª—è –≤–µ–∑–¥–µ—Ö–æ–¥–∞",
      price: "45,000 ‚ÇΩ",
      icon: "üîó"
    },
    {
      id: 1,
      title: "–î–≤–∏–≥–∞—Ç–µ–ª—å 2.0L –¥–∏–∑–µ–ª—å–Ω—ã–π",
      price: "180,000 ‚ÇΩ",
      icon: "‚öôÔ∏è"
    },
    {
      id: 8,
      title: "–ö–æ—Ä–æ–±–∫–∞ –ø–µ—Ä–µ–¥–∞—á –º–µ—Ö–∞–Ω–∏—á–µ—Å–∫–∞—è",
      price: "95,000 ‚ÇΩ",
      icon: "üîß"
    },
    {
      id: 12,
      title: "–ê–º–æ—Ä—Ç–∏–∑–∞—Ç–æ—Ä –ø–µ—Ä–µ–¥–Ω–∏–π",
      price: "12,000 ‚ÇΩ",
      icon: "üõ†Ô∏è"
    },
    {
      id: 15,
      title: "–ê–∫–∫—É–º—É–ª—è—Ç–æ—Ä 12V 100Ah",
      price: "15,000 ‚ÇΩ",
      icon: "üîã"
    },
    {
      id: 17,
      title: "–°–∏–¥–µ–Ω—å–µ –≤–æ–¥–∏—Ç–µ–ª—è",
      price: "25,000 ‚ÇΩ",
      icon: "ü™ë"
    }
  ];

  return (
    <div>
      <section className="hero">
        <div className="container">
          <div className="hero-content">
            <div className="hero-text">
              <h1>–ó–∞–ø—á–∞—Å—Ç–∏ –¥–ª—è –≤–µ–∑–¥–µ—Ö–æ–¥–æ–≤</h1>
              <p>
                –ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∑–∞–ø—á–∞—Å—Ç–∏ –¥–ª—è –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ –≤–µ–∑–¥–µ—Ö–æ–¥–æ–≤. 
                –ë—ã—Å—Ç—Ä–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞ –ø–æ –≤—Å–µ–π –†–æ—Å—Å–∏–∏. –ì–∞—Ä–∞–Ω—Ç–∏—è –∫–∞—á–µ—Å—Ç–≤–∞ –Ω–∞ –≤—Å–µ —Ç–æ–≤–∞—Ä—ã.
              </p>
              <Link to="/catalog" className="cta-button">
                –ü–µ—Ä–µ–π—Ç–∏ –≤ –∫–∞—Ç–∞–ª–æ–≥
                <FaArrowRight />
              </Link>
            </div>
            <div className="hero-image">
              <div className="hero-placeholder">
                <HeroVisual />
              </div>
              <p>–ù–∞–¥—ë–∂–Ω—ã–µ –∑–∞–ø—á–∞—Å—Ç–∏ –¥–ª—è –≤–∞—à–µ–≥–æ –≤–µ–∑–¥–µ—Ö–æ–¥–∞</p>
            </div>
          </div>
        </div>
      </section>

      <section className="features">
        <div className="container">
          <h2 className="section-title">–ü–æ—á–µ–º—É –≤—ã–±–∏—Ä–∞—é—Ç –Ω–∞—Å</h2>
          <div className="features-grid">
            {features.map((feature, index) => (
              <div key={index} className="feature-card">
                <div className="feature-icon">{feature.icon}</div>
                <h3 className="feature-title">{feature.title}</h3>
                <p className="feature-text">{feature.text}</p>
              </div>
            ))}
          </div>
        </div>
      </section>

      <section className="products popular-products">
        <div className="container">
          <h2 className="section-title">–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã</h2>

          {popularProducts.length === 0 ? (
            <div
              style={{
                display: 'flex',
                alignItems: 'center',
                justifyContent: 'center',
                padding: '2rem',
                borderRadius: '16px',
                border: '1px solid rgba(255,255,255,0.1)',
                background: 'linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.02))',
                boxShadow: '0 10px 30px rgba(0,0,0,0.2)',
                textAlign: 'center'
              }}
            >
              <div>
                <div style={{ fontSize: '2.2rem', color: '#ffd166', marginBottom: '0.5rem' }}>
                  <FaStar style={{ verticalAlign: 'middle' }} />
                </div>
                <h3 style={{ margin: '0 0 0.5rem' }}>–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã —Å–∫–æ—Ä–æ –ø–æ—è–≤—è—Ç—Å—è</h3>
                <p style={{ opacity: 0.85, margin: '0 0 1rem' }}>
                  –°–µ–π—á–∞—Å –º—ã —Å–æ–±–∏—Ä–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ –ø–æ–∫—É–ø–∫–∞–º. –í –∫–∞—Ç–∞–ª–æ–≥–µ —É–∂–µ –º–Ω–æ–≥–æ –æ—Ç–ª–∏—á–Ω—ã—Ö –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π.
                </p>
                <Link to="/catalog" className="cta-button">
                  –ü–µ—Ä–µ–π—Ç–∏ –≤ –∫–∞—Ç–∞–ª–æ–≥ <FaArrowRight />
                </Link>
              </div>
            </div>
          ) : (
            <div className="promotions-grid">
              {popularProducts.map((product) => (
                <Link to={`/product/${product.id}`} key={product.id} className="promotion-card">
                  <div className="promo-header">
                    <div className="promo-image-small">
                      {(() => {
                        const productData = products.find(p => p.id === product.id);
                        if (!productData) return <span className="promo-icon">{product.icon}</span>;
                        const mainImage = getMainImage(productData);
                        if (mainImage?.data) {
                          if (
                            typeof mainImage.data === 'string' &&
                            (mainImage.data.startsWith('data:image') || isImageUrl(mainImage.data))
                          ) {
                            return (
                              <img
                                src={mainImage.data}
                                alt={product.title}
                                className="product-image-img"
                                style={{ borderRadius: '8px' }}
                              />
                            );
                          }
                          return <span className="promo-icon">{mainImage.data}</span>;
                        }
                        return <span className="promo-icon">{product.icon}</span>;
                      })()}
                    </div>
                  </div>
                  <div className="promo-info">
                    <h3>{product.title}</h3>
                    <div className="min-purchase">–¶–µ–Ω–∞: {product.price}</div>
                    <div className="promo-link">
                      –ü–æ–¥—Ä–æ–±–Ω–µ–µ <FaArrowRight />
                    </div>
                  </div>
                </Link>
              ))}
            </div>
          )}
        </div>
      </section>
    </div>
  );
}

export default Home;

```

```css
.popular-products .promotions-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  gap: 2rem;
}

.popular-products .promotion-card {
  background: rgba(40, 40, 40, 0.8);
  border: 1px solid rgba(230, 163, 74, 0.3);
  border-radius: 15px;
  padding: 1.5rem;
  transition: all 0.3s ease;
  text-decoration: none;
  color: inherit;
}

.popular-products .promotion-card:hover {
  border-color: #e6a34a;
  background: rgba(230, 163, 74, 0.1);
  transform: translateY(-3px);
  box-shadow: 0 10px 25px rgba(230, 163, 74, 0.2);
}

.popular-products .promo-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 1rem;
}

.popular-products .promo-image-small {
  width: 60px;
  height: 60px;
  background: linear-gradient(135deg, #1a1a1a 0%, #2a1a2a 100%);
  border-radius: 10px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.8rem;
  border: 2px solid rgba(230, 163, 74, 0.3);
  overflow: hidden;
}

.popular-products .promo-info h3 {
  font-size: 1.2rem;
  font-weight: 600;
  margin-bottom: 0.5rem;
  color: #ffffff;
}

.popular-products .min-purchase {
  color: #cccccc;
  font-size: 0.95rem;
  margin-bottom: 0.8rem;
}

.popular-products .promo-link {
  color: #e6a34a;
  display: inline-flex;
  align-items: center;
  gap: 0.3rem;
}


```

–°–¥–µ–ª–∞–ª –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤ –≤ —Å—Ç–∏–ª–µ –∫–∞—Ä—Ç–æ—á–µ–∫ –∞–∫—Ü–∏–π:
- –ë–ª–æ–∫ ‚Äú–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã‚Äù –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–∞–∫—É—é –∂–µ —Å–µ—Ç–∫—É –∏ –∫–∞—Ä—Ç–æ—á–∫–∏, –∫–∞–∫ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –∞–∫—Ü–∏–π: —Ç–µ–º–Ω—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏, –ø–æ–¥—Å–≤–µ—Ç–∫–∞ –ø—Ä–∏ —Ö–æ–≤–µ—Ä–µ, –º–∏–Ω–∏-–ø—Ä–µ–≤—å—é, –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∏ —Å—Ç—Ä–æ–∫–∞ —Å —Ü–µ–Ω–æ–π, —Å—Å—ã–ª–∫–∞ ‚Äú–ü–æ–¥—Ä–æ–±–Ω–µ–µ‚Äù.
- –ï—Å–ª–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –µ—Å—Ç—å, –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–µ–≤—å—é; –∏–Ω–∞—á–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –∏–∫–æ–Ω–∫–∞.

–ò–∑–º–µ–Ω–µ–Ω–∏—è:
- `src/pages/Home.jsx`: –∑–∞–º–µ–Ω—ë–Ω —Ä–µ–Ω–¥–µ—Ä –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤ –Ω–∞ —Ä–∞–∑–º–µ—Ç–∫—É –∫–∞—Ä—Ç–æ—á–µ–∫ –∞–∫—Ü–∏–π, –ø–æ–¥–∫–ª—é—á–µ–Ω `Home.css`.
- `src/pages/Home.css`: –¥–æ–±–∞–≤–ª–µ–Ω—ã —Å—Ç–∏–ª–∏ –∫–∞—Ä—Ç–æ—á–µ–∫ –∏ —Å–µ—Ç–∫–∏ –¥–ª—è –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤, –≤ –¥—É—Ö–µ `Promotions.css`.

---

**User**

–ö–æ–≥–¥–∞ –∫–ª–∏–µ–Ω—Ç –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –≤ —Ä–∞–∑–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏–ª–∏ –≤ –∫–æ—Ä–∑–∏–Ω—É –∏–ª–∏ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç —Ç–æ–≤–∞—Ä, —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥–Ω–∏–º–∞–ª–∞—Å—å –Ω–∞–≤–µ—Ä—Ö 

---

**Cursor**

```javascriptreact
import React, { useState, useEffect } from 'react';
import { Outlet, Link, useLocation, useNavigate } from 'react-router-dom';
import { 
  FaTruck, 
  FaPhone, 
  FaEnvelope, 
  FaMapMarkerAlt,
  FaShoppingCart,
  FaSearch,
  FaBars
} from 'react-icons/fa';
import { useCart } from './context/CartContext';
import { useAdminData } from './context/AdminDataContext';
// removed wishlist import
import SearchModal from './components/SearchModal';
import telegramSetup from './utils/telegramSetup';
import debugOrders from './utils/debugOrders';
import './App.css';

function App() {
  const location = useLocation();
  const navigate = useNavigate();
  const { getCartItemsCount } = useCart();
  const { aboutContent } = useAdminData();
  // wishlist removed
  const [isSearchModalOpen, setIsSearchModalOpen] = useState(false);
  const [contactsActive, setContactsActive] = useState(false);
  
  useEffect(() => {
    // –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º, –≤ –∑–æ–Ω–µ –≤–∏–¥–∏–º–æ—Å—Ç–∏ –ª–∏ –±–ª–æ–∫ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ 
    if (!location.pathname.startsWith('/about')) {
      setContactsActive(false);
      return;
    }
    const el = document.getElementById('contacts');
    if (!el) {
      setContactsActive(false);
      return;
    }
    const obs = new IntersectionObserver(
      (entries) => {
        entries.forEach((en) => {
          setContactsActive(en.isIntersecting);
          if (!en.isIntersecting && window.location.hash === '#contacts') {
            // –≤—ã—à–ª–∏ –∏–∑ –±–ª–æ–∫–∞ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ ‚Äî —É–±–∏—Ä–∞–µ–º hash —á–µ—Ä–µ–∑ —Ä–æ—É—Ç–µ—Ä
            try { navigate('/about', { replace: true }); } catch {}
          }
        });
      },
      { threshold: 0.4 }
    );
    obs.observe(el);

    const onHashChange = () => setContactsActive(window.location.hash === '#contacts');
    window.addEventListener('hashchange', onHashChange);
    onHashChange();
    return () => {
      try { obs.disconnect(); } catch {}
      window.removeEventListener('hashchange', onHashChange);
    };
  }, [location.pathname, navigate]);

  // –ê–≤—Ç–æ–ø—Ä–æ–∫—Ä—É—Ç–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –≤–≤–µ—Ä—Ö –ø—Ä–∏ —Å–º–µ–Ω–µ –º–∞—Ä—à—Ä—É—Ç–∞ (–∫—Ä–æ–º–µ —è–∫–æ—Ä–µ–π)
  useEffect(() => {
    if (location.hash) return; // –µ—Å–ª–∏ –ø–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —è–∫–æ—Ä—é, –Ω–µ —Å–∫—Ä–æ–ª–ª–∏–º –∫ –≤–µ—Ä—Ö—É
    try {
      window.scrollTo({ top: 0, behavior: 'smooth' });
    } catch {
      window.scrollTo(0, 0);
    }
  }, [location.pathname]);
  
  const footerData = aboutContent.footer || {
    aboutSection: {
      title: '–û –∫–æ–º–ø–∞–Ω–∏–∏',
      description: '–ú—ã —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º—Å—è –Ω–∞ –ø–æ—Å—Ç–∞–≤–∫–µ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∑–∞–ø—á–∞—Å—Ç–µ–π –¥–ª—è –≤–µ–∑–¥–µ—Ö–æ–¥–æ–≤ –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ –∏ –º–∞—Ä–æ–∫.'
    },
    contactsSection: {
      title: '–ö–æ–Ω—Ç–∞–∫—Ç—ã',
      phone: '+7 (800) 123-45-67',
      email: 'info@vezdehod-zapchasti.ru',
      address: '–≥. –ú–æ—Å–∫–≤–∞, —É–ª. –ü—Ä–∏–º–µ—Ä–Ω–∞—è, 123'
    },
    informationSection: {
      title: '–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è',
      links: [
        { text: '–î–æ—Å—Ç–∞–≤–∫–∞ –∏ –æ–ø–ª–∞—Ç–∞', url: '/about' },
        { text: '–ì–∞—Ä–∞–Ω—Ç–∏—è', url: '/about' },
        { text: '–í–æ–∑–≤—Ä–∞—Ç —Ç–æ–≤–∞—Ä–∞', url: '/about' },
        { text: '–ü–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏', url: '/about' }
      ]
    },
    copyright: '¬© 2024 –í–µ–∑–¥–µ—Ö–æ–¥–ó–∞–ø—á–∞—Å—Ç–∏. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.'
  };

  const isActiveLink = (path) => {
    if (path === '/' && location.pathname === '/') return true;
    if (path !== '/' && location.pathname.startsWith(path)) return true;
    return false;
  };

  const handleCartClick = () => {
    navigate('/cart');
  };

  const handleSearchClick = () => {
    setIsSearchModalOpen(true);
  };

  const closeSearchModal = () => {
    setIsSearchModalOpen(false);
  };

  // wishlist removed

  return (
    <div className="app">
      <header className="header">
        <div className="container">
          <div className="header-content">
            <Link to="/" className="logo">
              <FaTruck />
              –í–µ–∑–¥–µ—Ö–æ–¥–ó–∞–ø—á–∞—Å—Ç–∏
            </Link>
            <nav className="nav">
              <Link 
                to="/" 
                className={`nav-link ${isActiveLink('/') ? 'active' : ''}`}
              >
                –ì–ª–∞–≤–Ω–∞—è
              </Link>
              <Link 
                to="/catalog" 
                className={`nav-link ${isActiveLink('/catalog') ? 'active' : ''}`}
              >
                –ö–∞—Ç–∞–ª–æ–≥
              </Link>
              <Link 
                to="/promotions" 
                className={`nav-link ${isActiveLink('/promotions') ? 'active' : ''}`}
              >
                –ê–∫—Ü–∏–∏
              </Link>
              <Link 
                to="/about" 
                className={`nav-link ${location.pathname.startsWith('/about') && !contactsActive && location.hash !== '#contacts' ? 'active' : ''}`}
                onClick={(e)=>{
                  e.preventDefault();
                  setContactsActive(false);
                  if (location.pathname.startsWith('/about')) {
                    navigate('/about', { replace: true });
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                  } else {
                    navigate('/about');
                    setTimeout(()=> window.scrollTo({ top: 0, behavior: 'smooth' }), 50);
                  }
                }}
              >
                –û –∫–æ–º–ø–∞–Ω–∏–∏
              </Link>
              <Link
                to="/about#contacts"
                className={`nav-link ${location.pathname.startsWith('/about') && (contactsActive || location.hash === '#contacts') ? 'active' : ''}`}
                onClick={(e) => {
                  e.preventDefault();
                  navigate('/about#contacts');
                  setTimeout(() => {
                    const el = document.getElementById('contacts');
                    if (el) el.scrollIntoView({ behavior: 'smooth' });
                  }, 50);
                }}
              >
                –ö–æ–Ω—Ç–∞–∫—Ç—ã
              </Link>
            </nav>
            <div className="header-actions">
              <button className="icon-button" onClick={handleSearchClick}>
                <FaSearch />
              </button>
              {/* wishlist button removed */}
              <button className="icon-button cart-button" onClick={handleCartClick}>
                <FaShoppingCart />
                {getCartItemsCount() > 0 && (
                  <span className="cart-count">{getCartItemsCount()}</span>
                )}
              </button>
              <button className="mobile-menu-button">
                <FaBars />
              </button>
            </div>
          </div>
        </div>
      </header>

      <main className="main-content">
        <Outlet />
      </main>

      <footer className="footer">
        <div className="container">
          <div className="footer-content">
            <div className="footer-section">
              <h3>{footerData.aboutSection.title}</h3>
              <p>{footerData.aboutSection.description}</p>
            </div>
            <div className="footer-section">
              <h3>{footerData.contactsSection.title}</h3>
              <a href={`tel:${footerData.contactsSection.phone.replace(/[^+\d]/g, '')}`}>
                <FaPhone /> {footerData.contactsSection.phone}
              </a>
              <a href={`mailto:${footerData.contactsSection.email}`}>
                <FaEnvelope /> {footerData.contactsSection.email}
              </a>
              <a href="/about#contacts" onClick={(e)=>{e.preventDefault(); navigate('/about#contacts'); setTimeout(()=>{ const el=document.getElementById('contacts'); if(el) el.scrollIntoView({behavior:'smooth'}); },50);}}>
                <FaMapMarkerAlt /> {footerData.contactsSection.address}
              </a>
            </div>
            <div className="footer-section">
              <h3>{footerData.informationSection.title}</h3>
              {footerData.informationSection.links.map((link, index) => (
                <Link key={index} to={link.url}>{link.text}</Link>
              ))}
            </div>
          </div>
          <div className="footer-bottom">
            <p>{footerData.copyright}</p>
          </div>
        </div>
      </footer>
      
      <SearchModal 
        isOpen={isSearchModalOpen} 
        onClose={closeSearchModal} 
      />
    </div>
  );
}

export default App;

```

–°–¥–µ–ª–∞–ª –∞–≤—Ç–æ–ø—Ä–æ–∫—Ä—É—Ç–∫—É –≤–≤–µ—Ä—Ö –ø—Ä–∏ —Å–º–µ–Ω–µ –º–∞—Ä—à—Ä—É—Ç–∞:
- –ü—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –º–µ–∂–¥—É —Ä–∞–∑–¥–µ–ª–∞–º–∏ (–∫–∞—Ç–∞–ª–æ–≥, –∫–∞—Ç–µ–≥–æ—Ä–∏—è/–ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è, –∫–æ—Ä–∑–∏–Ω–∞, —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Ç–æ–≤–∞—Ä–∞ –∏ —Ç.–¥.) –æ–∫–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–ª–∞–≤–Ω–æ —Å–∫—Ä–æ–ª–ª–∏—Ç—Å—è –∫ –Ω–∞—á–∞–ª—É.
- –ò—Å–∫–ª—é—á–µ–Ω–∏–µ: –ø–µ—Ä–µ—Ö–æ–¥ –ø–æ —è–∫–æ—Ä—é (–Ω–∞–ø—Ä–∏–º–µ—Ä, `/about#contacts`) ‚Äî –ø–ª–∞–≤–Ω—ã–π —Å–∫—Ä–æ–ª–ª –∫ —Å–µ–∫—Ü–∏–∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è.

–ò–∑–º–µ–Ω–µ–Ω–∏—è: `src/App.jsx` ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω —ç—Ñ—Ñ–µ–∫—Ç –Ω–∞ `location.pathname`, –∫–æ—Ç–æ—Ä—ã–π –≤—ã–ø–æ–ª–Ω—è–µ—Ç `window.scrollTo({ top: 0, behavior: 'smooth' })`.

---

**User**

–ò–∑–º–µ–Ω–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏ –Ω–∞ "–Æ–¢–û–†–°" 

---

**Cursor**

```javascriptreact
*** Begin Patch
*** Update File: src/App.jsx
@@
-            <Link to="/" className="logo">
+            <Link to="/" className="logo">
               <FaTruck />
-              –í–µ–∑–¥–µ—Ö–æ–¥–ó–∞–ø—á–∞—Å—Ç–∏
+              –Æ–¢–û–†–°
             </Link>
@@
-    copyright: '¬© 2024 –í–µ–∑–¥–µ—Ö–æ–¥–ó–∞–ø—á–∞—Å—Ç–∏. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.'
+    copyright: '¬© 2024 –Æ–¢–û–†–°. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.'
*** End Patch
```

```javascriptreact
import React, { useState, useEffect } from 'react';
import { Outlet, Link, useLocation, useNavigate } from 'react-router-dom';
import { 
  FaTruck, 
  FaPhone, 
  FaEnvelope, 
  FaMapMarkerAlt,
  FaShoppingCart,
  FaSearch,
  FaBars
} from 'react-icons/fa';
import { useCart } from './context/CartContext';
import { useAdminData } from './context/AdminDataContext';
// removed wishlist import
import SearchModal from './components/SearchModal';
import telegramSetup from './utils/telegramSetup';
import debugOrders from './utils/debugOrders';
import './App.css';

function App() {
  const location = useLocation();
  const navigate = useNavigate();
  const { getCartItemsCount } = useCart();
  const { aboutContent } = useAdminData();
  // wishlist removed
  const [isSearchModalOpen, setIsSearchModalOpen] = useState(false);
  const [contactsActive, setContactsActive] = useState(false);
  
  useEffect(() => {
    // –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º, –≤ –∑–æ–Ω–µ –≤–∏–¥–∏–º–æ—Å—Ç–∏ –ª–∏ –±–ª–æ–∫ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ 
    if (!location.pathname.startsWith('/about')) {
      setContactsActive(false);
      return;
    }
    const el = document.getElementById('contacts');
    if (!el) {
      setContactsActive(false);
      return;
    }
    const obs = new IntersectionObserver(
      (entries) => {
        entries.forEach((en) => {
          setContactsActive(en.isIntersecting);
          if (!en.isIntersecting && window.location.hash === '#contacts') {
            // –≤—ã—à–ª–∏ –∏–∑ –±–ª–æ–∫–∞ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ ‚Äî —É–±–∏—Ä–∞–µ–º hash —á–µ—Ä–µ–∑ —Ä–æ—É—Ç–µ—Ä
            try { navigate('/about', { replace: true }); } catch {}
          }
        });
      },
      { threshold: 0.4 }
    );
    obs.observe(el);

    const onHashChange = () => setContactsActive(window.location.hash === '#contacts');
    window.addEventListener('hashchange', onHashChange);
    onHashChange();
    return () => {
      try { obs.disconnect(); } catch {}
      window.removeEventListener('hashchange', onHashChange);
    };
  }, [location.pathname, navigate]);

  // –ê–≤—Ç–æ–ø—Ä–æ–∫—Ä—É—Ç–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –≤–≤–µ—Ä—Ö –ø—Ä–∏ —Å–º–µ–Ω–µ –º–∞—Ä—à—Ä—É—Ç–∞ (–∫—Ä–æ–º–µ —è–∫–æ—Ä–µ–π)
  useEffect(() => {
    if (location.hash) return; // –µ—Å–ª–∏ –ø–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —è–∫–æ—Ä—é, –Ω–µ —Å–∫—Ä–æ–ª–ª–∏–º –∫ –≤–µ—Ä—Ö—É
    try {
      window.scrollTo({ top: 0, behavior: 'smooth' });
    } catch {
      window.scrollTo(0, 0);
    }
  }, [location.pathname]);
  
  const footerData = aboutContent.footer || {
    aboutSection: {
      title: '–û –∫–æ–º–ø–∞–Ω–∏–∏',
      description: '–ú—ã —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º—Å—è –Ω–∞ –ø–æ—Å—Ç–∞–≤–∫–µ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∑–∞–ø—á–∞—Å—Ç–µ–π –¥–ª—è –≤–µ–∑–¥–µ—Ö–æ–¥–æ–≤ –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ –∏ –º–∞—Ä–æ–∫.'
    },
    contactsSection: {
      title: '–ö–æ–Ω—Ç–∞–∫—Ç—ã',
      phone: '+7 (800) 123-45-67',
      email: 'info@vezdehod-zapchasti.ru',
      address: '–≥. –ú–æ—Å–∫–≤–∞, —É–ª. –ü—Ä–∏–º–µ—Ä–Ω–∞—è, 123'
    },
    informationSection: {
      title: '–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è',
      links: [
        { text: '–î–æ—Å—Ç–∞–≤–∫–∞ –∏ –æ–ø–ª–∞—Ç–∞', url: '/about' },
        { text: '–ì–∞—Ä–∞–Ω—Ç–∏—è', url: '/about' },
        { text: '–í–æ–∑–≤—Ä–∞—Ç —Ç–æ–≤–∞—Ä–∞', url: '/about' },
        { text: '–ü–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏', url: '/about' }
      ]
    },
    copyright: '¬© 2024 –í–µ–∑–¥–µ—Ö–æ–¥–ó–∞–ø—á–∞—Å—Ç–∏. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.'
  };

  const isActiveLink = (path) => {
    if (path === '/' && location.pathname === '/') return true;
    if (path !== '/' && location.pathname.startsWith(path)) return true;
    return false;
  };

  const handleCartClick = () => {
    navigate('/cart');
  };

  const handleSearchClick = () => {
    setIsSearchModalOpen(true);
  };

  const closeSearchModal = () => {
    setIsSearchModalOpen(false);
  };

  // wishlist removed

  return (
    <div className="app">
      <header className="header">
        <div className="container">
          <div className="header-content">
            <Link to="/" className="logo">
              <FaTruck />
              –Æ–¢–û–†–°
            </Link>
            <nav className="nav">
              <Link 
                to="/" 
                className={`nav-link ${isActiveLink('/') ? 'active' : ''}`}
              >
                –ì–ª–∞–≤–Ω–∞—è
              </Link>
              <Link 
                to="/catalog" 
                className={`nav-link ${isActiveLink('/catalog') ? 'active' : ''}`}
              >
                –ö–∞—Ç–∞–ª–æ–≥
              </Link>
              <Link 
                to="/promotions" 
                className={`nav-link ${isActiveLink('/promotions') ? 'active' : ''}`}
              >
                –ê–∫—Ü–∏–∏
              </Link>
              <Link 
                to="/about" 
                className={`nav-link ${location.pathname.startsWith('/about') && !contactsActive && location.hash !== '#contacts' ? 'active' : ''}`}
                onClick={(e)=>{
                  e.preventDefault();
                  setContactsActive(false);
                  if (location.pathname.startsWith('/about')) {
                    navigate('/about', { replace: true });
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                  } else {
                    navigate('/about');
                    setTimeout(()=> window.scrollTo({ top: 0, behavior: 'smooth' }), 50);
                  }
                }}
              >
                –û –∫–æ–º–ø–∞–Ω–∏–∏
              </Link>
              <Link
                to="/about#contacts"
                className={`nav-link ${location.pathname.startsWith('/about') && (contactsActive || location.hash === '#contacts') ? 'active' : ''}`}
                onClick={(e) => {
                  e.preventDefault();
                  navigate('/about#contacts');
                  setTimeout(() => {
                    const el = document.getElementById('contacts');
                    if (el) el.scrollIntoView({ behavior: 'smooth' });
                  }, 50);
                }}
              >
                –ö–æ–Ω—Ç–∞–∫—Ç—ã
              </Link>
            </nav>
            <div className="header-actions">
              <button className="icon-button" onClick={handleSearchClick}>
                <FaSearch />
              </button>
              {/* wishlist button removed */}
              <button className="icon-button cart-button" onClick={handleCartClick}>
                <FaShoppingCart />
                {getCartItemsCount() > 0 && (
                  <span className="cart-count">{getCartItemsCount()}</span>
                )}
              </button>
              <button className="mobile-menu-button">
                <FaBars />
              </button>
            </div>
          </div>
        </div>
      </header>

      <main className="main-content">
        <Outlet />
      </main>

      <footer className="footer">
        <div className="container">
          <div className="footer-content">
            <div className="footer-section">
              <h3>{footerData.aboutSection.title}</h3>
              <p>{footerData.aboutSection.description}</p>
            </div>
            <div className="footer-section">
              <h3>{footerData.contactsSection.title}</h3>
              <a href={`tel:${footerData.contactsSection.phone.replace(/[^+\d]/g, '')}`}>
                <FaPhone /> {footerData.contactsSection.phone}
              </a>
              <a href={`mailto:${footerData.contactsSection.email}`}>
                <FaEnvelope /> {footerData.contactsSection.email}
              </a>
              <a href="/about#contacts" onClick={(e)=>{e.preventDefault(); navigate('/about#contacts'); setTimeout(()=>{ const el=document.getElementById('contacts'); if(el) el.scrollIntoView({behavior:'smooth'}); },50);}}>
                <FaMapMarkerAlt /> {footerData.contactsSection.address}
              </a>
            </div>
            <div className="footer-section">
              <h3>{footerData.informationSection.title}</h3>
              {footerData.informationSection.links.map((link, index) => (
                <Link key={index} to={link.url}>{link.text}</Link>
              ))}
            </div>
          </div>
          <div className="footer-bottom">
            <p>{footerData.copyright}</p>
          </div>
        </div>
      </footer>
      
      <SearchModal 
        isOpen={isSearchModalOpen} 
        onClose={closeSearchModal} 
      />
    </div>
  );
}

export default App;

```

```javascriptreact
import React, { useState, useEffect } from 'react';
import { Outlet, Link, useLocation, useNavigate } from 'react-router-dom';
import { 
  FaTruck, 
  FaPhone, 
  FaEnvelope, 
  FaMapMarkerAlt,
  FaShoppingCart,
  FaSearch,
  FaBars
} from 'react-icons/fa';
import { useCart } from './context/CartContext';
import { useAdminData } from './context/AdminDataContext';
// removed wishlist import
import SearchModal from './components/SearchModal';
import telegramSetup from './utils/telegramSetup';
import debugOrders from './utils/debugOrders';
import './App.css';

function App() {
  const location = useLocation();
  const navigate = useNavigate();
  const { getCartItemsCount } = useCart();
  const { aboutContent } = useAdminData();
  // wishlist removed
  const [isSearchModalOpen, setIsSearchModalOpen] = useState(false);
  const [contactsActive, setContactsActive] = useState(false);
  
  useEffect(() => {
    // –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º, –≤ –∑–æ–Ω–µ –≤–∏–¥–∏–º–æ—Å—Ç–∏ –ª–∏ –±–ª–æ–∫ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ 
    if (!location.pathname.startsWith('/about')) {
      setContactsActive(false);
      return;
    }
    const el = document.getElementById('contacts');
    if (!el) {
      setContactsActive(false);
      return;
    }
    const obs = new IntersectionObserver(
      (entries) => {
        entries.forEach((en) => {
          setContactsActive(en.isIntersecting);
          if (!en.isIntersecting && window.location.hash === '#contacts') {
            // –≤—ã—à–ª–∏ –∏–∑ –±–ª–æ–∫–∞ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ ‚Äî —É–±–∏—Ä–∞–µ–º hash —á–µ—Ä–µ–∑ —Ä–æ—É—Ç–µ—Ä
            try { navigate('/about', { replace: true }); } catch {}
          }
        });
      },
      { threshold: 0.4 }
    );
    obs.observe(el);

    const onHashChange = () => setContactsActive(window.location.hash === '#contacts');
    window.addEventListener('hashchange', onHashChange);
    onHashChange();
    return () => {
      try { obs.disconnect(); } catch {}
      window.removeEventListener('hashchange', onHashChange);
    };
  }, [location.pathname, navigate]);

  // –ê–≤—Ç–æ–ø—Ä–æ–∫—Ä—É—Ç–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –≤–≤–µ—Ä—Ö –ø—Ä–∏ —Å–º–µ–Ω–µ –º–∞—Ä—à—Ä—É—Ç–∞ (–∫—Ä–æ–º–µ —è–∫–æ—Ä–µ–π)
  useEffect(() => {
    if (location.hash) return; // –µ—Å–ª–∏ –ø–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —è–∫–æ—Ä—é, –Ω–µ —Å–∫—Ä–æ–ª–ª–∏–º –∫ –≤–µ—Ä—Ö—É
    try {
      window.scrollTo({ top: 0, behavior: 'smooth' });
    } catch {
      window.scrollTo(0, 0);
    }
  }, [location.pathname]);
  
  const footerData = aboutContent.footer || {
    aboutSection: {
      title: '–û –∫–æ–º–ø–∞–Ω–∏–∏',
      description: '–ú—ã —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º—Å—è –Ω–∞ –ø–æ—Å—Ç–∞–≤–∫–µ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∑–∞–ø—á–∞—Å—Ç–µ–π –¥–ª—è –≤–µ–∑–¥–µ—Ö–æ–¥–æ–≤ –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ –∏ –º–∞—Ä–æ–∫.'
    },
    contactsSection: {
      title: '–ö–æ–Ω—Ç–∞–∫—Ç—ã',
      phone: '+7 (800) 123-45-67',
      email: 'info@vezdehod-zapchasti.ru',
      address: '–≥. –ú–æ—Å–∫–≤–∞, —É–ª. –ü—Ä–∏–º–µ—Ä–Ω–∞—è, 123'
    },
    informationSection: {
      title: '–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è',
      links: [
        { text: '–î–æ—Å—Ç–∞–≤–∫–∞ –∏ –æ–ø–ª–∞—Ç–∞', url: '/about' },
        { text: '–ì–∞—Ä–∞–Ω—Ç–∏—è', url: '/about' },
        { text: '–í–æ–∑–≤—Ä–∞—Ç —Ç–æ–≤–∞—Ä–∞', url: '/about' },
        { text: '–ü–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏', url: '/about' }
      ]
    },
    copyright: '¬© 2024 –Æ–¢–û–†–°. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.'
  };

  const isActiveLink = (path) => {
    if (path === '/' && location.pathname === '/') return true;
    if (path !== '/' && location.pathname.startsWith(path)) return true;
    return false;
  };

  const handleCartClick = () => {
    navigate('/cart');
  };

  const handleSearchClick = () => {
    setIsSearchModalOpen(true);
  };

  const closeSearchModal = () => {
    setIsSearchModalOpen(false);
  };

  // wishlist removed

  return (
    <div className="app">
      <header className="header">
        <div className="container">
          <div className="header-content">
            <Link to="/" className="logo">
              <FaTruck />
              –Æ–¢–û–†–°
            </Link>
            <nav className="nav">
              <Link 
                to="/" 
                className={`nav-link ${isActiveLink('/') ? 'active' : ''}`}
              >
                –ì–ª–∞–≤–Ω–∞—è
              </Link>
              <Link 
                to="/catalog" 
                className={`nav-link ${isActiveLink('/catalog') ? 'active' : ''}`}
              >
                –ö–∞—Ç–∞–ª–æ–≥
              </Link>
              <Link 
                to="/promotions" 
                className={`nav-link ${isActiveLink('/promotions') ? 'active' : ''}`}
              >
                –ê–∫—Ü–∏–∏
              </Link>
              <Link 
                to="/about" 
                className={`nav-link ${location.pathname.startsWith('/about') && !contactsActive && location.hash !== '#contacts' ? 'active' : ''}`}
                onClick={(e)=>{
                  e.preventDefault();
                  setContactsActive(false);
                  if (location.pathname.startsWith('/about')) {
                    navigate('/about', { replace: true });
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                  } else {
                    navigate('/about');
                    setTimeout(()=> window.scrollTo({ top: 0, behavior: 'smooth' }), 50);
                  }
                }}
              >
                –û –∫–æ–º–ø–∞–Ω–∏–∏
              </Link>
              <Link
                to="/about#contacts"
                className={`nav-link ${location.pathname.startsWith('/about') && (contactsActive || location.hash === '#contacts') ? 'active' : ''}`}
                onClick={(e) => {
                  e.preventDefault();
                  navigate('/about#contacts');
                  setTimeout(() => {
                    const el = document.getElementById('contacts');
                    if (el) el.scrollIntoView({ behavior: 'smooth' });
                  }, 50);
                }}
              >
                –ö–æ–Ω—Ç–∞–∫—Ç—ã
              </Link>
            </nav>
            <div className="header-actions">
              <button className="icon-button" onClick={handleSearchClick}>
                <FaSearch />
              </button>
              {/* wishlist button removed */}
              <button className="icon-button cart-button" onClick={handleCartClick}>
                <FaShoppingCart />
                {getCartItemsCount() > 0 && (
                  <span className="cart-count">{getCartItemsCount()}</span>
                )}
              </button>
              <button className="mobile-menu-button">
                <FaBars />
              </button>
            </div>
          </div>
        </div>
      </header>

      <main className="main-content">
        <Outlet />
      </main>

      <footer className="footer">
        <div className="container">
          <div className="footer-content">
            <div className="footer-section">
              <h3>{footerData.aboutSection.title}</h3>
              <p>{footerData.aboutSection.description}</p>
            </div>
            <div className="footer-section">
              <h3>{footerData.contactsSection.title}</h3>
              <a href={`tel:${footerData.contactsSection.phone.replace(/[^+\d]/g, '')}`}>
                <FaPhone /> {footerData.contactsSection.phone}
              </a>
              <a href={`mailto:${footerData.contactsSection.email}`}>
                <FaEnvelope /> {footerData.contactsSection.email}
              </a>
              <a href="/about#contacts" onClick={(e)=>{e.preventDefault(); navigate('/about#contacts'); setTimeout(()=>{ const el=document.getElementById('contacts'); if(el) el.scrollIntoView({behavior:'smooth'}); },50);}}>
                <FaMapMarkerAlt /> {footerData.contactsSection.address}
              </a>
            </div>
            <div className="footer-section">
              <h3>{footerData.informationSection.title}</h3>
              {footerData.informationSection.links.map((link, index) => (
                <Link key={index} to={link.url}>{link.text}</Link>
              ))}
            </div>
          </div>
          <div className="footer-bottom">
            <p>{footerData.copyright}</p>
          </div>
        </div>
      </footer>
      
      <SearchModal 
        isOpen={isSearchModalOpen} 
        onClose={closeSearchModal} 
      />
    </div>
  );
}

export default App;

```

```javascriptreact
import React, { useState, useEffect } from 'react';
import { useNavigate, Link } from 'react-router-dom';
import { useAdminData } from '../../context/AdminDataContext';
import ProductManagement from './ProductManagement';
import CategoryManagement from './CategoryManagement';
import PromotionManagement from './PromotionManagement';
import ContentManagement from './ContentManagement';
import PopularProductsManagement from './PopularProductsManagement';
import OrderManagement from './OrderManagement';
import { migrateProductImages, getMainImage } from '../../utils/imageHelpers';
import { FaHome, FaBox, FaTags, FaUsers, FaChartBar, FaSignOutAlt, FaEdit, FaStar, FaShoppingCart } from 'react-icons/fa';
import './AdvancedAdminDashboard.css';

function AdvancedAdminDashboard() {
  const navigate = useNavigate();
  const { products, promotions } = useAdminData();
  const [activeSection, setActiveSection] = useState('overview');

  useEffect(() => {
    const isAuth = localStorage.getItem('adminAuth');
    if (!isAuth) {
      navigate('/admin');
    }
  }, [navigate]);

  const handleLogout = () => {
    localStorage.removeItem('adminAuth');
    navigate('/admin');
  };

  const menuItems = [
    { id: 'overview', label: '–û–±–∑–æ—Ä', icon: <FaChartBar /> },
    { id: 'products', label: '–¢–æ–≤–∞—Ä—ã', icon: <FaBox /> },
    { id: 'categories', label: '–ö–∞—Ç–µ–≥–æ—Ä–∏–∏', icon: <FaTags /> },
    { id: 'popular', label: '–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã', icon: <FaStar /> },
    { id: 'promotions', label: '–ê–∫—Ü–∏–∏', icon: <FaTags /> },
    { id: 'orders', label: '–ó–∞–∫–∞–∑—ã', icon: <FaShoppingCart /> },
    { id: 'content', label: '–ö–æ–Ω—Ç–µ–Ω—Ç', icon: <FaEdit /> }
  ];

  const renderOverview = () => (
    <div className="overview-section">
      <h2>–û–±–∑–æ—Ä —Å–∏—Å—Ç–µ–º—ã</h2>
      
      <div className="stats-grid">
        <div className="stat-card">
          <div className="stat-icon">üì¶</div>
          <div className="stat-content">
            <div className="stat-number">{products.length}</div>
            <div className="stat-label">–¢–æ–≤–∞—Ä–æ–≤</div>
          </div>
        </div>
        
        <div className="stat-card">
          <div className="stat-icon">üéØ</div>
          <div className="stat-content">
            <div className="stat-number">{promotions.length}</div>
            <div className="stat-label">–ê–∫—Ü–∏–π</div>
          </div>
        </div>
        
        <div className="stat-card">
          <div className="stat-icon">‚úÖ</div>
          <div className="stat-content">
            <div className="stat-number">{products.filter(p => p.available).length}</div>
            <div className="stat-label">–í –Ω–∞–ª–∏—á–∏–∏</div>
          </div>
        </div>
        
        <div className="stat-card">
          <div className="stat-icon">üí∞</div>
          <div className="stat-content">
            <div className="stat-number">{Math.round(products.reduce((sum, p) => sum + (p.price * (p.quantity || 0)), 0) / 1000)}–ö</div>
            <div className="stat-label">–û–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å —Å–∫–ª–∞–¥–∞</div>
          </div>
        </div>
      </div>

      <div className="recent-section">
        <h3>–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã</h3>
        <div className="product-list">
          {products && products.length > 0 ? products.slice(0, 5).map(product => (
            <div key={product.id} className="product-item">
              {(() => {
                const migratedProduct = migrateProductImages(product);
                const mainImage = getMainImage(migratedProduct);
                
                if (mainImage?.data) {
                  if (
                    typeof mainImage.data === 'string' &&
                    (mainImage.data.startsWith('data:image') || mainImage.data.startsWith('/uploads/') || mainImage.data.startsWith('http'))
                  ) {
                    return <img src={mainImage.data} alt={product.title} className="product-image-small" />;
                  }
                  return <span className="product-icon">{mainImage.data}</span>;
                }
                return <span className="product-icon">üì¶</span>;
              })()}
              <div className="product-info">
                <div className="product-name">{product.title}</div>
                <div className="product-price">{product.price.toLocaleString()} ‚ÇΩ</div>
                <div className="product-quantity">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ: {product.quantity || 0} —à—Ç.</div>
              </div>
              <div className={`product-status ${product.available ? 'available' : 'unavailable'}`}>
                {product.available ? '–í –Ω–∞–ª–∏—á–∏–∏' : '–ù–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏'}
              </div>
            </div>
          )) : (
            <div className="no-products">
              <p>–¢–æ–≤–∞—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã. <Link to="#" onClick={() => setActiveSection('products')}>–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä—ã</Link></p>
            </div>
          )}
        </div>
      </div>
    </div>
  );

  const renderContent = () => {
    switch (activeSection) {
      case 'overview':
        return renderOverview();
      case 'products':
        return <ProductManagement />;
      case 'categories':
        return <CategoryManagement />;
      case 'popular':
        return <PopularProductsManagement />;
      case 'promotions':
        return <PromotionManagement />;
      case 'orders':
        return <OrderManagement />;
      case 'content':
        return <ContentManagement />;
      default:
        return renderOverview();
    }
  };

  return (
    <div className="admin-dashboard">
      <aside className="admin-sidebar">
        <div className="sidebar-header">
          <h2>–Æ–¢–û–†–°</h2>
          <p>–ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å</p>
        </div>
        
        <nav className="sidebar-nav">
          {menuItems.map(item => (
            <button
              key={item.id}
              className={`nav-item ${activeSection === item.id ? 'active' : ''}`}
              onClick={() => setActiveSection(item.id)}
            >
              {item.icon}
              <span>{item.label}</span>
            </button>
          ))}
        </nav>
        
        <div className="sidebar-footer">
          <Link to="/" className="nav-item">
            <FaHome />
            <span>–ù–∞ —Å–∞–π—Ç</span>
          </Link>
          <button onClick={handleLogout} className="nav-item logout">
            <FaSignOutAlt />
            <span>–í—ã–π—Ç–∏</span>
          </button>
        </div>
      </aside>

      <main className="admin-main">
        <header className="admin-header">
          <h1>
            {menuItems.find(item => item.id === activeSection)?.label || '–û–±–∑–æ—Ä'}
          </h1>
          <div className="header-actions">
            <span>–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</span>
          </div>
        </header>
        
        <div className="admin-content">
          {renderContent()}
        </div>
      </main>
    </div>
  );
}

export default AdvancedAdminDashboard;
```

–ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–ª –±—Ä–µ–Ω–¥ –Ω–∞ —Å–∞–π—Ç–µ:
- –®–∞–ø–∫–∞: –ª–æ–≥–æ—Ç–∏–ø —Ç–µ–ø–µ—Ä—å –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç ‚Äú–Æ–¢–û–†–°‚Äù.
- –§—É—Ç–µ—Ä: ‚Äú¬© 2024 –Æ–¢–û–†–°. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.‚Äù
- –ê–¥–º–∏–Ω–∫–∞: –∑–∞–≥–æ–ª–æ–≤–æ–∫ –≤ –ª–µ–≤–æ–π –ø–∞–Ω–µ–ª–∏ —Ç–∞–∫–∂–µ ‚Äú–Æ–¢–û–†–°‚Äù.

–§–∞–π–ª—ã:
- `src/App.jsx` ‚Äî –ª–æ–≥–æ—Ç–∏–ø –∏ –∫–æ–ø–∏—Ä–∞–π—Ç.
- `src/pages/admin/AdvancedAdminDashboard.jsx` ‚Äî –∑–∞–≥–æ–ª–æ–≤–æ–∫ –ø–∞–Ω–µ–ª–∏.

